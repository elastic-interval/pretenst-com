(window.webpackJsonppretenst=window.webpackJsonppretenst||[]).push([[0],{255:function(e,t,n){e.exports=n(610)},566:function(e,t){},568:function(e,t){},608:function(e,t,n){},609:function(e,t,n){},610:function(e,t,n){"use strict";n.r(t);var a,r,i=n(110),c=n.n(i),s=n(242),o=n(0),l=n(79),u=n(46),f=n(36),d=n(25),h=n(26);!function(e){e[e.Busy=0]="Busy",e[e.Growing=1]="Growing",e[e.Shaping=2]="Shaping",e[e.Slack=3]="Slack",e[e.Realizing=4]="Realizing",e[e.Realized=6]="Realized"}(a||(a={})),function(e){e[e.Gravity=0]="Gravity",e[e.Drag=1]="Drag",e[e.PretenstFactor=2]="PretenstFactor",e[e.IterationsPerFrame=3]="IterationsPerFrame",e[e.IntervalCountdown=4]="IntervalCountdown",e[e.PretenstCountdown=5]="PretenstCountdown",e[e.FacePullEndZone=6]="FacePullEndZone",e[e.FacePullOrientationForce=7]="FacePullOrientationForce",e[e.SlackThreshold=8]="SlackThreshold",e[e.ShapingPretenstFactor=9]="ShapingPretenstFactor",e[e.ShapingStiffnessFactor=10]="ShapingStiffnessFactor",e[e.ShapingDrag=11]="ShapingDrag",e[e.MaxStrain=12]="MaxStrain",e[e.VisualStrain=13]="VisualStrain",e[e.NexusPushLength=20]="NexusPushLength",e[e.ColumnPushLength=21]="ColumnPushLength",e[e.TriangleLength=22]="TriangleLength",e[e.RingLength=23]="RingLength",e[e.NexusCrossLength=24]="NexusCrossLength",e[e.ColumnCrossLength=25]="ColumnCrossLength",e[e.BowMidLength=26]="BowMidLength",e[e.BowEndLength=27]="BowEndLength",e[e.PushOverPull=30]="PushOverPull",e[e.PushRadiusFactor=31]="PushRadiusFactor",e[e.PullRadiusFactor=32]="PullRadiusFactor",e[e.MaxStiffness=33]="MaxStiffness"}(r||(r={}));var m,p=60,v=Object.keys(r).filter((function(e){return isNaN(parseInt(e,10))})).map((function(e){return r[e]}));function g(e){switch(e){case m.NexusPush:return"Nex Push";case m.ColumnPush:return"Col Push";case m.Triangle:return"Tri";case m.Ring:return"Ring";case m.NexusCross:return"Nex Cross";case m.ColumnCross:return"Col Cross";case m.BowMid:return"Bow Mid";case m.BowEnd:return"Bow End";case m.FacePull:return"Face Pull"}}!function(e){e[e.NexusPush=0]="NexusPush",e[e.ColumnPush=1]="ColumnPush",e[e.Triangle=2]="Triangle",e[e.Ring=3]="Ring",e[e.NexusCross=4]="NexusCross",e[e.ColumnCross=5]="ColumnCross",e[e.BowMid=6]="BowMid",e[e.BowEnd=7]="BowEnd",e[e.FacePull=8]="FacePull"}(m||(m={}));var b,E,y,S=Object.keys(m).filter((function(e){return e.length>1&&m[e]!==m.FacePull})).map((function(e){return m[e]}));function P(e){return e===m.ColumnPush||e===m.NexusPush}function w(e){var t=r.NexusPushLength;if(!(e<t||e>r.BowEndLength))return m[m[e-t]]}function k(e){return r[r[e+r.NexusPushLength]]}!function(e){e[e.Rest=0]="Rest",e[e.Forward=1]="Forward",e[e.TurnLeft=2]="TurnLeft",e[e.TurnRight=3]="TurnRight",e[e.Reverse=4]="Reverse"}(b||(b={})),function(e){e[e.Middle=0]="Middle",e[e.RightSide=1]="RightSide",e[e.LeftSide=2]="LeftSide"}(E||(E={})),function(e){e[e.Frozen=0]="Frozen",e[e.Sticky=1]="Sticky",e[e.Slippery=2]="Slippery",e[e.Bouncy=3]="Bouncy"}(y||(y={}));var N,O,x,j,C=n(12),M=n(3),F=1.61803398875,V=Math.sqrt(2);function T(e){var t=new M.Vector3;switch(e){case N.XP:return t.setX(1);case N.XN:return t.setX(-1);case N.YP:return t.setY(1);case N.YN:return t.setY(-1);case N.ZP:return t.setZ(1);case N.ZN:return t.setZ(-1);default:return t}}function L(e,t){return T(e).multiplyScalar(V/2).addScaledVector(T(t),V/2/F)}!function(e){e[e.XP=0]="XP",e[e.XN=1]="XN",e[e.YP=2]="YP",e[e.YN=3]="YN",e[e.ZP=4]="ZP",e[e.ZN=5]="ZN"}(N||(N={})),function(e){e[e.XPA=0]="XPA",e[e.XPO=1]="XPO",e[e.XNA=2]="XNA",e[e.XNO=3]="XNO",e[e.YPA=4]="YPA",e[e.YPO=5]="YPO",e[e.YNA=6]="YNA",e[e.YNO=7]="YNO",e[e.ZPA=8]="ZPA",e[e.ZPO=9]="ZPO",e[e.ZNA=10]="ZNA",e[e.ZNO=11]="ZNO"}(O||(O={})),function(e){e[e.NNN=0]="NNN",e[e.PNN=1]="PNN",e[e.NPN=2]="NPN",e[e.NNP=3]="NNP",e[e.NPP=4]="NPP",e[e.PNP=5]="PNP",e[e.PPN=6]="PPN",e[e.PPP=7]="PPP"}(x||(x={})),function(e){e[e.NN=0]="NN",e[e.PN=1]="PN",e[e.NP=2]="NP",e[e.PP=3]="PP"}(j||(j={}));var A=[{alpha:L(N.ZN,N.XP),omega:L(N.ZP,N.XP)},{alpha:L(N.ZN,N.XN),omega:L(N.ZP,N.XN)},{alpha:L(N.XN,N.YP),omega:L(N.XP,N.YP)},{alpha:L(N.XN,N.YN),omega:L(N.XP,N.YN)},{alpha:L(N.YN,N.ZP),omega:L(N.YP,N.ZP)},{alpha:L(N.YN,N.ZN),omega:L(N.YP,N.ZN)}],R=[{name:x.NNN,opposite:x.PPP,negative:!0,ring:j.NN,pushEnds:[O.YNA,O.XNA,O.ZNA],ringMember:[j.NP,j.PN,j.PP]},{name:x.PNN,opposite:x.NPP,negative:!1,ring:j.PP,pushEnds:[O.XNA,O.YPA,O.ZNO],ringMember:[j.PN,j.NN,j.NP]},{name:x.NPN,opposite:x.PNP,negative:!1,ring:j.PN,pushEnds:[O.XNO,O.YNA,O.ZPA],ringMember:[j.PP,j.NP,j.NN]},{name:x.NNP,opposite:x.PPN,negative:!1,ring:j.NP,pushEnds:[O.XPA,O.YNO,O.ZNA],ringMember:[j.NN,j.PN,j.PP]},{name:x.NPP,opposite:x.PNN,negative:!0,ring:j.PP,pushEnds:[O.YNO,O.XPO,O.ZPA],ringMember:[j.PN,j.NP,j.NN]},{name:x.PNP,opposite:x.NPN,negative:!0,ring:j.PN,pushEnds:[O.YPO,O.XPA,O.ZNO],ringMember:[j.PP,j.NN,j.NP]},{name:x.PPN,opposite:x.NNP,negative:!0,ring:j.NP,pushEnds:[O.YPA,O.XNO,O.ZPO],ringMember:[j.NN,j.PP,j.PN]},{name:x.PPP,opposite:x.NNN,negative:!1,ring:j.NN,pushEnds:[O.XPO,O.YPO,O.ZPO],ringMember:[j.NP,j.PP,j.PN]}];function I(e){return R[e].opposite}function D(e){return e||{_:100}}function _(e){return e._/100}function B(e){return{_:100*e}}function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var U="ABCDabcd";function Y(e){return U.indexOf(e)>=0}var G="0123456789";function X(e){return G.indexOf(e)>=0}function $(e,t,n){switch(t){case"A":e.A=n;break;case"B":e.B=n;break;case"C":e.C=n;break;case"D":e.D=n;break;case"b":e.b=n;break;case"c":e.c=n;break;case"d":e.d=n;break;case"a":e.a=n;break;default:throw new Error("Unexpected direction directionChar: "+t)}}function Q(e,t,n){switch(t){case"A":e.MA=n;break;case"B":e.MB=n;break;case"C":e.MC=n;break;case"D":e.MD=n;break;case"a":e.Ma=n;break;case"b":e.Mb=n;break;case"c":e.Mc=n;break;case"d":e.Md=n;break;default:throw new Error("Unexpected direction directionChar: "+t)}}function H(e,t,n){function a(e){if(!e.match(/^\d+$/))throw new Error("Not a number: ".concat(e));return parseInt(e,10)}try{if(!n||0===n.length)return void e("No code to parse");var r=function e(t){function n(e,t){var n=e.indexOf(","),a=n>=0;if("("!==e.charAt(0))return a?{content:e.substring(0,n),skip:n}:{content:e,skip:e.length};var r=function(e){if("("!==e.charAt(0))throw new Error('Code must start with "(": '.concat(e," ").concat(e.charAt(0)));for(var t=0,n=0;n<e.length;n++){var a=e.charAt(n);if("("===a)t++;else if(")"===a&&0===--t)return n}throw new Error("No matching end bracket: |".concat(e,"|"))}(e);return{content:t?e.substring(1,r):e.substring(0,r+1),skip:r+1}}var r=n(t,!0).content,i={};function c(t){var a=n(r.substring(t),!1),i=a.content,c=a.skip;return{codeTree:e(i),skip:c}}for(var s=0;s<r.length;s++){var o=r.charAt(s);if(Y(o)){var l=c(s+1);if(!l.codeTree)throw new Error("No subtree: ".concat(r.substring(s)));$(i,o,l.codeTree),s+=l.skip}else if(X(o)){var u=n(r,!1);i._=a(u.content),s+=u.skip}else switch(o){case"S":var f=n(r.substring(s+1),!0);i.S={_:a(f.content)},s+=f.skip;break;case"M":var d=r.charAt(s+1),h=n(r.substring(s+2),!0);Q(i,d,{_:a(h.content)}),s+=h.skip+1;break;case",":case" ":break;default:throw new Error("Unexpected character: ".concat(o))}}return 0===Object.keys(i).length?void 0:i}(function(e){return e.replace(/[\n\r\t ]/g,"")}(n));if(!r)return;return function(e,t,n){return{name:e,tree:t,code:JSON.stringify(t).replace(/[_.:"]/g,"").replace(/[{]/g,"(").replace(/[}]/g,")").replace(/([ABCDabcdSM])\((\d*)\)/g,(function(e){return"".concat(arguments.length<=1?void 0:arguments[1]).concat(arguments.length<=2?void 0:arguments[2])})),fromUrl:n}}(function(e){var t=e.split(":");if(2===t.length)return t[1];return e.split("").filter((function(e){return Y(e)||X(e)})).join("")}(n),r,t)}catch(i){return void e(i.message)}}function J(e){throw new Error("Unable to parse: ".concat(e))}function q(e,t){var n=e.split(":");return 2===n.length?"".concat(n[0],":").concat(t.trim()):"".concat(e,":").concat(t)}var W,K=["(0):Zen","(1):One","(6):Six","(16,S90):Axoneme","(b1,a1):Knee","(b3,a3):Leg","(a1,b1,c1,d1):Nexus","(A2,B(3,b(2,S90),S80),C(3,c(2,S90),S80),D(3,d(2,S90),S80)):Tripod with Knees","(A(8, S85, MA1), a(8, S85, MA1)):Bulge Ring","(a1,b(3,S85,MA1),c(3,S85,MA1),d(3,S85,MA1)):Convergence Three","(a1,b(12,S85,MA1),c(12,S85,MA1),d(12,S85,MA1)):Convergence Twelve","(B(7,S80,MA1),C(2,S120,MA0),D(7,S80,MA1)):Halo by Crane","(B(5,S75),C(5,S75),D(5,S75)):Pretenst Lander","(a(1,MA0),c(3,b(3,d(3,c(3,b(3,d(1,MA0))))))):Zig Zag Loop","(B2, C2, D2, A(2, b2, c2, d2)):Crystal Interstitial","(a(2,b(2,c(2,d(1,MA11)),d(2,c(1,MA10))),c(2,d(2,b(1,MA13)),b(2,d(1,MA12))),d(2,b(2,c(1,MA15)),c(2,b(1,MA14)))),b(2,d(2,Mc13),c(2,Md14)),c(2,b(2,Md15),d(2,Mb10)),d(2,c(2,Mb11),b(2,Mc12))): Diamond","(a(3,b(3,c(3,d(2,MA11)),d(3,c(2,MA10))),c(3,d(3,b(2,MA13)),b(3,d(2,MA12))),d(3,b(3,c(2,MA15)),c(3,b(2,MA14)))),b(3,d(3,Mc13),c(3,Md14)),c(3,b(3,Md15),d(3,Mb10)),d(3,c(3,Mb11),b(3,Mc12))):Diamond2"].map((function(e){return H(J,!1,e)}));function ee(e,t){var n=[];return e.forEach((function(e){var a=e.brick,r=e.tree,i=e.fabric;function c(e,n,a,r){var c=e.base===x.PPP?I(a):a,s=i.builder.createConnectedBrick(e,c,r);return 0===n._&&function(e,n){function a(n,a){if(a){var r=e.base===x.NNN?e.faces[n]:e.faces[I(n)];if(r.removed)throw new Error("!! trying to use a face that was removed");t(a._,r)}}a(x.PPP,n.MA),a(x.NPP,n.Mb),a(x.PNP,n.Mc),a(x.PPN,n.Md),a(x.PNN,n.MB),a(x.NPN,n.MC),a(x.NNP,n.MD),a(x.NNN,n.Ma)}(s,n),{tree:n,brick:s,fabric:i}}var s=r._;if(s){var o=s-1;n.push(c(a,Z({},r,{_:o}),x.PPP,D(r.S)))}else l(a,x.PPP,r.A),l(a,x.NPP,r.b),l(a,x.PNP,r.c),l(a,x.PPN,r.d),l(a,x.PNN,r.B),l(a,x.NPN,r.C),l(a,x.NNP,r.D),l(a,x.NNN,r.a);function l(e,t,a){if(a){var r=D(a.S),i=Z({},a,{_:a._?a._-1:void 0});n.push(c(e,i,t,r))}}})),n}function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.Grow="Grow",e.Shape="Shape",e.Realize="Realize",e.View="View",e.Strain="Strain"}(W||(W={}));var ae="2019-12-14";function re(e){return Object.keys(e.recentCode).map((function(t){var n=e.recentCode[t],a=H((function(e){return console.error(e)}),!1,n);if(!a)throw new Error("Unable to read recent tenscript code: ".concat(n));return a}))}function ie(e,t){return ne({},e,{nonce:e.nonce+1},t)}var ce="State";function se(e){var t=localStorage.getItem(ce);if(t){var n=JSON.parse(t);if(n.version===ae)return n}return function(e){var t=v.map(e).reduce((function(e,t){return e[t.feature]={percent:100,numeric:t.defaultValue},e}),{});return{version:ae,nonce:0,surfaceCharacter:y.Frozen,featureValues:t,recentCode:{},controlTab:W.Grow,fullScreen:!0,ellipsoids:!1,rotating:!1,showPushes:!0,showPulls:!0}}(e)}function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var le=[50,75,90,100,125,150,200],ue=(1+Math.sqrt(5))/2,fe=Math.sqrt(2),de=Math.sqrt(3),he=Math.sqrt(2-2*Math.sqrt(2/3)),me=(ue/3-1/6)*de,pe=ue/3*de-1+fe/de,ve=Math.sqrt(.25+me*me+pe*pe);function ge(e){switch(e){case r.Gravity:return{feature:e,name:"Gravity",defaultValue:1e-7,percents:[0,10,50,100,200,500]};case r.Drag:return{feature:e,name:"Drag",defaultValue:1e-4,percents:[0,10,50,100,150,200]};case r.PretenstFactor:return{feature:e,name:"Pretenst factor",defaultValue:.03,percents:[0,50,90,100,125,150,200]};case r.IterationsPerFrame:return{feature:e,name:"Iterations per frame",defaultValue:100,percents:[10,25,50,100,200,300,500]};case r.IntervalCountdown:return{feature:e,name:"Interval Countdown",defaultValue:1e3,percents:[10,20,30,100,150,400,1e3]};case r.PretenstCountdown:return{feature:e,name:"Slack to Pretenst countdown",defaultValue:3e4,percents:le};case r.FacePullEndZone:return{feature:e,name:"Face Pull End Zone",defaultValue:4,percents:le};case r.FacePullOrientationForce:return{feature:e,name:"Face Pull Orientation Force",defaultValue:1e-4,percents:le};case r.SlackThreshold:return{feature:e,name:"Slack threshold",defaultValue:1e-4,percents:[.01,.1,1,10,100,1e3]};case r.ShapingPretenstFactor:return{feature:e,name:"Pretenst factor",defaultValue:.1,percents:[0,1,2,3,5,10,20,50,100]};case r.ShapingStiffnessFactor:return{feature:e,name:"Stiffness factor",defaultValue:10,percents:[100,150,200,250,300,400,500]};case r.ShapingDrag:return{feature:e,name:"Drag",defaultValue:.1,percents:[0,10,50,100,200,500]};case r.MaxStrain:return{feature:e,name:"Maximum Strain",defaultValue:.1,percents:[1,2,3,5,8,13,21,34,55,100]};case r.VisualStrain:return{feature:e,name:"Visual Strain",defaultValue:1,percents:[0,10,50,100,200,300,500,1e3,1e4,1e5]};case r.PushOverPull:return{feature:e,name:"Compression/Tension",defaultValue:1,percents:[10,20,30,50,100,200,300,500,1e3]};case r.NexusPushLength:return{feature:e,name:"Nexus Push",defaultValue:ue,percents:le};case r.ColumnPushLength:return{feature:e,name:"Column Push",defaultValue:fe,percents:le};case r.TriangleLength:return{feature:e,name:"Triangle",defaultValue:1,percents:le};case r.RingLength:return{feature:e,name:"Ring",defaultValue:he,percents:[10,80,90,100,110,120,130]};case r.NexusCrossLength:return{feature:e,name:"Nexus Cross",defaultValue:ve,percents:le};case r.ColumnCrossLength:return{feature:e,name:"Column Cross",defaultValue:1,percents:le};case r.BowMidLength:return{feature:e,name:"Bow Mid",defaultValue:.4,percents:le};case r.BowEndLength:return{feature:e,name:"Bow End",defaultValue:.6,percents:le};case r.PushRadiusFactor:return{feature:e,name:"Push Radius",defaultValue:4,percents:[5,25,50,100,150,200,300]};case r.PullRadiusFactor:return{feature:e,name:"Pull Radius",defaultValue:2,percents:[5,25,50,100,150,200,300]};case r.MaxStiffness:return{feature:e,name:"Maximum Stiffness",defaultValue:5e-4,percents:[5,25,50,100,150,200,500]}}}var be=function(){function e(t,n){Object(d.a)(this,e),this.config=t,this.value$=void 0;var a=n.getValue().featureValues[t.feature],r=void 0!==a?a:{numeric:t.defaultValue,percent:100};this.value$=new u.BehaviorSubject(r),this.value$.subscribe((function(e){var a=n.getValue(),r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},a.featureValues);r[t.feature]=e,n.next(ie(a,{featureValues:r}))}))}return Object(h.a)(e,[{key:"value",get:function(){return this.value$.getValue()}},{key:"title",get:function(){return this.config.name}},{key:"percentChoices",get:function(){return this.config.percents}},{key:"numeric",get:function(){return this.value$.getValue().numeric}},{key:"formatted",get:function(){var e=this.numeric,t=e.toExponential(5),n=t.indexOf("e+0");return n>0?t.substring(0,n):Math.max(t.indexOf("e-1"),t.indexOf("e-2"))>0?e.toFixed(5):Math.max(t.indexOf("e+1"),t.indexOf("e+2"))>0?e.toFixed(1):t}},{key:"percent",get:function(){return this.value$.getValue().percent},set:function(e){this.value$.next({numeric:this.config.defaultValue*e/100,percent:e})}},{key:"observable",get:function(){return this.value$}},{key:"fabricFeature",get:function(){return this.config.feature}}]),e}();function Ee(e){var t={};return v.map(ge).forEach((function(n){return t[n.feature]=new be(n,e)})),t}var ye=function(){function e(t,n,a,r){Object(d.a)(this,e),this.index=t,this.buffer=n,this.releaseInstance=a,this.fabricEngine=r,this._fabricFeatures=void 0,this._midpoint=void 0,this._lineColors=void 0,this._lineLocations=void 0,this._faceMidpoints=void 0,this._faceNormals=void 0,this._faceLocations=void 0,this._jointLocations=void 0,this._jointVelocities=void 0,this._unitVectors=void 0,this._strains=void 0,this._strainNuances=void 0,this._stiffnesses=void 0,this._linearDensities=void 0;var i=this.engine,c=i._fabricOffset(),s=this.buffer;this._fabricFeatures=new Se(s,c+i._fabricFeatures(),(function(){return p})),this._midpoint=new Se(s,c+i._midpoint(),(function(){return 3})),this._lineColors=new Se(s,c+i._lineColors(),(function(){return 3*i.getIntervalCount()*2})),this._lineLocations=new Se(s,c+i._lineLocations(),(function(){return 3*i.getIntervalCount()*2})),this._faceMidpoints=new Se(s,c+i._faceMidpoints(),(function(){return 3*i.getFaceCount()})),this._faceNormals=new Se(s,c+i._faceNormals(),(function(){return 3*i.getFaceCount()*3})),this._faceLocations=new Se(s,c+i._faceLocations(),(function(){return 3*i.getFaceCount()*3})),this._jointLocations=new Se(s,c+i._jointLocations(),(function(){return 3*i.getJointCount()})),this._jointVelocities=new Se(s,c+i._jointVelocities(),(function(){return 3*i.getJointCount()})),this._unitVectors=new Se(s,c+i._intervalUnits(),(function(){return 3*i.getIntervalCount()})),this._strains=new Se(s,c+i._intervalStrains(),(function(){return i.getIntervalCount()})),this._strainNuances=new Se(s,c+i._intervalStrainNuances(),(function(){return i.getIntervalCount()})),this._stiffnesses=new Se(s,c+i._stiffnesses(),(function(){return i.getIntervalCount()})),this._linearDensities=new Se(s,c+i._linearDensities(),(function(){return i.getIntervalCount()}))}return Object(h.a)(e,[{key:"applyFeature",value:function(e){this._fabricFeatures.floats[e.fabricFeature]=e.numeric}},{key:"setFeatureValue",value:function(e,t){this._fabricFeatures.floats[e]=t}},{key:"release",value:function(){this.releaseInstance(this.index)}},{key:"forgetDimensions",value:function(){this._faceMidpoints.clear(),this._faceLocations.clear(),this._faceNormals.clear(),this._jointLocations.clear(),this._lineLocations.clear(),this._lineColors.clear(),this._unitVectors.clear(),this._strains.clear(),this._strainNuances.clear(),this._stiffnesses.clear(),this._linearDensities.clear()}},{key:"location",value:function(e){return Pe(this._jointLocations.floats,e)}},{key:"apply",value:function(e){for(var t=this.engine.getJointCount(),n=0;n<t;n++){var a=Pe(this._jointLocations.floats,n);we(a.applyMatrix4(e),this._jointLocations.floats,n)}}},{key:"unitVector",value:function(e){return Pe(this._unitVectors.floats,e)}},{key:"velocities",value:function(){return this._jointVelocities.floats}},{key:"faceMidpoint",value:function(e){return ke(e,this._faceLocations.floats)}},{key:"faceNormal",value:function(e){return ke(e,this._faceNormals.floats)}},{key:"intervalLocation",value:function(e){return Pe(this._lineLocations.floats,e)}},{key:"getIntervalMidpoint",value:function(e){var t=this.intervalLocation(2*e),n=this.intervalLocation(2*e+1);return(new M.Vector3).add(t).add(n).multiplyScalar(.5)}},{key:"getMidpoint",value:function(e){return Pe(this._midpoint.floats,0,e)}},{key:"strains",get:function(){return this._strains.floats}},{key:"strainNuances",get:function(){return this._strainNuances.floats}},{key:"stiffnesses",get:function(){return this._stiffnesses.floats}},{key:"linearDensities",get:function(){return this._linearDensities.floats}},{key:"faceLocations",get:function(){return this._faceLocations.floats}},{key:"faceNormals",get:function(){return this._faceNormals.floats}},{key:"lineLocations",get:function(){return this._lineLocations.floats}},{key:"lineColors",get:function(){return this._lineColors.floats}},{key:"engine",get:function(){return this.fabricEngine.setInstance(this.index),this.fabricEngine}}]),e}(),Se=function(){function e(t,n,a){Object(d.a)(this,e),this.buffer=t,this.offset=n,this.length=a,this.array=void 0}return Object(h.a)(e,[{key:"clear",value:function(){this.array=void 0}},{key:"floats",get:function(){return this.array?this.array:this.array=new Float32Array(this.buffer,this.offset,this.length())}}]),e}(),Pe=function(e,t,n){var a=3*t;return n?(n.set(e[a],e[a+1],e[a+2]),n):new M.Vector3(e[a],e[a+1],e[a+2])},we=function(e,t,n){var a=3*n;t[a]=e.x,t[a+1]=e.y,t[a+2]=e.z};function ke(e,t){var n=3*e,a=Pe(t,n),r=Pe(t,n+1),i=Pe(t,n+2);return(new M.Vector3).add(a).add(r).add(i).multiplyScalar(1/3)}var Ne=function(){function e(t){var n=this;Object(d.a)(this,e),this.instanceArray=[],this.instanceUsed=[],this.arrayBuffer=void 0;var a=t.init();if(this.arrayBuffer=t.memory.buffer,0===this.arrayBuffer.byteLength)throw new Error("Zero byte length! ".concat(a));for(var r=0;r<t.getInstanceCount();r++)this.instanceArray.push(new ye(r,this.arrayBuffer,(function(e){return n.instanceUsed[e]=!1}),t)),this.instanceUsed.push(!1)}return Object(h.a)(e,[{key:"allocateInstance",value:function(){var e=this.instanceUsed.indexOf(!1);if(!(e<0))return this.instanceUsed[e]=!0,this.instanceArray[e]}}]),e}(),Oe=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function xe(){if("serviceWorker"in navigator){if(new URL("/app",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/app","/service-worker.js");Oe?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):je(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):je(e)}))}}function je(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var Ce=n(6),Me=n(621),Fe=n(30),Ve=n(245),Te=n(611),Le=function(){function e(t,n,a){Object(d.a)(this,e),this.numericFeature=t,this.fabric=n,this._stage=void 0,this._stage=a}return Object(h.a)(e,[{key:"withStage",value:function(t,n){return this.transition(t,n),this._stage=t,new e(this.numericFeature,this.fabric,t)}},{key:"transition",value:function(e,t){switch(this._stage){case a.Growing:switch(e){case a.Shaping:return void this.save()}break;case a.Shaping:switch(e){case a.Slack:return void(t&&t.adoptLengths&&(this.fabric.instance.engine.adoptLengths(),this.save()));case a.Realizing:return}break;case a.Slack:switch(e){case a.Shaping:case a.Realizing:return}break;case a.Realizing:switch(e){case a.Realized:return}break;case a.Realized:switch(e){case a.Slack:if(t&&t.strainToStiffness){var n=this.numericFeature(r.PushOverPull),i=function(e,t){var n=e.instance.strains,a=e.instance.stiffnesses,r=function(e){return e.reduce((function(e,t){return e+n[t.index]}),0)/e.length},i=e.intervals,c=i.filter((function(e){return e.isPush})),s=r(c),o=i.filter((function(e){return!e.isPush})),l=r(o),u=(-t*s+l)/2,f=i.map((function(e){return 1+(n[e.index]*(e.isPush?-t:1)-u)/u})),d=a.map((function(e,t){return e*f[t]})),h=d.map(Ae);return{newStiffnesses:d,newLinearDensities:h}}(this.fabric,n),c=i.newStiffnesses,s=i.newLinearDensities;this.restore();var o=this.fabric.instance;return c.forEach((function(e,t){return o.stiffnesses[t]=e})),void s.forEach((function(e,t){return o.linearDensities[t]=e}))}return t&&t.adoptLengths?(this.fabric.instance.engine.adoptLengths(),void this.save()):void this.restore()}}throw new Error("No transition ".concat(a[this._stage]," to ").concat(a[e]))}},{key:"save",value:function(){this.fabric.instance.engine.cloneInstance(this.fabric.instance.index,this.fabric.slackInstance.index)}},{key:"restore",value:function(){var e=this;this.fabric.instance.engine.cloneInstance(this.fabric.slackInstance.index,this.fabric.instance.index),v.forEach((function(t){e.fabric.instance.setFeatureValue(t,e.numericFeature(t))}))}},{key:"stage",get:function(){return this._stage}}]),e}();function Ae(e){return Math.sqrt(e)}var Re=n(243);function Ie(e){return.6*e}var De=function(){function e(t,n){Object(d.a)(this,e),this.fabric=t,this.numericFeature=n,this.faceMarks={}}return Object(h.a)(e,[{key:"createBrickAt",value:function(e,t){var n=this.createBrickPointsAt(x.PPP,t,e);return this.createBrick(n,x.NNN,t)}},{key:"createConnectedBrick",value:function(e,t,n){var a=e.faces[t],i=_(e.scale),c=i*_(n),s=this.createBrickOnFace(a,B(c)),o=s.faces[s.base],l=this.numericFeature(r.IntervalCountdown);return this.connectFaces(a,o,B((i+c)/2),l)||console.error("Cannot connect!"),s}},{key:"turnUpright",value:function(){var e=this.faceMarkLists.find((function(e){return 1===e.length}));e&&this.uprightAtOrigin(e[0])}},{key:"checkFacePulls",value:function(e,t){var n=this;if(0===e.length)return e;var a=this.fabric.instance;return e.filter((function(e){var i=e.alpha,c=e.omega,s=e.scaleFactor;return!(a.faceMidpoint(i.index).distanceTo(a.faceMidpoint(c.index))<=10*Ie(s))||(function(e){var t=e.alpha,a=e.omega,i=e.scaleFactor,c=n.numericFeature(r.IntervalCountdown);n.connectFaces(t,a,B(i),c)||console.error("Unable to connect")}(e),t(e),!1)}))}},{key:"optimize",value:function(){var e=this,t=this.fabric,n=t.instance,a=[],i=function(e){var n=t.intervals.filter((function(e){return e.isPush})).find((function(t){return t.alpha.index===e||t.omega.index===e}));if(!n)throw new Error("Cannot find ".concat(e));return{interval:n,joint:n.alpha.index===e?n.alpha:n.omega}},c=t.intervals.filter((function(e){return e.intervalRole===m.ColumnCross||e.intervalRole===m.NexusCross}));c.forEach((function(e,t){var r=e.alpha.index,s=e.omega.index,o=i(r),l=i(s),u=n.location(r),f=n.location(s),d=u.distanceTo(f),h=(new M.Vector3).addVectors(u,f).multiplyScalar(.5);c.forEach((function(c,m){var p=c.alpha.index,v=c.omega.index;if(!(t>=m||r===p||r===v||s===p||s===v)){var g,b,E,y,S,P=i(p),w=i(v),k=function(e,t){return e.interval.index===t.interval.index};if(k(o,P))g=o.interval,b=e.alpha,E=e.omega,y=c.alpha,S=c.omega;else if(k(o,w))g=o.interval,b=e.alpha,E=e.omega,y=c.omega,S=c.alpha;else if(k(l,P))g=l.interval,b=e.omega,E=e.alpha,y=c.alpha,S=c.omega;else{if(!k(l,w))return;g=l.interval,b=e.omega,E=e.alpha,y=c.omega,S=c.alpha}var N=n.location(p),O=n.location(v),x=N.distanceTo(O),j=(new M.Vector3).addVectors(N,O).multiplyScalar(.5),C=u.distanceTo(j)/x,F=f.distanceTo(j)/x,V=N.distanceTo(h)/d,T=O.distanceTo(h)/d,L=0,A=function(e){e<.5&&L++};if(A(C),A(F),A(V),A(T),!(L<2)){var R=g.scale;a.push({scale:R,a:b,x:E,b:y,y:S})}}}))}));var s=this.numericFeature(r.IntervalCountdown);a.forEach((function(n){var a=n.scale,r=n.a,i=n.x,c=n.b,o=n.y;t.createInterval(i,o,m.BowMid,a,s);var l=t.findInterval(r,i),u=t.findInterval(r,o),f=t.findInterval(c,i),d=t.findInterval(c,o);if(!(l&&f&&u&&d))throw new Error("Cannot find intervals during optimize");t.removeInterval(l),t.removeInterval(d),e.fabric.changeIntervalRole(u,m.BowEnd,a,s),e.fabric.changeIntervalRole(f,m.BowEnd,a,s)})),n.forgetDimensions()}},{key:"uprightAtOrigin",value:function(e){var t=this.faceToOrigin(e);this.fabric.instance.apply(t)}},{key:"createFacePulls",value:function(e){var t=this,n=this.fabric.instance,a=function(){var a,r=t.createBrickAt((a=e.map((function(e){return n.faceMidpoint(e.index)}))).reduce((function(e,t){return e.add(t)}),new M.Vector3).multiplyScalar(1/a.length),B(function(e){return e.reduce((function(e,t){return e+_(t.brick.scale)}),0)/e.length}(e)));n.engine.renderNumbers();return e.map((function(e){return t.fabric.createFacePull(function(e){var t=n.faceMidpoint(e.index);return r.faces.filter((function(t){return t.negative!==e.negative})).reduce((function(e,a){return n.faceMidpoint(e.index).distanceTo(t)<n.faceMidpoint(a.index).distanceTo(t)?e:a}))}(e),e)}))};switch(e.length){case 2:return e[0].negative===e[1].negative?a():[this.fabric.createFacePull(e[0],e[1])];case 3:return a();default:return[]}}},{key:"createBrickOnFace",value:function(e,t){var n=this,a=R[e.triangle].negative,r=e.brick,i=e.triangle,c=r.faces[i].joints.map((function(e){return n.fabric.instance.location(e.index)})),s=c.reduce((function(e,t){return e.add(t)}),new M.Vector3).multiplyScalar(1/3),o=(new M.Vector3).addVectors(c[0],c[1]).multiplyScalar(.5),l=(new M.Vector3).subVectors(o,s).normalize(),u=(new M.Vector3).subVectors(c[1],s).normalize(),f=(new M.Vector3).add(l).multiplyScalar(l.dot(u)),d=u.sub(f).normalize(),h=(new M.Vector3).crossVectors(d,l).normalize(),m=(new M.Matrix4).makeBasis(l,h,d).setPosition(s),p=a?x.NNN:x.PPP,v=this.createBrickPointsAt(p,t,new M.Vector3(0,0,0)).map((function(e){return e.applyMatrix4(m)})),g=a?x.PPP:x.NNN;return this.createBrick(v,g,t)}},{key:"createBrick",value:function(e,t,n){var a,i=this,c=this.numericFeature(r.IntervalCountdown),s=function(e,t,n){return{index:e,base:t,scale:n,joints:[],pushes:[],pulls:[],crosses:[],rings:[[],[],[],[]],faces:[],negativeAdjacent:0,postiveeAdjacent:0}}(this.fabric.bricks.length,t,n);this.fabric.bricks.push(s);var o=e.map((function(e,t){return i.fabric.createJointIndex(t,e)}));A.forEach((function(e,t){Object(Re.a)(e);var a=o[2*t],r=o[2*t+1],l={index:a,oppositeIndex:r},u={index:r,oppositeIndex:a};s.pushes.push(i.fabric.createInterval(l,u,m.NexusPush,n,c))})),s.pushes.forEach((function(e){return s.joints.push(e.alpha,e.omega)}));var l=s.pushes.reduce((function(e,t){return e.push(t.alpha,t.omega),e}),[]);return(a=this.fabric.joints).push.apply(a,Object(C.a)(l)),R.forEach((function(e){for(var t=e.pushEnds.map((function(e){return l[e]})),a=0;a<3;a++){var r=t[a],o=t[(a+1)%3],u=i.fabric.createInterval(r,o,m.Triangle,n,c);s.pulls.push(u),s.rings[e.ringMember[a]].push(u)}})),R.forEach((function(e){var t=i.fabric.createFace(s,e.name);s.faces.push(t)})),this.fabric.instance.forgetDimensions(),s}},{key:"createBrickPointsAt",value:function(e,t,n){var a=A.reduce((function(e,t){return e.push((new M.Vector3).add(t.alpha)),e.push((new M.Vector3).add(t.omega)),e}),[]),r=I(e),i=R[r].pushEnds.map((function(e){return a[e]})).reverse(),c=i.reduce((function(e,t){return e.add(t)}),new M.Vector3).multiplyScalar(1/3),s=(new M.Vector3).subVectors(i[0],c).normalize(),o=(new M.Vector3).sub(c).normalize(),l=(new M.Vector3).crossVectors(o,s).normalize(),u=(new M.Matrix4).makeBasis(s,o,l),f=_(t),d=(new M.Matrix4).getInverse(u).setPosition(n).scale(new M.Vector3(f,f,f));return a.map((function(e){return e.applyMatrix4(d)}))}},{key:"faceToOrigin",value:function(e){var t=this;this.fabric.instance.engine.renderNumbers();var n=e.joints.map((function(e){return t.fabric.instance.location(e.index)})),a=n.reduce((function(e,t){return e.add(t)}),new M.Vector3).multiplyScalar(1/3),r=(new M.Vector3).subVectors(n[1],a).normalize(),i=(new M.Vector3).subVectors(n[0],a).normalize(),c=(new M.Vector3).crossVectors(i,r).normalize();i.crossVectors(r,c).normalize();var s=(new M.Matrix4).makeBasis(r,c,i).setPosition(a);return(new M.Matrix4).getInverse(s)}},{key:"nineJointPairsByProximity",value:function(e,t){var n=[],a=this.fabric.instance;return e.joints.forEach((function(e){t.joints.forEach((function(t){var r=a.location(e.index),i=a.location(t.index),c=r.distanceTo(i);n.push({jointA:e,jointB:t,distance:c})}))})),n.sort((function(e,t){return e.distance-t.distance}))}},{key:"facesToRing",value:function(e,t){if(e.negative===t.negative)throw new Error("Polarity not opposite");var n=this.nineJointPairsByProximity(e,t).slice(0,6),a=n.shift();if(!a)throw new Error("No closest found");var r=function(e){var t=n.findIndex(e);return t>=0?n.splice(t,1)[0]:void 0},i=function(e){var t=r((function(t){return t.jointB.index===e.index}));return t?t.jointA:void 0},c=function(e){var t=r((function(t){return t.jointA.index===e.index}));return t?t.jointB:void 0},s=a.jointA,o=a.jointB,l=c(s);if(l){var u=i(l);if(u){var f=c(u);if(f){var d=i(f);if(d){var h=c(d);if(h&&h.index===o.index){var m=(e.joints.findIndex((function(e){return e.index===s.index}))+1)%3===e.joints.findIndex((function(e){return e.index===u.index}));return{faceA:e,faceB:t,jointsA:m!==e.negative?[s,d,u]:[s,u,d],jointsB:m!==e.negative?[l,o,f]:[o,l,f]}}console.error("Cannot complete ring!")}}}}}},{key:"connectFaces",value:function(e,t,n,a){var r=this;if(e.negative===t.negative)throw new Error("Same polarity!");var i=this.facesToRing(e,t);if(!i)return!1;for(var c=function(e){return e.negativeAdjacent>1||e.postiveeAdjacent>1},s=function(e,t,i){return r.fabric.createInterval(e,t,i,n,a)},o=function(e,t){return s(e,t,m.Ring)},l=function(e,t,n){var a=r.fabric.joints[t.oppositeIndex],i=c(n.brick)?m.NexusCross:m.ColumnCross;return s(e,a,i)},u=0;u<3;u++){var f=i.jointsA[u],d=i.jointsB[u],h=i.jointsB[(u+1)%3];o(f,d),o(f,h),l(f,h,t),l(d,f,e)}var p=function(e){var t=e.brick.scale,n=e.triangle,i=e.brick;e.negative?i.negativeAdjacent++:i.postiveeAdjacent++,R.filter((function(e){return e.opposite!==n&&e.negative!==R[n].negative})).forEach((function(e){return i.faces[e.name].canGrow=!1})),r.fabric.removeFace(e,!0);var s=R[n].ring;c(i)?(i.pulls.filter((function(e){return!e.removed})).forEach((function(e){return r.fabric.changeIntervalRole(e,m.Triangle,t,a)})),i.crosses.forEach((function(e){return r.fabric.changeIntervalRole(e,m.NexusCross,t,a)}))):i.rings[s].filter((function(e){return!e.removed})).forEach((function(e){return r.fabric.changeIntervalRole(e,m.Ring,t,a)}));var o=c(i)?m.NexusPush:m.ColumnPush;i.pushes.filter((function(e){return!e.removed})).forEach((function(e){return r.fabric.changeIntervalRole(e,o,t,a)}))};return p(e),p(t),this.fabric.instance.forgetDimensions(),!0}},{key:"markFace",get:function(){var e=this;return function(t,n){var a=e.faceMarks[t];a?a.push(n):e.faceMarks[t]=[n]}}},{key:"initialFacePulls",get:function(){var e=this;return this.faceMarkLists.filter((function(e){return 2===e.length||3===e.length})).reduce((function(t,n){return[].concat(Object(C.a)(t),Object(C.a)(e.createFacePulls(n)))}),[])}},{key:"faceMarkLists",get:function(){var e=this;return Object.keys(this.faceMarks).map((function(t){return e.faceMarks[t]}))}}]),e}(),_e=new M.SphereGeometry(1,32,8),Be=65535;function ze(e){return _(e)/1e4}var Ze,Ue,Ye=function(){function e(t,n,r,i,c){Object(d.a)(this,e),this.roleDefaultLength=t,this.numericFeature=n,this.instance=r,this.slackInstance=i,this.tenscript=c,this.life$=void 0,this.joints=[],this.intervals=[],this.facePulls=[],this.faces=[],this.bricks=[],this.activeTenscript=void 0,this.facesToConnect=void 0,this.maxJointSpeed=0,this.builder=void 0,this.faceCount=void 0,this.faceLocations=void 0,this.faceNormals=void 0,this._facesGeometry=new M.BufferGeometry,this.intervalCount=void 0,this.lineLocations=void 0,this.lineColors=void 0,this._linesGeometry=new M.BufferGeometry,this.life$=new u.BehaviorSubject(new Le(n,this,a.Growing)),this.builder=new De(this,n),this.refreshLineGeometry(),this.refreshFaceGeometry();var s=this.builder.createBrickAt(new M.Vector3,D());this.bricks=[s],this.activeTenscript=[{tree:this.tenscript.tree,brick:s,fabric:this}]}return Object(h.a)(e,[{key:"toStage",value:function(e,t){e!==this.life.stage&&this.life$.next(this.life.withStage(e,t))}},{key:"connectFaces",value:function(e){this.facesToConnect=e}},{key:"brickMidpoint",value:function(e,t){var n=this,a=e.joints,r=t||new M.Vector3;return a.reduce((function(e,t){return e.add(n.instance.location(t.index))}),r).multiplyScalar(1/a.length)}},{key:"createJointIndex",value:function(e,t){return this.engine.createJoint(e,E.RightSide,t.x,t.y,t.z)}},{key:"createFacePull",value:function(e,t){var n=this.instance,a=n.faceMidpoint(e.index).distanceTo(n.faceMidpoint(t.index)),r=ze(D()),i=Ae(r),c=(_(e.brick.scale)+_(t.brick.scale))/2,s=Ie(c),o={index:this.engine.createInterval(e.index,t.index,m.FacePull,s,r,i,function(e){var t=4e3*e;return t>Be?Be:t}(a)),alpha:e,omega:t,distance:a,scaleFactor:c,removed:!1};return this.facePulls.push(o),this.instance.forgetDimensions(),o}},{key:"removeFacePull",value:function(e){this.facePulls=this.facePulls.filter((function(t){return t.index!==e.index})),this.engine.removeInterval(e.index),this.facePulls.forEach((function(t){t.index>e.index&&t.index--})),this.intervals.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0,this.instance.forgetDimensions()}},{key:"createInterval",value:function(e,t,n,a,r){var i=_(a)*this.roleDefaultLength(n),c=ze(a),s=Ae(c),o={index:this.engine.createInterval(e.index,t.index,n,i,c,s,r),intervalRole:n,scale:a,alpha:e,omega:t,removed:!1,isPush:P(n)};return this.intervals.push(o),o}},{key:"changeIntervalScale",value:function(e,t){e.scale=B(_(e.scale)*t),this.instance.engine.multiplyRestLength(e.index,t,100)}},{key:"changeIntervalRole",value:function(e,t,n,a){e.intervalRole=t;var r=this.instance.engine;r.setIntervalRole(e.index,t),r.changeRestLength(e.index,_(n)*this.roleDefaultLength(t),a)}},{key:"removeInterval",value:function(e){this.intervals=this.intervals.filter((function(t){return t.index!==e.index})),this.engine.removeInterval(e.index),this.intervals.forEach((function(t){t.index>e.index&&t.index--})),this.facePulls.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0,this.instance.forgetDimensions()}},{key:"createFace",value:function(e,t){var n=R[t],a=n.negative,r=n.pushEnds,i=r.map((function(t){return e.joints[t]})),c=r.map((function(t){var n=e.pushes.find((function(n){var a=e.joints[t];return a.index===n.alpha.index||a.index===n.omega.index}));if(void 0===n)throw new Error;return n})),s=[0,1,2].map((function(n){return e.pulls[3*t+n]})),o={index:this.engine.createFace(i[0].index,i[1].index,i[2].index),canGrow:!0,negative:a,removed:!1,brick:e,triangle:t,joints:i,pushes:c,pulls:s};return this.faces.push(o),o}},{key:"removeFace",value:function(e,t){var n=this;this.engine.removeFace(e.index),this.faces=this.faces.filter((function(t){return t.index!==e.index})),this.faces.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0,t&&e.pulls.forEach((function(e){return n.removeInterval(e)}))}},{key:"release",value:function(){this.instance.release()}},{key:"needsUpdate",value:function(){var e=this.instance;this.faceLocations.array=e.faceLocations,this.faceLocations.needsUpdate=!0,this.faceNormals.array=e.faceNormals,this.faceNormals.needsUpdate=!0,this.lineLocations.array=e.lineLocations,this.lineLocations.needsUpdate=!0,this.lineColors.array=e.lineColors,this.lineColors.needsUpdate=!0,this._linesGeometry.computeBoundingSphere(),this._facesGeometry.computeBoundingSphere()}},{key:"startTightening",value:function(e){this.facePulls=e}},{key:"iterate",value:function(){var e=this,t=this.engine,n=t.iterate(this.life$.getValue().stage);if(this.maxJointSpeed=Math.sqrt(t.renderNumbers()),n===a.Busy)return n;var r=this.activeTenscript;if(r){if(r.length>0&&(this.activeTenscript=ee(r,this.builder.markFace),t.centralize()),0===r.length&&(this.activeTenscript=void 0,n===a.Growing)){var i=t.finishGrowing();return this.facePulls=this.builder.initialFacePulls,i}}else{var c=this.facesToConnect;c&&(this.facesToConnect=void 0,this.builder.createFacePulls(c)),this.facePulls=this.builder.checkFacePulls(this.facePulls,(function(t){return e.removeFacePull(t)}))}return n}},{key:"findInterval",value:function(e,t){return this.intervals.find((function(n){return n.alpha.index===e.index&&n.omega.index===t.index||n.alpha.index===t.index&&n.omega.index===e.index}))}},{key:"orientInterval",value:function(e,t,n){var a=new M.Vector3(0,1,0),r=this.instance.unitVector(e.index),i=(new M.Quaternion).setFromUnitVectors(a,r),c=this.instance.location(e.alpha.index),s=this.instance.location(e.omega.index),o=c.distanceTo(s),l=this.instance.strains[e.index],u=o/2;return{scale:new M.Vector3(t,u+u*-l*n,t),rotation:i}}},{key:"refreshLineGeometry",value:function(){this.engine.renderNumbers(),this.intervalCount=this.instance.engine.getIntervalCount(),this.lineLocations=new M.Float32BufferAttribute(this.instance.lineLocations,3),this.lineColors=new M.Float32BufferAttribute(this.instance.lineColors,3),this._linesGeometry.addAttribute("position",this.lineLocations),this._linesGeometry.addAttribute("color",this.lineColors),this._linesGeometry.computeBoundingSphere()}},{key:"refreshFaceGeometry",value:function(){this.engine.renderNumbers(),this.faceCount=this.instance.engine.getFaceCount(),this.faceLocations=new M.Float32BufferAttribute(this.instance.faceLocations,3),this.faceNormals=new M.Float32BufferAttribute(this.instance.faceNormals,3),this._facesGeometry.addAttribute("position",this.faceLocations),this._facesGeometry.addAttribute("normal",this.faceNormals),this._facesGeometry.computeBoundingSphere()}},{key:"life",get:function(){return this.life$.getValue()}},{key:"submergedJoints",get:function(){var e=this;return this.joints.filter((function(t){return e.instance.location(t.index).y<0}))}},{key:"facesGeometry",get:function(){return this.faceCount!==this.instance.engine.getFaceCount()&&this.refreshFaceGeometry(),this._facesGeometry}},{key:"linesGeometry",get:function(){return this.intervalCount!==this.instance.engine.getIntervalCount()&&this.refreshLineGeometry(),this._linesGeometry}},{key:"output",get:function(){var e=this,t=function(e){return e.toFixed(5).replace(/[.]/,",")},n=this.instance.strains,a=this.instance.stiffnesses,r=this.instance.linearDensities;return{name:this.tenscript.name,joints:this.joints.map((function(n){var a=e.instance.location(n.index);return{index:(n.index+1).toString(),x:t(a.x),y:t(a.z),z:t(a.y)}})),intervals:this.intervals.map((function(i){var c=e.instance.location(i.alpha.index),s=e.instance.location(i.omega.index),o=c.distanceTo(s),l="".concat(i.alpha.index+1,",").concat(i.omega.index+1),u=t(n[i.index]),f=i.isPush?"Push":"Pull",d=a[i.index],h=t(d),p=r[i.index],v=t(p),g=m[i.intervalRole];return{joints:l,type:f,strainString:u,stiffness:d,stiffnessString:h,linearDensity:p,linearDensityString:v,isPush:P(i.intervalRole),role:g,length:o}})).sort((function(e,t){return e.isPush&&!t.isPush?-1:!e.isPush&&t.isPush?1:e.stiffness-t.stiffness}))}}},{key:"engine",get:function(){return this.instance.engine}}]),e}(),Ge=n(616),Xe=n(617),$e=n(622),Qe=n(618),He=n(619),Je=n(620),qe=["#fc4d4d","#fb712a","#ed9400","#d4b500","#afd200","#80da52","#4edd83","#00ddad","#00c4d7","#00a5ff","#007bff","#2329f7"].reverse().map((function(e){return new M.Color(e)})),We=!0,Ke=new M.MeshPhongMaterial({color:new M.Color("#1c1608"),side:M.DoubleSide}),et=new M.LineBasicMaterial({vertexColors:M.VertexColors}),tt=new M.LineBasicMaterial({color:new M.Color("#cace02")}),nt=new M.MeshPhongMaterial({lights:We,color:new M.Color("white"),side:M.DoubleSide,transparent:!0,opacity:.2}),at=new M.MeshPhongMaterial({color:new M.Color("#91934f"),lights:!0}),rt=qe.map((function(e){return new M.MeshLambertMaterial({color:e,lights:We})}));function it(e){switch(e){case m.NexusPush:return"#6541b4";case m.ColumnPush:return"#2f3aca";case m.Triangle:return"#f9c9bf";case m.Ring:return"#cc3200";case m.NexusCross:return"#59ebcb";case m.ColumnCross:return"#73c84a";case m.BowMid:return"#f101e9";case m.BowEnd:return"#cb01c3";case m.FacePull:return"#bf0105";default:return}}function ct(e){var t=function(e){return new M.Color(it(e))}(e);return new M.MeshLambertMaterial({color:t,lights:We})}function st(e){var t=e.feature,n=e.disabled,a=Object(o.useState)((function(){return t.percent})),r=Object(Ce.a)(a,2),i=r[0],c=r[1];Object(o.useEffect)((function(){var e=t.observable.subscribe((function(e){var t=e.percent;return c(t)}));return function(){return e.unsubscribe()}}),[]);var s=it(w(t.fabricFeature)),l=s||"#919191";return o.createElement("div",{className:"my-2"},o.createElement("div",{className:"float-right",style:{color:n?"gray":"white"}},t.formatted),o.createElement("div",null,t.config.name),o.createElement(Te.a,{className:"w-100"},t.percentChoices.map((function(e){var a=i===e?"#000000":l;return o.createElement(Ve.a,{disabled:n,size:"sm",style:{color:"white",backgroundColor:a},key:"".concat(t.config.name,":").concat(e),onClick:function(){return t.percent=e}},function(e){return e<=100?"".concat(e,"%"):"".concat(e/100,"x")}(e))}))))}function ot(e){var t=e.fabric,n=e.stageTransition,r=e.disabled,i=Object(o.useState)(t.life),c=Object(Ce.a)(i,2),s=c[0],l=c[1];function u(e){return!(!r&&s.stage!==a.Busy&&s.stage!==a.Realizing)||s.stage!==e}switch(Object(o.useEffect)((function(){var e=t.life$.subscribe(l);return function(){return e.unsubscribe()}}),[t]),n){case Ze.CaptureLengthsToSlack:return o.createElement(Ve.a,{className:"my-1 w-100",disabled:u(a.Shaping),onClick:function(){return t.toStage(a.Slack,{adoptLengths:!0})}},"Capture Lengths ",o.createElement(Me.j,null)," (",o.createElement(lt,{stage:a.Shaping})," ) ",o.createElement(Me.d,null)," ( ",o.createElement(Me.f,null),o.createElement(lt,{stage:a.Slack})," ) New Slack");case Ze.CurrentLengthsToSlack:return o.createElement(Ve.a,{className:"my-1 w-100",disabled:u(a.Shaping),onClick:function(){return t.toStage(a.Slack)}},"Current Lengths ",o.createElement(lt,{stage:a.Shaping})," ",o.createElement(Me.d,null),o.createElement(lt,{stage:a.Slack})," Slack");case Ze.SlackToRealizing:return o.createElement(Ve.a,{className:"my-1 w-100",disabled:u(a.Slack),onClick:function(){return t.toStage(a.Realizing)}},"Slack ",o.createElement(lt,{stage:a.Slack})," ",o.createElement(Me.d,null)," ",o.createElement(lt,{stage:a.Realized})," Realized");case Ze.SlackToShaping:return o.createElement(Te.a,{vertical:!0,className:"w-100 my-1"},o.createElement(Ve.a,{className:"my-1 w-100",disabled:u(a.Slack),onClick:function(){return t.toStage(a.Shaping)}},"Slack ",o.createElement(lt,{stage:a.Slack})," ",o.createElement(Me.d,null)," ",o.createElement(lt,{stage:a.Shaping})," Shaping"));case Ze.CaptureRealizedToSlack:return o.createElement(Ve.a,{className:"my-1 w-100",disabled:u(a.Realized),onClick:function(){return t.toStage(a.Slack,{adoptLengths:!0})}},"Capture realized ",o.createElement(Me.j,null)," ( ",o.createElement(lt,{stage:a.Realized})," ) ",o.createElement(Me.d,null)," ( ",o.createElement(Me.f,null),o.createElement(lt,{stage:a.Slack})," ) New Slack");case Ze.CaptureStrainForStiffness:return o.createElement(Ve.a,{className:"my-1 w-100",disabled:u(a.Realized),onClick:function(){return t.toStage(a.Slack,{strainToStiffness:!0})}},"Capture Strain ",o.createElement(Me.j,null)," ( ",o.createElement(lt,{stage:a.Realized})," ",o.createElement(Me.E,null)," ) ",o.createElement(Me.d,null),"( ",o.createElement(lt,{stage:a.Slack})," ",o.createElement(Me.k,null)," ) Slack Stiffness")}}function lt(e){switch(e.stage){case a.Busy:return o.createElement(Me.n,null);case a.Growing:return o.createElement(Me.L,null);case a.Shaping:return o.createElement(Me.Q,null);case a.Slack:return o.createElement(Me.S,null);case a.Realizing:return o.createElement(Me.n,null);case a.Realized:return o.createElement(Me.A,null)}}function ut(e){var t=e.floatFeatures,n=e.fabric,i=e.selectedIntervals,c=e.setFabric,s=e.shapeSelection,l=e.setShapeSelection,u=e.selectedFaces,f=e.clearSelectedFaces,d=e.storedState$,h=Object(o.useState)(!1),p=Object(Ce.a)(h,2),v=p[0],b=p[1];Object(o.useEffect)((function(){n.instance.engine.setPushAndPull(v)}),[v]);var E=Object(o.useState)(d.getValue().ellipsoids),y=Object(Ce.a)(E,2),P=y[0],w=y[1];Object(o.useEffect)((function(){var e=[d.subscribe((function(e){return w(e.ellipsoids)}))];return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[]);var N=Object(o.useState)(n.life),O=Object(Ce.a)(N,2),x=O[0],j=O[1];Object(o.useEffect)((function(){var e=n.life$.subscribe(j);return function(){return e.unsubscribe()}}),[n]);var C=Object(o.useState)(t[r.NexusPushLength]),M=Object(Ce.a)(C,2),F=M[0],V=M[1],T=function(e,t,a){return function(){i&&i.forEach((function(r){r.isPush&&!t||!r.isPush&&!a||n.changeIntervalScale(r,e?1.03:1/1.03)}))}};function L(){return P||x.stage!==a.Shaping}function A(e,t){return!(!L()&&s===t)||(u.length<e||P)}function R(){return P||s!==Ue.None}return o.createElement("div",null,o.createElement(Vt,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Me.a,null)," Phase"),o.createElement(ot,{fabric:n,stageTransition:Ze.CaptureLengthsToSlack,disabled:R()}),o.createElement(ot,{fabric:n,stageTransition:Ze.CurrentLengthsToSlack,disabled:R()}),o.createElement(ot,{fabric:n,stageTransition:Ze.SlackToShaping,disabled:R()})),o.createElement(Vt,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Me.y,null)," Manual"),o.createElement(Te.a,{size:"sm",className:"w-100 my-2"},o.createElement(Ve.a,{color:s===Ue.Intervals?"warning":"secondary",disabled:P&&s===Ue.None||0===u.length,onClick:function(){var e=s===Ue.Intervals?Ue.None:Ue.Intervals;l(e)}},o.createElement("span",null,o.createElement(Me.b,null)," Adjust ",o.createElement(Me.e,null))),o.createElement(Ve.a,{disabled:A(1,Ue.Intervals),onClick:T(!0,!0,!0)},"TC ",o.createElement(Me.e,null)),o.createElement(Ve.a,{disabled:A(1,Ue.Intervals),onClick:T(!1,!0,!0)},"TC ",o.createElement(Me.b,null)),o.createElement(Ve.a,{disabled:A(1,Ue.Intervals),onClick:T(!0,!1,!0)},"T",o.createElement(Me.e,null)),o.createElement(Ve.a,{disabled:A(1,Ue.Intervals),onClick:T(!1,!1,!0)},"T ",o.createElement(Me.b,null)),o.createElement(Ve.a,{disabled:A(1,Ue.Intervals),onClick:T(!0,!0,!1)},"C ",o.createElement(Me.e,null)),o.createElement(Ve.a,{disabled:A(1,Ue.Intervals),onClick:T(!1,!0,!1)},"C ",o.createElement(Me.b,null))),o.createElement(Te.a,{size:"sm",className:"w-100 my-2"},o.createElement(Ve.a,{disabled:0===u.length||L()&&s!==Ue.None,onClick:function(){return f()}},o.createElement(Me.O,null)," Clear selection"),o.createElement(Ve.a,{disabled:A(1,Ue.Faces),onClick:function(){n.builder.uprightAtOrigin(u[0]),f()}},o.createElement(Me.o,null),o.createElement("span",null," Upright")),o.createElement(Ve.a,{disabled:A(2,Ue.Faces),onClick:function(){n.connectFaces(u),f(),l(Ue.None),c(n)}},o.createElement(Me.D,null),o.createElement("span",null," Connect")),o.createElement(Ve.a,{disabled:L(),onClick:function(){return n.builder.optimize()}},o.createElement(Me.F,null),o.createElement("span",null," Bows")))),o.createElement(Vt,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Me.Q,null)," Adjustments"),o.createElement(st,{feature:t[r.ShapingPretenstFactor],disabled:L()}),o.createElement(st,{feature:t[r.ShapingDrag],disabled:L()}),o.createElement(st,{feature:t[r.ShapingStiffnessFactor],disabled:L()}),o.createElement(Te.a,{size:"sm",className:"w-100 my-2"},o.createElement(Ve.a,{disabled:L(),color:v?"secondary":"success",onClick:function(){return b(!1)}},o.createElement(Me.l,null),": T or C"),o.createElement(Ve.a,{disabled:L(),color:v?"success":"secondary",onClick:function(){return b(!0)}},o.createElement(Me.r,null),": T=C"))),o.createElement(Vt,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Me.E,null)," Default Lengths"),o.createElement(st,{key:F.title,feature:F,disabled:L()}),o.createElement(Te.a,{className:"my-2"},S.map((function(e){return{intervalRole:e,feature:t[k(e)]}})).map((function(e){var t=e.intervalRole,n=e.feature;return o.createElement(Ve.a,{size:"sm",key:m[t],onClick:function(){return V(n)},color:F.fabricFeature===n.fabricFeature?"success":"secondary"},g(t))})))))}function ft(e){var t=e.floatFeatures,n=e.fabric,i=e.shapeSelection,c=e.storedState$,s=Object(o.useState)(c.getValue()),l=Object(Ce.a)(s,2),u=l[0],f=l[1],d=Object(o.useState)(c.getValue().ellipsoids),h=Object(Ce.a)(d,2),m=h[0],p=h[1];Object(o.useEffect)((function(){var e=[c.subscribe((function(e){p(u.ellipsoids),f(e)}))];return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[]);var v,g=Object(o.useState)(n.life),b=Object(Ce.a)(g,2),E=b[0],S=b[1];function P(){return m||i!==Ue.None||E.stage<a.Slack}function w(){return m||i!==Ue.None}return Object(o.useEffect)((function(){var e=n.life$.subscribe(S);return function(){return e.unsubscribe()}}),[n]),o.createElement("div",null,o.createElement(Vt,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Me.a,null)," Phase"),o.createElement(ot,{fabric:n,stageTransition:Ze.SlackToRealizing,disabled:w()}),o.createElement(ot,{fabric:n,stageTransition:Ze.CaptureRealizedToSlack,disabled:w()})),o.createElement(Vt,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Me.x,null)," Environment"),o.createElement(st,{feature:t[r.PretenstFactor],disabled:P()}),o.createElement("div",{className:"float-right",style:{color:P()?"gray":"white"}},y[u.surfaceCharacter]),o.createElement("div",null,"Surface"),o.createElement(Te.a,{size:"sm",className:"w-100"},(v=y,Object.keys(v).filter((function(e){return e.length>1})).map((function(e){return v[e]}))).map((function(e){return o.createElement(Ve.a,{key:y[e],disabled:P(),active:u.surfaceCharacter===e,onClick:function(){return t={surfaceCharacter:e},void c.next(ie(c.getValue(),t));var t}},y[e])}))),o.createElement(st,{feature:t[r.Gravity],disabled:P()}),o.createElement(st,{feature:t[r.Drag],disabled:P()})),o.createElement(Vt,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Me.g,null)," Compression vs Tension"),o.createElement(ot,{fabric:n,stageTransition:Ze.CaptureStrainForStiffness,disabled:w()}),o.createElement(st,{feature:t[r.PushOverPull],disabled:P()})))}!function(e){e[e.CaptureLengthsToSlack=0]="CaptureLengthsToSlack",e[e.CurrentLengthsToSlack=1]="CurrentLengthsToSlack",e[e.SlackToRealizing=2]="SlackToRealizing",e[e.SlackToShaping=3]="SlackToShaping",e[e.CaptureRealizedToSlack=4]="CaptureRealizedToSlack",e[e.CaptureStrainForStiffness=5]="CaptureStrainForStiffness"}(Ze||(Ze={})),function(e){e[e.None=0]="None",e[e.Faces=1]="Faces",e[e.Intervals=2]="Intervals"}(Ue||(Ue={}));var dt=.7,ht=1.4,mt=3.5,pt=[r.MaxStrain,r.MaxStiffness,r.VisualStrain,r.SlackThreshold];function vt(e){var t=new M.Geometry,n=function(e,t){return new M.Vector3(e,t,0)};return t.vertices=[n(0,-mt),n(0,mt),n(-dt,mt),n(dt,mt),n(-dt,-mt),n(dt,-mt)],e&&t.vertices.push(n(-dt,0),n(dt,0)),t}function gt(e,t,n,a,r){var i=new Float32Array(2*n.length*3),c=0;e.forEach((function(e){var t=(n[e.index]-a)/(r-a),s=t<-1?-1:t>1?1:t;i[c++]=-dt*ht,i[c++]=s*mt,i[c++]=0,i[c++]=dt*ht,i[c++]=s*mt,i[c++]=0}));var s=new M.BufferGeometry;return s.addAttribute("position",new M.Float32BufferAttribute(i,3)),s.addAttribute("color",new M.Float32BufferAttribute(t,3)),s}function bt(e){var t=e.floatFeatures,n=e.fabric,a=e.storedState$,i=Object(o.useRef)();return o.createElement(o.Fragment,null,o.createElement(Vt,{height:"50%"},o.createElement("div",{style:{position:"absolute",left:"6em"}},"Strain"),o.createElement("div",{style:{position:"absolute",right:"5em"}},"Stiffness"),o.createElement((function(){var e=Object(o.useState)(0),t=Object(Ce.a)(e,2),c=t[0],s=t[1],l=Object(o.useState)(a.getValue().featureValues[r.MaxStrain].numeric),u=Object(Ce.a)(l,2),f=u[0],d=u[1],h=Object(o.useState)(a.getValue().featureValues[r.MaxStiffness].numeric),m=Object(Ce.a)(h,2),p=m[0],v=m[1];Object(o.useEffect)((function(){var e=a.subscribe((function(e){d(e.featureValues[r.MaxStrain].numeric),v(e.featureValues[r.MaxStiffness].numeric)}));return function(){return e.unsubscribe()}}),[n]),Object(o.useEffect)((function(){var e=setInterval((function(){var e=n.instance.engine.getAge();c<e&&s(e)}),1e3);return function(){return clearTimeout(e)}}),[]);var g=n.instance;function b(e){var t=e.position,n=e.intervals,a=e.floats,r=e.mid,i=e.max,c=e.middleTick;return o.createElement("group",{position:new M.Vector3(t,-.15,0)},o.createElement("lineSegments",{geometry:gt(n,g.lineColors,a,r,i),material:et}),o.createElement("lineSegments",{geometry:vt(c),material:tt}))}return o.createElement(Fe.a,null,o.createElement("orthographicCamera",{position:new M.Vector3(0,0,-1),ref:i}),o.createElement("scene",null,o.createElement(b,{position:-1.5,intervals:n.intervals,floats:g.strains,mid:0,max:f,middleTick:!0}),o.createElement(b,{position:1.5,intervals:n.intervals,floats:g.stiffnesses,mid:0,max:p,middleTick:!1})))}),null)),o.createElement(Vt,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Me.M,null)," Adjustments"),pt.map((function(e){return o.createElement(st,{key:r[e],feature:t[e],disabled:!1})}))))}var Et=n(623),yt=n(612),St=n(613),Pt=n(614),wt=n(615);function kt(e){var t=e.rootTenscript,n=e.setRootTenscript,a=e.fabric,r=e.runTenscript,i=e.storedState$,c=Object(o.useState)(a&&!a.tenscript.fromUrl?a.tenscript:t),s=Object(Ce.a)(c,2),l=s[0],u=s[1],f=Object(o.useState)(""),d=Object(Ce.a)(f,2),h=d[0],m=d[1],p=Object(o.useState)(!1),v=Object(Ce.a)(p,2),g=v[0],b=v[1],E=Object(o.useState)(re(i.getValue())),y=Object(Ce.a)(E,2),S=y[0],P=y[1],w=Object(o.useState)(!1),k=Object(Ce.a)(w,2),N=k[0],O=k[1];function x(e){var t=function(e,t){var n=t.code,a=t.name,r=ne({},e.recentCode);return r[a]=q(n,a),ie(e,{recentCode:r})}(i.getValue(),e);P(re(t)),i.next(t)}return o.createElement("div",{id:"tenscript-panel",style:{flexDirection:"column",position:"relative",backgroundColor:"rgba(0,0,0,1)",height:"100%"}},o.createElement(Vt,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Me.L,null)," Tenscript"),o.createElement("div",{id:"code-and-run",style:{flexDirection:"column",height:"available"}},o.createElement(Nt,{tenscript:l,setTenscript:u,error:h,setError:m}),o.createElement(Te.a,{className:"w-100 my-2"},o.createElement(Ve.a,{color:h.length>0?"warning":"success",disabled:h.length>0,onClick:function(){return r(l)}},0===h.length?o.createElement("span",null,"Execute ",o.createElement(Me.H,null)," tenscript"):o.createElement("span",null,o.createElement(Me.i,null)," ",h))))),o.createElement(Vt,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Me.h,null)," Storage"),0===S.length?void 0:o.createElement(Et.a,{className:"w-100 my-2",isOpen:g,toggle:function(){return b(!g)}},o.createElement(yt.a,{style:{borderRadius:"1.078em"}},g?o.createElement(Me.J,null):o.createElement(Me.I,null)," Recent"),o.createElement(St.a,null,S.map((function(e,t){return o.createElement(Pt.a,{key:"Recent".concat(t),onClick:function(){return r(e)}},e.name)})))),o.createElement(Te.a,{className:"w-100 my-2"},o.createElement(Ve.a,{disabled:l.code===t.code,onClick:function(){n(l),x(l)}},"Save ",o.createElement(Me.B,null)," for later")),o.createElement(Et.a,{className:"w-100 my-2",isOpen:N,toggle:function(){return O(!N)}},o.createElement(yt.a,{color:"info",style:{borderRadius:"1.078em"}},"Explore ",o.createElement(Me.C,null)," existing designs"),o.createElement(St.a,null,K.map((function(e,t){return o.createElement(Pt.a,{key:"Boot".concat(t),onClick:function(){return r(e)}},e.name)}))))))}function Nt(e){var t=e.tenscript,n=e.setTenscript,a=e.error,r=e.setError,i=Object(o.useState)(""),c=Object(Ce.a)(i,2),s=c[0],l=c[1];function u(e){l(e),function(e){var t=H(r,!1,e);t&&(r(""),n(t))}(e)}return Object(o.useEffect)((function(){return l(t.code)}),[]),o.createElement("div",{className:"my-2 p-2 w-100",style:{backgroundColor:"#757575",color:"#ffffff",borderStyle:"solid",borderRadius:"1em",borderColor:0===a.length?"black":"#f0ad4e",borderWidth:"2px"}},o.createElement("h6",{className:"w-100 text-center"},o.createElement("i",null,'"',t.name,'"')),o.createElement(wt.a,{style:{borderRadius:"1em",height:"20em"},type:"textarea",id:"tenscript",value:s,onChange:function(e){return u(e.target.value)}}))}var Ot=n(112),xt=n(250),jt=n.n(xt);n(251);function Ct(e){var t=e.floatFeatures,n=e.fabric,i=e.visibleRoles,c=e.setVisibleRoles,s=e.storedState$,l=Object(o.useState)(s.getValue().ellipsoids),u=Object(Ce.a)(l,2),f=u[0],d=u[1],h=Object(o.useState)(s.getValue().showPushes),m=Object(Ce.a)(h,2),p=m[0],v=m[1],b=Object(o.useState)(s.getValue().showPulls),E=Object(Ce.a)(b,2),y=E[0],P=E[1];Object(o.useEffect)((function(){var e=s.subscribe((function(e){d(e.ellipsoids),v(e.showPushes),P(e.showPulls)}));return function(){return e.unsubscribe()}}),[]);var w=Object(o.useState)(n.life),k=Object(Ce.a)(w,2),N=k[0],O=k[1];function x(e){var t=e.pushes,n=e.pulls,a=e.children;return o.createElement(Ve.a,{style:{color:"white"},color:t===p&&n===y?"success":"secondary",onClick:function(){s.next(ie(s.getValue(),{showPulls:n,showPushes:t}))}},a)}return Object(o.useEffect)((function(){var e=n.life$.subscribe(O);return function(){return e.unsubscribe()}}),[n]),o.createElement("div",null,o.createElement(Vt,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Me.t,null)," Coloring"),o.createElement(Te.a,{className:"w-100 my-2"},o.createElement(x,{pushes:!0,pulls:!0},o.createElement("span",null,o.createElement(Me.w,null)," All")),o.createElement(x,{pushes:!1,pulls:!0},o.createElement("span",null,o.createElement(Me.R,null)," Pulls")),o.createElement(x,{pushes:!0,pulls:!1},o.createElement("span",null,o.createElement(Me.s,null)," Pushes")),o.createElement(x,{pushes:!1,pulls:!1},o.createElement("span",null,o.createElement(Me.m,null)," Roles")))),o.createElement(Vt,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Me.j,null)," Snapshot"),o.createElement(Te.a,{size:"sm"},S.map((function(e){return o.createElement(Ve.a,{color:i.indexOf(e)<0?"secondary":"success",key:"viz".concat(e),onClick:function(){i.indexOf(e)<0?c([].concat(Object(C.a)(i),[e])):c(i.filter((function(t){return t!==e})))},disabled:!f},g(e))}))),o.createElement(st,{key:"pushrad",feature:t[r.PushRadiusFactor],disabled:!f}),o.createElement(st,{key:"pullrad",feature:t[r.PullRadiusFactor],disabled:!f})),o.createElement(Vt,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Me.n,null)," Time"),o.createElement(st,{key:"it",feature:t[r.IterationsPerFrame],disabled:f}),o.createElement(st,{key:"ic",feature:t[r.IntervalCountdown],disabled:f}),o.createElement(st,{key:"pc",feature:t[r.PretenstCountdown],disabled:f})),o.createElement(Vt,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Me.v,null)," Perturb"),o.createElement(Te.a,{className:"w-100"},o.createElement(Ve.a,{disabled:N.stage!==a.Realized,onClick:function(){return n.instance.engine.setAltitude(1)}},o.createElement(Me.z,null)," Nudge"),o.createElement(Ve.a,{disabled:N.stage!==a.Realized,onClick:function(){return n.instance.engine.setAltitude(10)}},o.createElement(Me.G,null)," Drop"),o.createElement(Ve.a,{disabled:f,onClick:function(){return n.instance.engine.centralize()}},o.createElement(Me.p,null)," Centralize"))),o.createElement(Vt,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Me.K,null)," Take"),o.createElement(Te.a,{vertical:!0,className:"w-100"},o.createElement(Ve.a,{onClick:function(){return function(e){var t=e.output,n=new jt.a;n.file("joints.csv",function(e){var t=[];return t.push(["index","x","y","z"]),e.joints.forEach((function(e){return t.push([e.index,e.x,e.y,e.z])})),t.map((function(e){return e.join(";")})).join("\n")}(t)),n.file("intervals.csv",function(e){var t=[];return t.push(["joints","type","strain","elasticity","linear density","role","length"]),e.intervals.forEach((function(e){t.push(['"=""'.concat(e.joints,'"""'),e.type,e.strainString,e.stiffnessString,e.linearDensityString,e.role,e.length.toFixed(8)])})),t.map((function(e){return e.join(";")})).join("\n")}(t)),n.file("submerged.csv",function(e){var t=[];return t.push(["joints"]),t.push(['"=""'.concat(e.submergedJoints.map((function(e){return e.index+1})),'"""')]),t.map((function(e){return e.join(";")})).join("\n")}(e)),n.generateAsync({type:"blob",mimeType:"application/zip"}).then((function(e){var t=(new Date).toISOString().replace(/[.].*/,"").replace(/[:T_]/g,"-");Ot.saveAs(e,"pretenst-".concat(t,".zip"))}))}(n)}},o.createElement(Me.q,null)," Download CSV ",o.createElement(Me.u,null)))))}var Mt="25em";function Ft(e){var t=e.floatFeatures,n=e.rootTenscript,a=e.setRootTenscript,r=e.shapeSelection,i=e.setShapeSelection,c=e.selectedFaces,s=e.clearSelectedFaces,l=e.selectedIntervals,u=e.fabric,f=e.setFabric,d=e.runTenscript,h=e.visibleRoles,m=e.setVisibleRoles,p=e.toFullScreen,v=e.storedState$,g=Object(o.useState)(u?u.life:void 0),b=Object(Ce.a)(g,2),E=b[0],y=b[1];Object(o.useEffect)((function(){var e=u?u.life$.subscribe(y):void 0;return function(){e&&e.unsubscribe()}}),[u]);var S=Object(o.useState)(v.getValue().controlTab),P=Object(Ce.a)(S,2),w=P[0],k=P[1];function N(e){var t=e.tab;return o.createElement(Ge.a,null,o.createElement(Xe.a,{active:w===t,onClick:function(){return v.next(ie(v.getValue(),{controlTab:t}))}},t))}function O(e){var p=e.tab,g=o.createElement($e.a,{color:"warning"},"No fabric");return o.createElement(Qe.a,{id:"tab-pane",style:{height:"100%"},tabId:p},o.createElement((function(){switch(p){case W.Grow:return o.createElement(kt,{rootTenscript:n,setRootTenscript:a,fabric:u,runTenscript:d,storedState$:v});case W.Shape:return u?o.createElement(ut,{floatFeatures:t,fabric:u,setFabric:f,selectedIntervals:l,shapeSelection:r,setShapeSelection:i,selectedFaces:c,clearSelectedFaces:s,storedState$:v}):g;case W.Realize:return u?o.createElement(ft,{floatFeatures:t,fabric:u,shapeSelection:r,storedState$:v}):g;case W.View:return u?o.createElement(Ct,{floatFeatures:t,fabric:u,visibleRoles:h,setVisibleRoles:m,storedState$:v}):g;case W.Strain:return u?o.createElement(bt,{floatFeatures:t,fabric:u,storedState$:v}):g}}),null))}return Object(o.useEffect)((function(){w!==W.Shape&&s()}),[w,E]),Object(o.useEffect)((function(){var e=v.subscribe((function(e){return k(e.controlTab)}));return function(){return e.unsubscribe()}}),[]),o.createElement("div",{className:"h-100"},o.createElement(He.a,{tabs:!0,style:{backgroundColor:"#b2b2b2"}},Object.keys(W).map((function(e){return o.createElement(N,{key:"T".concat(e),tab:W[e]})}))),o.createElement(Je.a,{style:{flex:1,flexFlow:"auto",height:"100%"},id:"tab-content",activeTab:w},Object.keys(W).map((function(e){return o.createElement(O,{key:e,tab:W[e]})}))),o.createElement("div",{style:{position:"absolute",top:0,height:"100%",left:Mt,zIndex:10,width:"1em"}},o.createElement((function(){return o.createElement(Ve.a,{style:{padding:0,margin:0,borderRadius:0,width:"1em"},className:"w-100 h-100",color:"dark",onClick:p},o.createElement(Me.c,null))}),null)))}function Vt(e){var t=e.children,n=e.height;return o.createElement("div",{className:"m-3 p-2",style:{height:n,borderRadius:"1em",borderStyle:"solid",borderWidth:"0.1em",borderColor:"#45782e"}},t)}var Tt=n(254),Lt=n(252),At=n(253),Rt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},It={type:"change"},Dt={type:"start"},_t={type:"end"},Bt=function(e){function t(e,n){var a;return Object(d.a)(this,t),(a=Object(Tt.a)(this,Object(Lt.a)(t).call(this))).object=void 0,a.element=void 0,a.window=void 0,a.enabled=void 0,a.target=void 0,a.enableZoom=void 0,a.zoomSpeed=void 0,a.minDistance=void 0,a.maxDistance=void 0,a.enableRotate=void 0,a.rotateSpeed=void 0,a.enablePan=void 0,a.keyPanSpeed=void 0,a.autoRotate=void 0,a.autoRotateSpeed=void 0,a.minZoom=void 0,a.maxZoom=void 0,a.minPolarAngle=void 0,a.maxPolarAngle=void 0,a.minAzimuthAngle=void 0,a.maxAzimuthAngle=void 0,a.keys=void 0,a.mouseButtons=void 0,a.enableDamping=void 0,a.dampingFactor=void 0,a.spherical=void 0,a.sphericalDelta=void 0,a.scale=void 0,a.target0=void 0,a.position0=void 0,a.zoom0=void 0,a.state=void 0,a.panOffset=void 0,a.zoomChanged=void 0,a.rotateStart=void 0,a.rotateEnd=void 0,a.rotateDelta=void 0,a.panStart=void 0,a.panEnd=void 0,a.panDelta=void 0,a.dollyStart=void 0,a.dollyEnd=void 0,a.dollyDelta=void 0,a.updateLastPosition=void 0,a.updateOffset=void 0,a.updateQuat=void 0,a.updateLastQuaternion=void 0,a.updateQuatInverse=void 0,a.panLeftV=void 0,a.panUpV=void 0,a.panInternalOffset=void 0,a.onMouseUp=void 0,a.onMouseDown=void 0,a.onMouseMove=void 0,a.onMouseWheel=void 0,a.onTouchStart=void 0,a.onTouchEnd=void 0,a.onTouchMove=void 0,a.object=e,a.element=n,a.window=window,a.enabled=!0,a.target=new M.Vector3,a.minDistance=0,a.maxDistance=1/0,a.minZoom=0,a.maxZoom=1/0,a.minPolarAngle=0,a.maxPolarAngle=Math.PI,a.minAzimuthAngle=-1/0,a.maxAzimuthAngle=1/0,a.enableDamping=!1,a.dampingFactor=.25,a.enableZoom=!0,a.zoomSpeed=1,a.enableRotate=!0,a.rotateSpeed=1,a.enablePan=!0,a.keyPanSpeed=7,a.autoRotate=!1,a.autoRotateSpeed=2,a.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},a.mouseButtons={ORBIT:M.MOUSE.LEFT,ZOOM:M.MOUSE.MIDDLE,PAN:M.MOUSE.RIGHT},a.target0=a.target.clone(),a.position0=a.object.position.clone(),a.zoom0=a.object.zoom,a.updateOffset=new M.Vector3,a.updateQuat=(new M.Quaternion).setFromUnitVectors(a.object.up,new M.Vector3(0,1,0)),a.updateQuatInverse=a.updateQuat.clone().inverse(),a.updateLastPosition=new M.Vector3,a.updateLastQuaternion=new M.Quaternion,a.state=Rt.NONE,a.scale=1,a.spherical=new M.Spherical,a.sphericalDelta=new M.Spherical,a.panOffset=new M.Vector3,a.zoomChanged=!1,a.rotateStart=new M.Vector2,a.rotateEnd=new M.Vector2,a.rotateDelta=new M.Vector2,a.panStart=new M.Vector2,a.panEnd=new M.Vector2,a.panDelta=new M.Vector2,a.dollyStart=new M.Vector2,a.dollyEnd=new M.Vector2,a.dollyDelta=new M.Vector2,a.panLeftV=new M.Vector3,a.panUpV=new M.Vector3,a.panInternalOffset=new M.Vector3,a.onMouseDown=function(e){if(e.preventDefault(),a.enabled){if(e.button===a.mouseButtons.ORBIT){if(!a.enableRotate)return;a.rotateStart.set(e.clientX,e.clientY),a.state=Rt.ROTATE}else if(e.button===a.mouseButtons.ZOOM){if(!a.enableZoom)return;a.dollyStart.set(e.clientX,e.clientY),a.state=Rt.DOLLY}else if(e.button===a.mouseButtons.PAN){if(!a.enablePan)return;a.panStart.set(e.clientX,e.clientY),a.state=Rt.PAN}a.state!==Rt.NONE&&(document.addEventListener("mousemove",a.onMouseMove,!1),document.addEventListener("mouseup",a.onMouseUp,!1),a.dispatchEvent(Dt))}},a.onMouseMove=function(e){if(e.preventDefault(),a.enabled)if(a.state===Rt.ROTATE){if(!a.enableRotate)return;a.rotateEnd.set(e.clientX,e.clientY),a.rotateDelta.subVectors(a.rotateEnd,a.rotateStart),a.rotateLeft(2*Math.PI*a.rotateDelta.x/a.element.clientWidth*a.rotateSpeed),a.rotateUp(2*Math.PI*a.rotateDelta.y/a.element.clientHeight*a.rotateSpeed),a.rotateStart.copy(a.rotateEnd),a.update()}else if(a.state===Rt.DOLLY){if(!a.enableZoom)return;a.dollyEnd.set(e.clientX,e.clientY),a.dollyDelta.subVectors(a.dollyEnd,a.dollyStart),a.dollyDelta.y>0?a.dollyIn(a.getZoomScale()):a.dollyDelta.y<0&&a.dollyOut(a.getZoomScale()),a.dollyStart.copy(a.dollyEnd),a.update()}else if(a.state===Rt.PAN){if(!a.enablePan)return;a.panEnd.set(e.clientX,e.clientY),a.panDelta.subVectors(a.panEnd,a.panStart),a.pan(a.panDelta.x,a.panDelta.y),a.panStart.copy(a.panEnd),a.update()}},a.onMouseUp=function(e){e.preventDefault(),a.enabled&&(document.removeEventListener("mousemove",a.onMouseMove,!1),document.removeEventListener("mouseup",a.onMouseUp,!1),a.dispatchEvent(_t),a.state=Rt.NONE)},a.onMouseWheel=function(e){e.preventDefault(),a.enabled&&a.enableZoom&&(a.state===Rt.NONE||a.state===Rt.ROTATE)&&(e.stopPropagation(),e.deltaY<0?a.dollyOut(a.getZoomScale()):e.deltaY>0&&a.dollyIn(a.getZoomScale()),a.update(),a.dispatchEvent(Dt),a.dispatchEvent(_t))},a.onTouchStart=function(e){if(e.preventDefault(),a.enabled){switch(e.touches.length){case 1:if(!a.enableRotate)return;a.rotateStart.set(e.touches[0].pageX,e.touches[0].pageY),a.state=Rt.TOUCH_ROTATE;break;case 2:if(!a.enableZoom)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);a.dollyStart.set(0,r),a.state=Rt.TOUCH_DOLLY;break;case 3:if(!a.enablePan)return;a.panStart.set(e.touches[0].pageX,e.touches[0].pageY),a.state=Rt.TOUCH_PAN;break;default:a.state=Rt.NONE}a.state!==Rt.NONE&&a.dispatchEvent(Dt)}},a.onTouchMove=function(e){if(e.preventDefault(),a.enabled)switch(e.touches.length){case 1:if(!a.enableRotate)return;if(a.state!==Rt.TOUCH_ROTATE)return;a.rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY),a.rotateDelta.subVectors(a.rotateEnd,a.rotateStart),a.rotateLeft(2*Math.PI*a.rotateDelta.x/a.element.clientWidth*a.rotateSpeed),a.rotateUp(2*Math.PI*a.rotateDelta.y/a.element.clientHeight*a.rotateSpeed),a.rotateStart.copy(a.rotateEnd),a.update();break;case 2:if(!a.enableZoom)return;if(a.state!==Rt.TOUCH_DOLLY)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);a.dollyEnd.set(0,r),a.dollyDelta.subVectors(a.dollyEnd,a.dollyStart),a.dollyDelta.y>0?a.dollyOut(a.getZoomScale()):a.dollyDelta.y<0&&a.dollyIn(a.getZoomScale()),a.dollyStart.copy(a.dollyEnd),a.update();break;case 3:if(!a.enablePan)return;if(a.state!==Rt.TOUCH_PAN)return;a.panEnd.set(e.touches[0].pageX,e.touches[0].pageY),a.panDelta.subVectors(a.panEnd,a.panStart),a.pan(a.panDelta.x,a.panDelta.y),a.panStart.copy(a.panEnd),a.update();break;default:a.state=Rt.NONE}},a.onTouchEnd=function(e){e.preventDefault(),a.enabled&&(a.dispatchEvent(_t),a.state=Rt.NONE)},a.element.addEventListener("mousedown",a.onMouseDown,{capture:!0}),a.element.addEventListener("wheel",a.onMouseWheel,{capture:!0}),a.element.addEventListener("touchstart",a.onTouchStart,{capture:!0}),a.element.addEventListener("touchend",a.onTouchEnd,{capture:!0}),a.element.addEventListener("touchmove",a.onTouchMove,{capture:!0}),a.update(),a}return Object(At.a)(t,e),Object(h.a)(t,[{key:"update",value:function(){var e=this.object.position;return this.updateOffset.copy(e).sub(this.target),this.updateOffset.applyQuaternion(this.updateQuat),this.spherical.setFromVector3(this.updateOffset),this.autoRotate&&this.state===Rt.NONE&&this.rotateLeft(this.getAutoRotationAngle()),this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi,this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),this.target.add(this.panOffset),this.updateOffset.setFromSpherical(this.spherical),this.updateOffset.applyQuaternion(this.updateQuatInverse),e.copy(this.target).add(this.updateOffset),this.object.lookAt(this.target),this.enableDamping?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor):this.sphericalDelta.set(0,0,0),this.scale=1,this.panOffset.set(0,0,0),!!(this.zoomChanged||this.updateLastPosition.distanceToSquared(this.object.position)>1e-6||8*(1-this.updateLastQuaternion.dot(this.object.quaternion))>1e-6)&&(this.dispatchEvent(It),this.updateLastPosition.copy(this.object.position),this.updateLastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0)}},{key:"panLeft",value:function(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}},{key:"panUp",value:function(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}},{key:"pan",value:function(e,t){var n=this.element,a=this.object.position;this.panInternalOffset.copy(a).sub(this.target);var r=this.panInternalOffset.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*r/n.clientHeight,this.object.matrix),this.panUp(2*t*r/n.clientHeight,this.object.matrix)}},{key:"dollyIn",value:function(e){this.scale/=e}},{key:"dollyOut",value:function(e){this.scale*=e}},{key:"getAutoRotationAngle",value:function(){return 2*Math.PI/60/60*this.autoRotateSpeed}},{key:"getZoomScale",value:function(){return Math.pow(.95,this.zoomSpeed)}},{key:"rotateLeft",value:function(e){this.sphericalDelta.theta-=e}},{key:"rotateUp",value:function(e){this.sphericalDelta.phi-=e}},{key:"getPolarAngle",value:function(){return this.spherical.phi}},{key:"getAzimuthalAngle",value:function(){return this.spherical.theta}},{key:"dispose",value:function(){this.element.removeEventListener("mousedown",this.onMouseDown,!1),this.element.removeEventListener("wheel",this.onMouseWheel,!1),this.element.removeEventListener("touchstart",this.onTouchStart,!1),this.element.removeEventListener("touchend",this.onTouchEnd,!1),this.element.removeEventListener("touchmove",this.onTouchMove,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1)}},{key:"reset",value:function(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(It),this.update(),this.state=Rt.NONE}}]),t}(M.EventDispatcher),zt=[new M.Vector3(0,0,-20),new M.Vector3(-17.32,0,-10),new M.Vector3(-17.32,0,10),new M.Vector3(0,0,20),new M.Vector3(17.32,0,10),new M.Vector3(17.32,0,-10)],Zt=new M.Color("tan"),Ut=6,Yt=new M.Vector3(0,1,0),Gt=.03;function Xt(){var e=Object(o.useMemo)((function(){return function(){var e=new M.Geometry;return function(e,t){e.push.apply(e,Object(C.a)(zt.map((function(e){return new M.Vector3(e.x,e.y,e.z)})))),e.push(new M.Vector3);for(var n=0;n<Ut;n++){var a=(n+1)%Ut,r=[Yt,(new M.Vector3).add(Yt).addScaledVector(zt[n],Gt).normalize(),(new M.Vector3).add(Yt).addScaledVector(zt[a],Gt).normalize()];t.push(new M.Face3(Ut,n,a,r,Zt))}}(e.vertices,e.faces),e.vertices.forEach((function(e){return e.sub(new M.Vector3(0,.01,0))})),e.computeBoundingSphere(),e}()}),[]);return o.createElement("mesh",{name:"Spots",geometry:e,material:Ke})}Object(Fe.b)({Orbit:Bt});var $t=new M.Color("#ffffff"),Qt=100,Ht=1,Jt=new M.SphereGeometry(Qt,25,25).scale(Ht,Ht,Ht),qt=.01,Wt=4;function Kt(e){var t=e.fabric,n=e.fabricError,r=e.selectedIntervals,i=e.selectedFaces,c=e.setSelectedFaces,s=e.storedState$,l=e.shapeSelection,u=e.ellipsoids,f=e.visibleRoles,d=document.getElementById("view-container"),h=Object(o.useState)(0),m=Object(Ce.a)(h,2),p=m[0],v=m[1],g=Object(Fe.d)().camera,b=Object(o.useMemo)((function(){var e=(new M.TextureLoader).load("space.jpg");return new M.MeshPhongMaterial({map:e,side:M.BackSide})}),[]),E=Object(o.useState)(t.life),y=Object(Ce.a)(E,2),S=y[0],P=y[1];Object(o.useEffect)((function(){var e=t.life$.subscribe(P);return function(){return e.unsubscribe()}}),[t]);var w=Object(o.useState)(s.getValue()),k=Object(Ce.a)(w,2),N=k[0],O=k[1];Object(o.useEffect)((function(){var e=s.subscribe((function(e){return O(e)}));return function(){return e.unsubscribe()}}),[]),Object(o.useEffect)((function(){x.current.autoRotate=N.rotating}),[N]);var x=Object(Fe.e)((function(e){var t=new M.Vector3(0,Wt,0);g.position.set(t.x,Wt,t.z+4*Wt),g.lookAt(x.current.target),g.fov=60,g.far=2*Qt,g.near=.001,e.object=g,e.minPolarAngle=-.98*Math.PI/2,e.maxPolarAngle=.8*Math.PI,e.maxDistance=Qt*Ht*.9,e.zoomSpeed=.5,e.enableZoom=!0,e.target.set(t.x,t.y,t.z),e.update()}),[]);return Object(Fe.c)((function(){try{var e=t.instance,r=e.getMidpoint(),i=(new M.Vector3).subVectors(r,x.current.target).multiplyScalar(qt);if(x.current.target.add(i),x.current.update(),!u&&l!==Ue.Faces){var c=t.iterate();S.stage===a.Realizing&&c===a.Realized?setTimeout((function(){return t.toStage(a.Realized,{})})):c!==S.stage&&S.stage!==a.Realizing&&c!==a.Busy&&setTimeout((function(){return t.toStage(c,{})}))}e.engine.renderNumbers(),t.needsUpdate(),v(e.engine.getAge())}catch(s){n(s)}}),!0,[t,t,p,S,l,u]),o.createElement("group",null,o.createElement("orbit",{ref:x,args:[g,d]}),o.createElement("scene",null,u?o.createElement(nn,{key:"ellipsoid",fabric:t,selectedIntervals:r,storedState:N,visibleRoles:f}):o.createElement(an,{key:"lines",fabric:t,selectedIntervals:r,storedState:N}),l!==Ue.Faces?void 0:o.createElement(rn,{key:"faces",fabric:t,stage:S.stage,selectFace:function(e){i.some((function(t){return t.index===e.index}))?c(i.filter((function(t){return t.index!==e.index}))):c([].concat(Object(C.a)(i),[e]))}}),i.map((function(e){return o.createElement(en,{key:"Face".concat(e.index),fabric:t,face:e})})),S.stage<=a.Slack?void 0:o.createElement(Xt,null),o.createElement("mesh",{key:"space",geometry:Jt,material:b}),o.createElement("ambientLight",{color:$t,intensity:.8}),o.createElement("directionalLight",{color:new M.Color("#FFFFFF"),intensity:2})))}function en(e){var t=e.fabric,n=e.face,a=_(n.brick.scale)/8;return o.createElement("mesh",{geometry:_e,position:t.instance.faceMidpoint(n.index),material:at,scale:new M.Vector3(a,a,a)})}function tn(e){var t=e.fabric,n=e.interval,a=e.storedState,i=ct(n.intervalRole);if((a.showPushes||a.showPulls)&&(i=function(e){var t=Math.floor(e*rt.length);return rt[t>=rt.length?rt.length-1:t]}(t.instance.strainNuances[n.index]),(!a.showPushes||!a.showPulls)&&(a.showPushes&&!n.isPush||a.showPulls&&n.isPush)))return o.createElement("group",null);var c=t.instance.linearDensities[n.index],s=a.featureValues[n.isPush?r.PushRadiusFactor:r.PullRadiusFactor],l=a.featureValues[r.VisualStrain],u=t.orientInterval(n,s.numeric*c,l.numeric),f=u.scale,d=u.rotation;return o.createElement("mesh",{geometry:_e,position:t.instance.getIntervalMidpoint(n.index),rotation:(new M.Euler).setFromQuaternion(d),scale:f,material:i,matrixWorldNeedsUpdate:!0})}function nn(e){var t=e.fabric,n=e.visibleRoles,a=e.selectedIntervals,r=e.storedState;return o.createElement("group",null,a.length>0?a.map((function(e){return o.createElement(tn,{key:"SI".concat(e.index),fabric:t,interval:e,storedState:r})})):t.intervals.map((function(e){return n.indexOf(e.intervalRole)<0?void 0:o.createElement(tn,{key:"I".concat(e.index),fabric:t,interval:e,storedState:r})})),"}")}function an(e){var t=e.fabric,n=e.selectedIntervals,a=e.storedState;return o.createElement("group",null,o.createElement("lineSegments",{key:"lines",geometry:t.linesGeometry,material:et}),n.map((function(e){return o.createElement(tn,{key:"SI".concat(e.index),fabric:t,interval:e,storedState:a})})))}function rn(e){var t=e.fabric,n=e.stage,r=e.selectFace,i=Object(Fe.d)().raycaster,c=Object(o.useRef)(),s=Object(o.useState)(),l=Object(Ce.a)(s,2),u=l[0],f=l[1];return o.createElement("mesh",{key:"faces",ref:c,onPointerDown:function(e){return f(e)},onPointerUp:function(e){var s=c.current;if(!function(e){return e===a.Growing||e===a.Slack}(n)&&u&&s){var o=u.clientX-e.clientX,l=u.clientY-e.clientY;if(!(o*o+l*l>100)){var d=i.intersectObjects([s],!0).map((function(e){return e.faceIndex})).map((function(e){if(void 0!==e)return t.faces[e]})).reverse().pop();f(void 0),d&&r(d)}}},geometry:t.facesGeometry,material:nt})}var cn="25em",sn="26em";function on(e){var t=function(){var e=location.hash.substring(1);try{return H((function(e){return console.error(e)}),!0,decodeURIComponent(e))}catch(t){console.error("Code error",t)}}();if(t)return t;var n=re(e);return n.length>0?n[0]:K[0]}function ln(e){var t=e.fabricKernel,n=e.floatFeatures,a=e.storedState$,i=Object(o.useMemo)((function(){return t.allocateInstance()}),[]),c=Object(o.useMemo)((function(){return t.allocateInstance()}),[]),s=Object(o.useState)(),l=Object(Ce.a)(s,2),u=l[0],f=l[1],d=Object(o.useState)([]),h=Object(Ce.a)(d,2),p=h[0],v=h[1],g=Object(o.useState)([]),b=Object(Ce.a)(g,2),E=b[0],y=b[1];Object(o.useEffect)((function(){return v(E.reduce((function(e,t){var n=function(t){return!e.some((function(e){return t.index===e.index}))},a=t.pulls.filter(n),r=t.pushes.filter(n);return[].concat(Object(C.a)(e),Object(C.a)(r),Object(C.a)(a))}),[]))}),[E]);var P=Object(o.useState)((function(){return on(a.getValue())})),k=Object(Ce.a)(P,2),N=k[0],O=k[1];Object(o.useEffect)((function(){0===location.hash.length&&(location.hash=q(N.code,N.name))}),[N]);var x=Object(o.useState)(S),j=Object(Ce.a)(x,2),M=j[0],F=j[1],V=Object(o.useState)(a.getValue().rotating),T=Object(Ce.a)(V,2),L=T[0],A=T[1],R=Object(o.useState)(Ue.None),I=Object(Ce.a)(R,2),D=I[0],B=I[1],z=Object(o.useState)(a.getValue().fullScreen),Z=Object(Ce.a)(z,2),U=Z[0],Y=Z[1],G=Object(o.useState)(a.getValue().ellipsoids),X=Object(Ce.a)(G,2),$=X[0],Q=X[1];function H(e){if(i&&c){location.hash=q(e.code,e.name),i.engine.initInstance(),i.forgetDimensions(),n[r.ShapingPretenstFactor].percent=100,n[r.ShapingDrag].percent=100,n[r.ShapingStiffnessFactor].percent=100,a.next(ie(a.getValue(),{ellipsoids:!1})),Object.keys(n).map((function(e){return n[e]})).forEach((function(e){return i.applyFeature(e)}));f(new Ye((function(e){return function(e,t){if(t===m.FacePull)throw new Error;return e[r[r[t+r.NexusPushLength]]].numeric}(n,e)}),(function(e){return a.getValue().featureValues[e].numeric}),i,c,e))}}function J(e){a.next(ie(a.getValue(),{fullScreen:e}))}return Object(o.useEffect)((function(){return F(S)}),[$]),Object(o.useEffect)((function(){var e=a.subscribe((function(e){if(Y(e.fullScreen),Q(e.ellipsoids),A(e.rotating),u){var t=u.instance.engine;t.setColoring(e.showPushes,e.showPulls),t.setSurfaceCharacter(e.surfaceCharacter)}}));return function(){return e.unsubscribe()}}),[u]),Object(o.useEffect)((function(){var e=Object.keys(n).map((function(e){return n[e]})).map((function(e){return e.observable.subscribe((function(t){if(u){u.instance.applyFeature(e);var n=w(e.config.feature);if(void 0!==n){var a=u.instance.engine;u.intervals.filter((function(e){return e.intervalRole===n})).forEach((function(t){var n=e.numeric*_(t.scale);a.changeRestLength(t.index,n,500)}))}}}))}));return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[u]),Object(o.useEffect)((function(){var e=setTimeout((function(){u||H(N)}),200);return function(){return clearTimeout(e)}}),[N]),o.createElement(o.Fragment,null,U?o.createElement(Ve.a,{id:"to-full-screen",color:"dark",onClick:function(){return J(!1)}},o.createElement(Me.d,null),o.createElement("br",null),o.createElement(Me.P,null),o.createElement("br",null),o.createElement(Me.d,null)):o.createElement("div",{id:"left-side",style:{visibility:U?"collapse":"visible",width:cn}},o.createElement(Ft,{floatFeatures:n,rootTenscript:N,setRootTenscript:O,fabric:u,setFabric:f,selectedIntervals:p,shapeSelection:D,setShapeSelection:B,selectedFaces:E,clearSelectedFaces:function(){return y([])},runTenscript:H,toFullScreen:function(){return J(!0)},visibleRoles:M,setVisibleRoles:F,storedState$:a})),o.createElement("div",{style:{position:"absolute",left:U?0:sn,right:0,height:"100%"}},u?o.createElement("div",{className:"h-100"},o.createElement(un,{fabric:u}),o.createElement("div",{id:"bottom-middle"},o.createElement(Te.a,null,o.createElement(Ve.a,{color:$?"warning":"secondary",onClick:function(){return a.next(ie(a.getValue(),{ellipsoids:!$}))}},o.createElement(Me.j,null)),o.createElement(Ve.a,{color:D===Ue.Faces?"warning":"secondary",disabled:$&&D===Ue.None,onClick:function(){return B(D!==Ue.Faces?Ue.Faces:Ue.None)}},o.createElement("span",null,o.createElement(Me.y,null))),o.createElement(Ve.a,{color:L?"warning":"secondary",onClick:function(){return a.next(ie(a.getValue(),{rotating:!L}))}},o.createElement(Me.N,null)))),o.createElement("div",{id:"view-container",className:"h-100"},o.createElement(Fe.a,{style:{backgroundColor:"black",borderStyle:"solid",borderColor:D===Ue.Faces||$?"#f0ad4e":"black",cursor:D===Ue.Faces?"pointer":"all-scroll",borderWidth:"2px"}},o.createElement(Kt,{fabric:u,fabricError:function(e){console.error(e);var t=u.tenscript;f(void 0),setTimeout((function(){return H(t)}),1e3)},selectedIntervals:p,selectedFaces:E,setSelectedFaces:y,shapeSelection:D,ellipsoids:$,visibleRoles:M,storedState$:a})))):o.createElement("div",{id:"tensegrity-view",className:"h-100"},o.createElement("div",{style:{position:"relative",top:"50%",left:"50%"}},o.createElement(Ve.a,{onClick:function(){return H(N)}},o.createElement("h6",null,N.name),o.createElement("h1",null,o.createElement(Me.H,null)))))))}function un(e){var t=e.fabric,n=Object(o.useState)(t.life),r=Object(Ce.a)(n,2),i=r[0],c=r[1];return Object(o.useEffect)((function(){var e=t.life$.subscribe(c);return function(){return e.unsubscribe()}}),[t]),o.createElement("div",{id:"top-middle"},o.createElement("span",null,a[i.stage])," ",o.createElement("i",null,'"',t.tenscript.name,'"'))}n(608),n(609);function fn(){return(fn=Object(s.a)(c.a.mark((function e(){var t,n,a,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,getFabricEngine();case 2:t=e.sent,n=new Ne(t),a=document.getElementById("root"),(r=new u.BehaviorSubject(se(ge))).subscribe((function(e){return t=e,void localStorage.setItem(ce,JSON.stringify(t));var t})),l.render(o.createElement(ln,{fabricKernel:n,floatFeatures:Ee(r),storedState$:r}),a),xe();case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){fn.apply(this,arguments)}()}},[[255,1,2]]]);
//# sourceMappingURL=main.ff14a7a6.chunk.js.map