(window.webpackJsonppretenst=window.webpackJsonppretenst||[]).push([[4],{568:function(e,t){},570:function(e,t){},8:function(e,t,n){"use strict";n.r(t);var r,a=n(0),i=n.n(a),o=n(1),c=n(10),s=n(62),l=n(63),u=n(16),h=n(221),f=n(36),d=n(7),m=new u.Vector3(1,0,0),g=new u.Vector3(0,0,1),p=new u.Vector3(0,1,0);!function(e){e[e.Push=0]="Push",e[e.Pull=1]="Pull",e[e.PhiPush=2]="PhiPush",e[e.RootPush=3]="RootPush",e[e.PhiTriangle=4]="PhiTriangle",e[e.Twist=5]="Twist",e[e.InterTwist=6]="InterTwist",e[e.Ring=7]="Ring",e[e.Cross=8]="Cross",e[e.BowMid=9]="BowMid",e[e.BowEnd=10]="BowEnd",e[e.RadialPull=11]="RadialPull",e[e.ConnectorPull=12]="ConnectorPull",e[e.DistancerPull=13]="DistancerPull"}(r||(r={}));var v=1.618033988749895;function b(e){switch(e){case r.Push:case r.Pull:return 1;case r.PhiPush:return v;case r.RootPush:return 1.414213562373095;case r.PhiTriangle:case r.Twist:case r.InterTwist:return 1;case r.Ring:return Math.sqrt(2-2*Math.sqrt(2/3));case r.Cross:return Math.sqrt(1.2301705239829062);case r.BowMid:return.4;case r.BowEnd:return.6;case r.DistancerPull:return 1;default:throw new Error("role?")}}var y=Object.keys(d.WorldFeature).filter((function(e){return isNaN(parseInt(e,10))})).map((function(e){return d.WorldFeature[e]}));function w(e,t){switch(e){case r.Push:return t?"Push":"P+";case r.Pull:return t?"Pull":"P-";case r.PhiPush:return t?"Phi Push":"PP";case r.RootPush:return t?"Root Push":"RP";case r.PhiTriangle:return t?"Phi Triangle":"PT";case r.Ring:return t?"Ring":"RI";case r.Twist:return t?"Twist":"TW";case r.InterTwist:return t?"Intertwist":"IT";case r.Cross:return t?"Cross":"CR";case r.BowMid:return t?"Bow-mid":"BM";case r.BowEnd:return t?"Bow-end":"BE";case r.DistancerPull:return t?"Distancer Pull":"DP";default:return"?"}}var E,S,k,x=Object.keys(r).filter((function(e){switch(r[e]){case r.PhiPush:case r.RootPush:case r.PhiTriangle:case r.Twist:case r.InterTwist:case r.Ring:case r.Cross:case r.BowMid:case r.BowEnd:case r.DistancerPull:return!0;default:return!1}})).map((function(e){return r[e]}));function P(e){switch(e){case r.PhiPush:case r.RootPush:case r.Push:return!0}return!1}function j(e){switch(e){case d.Stage.Growing:return"Growing";case d.Stage.Shaping:return"Shaping";case d.Stage.Slack:return"Slack";case d.Stage.Pretensing:return"Pretensing";default:return"Pretenst"}}function O(){var e=location.hash;return"#bridge"===e?E.Bridge:"#gotchi"===e?E.Gotchi:e.startsWith("#sphere")?E.Sphere:E.Design}function C(e){location.hash=e,location.reload()}function F(e){var t=e.toExponential(5),n=t.indexOf("e+0");return n>0?t.substring(0,n):Math.max(t.indexOf("e-1"),t.indexOf("e-2"))>0?e.toFixed(5):Math.max(t.indexOf("e+1"),t.indexOf("e+2"))>0?e.toFixed(1):t}function V(e,t){return(new u.Vector3).subVectors(e,t).normalize()}function M(e,t){return(new u.Vector3).addVectors(e,t).normalize()}function T(e){var t=new u.Vector3;return e.forEach((function(e){return t.add(e)})),t.multiplyScalar(1/e.length)}function R(e,t,n){var r=3*t;return n?(n.set(e[r],e[r+1],e[r+2]),n):new u.Vector3(e[r],e[r+1],e[r+2])}function A(e){switch(e){case S.Left:return S.Right;case S.Right:return S.Left}}!function(e){e.Design="design",e.Gotchi="gotchi",e.Bridge="bridge",e.Sphere="sphere"}(E||(E={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"}(S||(S={})),function(e){e[e.NNN=0]="NNN",e[e.PNN=1]="PNN",e[e.NPN=2]="NPN",e[e.NNP=3]="NNP",e[e.NPP=4]="NPP",e[e.PNP=5]="PNP",e[e.PPN=6]="PPN",e[e.PPP=7]="PPP"}(k||(k={}));var D=[k.NNN,k.PNN,k.NPN,k.NNP,k.NPP,k.PNP,k.PPN,k.PPP];function N(e){var t=e.instance,n=e.index;return t.jointLocation(n)}function I(e,t){return N(e).distanceTo(N(t))}function L(e){var t=e.alpha,n=e.omega;return N(t).add(N(n)).multiplyScalar(.5)}function _(e){return I(e.alpha,e.omega)}function B(e){if(!e.push)throw new Error("No push");var t=e.push;if(t.alpha.index===e.index)return t.omega;if(t.omega.index===e.index)return t.alpha;throw new Error("Big problem")}function z(e,t){if(t.alpha.index===e.index)return t.omega;if(t.omega.index===e.index)return t.alpha;throw new Error("No other joint")}function W(e){return T(e.ends.map(N))}function G(e){return e||{_:100}}function U(e){return e._/100}function $(e){return{_:100*e}}function J(e,t){switch(e.faces.length){case 2:switch(t){case k.NNN:return e.faces[0];case k.PPP:return e.faces[1]}break;case 8:switch(t){case k.NNN:return e.faces[0];case k.PNN:return e.faces[2];case k.NPN:return e.faces[1];case k.NNP:return e.faces[3];case k.NPP:return e.faces[4];case k.PNP:return e.faces[5];case k.PPN:return e.faces[6];case k.PPP:return e.faces[7]}}throw new Error("Face ".concat(k[t]," not found in twist with ").concat(e.faces.length," faces"))}function H(){return{faces:[],intervals:[],joints:[]}}var q;function Q(){return"'Melkvonder Ulft':("+" A(".concat(4,",MA0),")+" b(".concat(4,",MA1),")+" a(".concat(4,",MA3),")+" B(".concat(4,",MA2)")+")"+":0=anchor-(".concat(25,",").concat(9,")-").concat(5,"-").concat(110)+":1=anchor-(".concat(25,",-").concat(9,")-").concat(5,"-").concat(110)+":2=anchor-(-".concat(25,",").concat(9,")-").concat(5,"-").concat(110)+":3=anchor-(-".concat(25,",-").concat(9,")-").concat(5,"-").concat(110)}function Z(e,t){switch(e){case d.WorldFeature.IntervalCountdown:return t;case d.WorldFeature.Gravity:return.03*t;case d.WorldFeature.Drag:return 2*t;case d.WorldFeature.PretensingCountdown:return 3*t;case d.WorldFeature.VisualStrain:return t;case d.WorldFeature.PretenstFactor:return 5*t;case d.WorldFeature.PushOverPull:return 4;default:return t}}function Y(e){for(var t=b(r.Cross),n=b(r.Cross),a=function(t,r){var a=n*(r?-.5:.5),i=new u.Vector3(t,7,a),o={index:e.createJoint(i).index,instance:e.instance};return e.joints.push(o),o},i=function(t,n,r){var a=G();return e.createInterval(t,n,r,a)},o=a(0,!0),c=a(0,!1),s=[[o],[c],[o],[c]],l=1;l<7;l++){var d=l*t;s[q.FrontLeft].push(a(d,!0)),s[q.FrontRight].push(a(d,!1)),s[q.BackLeft].push(a(-d,!0)),s[q.BackRight].push(a(-d,!1))}e.instance.refreshFloatView(),i(o,c,r.Pull);for(var m=function(e){return[s[0][e],s[1][e],s[2][e],s[3][e]]},g=1;g<7;g++){var p=m(g-1),v=m(g);i(v[0],v[1],r.Pull),i(v[2],v[3],r.Pull);for(var y=0;y<4;y++)i(p[y],v[y],r.Pull)}i(s[q.FrontLeft][1],s[q.BackRight][1],r.Push),i(s[q.FrontRight][1],s[q.BackLeft][1],r.Push);for(var w=2;w<7;w++){var E=m(w-2),S=m(w);i(E[0],S[1],r.Push),i(E[1],S[0],r.Push),i(E[2],S[3],r.Push),i(E[3],S[2],r.Push)}for(var x=function(e,t){var n=[[],[],[],[]];e.faces.forEach((function(e){var t=[],r=q.FrontRight,a=t.shift();if(!a)throw new Error("no top!");var i=t.length;e.ends.forEach((function(t,o){Object(h.a)(t);var c="[".concat(r,"]:[").concat(i,":").concat(k[a],"]:J").concat(o);n[r].push({face:e,name:c,arch:r,distance:i,jointIndex:o})}))}));var r=function(e){return!(e.distance>t)},a=function(e,t){var n=N(e.face.ends[e.jointIndex]),r=N(t.face.ends[t.jointIndex]);return n.lengthSq()-r.lengthSq()};return[n[q.FrontLeft].filter(r).sort(a),n[q.FrontRight].filter(r).sort(a),n[q.BackLeft].filter(r).sort(a),n[q.BackRight].filter(r).sort(a)]}(e,6),P=function(t,n){var a=r.Pull,i=$(I(t,n));return e.createInterval(t,n,a,i)},j=function(e){Object(f.a)(x[e]).forEach((function(t,n){if(0!==n){var r=s[e][1+Math.floor(n/3)],a=t.face.ends[t.jointIndex];P(r,a)}}))},O=0;O<4;O++)j(O);return P(s[q.FrontRight][0],e.joints[11]),P(s[q.FrontLeft][0],e.joints[10]),P(s[q.FrontRight][0],e.joints[9]),P(s[q.FrontLeft][0],e.joints[8]),x}!function(e){e[e.FrontLeft=0]="FrontLeft",e[e.FrontRight=1]="FrontRight",e[e.BackLeft=2]="BackLeft",e[e.BackRight=3]="BackRight"}(q||(q={}));var X=n(23),K=n(655),ee=n(49),te=n(647),ne=n(605),re=n(562),ae=n(563),ie=n.n(ae);function oe(e){return e.toFixed(5).replace(/[.]/,",")}function ce(){return(new Date).toISOString().replace(/[.].*/,"").replace(/[:T_]/g,"-")}function se(e){var t=new ie.a;t.file("joints.csv",function(e){var t=[];return t.push(["index","x","y","z"]),e.joints.forEach((function(e){return t.push([(e.index+1).toFixed(0),oe(e.x),oe(e.y),oe(e.z)])})),t.map((function(e){return e.join(";")})).join("\n")}(e)),t.file("intervals.csv",function(e){var t=[];return t.push(["joints","type","strain","stiffness","linear density","role","length"]),e.intervals.forEach((function(e){t.push(['"=""'.concat(e.joints.map((function(e){return(e+1).toFixed(0)})),'"""'),e.type,oe(e.strain),oe(e.stiffness),oe(e.linearDensity),e.role,e.length.toFixed(8)])})),t.map((function(e){return e.join(";")})).join("\n")}(e)),t.file("submerged.csv",function(e){var t=[];return t.push(["joints"]),t.map((function(e){return e.join(";")})).join("\n")}()),t.generateAsync({type:"blob",mimeType:"application/zip"}).then((function(e){re.saveAs(e,"pretenst-".concat(ce(),".zip"))}))}function le(e){var t=new ie.a;t.file("pretenst-".concat(ce(),".json"),JSON.stringify(e,void 0,2)),t.generateAsync({type:"blob",mimeType:"application/zip"}).then((function(e){re.saveAs(e,"pretenst-".concat(ce(),".zip"))}))}var ue=["#fd0000","#c94f00","#d58e1c","#897c00","#6c8901","#1d6c01","#0e4e00","#007f67","#01808b","#005da3","#0015c7","#0000ff"].reverse().map((function(e){return(new u.Color).setHex(parseInt("".concat(e.substring(1)),16))})),he=new u.MeshPhongMaterial({color:new u.Color("#181818"),side:u.FrontSide,opacity:.5}),fe=new u.LineBasicMaterial({vertexColors:!0}),de=new u.MeshPhongMaterial({color:new u.Color("#ffbf00")}),me=new u.MeshPhongMaterial({color:new u.Color("#6c72e0")});ue.map((function(e){return new u.MeshLambertMaterial({color:e})}));function ge(e){switch(e){case r.PhiPush:return"#8955fa";case r.RootPush:return"#2b38ff";case r.PhiTriangle:return"#d0c61a";case r.Twist:return"#ffffff";case r.InterTwist:return"#d0c61a";case r.Ring:return"#ff5c2b";case r.Cross:return"#28c245";case r.BowMid:case r.BowEnd:return"#4393b3";case r.DistancerPull:case r.ConnectorPull:case r.RadialPull:return"#f3f3e6";default:return}}function pe(e){var t=function(e){return new u.Color(ge(e))}(e);return new u.MeshLambertMaterial({color:t})}var ve=new u.MeshLambertMaterial({color:"#1d1d1d"}),be=[new u.Vector3(0,0,-20),new u.Vector3(-17.32,0,-10),new u.Vector3(-17.32,0,10),new u.Vector3(0,0,20),new u.Vector3(17.32,0,10),new u.Vector3(17.32,0,-10)],ye=new u.Color("tan"),we=new u.Vector3(0,1,0);function Ee(){var e=Object(c.useMemo)((function(){return function(){var e=new u.Geometry;return function(e,t){e.push.apply(e,Object(f.a)(be.map((function(e){return new u.Vector3(e.x,e.y,e.z).multiplyScalar(4)})))),e.push(new u.Vector3);for(var n=0;n<6;n++){var r=(n+1)%6,a=[we,(new u.Vector3).add(we).addScaledVector(be[n],.03).normalize(),(new u.Vector3).add(we).addScaledVector(be[r],.03).normalize()];t.push(new u.Face3(6,n,r,a,ye))}}(e.vertices,e.faces),e.vertices.forEach((function(e){return e.sub(new u.Vector3(0,.01,0))})),e}()}),[]);return c.createElement("mesh",{name:"Patches",geometry:e,material:he})}function Se(e){var t=e.tensegrity,n=Object(c.useState)(t.stage$.getValue()),r=Object(X.a)(n,2),a=r[0],i=r[1];function o(){return t.getFabricOutput(.012,.005,.015)}return Object(c.useEffect)((function(){var e=t.stage$.subscribe(i);return function(){return e.unsubscribe()}}),[t]),c.createElement("div",{id:"view-container",style:{position:"absolute",left:0,right:0,height:"100%"}},c.createElement("div",{id:"top-middle"},j(a)),c.createElement("div",{id:"bottom-right"},c.createElement(te.a,{vertical:!1},c.createElement(ne.a,{onClick:function(){return se(o())}},c.createElement(K.l,null),c.createElement(K.p,null)),c.createElement(ne.a,{onClick:function(){return le(o())}},c.createElement(K.l,null)," ",c.createElement(K.o,null)),c.createElement(ne.a,{onClick:function(){return C(E.Design)}},c.createElement(K.G,null)))),c.createElement(ee.a,{style:{backgroundColor:"black"}},c.createElement(je,null),t?c.createElement(ke,{tensegrity:t,stage:a}):c.createElement("h1",null,"No bridge")))}function ke(e){var t=e.tensegrity,n=e.stage,r=Object(ee.d)().camera,a=document.getElementById("view-container"),i=Object(ee.e)((function(e){e.minPolarAngle=0,e.maxPolarAngle=Math.PI/2,e.minDistance=.1,e.maxDistance=9e3,e.zoomSpeed=.5,e.enableZoom=!0,e.target.set(0,50,0),e.update()}),[]),o=Object(c.useState)(!0),s=Object(X.a)(o,1)[0],l=Object(c.useState)(0),h=Object(X.a)(l,2),f=h[0],m=h[1],g=Object(c.useState)(!1),p=Object(X.a)(g,2),v=p[0],b=p[1],y=Object(c.useState)([]),w=Object(X.a)(y,2),E=w[0],S=w[1];return Object(ee.c)((function(){var e=i.current;switch(e.target.copy(t.instance.midpoint),e.update(),d.Stage.Slack){case d.Stage.Growing:m(f+1);break;case d.Stage.Shaping:if(n===d.Stage.Growing){m(0);break}if(f<1e3){m(f+1);break}1e3===f&&(console.log("Ribbon!"),S(Y(t)),e.autoRotate=!0,e.rotateSpeed=5,m(0));break;case d.Stage.Slack:m(0);break;case d.Stage.Pretensing:m(f+1);break;case d.Stage.Pretenst:if(n===d.Stage.Pretensing){m(0);break}200===f&&(v||(b(!0),console.log("strain to stiffness",v))),m(f+1);break;default:m(f+1)}})),c.createElement("group",null,c.createElement("orbit",{ref:i,args:[r,a]}),c.createElement("scene",null,s?c.createElement("lineSegments",{key:"lines",geometry:t.instance.floatView.lineGeometry,material:fe}):c.createElement(c.Fragment,null,t.intervals.map((function(e){return c.createElement(xe,{key:"I".concat(e.index),tensegrity:t,interval:e})})),E.map((function(e){return e.map((function(e){return c.createElement(Pe,{key:e.name,hook:e})}))}))),c.createElement(Ee,null),c.createElement("ambientLight",{color:new u.Color("white"),intensity:.8}),c.createElement("directionalLight",{color:new u.Color("#FFFFFF"),intensity:2})))}function xe(e){var t=e.tensegrity,n=e.interval,r=e.onPointerDown,a=t.instance.unitVector(n.index),i=(new u.Quaternion).setFromUnitVectors(new u.Vector3(0,1,0),a),o=_(n),s=P(n.intervalRole),l=s?.012:.005,h=new u.Vector3(l,o+(s?-.03:0),l),f=new u.Vector3(.015,.015,.015);return c.createElement(c.Fragment,null,s?c.createElement(c.Fragment,null,c.createElement("mesh",{position:L(n),rotation:(new u.Euler).setFromQuaternion(i),scale:h,onPointerDown:r},c.createElement("meshLambertMaterial",{attach:"material",color:new u.Color("#bd7b14")}),c.createElement("cylinderGeometry",{attach:"geometry",args:[.5,.5,1,6,1]})),c.createElement("mesh",{position:L(n),rotation:(new u.Euler).setFromQuaternion(i),scale:h,matrixWorldNeedsUpdate:!0,onPointerDown:r},c.createElement("meshLambertMaterial",{attach:"material",color:new u.Color("#ec8700")}),c.createElement("cylinderGeometry",{attach:"geometry",args:[1,1,.85,12,1]})),c.createElement("mesh",{position:N(n.alpha),scale:f,onPointerDown:r},c.createElement("sphereGeometry",{attach:"geometry",args:[1,32,8]}),c.createElement("meshPhongMaterial",{attach:"material",color:new u.Color("#2bc19d")})),c.createElement("mesh",{position:N(n.omega),scale:f,onPointerDown:r},c.createElement("sphereGeometry",{attach:"geometry",args:[1,32,8]}),c.createElement("meshPhongMaterial",{attach:"material",color:new u.Color("#2bc19d")}))):c.createElement("mesh",{position:L(n),rotation:(new u.Euler).setFromQuaternion(i),scale:h,onPointerDown:r},c.createElement("meshLambertMaterial",{attach:"material",color:new u.Color("#faf8f8")}),c.createElement("cylinderGeometry",{attach:"geometry",args:[1,1,1,6,1]})))}function Pe(e){var t=e.hook,n=new u.Vector3(.04,.04,.04),r=t.face;return c.createElement(c.Fragment,null,r.ends.map((function(e){return c.createElement("mesh",{key:"hook-".concat(e.index),position:N(e),scale:n,matrixWorldNeedsUpdate:!0},c.createElement("sphereGeometry",{attach:"geometry",args:[1,32,8]}),c.createElement("meshPhongMaterial",{attach:"material",color:new u.Color("#43d903")}))})))}function je(e){var t=Object(c.useRef)(),n=Object(ee.d)().setDefaultCamera;return Object(c.useEffect)((function(){var e=t.current;if(!e)throw new Error("No camera");e.fov=50,e.position.set(35,10,30),n(e)}),[]),Object(ee.c)((function(){var e=t.current;if(!e)throw new Error("No camera");e.updateMatrixWorld()})),c.createElement("perspectiveCamera",Object.assign({ref:t},e))}var Oe=n(18),Ce=n(22),Fe=function(){function e(t,n,r,a){var i=this;Object(Oe.a)(this,e),this.fabric=void 0,this.world=void 0,this.view=void 0,this.floatView=function(){var e=new Float32Array(0);return{jointCount:0,intervalCount:0,faceCount:0,lineGeometry:new u.BufferGeometry,faceGeometry:new u.BufferGeometry,jointLocations:e,unitVectors:e,idealLengths:e,strains:e,strainLimits:new Float32Array(4),strainNuances:e,stiffnesses:e,linearDensities:e}}(),this.adoptFabric=void 0,this.midpoint=new u.Vector3(0,0,0),this.forward=new u.Vector3(1,0,0),this.right=new u.Vector3(0,0,1),this.left=new u.Vector3(0,0,-1),this.featuresToApply=[],this.fabricBackup=void 0,this.world=r,this.adoptFabric=function(e){return i.free(),i.fabric=e,i.view=t.View.on_fabric(e),i},this.adoptFabric(a||t.Fabric.new(n))}return Object(Ce.a)(e,[{key:"iterate",value:function(){var e=this.fabric.iterate(this.world);this.refreshFloatView();var t=this.featuresToApply.shift();return t&&this.world.set_float_value(t.worldFeature,t.numeric),e}},{key:"showFrozen",value:function(e){this.updateFloatView(!0,e)}},{key:"snapshot",value:function(){console.log("snapshot"),this.fabricBackup=this.fabricClone}},{key:"restoreSnapshot",value:function(){console.log("restoreSnapshot");var e=this.fabricBackup;if(!e)throw new Error("Missing backup");this.adoptFabric(e.clone())}},{key:"refreshFloatView",value:function(){this.view.render(this.fabric,this.world),this.midpoint.set(this.view.midpoint_x(),this.view.midpoint_y(),this.view.midpoint_z()),this.updateFloatView(!1,!1)}},{key:"clear",value:function(){return this.fabric.clear(),this.refreshFloatView(),this}},{key:"applyFeature",value:function(e){this.featuresToApply.push(e)}},{key:"jointLocation",value:function(e){return R(this.floatView.jointLocations,e)}},{key:"apply",value:function(e){this.fabric.apply_matrix4(new Float32Array(e.toArray())),this.refreshFloatView()}},{key:"unitVector",value:function(e){return R(this.floatView.unitVectors,e)}},{key:"free",value:function(){var e=this.fabric;e&&e.free();var t=this.view;t&&t.free()}},{key:"updateFloatView",value:function(e,t){var n=this.fabric,r=this.view,a=n.get_joint_count(),i=n.get_interval_count(),o=n.get_face_count(),c=this.floatView;if(c.jointCount!==a||c.intervalCount!==i||c.faceCount!==o){c.jointCount=a,c.intervalCount=i,c.faceCount=o,c.lineGeometry.dispose(),c.lineGeometry=new u.BufferGeometry;var s=new Float32Array(3*i*2);r.copy_line_locations_to(s),c.lineGeometry.setAttribute("position",new u.Float32BufferAttribute(s,3));var l=new Float32Array(3*i*2);if(e)if(t){l.fill(0);for(var h=1;h<l.length;h+=3)l[h]=1}else l.fill(1);else r.copy_line_colors_to(l);c.lineGeometry.setAttribute("color",new u.Float32BufferAttribute(l,3)),c.faceGeometry.dispose(),c.faceGeometry=new u.BufferGeometry;var f=new Float32Array(3*o*3);r.copy_face_vertex_locations_to(f),c.faceGeometry.setAttribute("position",new u.Float32BufferAttribute(f,3));var d=new Float32Array(3*o*3);r.copy_face_normals_to(d),c.faceGeometry.setAttribute("normal",new u.Float32BufferAttribute(d,3)),c.jointLocations=new Float32Array(3*a),c.unitVectors=new Float32Array(3*i),c.idealLengths=new Float32Array(i),c.strains=new Float32Array(i),c.strainNuances=new Float32Array(i),c.stiffnesses=new Float32Array(i),c.linearDensities=new Float32Array(i)}else{var m=this.floatView.lineGeometry.attributes,g=this.floatView.faceGeometry.attributes;if(m.position){var v=m.position;r.copy_line_locations_to(v.array),v.needsUpdate=!0;var b=m.color,y=b.array;if(e)if(t){y.fill(0);for(var w=1;w<y.length;w+=3)y[w]=1}else y.fill(1);else r.copy_line_colors_to(y);b.needsUpdate=!0;var E=g.position;r.copy_face_vertex_locations_to(E.array),E.needsUpdate=!0;var S=g.normal;r.copy_face_normals_to(S.array),S.needsUpdate=!0}}r.copy_joint_locations_to(c.jointLocations),r.copy_unit_vectors_to(c.unitVectors),r.copy_ideal_lengths_to(c.idealLengths),r.copy_strains_to(c.strains),r.copy_strain_limits_to(c.strainLimits),r.copy_strain_nuances_to(c.strainNuances),r.copy_stiffnesses_to(c.stiffnesses),r.copy_linear_densities_to(c.linearDensities);var k=c.jointLocations;!function(e,t,n){var r=3*e,a=3*t;n.set(k[a]-k[r],k[a+1]-k[r+1],k[a+2]-k[r+2])}(2,1,this.forward),this.forward.y=0,this.forward.normalize(),this.right.crossVectors(this.forward,p).normalize(),this.left.set(0,0,0).sub(this.right)}},{key:"stage",get:function(){return this.fabric.get_stage()},set:function(e){this.fabric.request_stage(e,this.world)||console.error("Could not move to stage ".concat(e,"!"))}},{key:"fabricClone",get:function(){return this.fabric.clone()}}]),e}();var Ve,Me=n(44);!function(e){e.Script="Script",e.Phase="Phase",e.Shape="Shape",e.Live="Live",e.Frozen="Frozen"}(Ve||(Ve={}));function Te(e,t){var n=e.getValue();return e.next(Object(Me.a)({},n,{nonce:n.nonce+1},t))}function Re(e){localStorage.setItem("State",JSON.stringify(e))}function Ae(e,t){var n=localStorage.getItem("State");if(n){var r=JSON.parse(n);if("2020-09-24"===r.version)return r}return function(e,t){var n=y.map(e).reduce((function(e,n){return e[n.feature]={percent:100,numeric:t(n.feature)},e}),{});return{version:"2020-09-24",nonce:0,surfaceCharacter:d.SurfaceCharacter.Frozen,featureValues:n,controlTab:Ve.Script,demoCount:0,fullScreen:!0,polygons:!1,rotating:!0,visibleRoles:x,pushBottom:0,pushTop:1,pullBottom:0,pullTop:1}}(e,t)}function De(e){switch(e){case d.WorldFeature.Gravity:return{feature:e,name:"Gravity",percents:[0,10,25,50,100,200,500,1e3]};case d.WorldFeature.Antigravity:return{feature:e,name:"Antigravity",percents:[5,25,50,100,150,200,500]};case d.WorldFeature.ShapingDrag:return{feature:e,name:"Shaping Drag",percents:[0,10,50,100,200,500]};case d.WorldFeature.Drag:return{feature:e,name:"Drag",percents:[0,10,50,100,150,200,500,1e3]};case d.WorldFeature.ShapingPretenstFactor:return{feature:e,name:"Shaping Pretenst factor",percents:[0,1,2,3,5,10,20,50,100]};case d.WorldFeature.PretenstFactor:return{feature:e,name:"Pretenst factor",percents:[0,50,90,100,125,150,200,300,500]};case d.WorldFeature.IterationsPerFrame:return{feature:e,name:"Iterations per frame",percents:[2,10,25,50,100,200,300,500]};case d.WorldFeature.IntervalCountdown:return{feature:e,name:"Interval Countdown",percents:[10,20,30,100,150,400,1e3,1e4]};case d.WorldFeature.PretensingCountdown:return{feature:e,name:"Slack to Pretenst countdown",percents:[50,75,90,100,125,150,200]};case d.WorldFeature.VisualStrain:return{feature:e,name:"Visual Strain",percents:[0,10,50,100,200,300,500,1e3,2e3,3e3]};case d.WorldFeature.PushOverPull:return{feature:e,name:"Compression/Tension",percents:[10,25,50,100,200,300,400,500,600,700]};default:throw new Error("Feature?")}}var Ne=function(){function e(t,n,r){Object(Oe.a)(this,e),this.config=t,this.defaultValue=n,this.value$=void 0;var a=r.getValue().featureValues[t.feature],i=void 0!==a?a:{numeric:this.defaultValue,percent:100};this.value$=new l.BehaviorSubject(i),this.value$.subscribe((function(e){var n=r.getValue(),a=Object(Me.a)({},n.featureValues);a[t.feature]=e,Te(r,{featureValues:a})}))}return Object(Ce.a)(e,[{key:"value",get:function(){return this.value$.getValue()}},{key:"title",get:function(){return this.config.name}},{key:"percentChoices",get:function(){return this.config.percents}},{key:"numeric",get:function(){return this.value$.getValue().numeric}},{key:"formatted",get:function(){return F(this.numeric)}},{key:"percent",get:function(){return this.value$.getValue().percent},set:function(e){this.value$.next({numeric:this.defaultValue*e/100,percent:e})}},{key:"observable",get:function(){return this.value$}},{key:"worldFeature",get:function(){return this.config.feature}}]),e}();function Ie(e,t){var n={};return y.map(De).forEach((function(r){n[r.feature]=new Ne(r,t(r.feature),e)})),n}var Le;function _e(e){e._;var t=e.b,n=e.c,r=e.d,a=e.B,i=e.C,o=e.D,c=e.Mb,s=e.Mc,l=e.Md,u=e.MB,h=e.MC,f=e.MD;return!!(t||n||r||a||i||o||c||s||l||u||h||f)}!function(e){e[e.Subtree=0]="Subtree",e[e.BaseFace=1]="BaseFace",e[e.JoinFaces=2]="JoinFaces",e[e.FaceDistance=3]="FaceDistance",e[e.Anchor=4]="Anchor"}(Le||(Le={}));var Be=/([LR]?)(\d*)(\(.*\))/;function ze(e){return JSON.stringify(e).replace(/[_.:"]/g,"").replace(/[{]/g,"(").replace(/[}]/g,")").replace(/([ABCDabcdSM])\((\d*)\)/g,(function(e){return"".concat(arguments.length<=1?void 0:arguments[1]).concat(arguments.length<=2?void 0:arguments[2])}))}function We(e,t,n,r,a,i){var o=n>3?n.toFixed(0):"",c=function(e){return e===S.Left?"L":"R"}(t)+o+ze(r),s=[];Object.keys(a).forEach((function(e){var t=a[e];switch(t.action){case Le.Subtree:var n=t.tree;if(!n)throw new Error("Missing tree");s.push("".concat(e,"=subtree").concat(ze(n)));break;case Le.BaseFace:case Le.JoinFaces:break;case Le.FaceDistance:if(!t.scale)throw new Error("Missing scale");s.push("".concat(e,"=face-distance-").concat(t.scale._));break;case Le.Anchor:var r=t.point,i=t.scale;if(!r||!i)throw new Error("Bad anchor");var o=function(e){return e.toFixed(1)};s.push("".concat(e,"=anchor-(").concat(o(r.x),",").concat(o(r.z),")-").concat(-r.y,"-").concat(i._))}}));var l=s.length>0?":".concat(s.join(":")):"";return{name:e,tree:r,spin:t,pushesPerTwist:n,marks:a,code:"'".concat(e,"':").concat(c).concat(l),fromUrl:i}}function Ge(e){return"aBCDbcdA".indexOf(e)>=0}function Ue(e,t){return t["M".concat("aBCDbcdA"[e])]}function $e(e){return"0123456789".indexOf(e)>=0}function Je(e){if(!e.match(/^\d+$/))throw new Error("Not a number: ".concat(e));return parseInt(e,10)}function He(e){var t=e.replace(/[\n\r\t]/g,"").split(":"),n=t.find((function(e){return e.startsWith("'")&&e.endsWith("'")})),r=function(e){var t=Be.exec(e);if(!t)throw new Error("Couldn't parse");var n="R"===t[1]?S.Right:S.Left,r=0===t[2].length?3:parseInt(t[2],10);return{mainCode:t[3],spin:n,pushesPerTwist:r}}(t.find((function(e){return Be.test(e)}))||"(0)"),a=r.mainCode,i=r.spin,o=r.pushesPerTwist,c={};return t.filter((function(e){return e.match(/^\d+=.*$/)})).forEach((function(e){var t=e.indexOf("="),n=Number(e.substring(0,t));c[n]=e.substring(t+1)})),{name:n?n.replace(/'/g,""):"",spin:i,pushesPerTwist:o,mainCode:a,markCode:c}}function qe(e,t){var n=e.indexOf(","),r=n>=0;if("("!==e.charAt(0))return r?{content:e.substring(0,n),skip:n}:{content:e,skip:e.length};var a=function(e){if("("!==e.charAt(0))throw new Error('Code must start with "(": '.concat(e," ").concat(e.charAt(0)));for(var t=0,n=0;n<e.length;n++){var r=e.charAt(n);if("("===r)t++;else if(")"===r&&0===--t)return n}throw new Error("No matching end bracket: |".concat(e,"|"))}(e);return{content:t?e.substring(1,a):e.substring(0,a+1),skip:a+1}}function Qe(e,t,n){function r(e){var t=qe(e,!0).content,n={};function a(e){var n=qe(t.substring(e),!1),a=n.content,i=n.skip;return{codeTree:r(a),skip:i}}for(var i=0;i<t.length;i++){var o=t.charAt(i);if(Ge(o)){var c=a(i+1);if(!c.codeTree)throw new Error("No subtree: ".concat(t.substring(i)));n[o]=c.codeTree,i+=c.skip}else if($e(o)){var s=qe(t,!1);n._=Je(s.content),i+=s.skip}else switch(o){case"S":var l=qe(t.substring(i+1),!0);n.S={_:Je(l.content)},i+=l.skip;break;case"M":var u=t.charAt(i+1),h=qe(t.substring(i+2),!0);n["M".concat(u)]={_:Je(h.content)},i+=h.skip+1;break;case",":case" ":break;default:throw new Error("Unexpected character: ".concat(o))}}return 0===Object.keys(n).length?void 0:n}try{if(!n||0===n.length)return void e("No code to parse");var a=He(n),i=a.name,o=a.spin,c=a.pushesPerTwist,s=a.mainCode,l=a.markCode;if(!i.length)return;var h=r(s);if(!h)return;var f={};return Object.keys(l).forEach((function(e){var t=l[e];if(t.startsWith("subtree")){var n=r(t.substring("subtree".length));f[e]={action:Le.Subtree,tree:n}}else if(t.startsWith("base-face"))f[e]={action:Le.BaseFace};else if(t.startsWith("join-faces"))f[e]={action:Le.JoinFaces};else if(t.startsWith("face-distance-")){var a={_:parseInt(t.split("-")[2],10)};f[e]={action:Le.FaceDistance,scale:a}}else{var i=t.match(/anchor-\(([0-9.-]*),([0-9.-]*)\)-(\d*)-(\d*)/);if(!i)throw new Error("Unrecognized mark code: [".concat(t,"]"));var o=parseFloat(i[1]),c=parseFloat(i[2]),s=parseFloat(i[3]),h={_:parseInt(i[4],10)},d=new u.Vector3(o,-s,c);f[e]={action:Le.Anchor,point:d,scale:h}}})),We(i,o,c,h,f,t)}catch(d){return void e(d.message)}}function Ze(e){throw new Error("Unable to parse: ".concat(e))}var Ye=["'One':(1)","'Six':(6)","'Axoneme':(30,S95)","'Knee':(3,b3)","'Snelson Star':(a(15,S90),b(15,S90),c(15,S90),d(15,S90))","'Tripod with Knees':R(A5,B(7,c(5,S90),S90),C(7,c(5,S90),S90),D(7,c(5,S90),S90))","'Pretenst Lander':(B(15,S90),C(15,S90),D(15,S90))","'Zig Zag Loop':(d(3,MA0),c(7,b(7,d(7,d(7,d(7,d(3,MA0)))))))","'Bulge Ring':(A(15,S90, MA1), a(16, S90, MA1))","'Ring':(A(19,MA1),a(18,MA1))","'Convergence':(a1,b(15,S92,MA1),c(15,S92,MA1),d(15,S92,MA1))","'Halo by Crane':L(5,S92,b(12,S92,MA1),d(11,S92,MA1))","'Thick Tripod':(A3,B(8,MA1),C(8,MA1),D(8,MA1)):1=face-distance-35","'Diamond':R(a(5,b(5,c(5,c(2,MA3)),d(5,b(2,MA4))),c(5,d(5,b(2,MA5)),c(5,c(2,MA1))),d(5,c(5,c(2,MA6)),d(5,b(2,MA2)))),b(5,b(5,d(2,MA3)),c(5,c(2,MA2))),c(5,b(5,d(2,MA6)),c(5,c(2,MA5))),d(5,c(5,c(2,MA4)),b(5,d(2,MA1))))","'Composed':(6,b(4,MA0),c(4,MA0),d(4,MA0)):0=subtree(b5,c5,d5)","'Equus Lunae':L(A(16,S95,Mb0),b(16,S95,Md0),a(16,S95,Md0),B(16,Mb0,S95)):0=face-distance-60","'Infinity':(a(16,S90,MA1),b(16,S90,MA2),B(16,S90,MA1),A(16,S90,MA2))","'Binfinity':(d(16,S90,MA4),C(16,S90,MA4),c(16,S90,MA3),D(16,S90,MA3),a(16,S90,MA1),b(16,S90,MA2),B(16,S90,MA1),A(16,S90,MA2))","'Mobiosity':(d(16,S90,MA4),C(16,S90,MA4),c(16,S90,MA3),D(16,S90,MA2),a(16,S90,MA1),b(16,S90,MA2),B(16,S90,MA1),A(16,S90,MA3))","'Cup':L24(15,S105)","'Torus':L24(A(13,S95,MA1),a(14,S95,MA1))","'Pretenst Squared':L(a(3,MA1),A(2,MA1)):1=face-distance-70"].map((function(e){return Qe(Ze,!1,e)}));function Xe(e,t,n,r,a){var i,o,c=e.builder,s=e.twist,l=e.marks,u=J(s,n),h=c.createTwistOn(u,a,r);return 0===t._&&(i=h,o=t,D.forEach((function(e){var t=Ue(e,o);t&&(J(i,e).mark=t)}))),{tree:t,twist:h,builder:c,marks:l,reorient:!1}}function Ke(e){var t=[];return e.forEach((function(e){var n=e.tree,r=e.marks,a=e.builder,i=e.reorient,o=n._;if(o){var c=o-1,s=Object(Me.a)({},n,{_:c}),l=_e(n)&&0===c;t.push(Xe(e,s,k.PPP,l,G(n.S)))}else{if(i){var h=n.A,f=n.a,d=n.B,m=n.b;if(!(!f||!h||!m||!d)){var g=a.tensegrity.joints.map(N);a.tensegrity.instance.apply(function(e,t){var n=V(e[0],e[1]),r=V(e[3],e[2]),a=V(e[5],e[4]),i=e.reduce((function(e,t){return e.add(t)}),new u.Vector3).multiplyScalar(1/e.length),o=(new u.Matrix4).makeBasis(n,r,a).setPosition(i),c=(new u.Matrix4).makeRotationX(-.27*Math.PI),s=(new u.Matrix4).makeRotationY(-t*Math.PI/3);return(new u.Matrix4).getInverse(o.multiply(c).multiply(s))}(g,0))}}D.forEach((function(a){var i=function(e,t){return t["aBCDbcdA"[e]]}(a,n),o=Ue(a,n);if(i){var c=i._?i._-1:0,s=Object(Me.a)({},i,{_:c}),l=_e(i)&&0===c;t.push(Xe(e,s,a,l,G(i.S)))}else if(o){var u=r[o._];if(u&&u.action===Le.Subtree){var h=u.tree;if(!h)throw new Error("Missing subtree");!function(e,t){t["M".concat("aBCDbcdA"[e])]=void 0}(a,n);var f=_e(h);t.push(Xe(e,h,a,f,G(h.S)))}}}))}})),t}var et=function(){function e(t){Object(Oe.a)(this,e),this.tensegrity=t}return Object(Ce.a)(e,[{key:"createBud",value:function(e){var t=e.spin,n=e.tree,r=e.marks,a=void 0===n._,i=_e(n)&&a;return{builder:this,tree:n,twist:this.createTwistAt(new u.Vector3,t,G(),i),marks:r,reorient:a}}},{key:"createTwistOn",value:function(e,t,n){var a=U(e.scale),i=$(U(t)*a);if(n){var o=this.createTwist(rt(e,i),i,A(e.spin),r.PhiPush),c=J(o,k.PPP),s=this.createTwist(rt(c,i),i,A(c.spin),r.PhiPush),l=this.createOmniTwist(o,s);return this.connect(e,J(l,k.NNN),tt(e.omni,n)),l}var u=rt(e,i),h=this.createTwist(u,i,A(e.spin),r.RootPush);return this.connect(e,J(h,k.NNN),tt(e.omni,n)),h}},{key:"faceToOrigin",value:function(e){var t=this.tensegrity.instance;t.apply(function(e){var t=e.ends.map(N),n=T(t),r=(new u.Vector3).subVectors(t[1],n).normalize(),a=(new u.Vector3).subVectors(t[0],n).normalize(),i=(new u.Vector3).crossVectors(r,a).normalize();a.crossVectors(r,i).normalize();var o=(new u.Matrix4).makeBasis(r,i,a).setPosition(n);return(new u.Matrix4).getInverse(o)}(e)),t.refreshFloatView()}},{key:"createRadialPulls",value:function(e,t){var n=this,r=function(){var t=$(function(e){return e.reduce((function(e,t){return e+U(t.scale)}),0)/e.length}(e)),r=function(e){return e.reduce((function(e,t){return e.add(W(t))}),new u.Vector3).multiplyScalar(1/e.length)}(e),a=n.createTwistAt(r,S.Left,t,!0);return n.tensegrity.instance.refreshFloatView(),e.map((function(e){var t=a.faces.filter((function(t){var n=t.spin;return t.pulls.length>0&&n!==e.spin})),r=W(e),i=t.reduce((function(e,t){return W(e).distanceTo(r)<W(t).distanceTo(r)?e:t}));return n.tensegrity.createRadialPull(i,e)}))};if(!t||t.action===Le.FaceDistance){var a=t?t.scale:$(.75);if(!a)throw new Error("Missing pull scale");var i=[];return e.forEach((function(t,r){e.forEach((function(e,o){r<=o||i.push(n.tensegrity.createRadialPull(t,e,a))}))})),i}if(t.action!==Le.JoinFaces)return[];switch(e.length){case 2:return e[0].spin===e[1].spin?r():[this.tensegrity.createRadialPull(e[0],e[1])];case 3:return r();default:return[]}}},{key:"checkConnectors",value:function(e,t){var n=this;if(0===e.length)return e;var a=function(e,t){!function(e,t){for(var n=Object(f.a)(e.ends).reverse(),r=t.ends,a=[],i=0;i<n.length;i++){for(var o=0,c=0;c<n.length;c++){var s=(c+i)%n.length;o+=I(n[c],r[s]),o+=I(r[s],n[(c+1)%n.length])}a.push(o)}var l=0,u=a[l];a.forEach((function(e,t){e<u&&(l=t,u=e)})),l>0&&(t.ends=t.ends.map((function(e,n){return Object(h.a)(e),t.ends[(n+l)%t.ends.length]})))}(e,t),n.connect(e,t,tt(e.omni,t.omni))};return e.filter((function(e){var n=e.axis,i=e.alpha,o=e.omega,c=e.alphaRays,s=e.omegaRays;if(n.intervalRole===r.ConnectorPull&&I(n.alpha,n.omega)<=.05)return a(i,o),t(n),c.forEach(t),s.forEach(t),!1;return!0}))}},{key:"createTwistAt",value:function(e,t,n,a){var i=this.tensegrity.pushesPerTwist;if(a){var o=this.createTwist(nt(e,i,t,n),n,t,r.PhiPush),c=J(o,k.PPP),s=this.createTwist(rt(c,n),n,A(c.spin),r.PhiPush);return this.createOmniTwist(o,s)}return this.createTwist(nt(e,i,t,n),n,t,r.RootPush)}},{key:"createOmniTwist",value:function(e,t){var n=this,r=e.scale,a=this.connect(J(e,k.PPP),J(t,k.NNN),tt(!0,!0)),i=[].concat(Object(f.a)(e.pulls),Object(f.a)(t.pulls),Object(f.a)(a)),o=function(e,t){var a=i.filter((function(t){var n=t.alpha,r=t.omega;return e.index===n.index||e.index===r.index})),o=a.map((function(t){return z(e,t)})),c=i.find((function(e){var t=e.alpha,n=e.omega;return t.index===o[0].index&&n.index===o[1].index})),s=i.find((function(e){var t=e.alpha,n=e.omega;return t.index===o[1].index&&n.index===o[0].index}));if(o.push(e),t===S.Left&&o.reverse(),c)a.push(c);else{if(!s)throw new Error("Interval not found");a.push(s)}return n.tensegrity.createFace(o,!0,t,r,a)},c=t.faces[1],s=c.ends.map((function(e){return o(e,A(c.spin))})),l=e.faces[0],u=l.ends.map((function(e){return o(e,A(l.spin))}));l.omni=c.omni=!0;var h=[].concat(Object(f.a)(e.pushes),Object(f.a)(t.pushes)),d=[l].concat(Object(f.a)(u),Object(f.a)(s),[c]);return{scale:r,pushes:h,pulls:i,faces:d}}},{key:"connect",value:function(e,t,n){for(var a=Object(f.a)(e.ends).reverse(),i=t.ends,o=a.map(B),c=a,s=i,l=i.map(B),u=$((U(e.scale)+U(t.scale))/2),h=[],d=0;d<c.length;d++){var m=o[d],g=o[(d+1)%o.length],p=c[d],v=c[(d+1)%c.length],b=s[d],y=l[d];h.push(this.tensegrity.createInterval(p,b,n.ring,u)),h.push(this.tensegrity.createInterval(b,v,n.ring,u)),e.spin===S.Left?h.push(this.tensegrity.createInterval(b,g,n.down,u)):h.push(this.tensegrity.createInterval(b,m,n.down,u)),t.spin===S.Left?h.push(this.tensegrity.createInterval(v,y,n.up,u)):h.push(this.tensegrity.createInterval(p,y,n.up,u))}if(n.ring===r.Ring)for(var w=$((U(e.scale)+U(t.scale))/2),E=0;E<c.length;E++){var k=[].concat(Object(f.a)(e.pulls),Object(f.a)(t.pulls)),x=o[E],P=o[(E+1)%o.length],j=c[E],O=c[(E+1)%c.length],C=s[E],F=s[(E+1)%s.length],V=s[(E+s.length-1)%s.length],M=l[E];e.spin===S.Left?this.tensegrity.createFace([C,P,j],!1,A(e.spin),w,k):this.tensegrity.createFace([C,O,x],!1,A(e.spin),w,k),t.spin===S.Left?this.tensegrity.createFace([O,M,F],!1,A(t.spin),w,k):this.tensegrity.createFace([j,V,M],!1,A(t.spin),w,k)}return this.tensegrity.removeFace(t),this.tensegrity.removeFace(e),h}},{key:"createTwist",value:function(e,t,n,a){var i=this,o=e.map((function(e){var t=e.alpha,n=e.omega;return{alpha:i.tensegrity.createJoint(t),omega:i.tensegrity.createJoint(n)}}));this.tensegrity.instance.refreshFloatView();var c=o.map((function(e){return e.alpha})),s=o.map((function(e){return e.omega})).reverse(),l=c.map((function(e,n){return i.tensegrity.createInterval(e,c[(n+1)%c.length],r.InterTwist,t)})),u=this.tensegrity.createFace(c,!1,n,t,l),h=s.map((function(e,n){return i.tensegrity.createInterval(e,s[(n+1)%s.length],r.InterTwist,t)})),f=this.tensegrity.createFace(s,!1,n,t,h),d={scale:t,pushes:[],pulls:[],faces:[u,f]};return o.forEach((function(e){var n=e.alpha,r=e.omega,o=i.tensegrity.createInterval(n,r,a,t);d.pushes.push(o),n.push=r.push=o})),o.forEach((function(e,a){var c=e.alpha,s=n===S.Left?o.length-1:1,l=o[(a+s)%o.length].omega;d.pulls.push(i.tensegrity.createInterval(c,l,r.Twist,t))})),d}}]),e}();function tt(e,t){return e||t?e&&!t?{ring:r.Ring,up:r.Cross,down:r.InterTwist}:!e&&t?{ring:r.Ring,up:r.InterTwist,down:r.Cross}:{ring:r.PhiTriangle,down:r.PhiTriangle,up:r.PhiTriangle}:{ring:r.Ring,up:r.InterTwist,down:r.InterTwist}}function nt(e,t,n,r){for(var a=[],i=0;i<t;i++){var o=i*Math.PI*2/t,c=Math.cos(o),s=Math.sin(o);a.push(new u.Vector3(c,0,s).add(e))}return at(a,n,r)}function rt(e,t){return at(e.ends.map(N).reverse(),A(e.spin),t)}function at(e,t,n){for(var a=b(r.PhiTriangle)*U(n)/Math.sqrt(3),i=a*e.length/3/Math.sqrt(3),o=[],c=T(e),s=function(e){for(var t=T(e),n=e.map((function(e){return(new u.Vector3).copy(e).sub(t)})),r=new u.Vector3,a=0;a<n.length;a++){var i=n[a],o=n[(a+1)%n.length];r.add((new u.Vector3).crossVectors(o,i).normalize())}return r.normalize()}(e).multiplyScalar(a),l=0;l<e.length;l++){var h=V(e[(l+e.length-1)%e.length],c),f=V(e[l],c),d=V(e[(l+1)%e.length],c),m=V(e[(l+2)%e.length],c),g=M(f,d),p=M(d,m),v=M(f,h),y=(new u.Vector3).copy(c),w=(new u.Vector3).copy(c).add(s);t===S.Left?(y.addScaledVector(g,i),w.addScaledVector(p,i)):(y.addScaledVector(g,i),w.addScaledVector(v,i)),o.push({alpha:y,omega:w})}return o}var it=function(){function e(t){Object(Oe.a)(this,e),this.tensegrity=t}return Object(Ce.a)(e,[{key:"replaceCrosses",value:function(e){var t=this.tensegrity,n=[],a=function(e){var n=t.intervals.filter((function(e){return P(e.intervalRole)})).find((function(t){return t.alpha.index===e||t.omega.index===e}));if(!n)throw new Error("Cannot find ".concat(e));return{interval:n,joint:n.alpha.index===e?n.alpha:n.omega}},i=t.intervals.filter((function(e){return e.intervalRole===r.Cross}));i.forEach((function(e,t){var r=e.alpha.index,o=e.omega.index,c=a(r),s=a(o),l=N(e.alpha),h=N(e.omega),f=l.distanceTo(h),d=(new u.Vector3).addVectors(l,h).multiplyScalar(.5);i.forEach((function(i,m){var g=i.alpha.index,p=i.omega.index;if(!(t>=m||r===g||r===p||o===g||o===p)){var v,b,y,w,E,S=a(g),k=a(p),x=function(e,t){return e.interval.index===t.interval.index};if(x(c,S))v=c.interval,b=e.alpha,y=e.omega,w=i.alpha,E=i.omega;else if(x(c,k))v=c.interval,b=e.alpha,y=e.omega,w=i.omega,E=i.alpha;else if(x(s,S))v=s.interval,b=e.omega,y=e.alpha,w=i.alpha,E=i.omega;else{if(!x(s,k))return;v=s.interval,b=e.omega,y=e.alpha,w=i.omega,E=i.alpha}var P=N(i.alpha),j=N(i.omega),O=P.distanceTo(j),C=(new u.Vector3).addVectors(P,j).multiplyScalar(.5),F=l.distanceTo(C)/O,V=h.distanceTo(C)/O,M=P.distanceTo(d)/f,T=j.distanceTo(d)/f,R=0,A=function(e){e<.5&&R++};if(A(F),A(V),A(M),A(T),!(R<2)){var D=v.scale;n.push({scale:D,a:b,x:y,b:w,y:E})}}}))})),n.forEach((function(e){var n=e.scale,a=e.a,i=e.x,o=e.b,c=e.y;t.createInterval(i,c,r.BowMid,n);var s=t.findInterval(a,i),l=t.findInterval(a,c),u=t.findInterval(o,i),h=t.findInterval(o,c);s&&u&&l&&h?(t.removeInterval(s),t.removeInterval(h)):console.log("Cannot find intervals during optimize")}))}},{key:"stiffnessesFromStrains",value:function(e){var t=this.tensegrity.numericFeature(d.WorldFeature.PushOverPull),n=function(e,t,n){var r=e.instance.floatView,a=r.strains,i=function(e){var n=e.filter(t);return n.reduce((function(e,t){return e+a[t.index]}),0)/n.length},o=e.intervals,c=o.filter((function(e){return P(e.intervalRole)})),s=i(c),l=o.filter((function(e){return!P(e.intervalRole)})),u=i(l),h=(-n*s+u)/2,f=o.map((function(e){return t(e)?1+(a[e.index]*(P(e.intervalRole)?-n:1)-h)/h:1})),d=r.stiffnesses.map((function(e,t){return e*f[t]})),m=r.linearDensities.map((function(e,t){return Math.sqrt(e*e*f[t])}));return{stiffnesses:d,linearDensities:m}}(this.tensegrity,e,t),r=n.stiffnesses,a=n.linearDensities;this.tensegrity.instance.restoreSnapshot(),this.tensegrity.fabric.copy_material(r,a)}}]),e}();var ot=function(){function e(t,n,r,a,i){Object(Oe.a)(this,e),this.location=t,this.scale=n,this.numericFeature=r,this.instance=a,this.tenscript=i,this.stage$=void 0,this.joints=[],this.intervals=[],this.connectors=[],this.faces=[],this.pushesPerTwist=void 0,this.builder=void 0,this.jobs=[],this.buds=void 0,this.instance.clear(),this.stage$=new l.BehaviorSubject(this.fabric.get_stage()),this.pushesPerTwist=this.tenscript.pushesPerTwist,this.builder=new et(this),this.buds=[this.builder.createBud(this.tenscript)]}return Object(Ce.a)(e,[{key:"createJoint",value:function(e){var t={index:this.fabric.create_joint(e.x,e.y,e.z),instance:this.instance};return this.joints.push(t),t}},{key:"createRadialPull",value:function(e,t,n){var a=this,i=this.createJoint(W(e)),o=this.createJoint(W(t));this.instance.refreshFloatView();var c=this.creatAxis(i,o,n),s=e.ends.reduce((function(e,t){return e+I(i,t)}),0)/e.ends.length,l=t.ends.reduce((function(e,t){return e+I(o,t)}),0)/t.ends.length,u=e.ends.map((function(e){return a.createRay(i,e,s)})),h=t.ends.map((function(e){return a.createRay(o,e,l)})),f={alpha:e,omega:t,axis:c,alphaRays:u,omegaRays:h};return c.intervalRole===r.ConnectorPull&&this.connectors.push(f),f}},{key:"createInterval",value:function(e,t,n,r){var a=b(n)*U(r),i=I(e,t),o=this.numericFeature(d.WorldFeature.IntervalCountdown)*Math.abs(a-i),c=lt(r),s=c.stiffness,l=c.linearDensity,u={index:this.fabric.create_interval(e.index,t.index,P(n),i,a,s,l,o),intervalRole:n,scale:r,alpha:e,omega:t,removed:!1};return this.intervals.push(u),u}},{key:"changeIntervalScale",value:function(e,t){e.scale=$(U(e.scale)*t),this.fabric.multiply_rest_length(e.index,t,100)}},{key:"removeInterval",value:function(e){this.intervals=this.intervals.filter((function(t){return t.index!==e.index})),this.eliminateInterval(e.index),e.removed=!0}},{key:"createFace",value:function(e,t,n,r,a){var i=this,o=function(e,t){for(var n=i.intervals.length-1;n>=0;n--){var r=i.intervals[n],a=r.alpha,o=r.omega;if(a.index===e.index&&o.index===t.index||o.index===e.index&&a.index===t.index)return r}throw new Error("Could not find pull")},c=e[0],s=e[Math.floor(e.length/3)],l=e[Math.floor(2*e.length/3)],u={index:this.fabric.create_face(c.index,s.index,l.index),omni:t,spin:n,scale:r,ends:e,pulls:a||[o(c,s),o(s,l),o(l,c)]};return this.faces.push(u),u}},{key:"removeFace",value:function(e){var t=this;e.pulls.forEach((function(e){return t.removeInterval(e)})),e.pulls=[],this.fabric.remove_face(e.index),this.faces=this.faces.filter((function(t){return t.index!==e.index})),this.faces.forEach((function(t){t.index>e.index&&t.index--}))}},{key:"do",value:function(e){this.jobs.push(e)}},{key:"iterate",value:function(){var e=this,t=this.instance.iterate();if(t)return t;var n=this.jobs.shift();if(n)return n(this),!0;if(this.stage===d.Stage.Growing){if(this.buds.length>0)return this.buds=Ke(this.buds),0===this.buds.length&&function(e,t,n){var r={};return e.forEach((function(e){if(void 0!==e.mark){var t=r[e.mark._];t?t.push(e):r[e.mark._]=[e]}})),Object.entries(r).map((function(e){var a=Object(X.a)(e,2),i=a[0],o=a[1],c=t[i],s=c||(1===o.length?{action:Le.BaseFace}:{action:Le.JoinFaces});return new st(r[i],s,n)}))}(this.faces,this.tenscript.marks,this.builder).forEach((function(e){return e.execute()})),!1;if(this.connectors.length>0)return this.connectors=this.builder.checkConnectors(this.connectors,(function(t){return e.removeInterval(t)})),!1;this.stage=d.Stage.Shaping}return!1}},{key:"strainToStiffness",value:function(){new it(this).stiffnessesFromStrains((function(e){switch(e.intervalRole){case r.Push:case r.Pull:return!1;default:return!(N(e.alpha).y+N(e.omega).y<.1)}}))}},{key:"findInterval",value:function(e,t){return this.intervals.find((function(n){return n.alpha.index===e.index&&n.omega.index===t.index||n.alpha.index===t.index&&n.omega.index===e.index}))}},{key:"getFabricOutput",value:function(e,t,n){var r=this;this.instance.refreshFloatView();var a=this.instance.floatView.idealLengths,i=this.instance.floatView.strains,o=this.instance.floatView.stiffnesses,c=this.instance.floatView.linearDensities;return{name:this.tenscript.name,joints:this.joints.map((function(e){var t=N(e),a=function(e,t){var n=t.filter((function(t){return t.alpha.index===e.index||t.omega.index===e.index})),r=n.find((function(e){return P(e.intervalRole)}));if(!r)return[];var a=function(t){return(new u.Vector3).subVectors(N(z(e,t)),N(e)).normalize()},i=a(r),o=n.map((function(t){return{interval:t,unit:a(t),hole:{index:0,interval:t.index,role:w(t.intervalRole),oppositeJoint:z(e,t).index,chords:[]}}})).sort((function(e,t){var n=e.unit.dot(i),r=t.unit.dot(i);return n<r?1:n>r?-1:0}));return o.forEach((function(e,t){return e.hole.index=t})),o.forEach((function(e){var t;o.filter((function(t){return t.hole.index!==e.hole.index})).sort((t=e.unit,function(e,n){var r=e.unit.dot(t),a=n.unit.dot(t);return r<a?1:r>a?-1:0})).forEach((function(t){var n=Math.acos(e.unit.dot(t.unit)),r=2*Math.sin(n/2)*.015;e.hole.chords.push({holeIndex:t.hole.index,length:r})}))})),o.map((function(e){return e.hole}))}(e,r.intervals);return{index:e.index,radius:n,x:t.x,y:t.z,z:t.y,anchor:!1,holes:a}})),intervals:this.intervals.map((function(n){var s=P(n.intervalRole),l=s?e:t,u=_(n),h=n.alpha.index,f=n.omega.index;if(h>=r.joints.length||f>=r.joints.length)throw new Error("Joint not found ".concat(w(n.intervalRole),":").concat(h,",").concat(f,":").concat(r.joints.length));return{index:n.index,joints:[h,f],type:s?"Push":"Pull",strain:i[n.index],stiffness:o[n.index],linearDensity:c[n.index],role:w(n.intervalRole),scale:n.scale._,idealLength:a[n.index],isPush:s,length:u,radius:l}}))}}},{key:"creatAxis",value:function(e,t,n){var a=I(e,t),i=n?r.DistancerPull:r.ConnectorPull,o=n?U(n)*a:.025,c=G(),s=lt(c),l=s.stiffness,u=s.linearDensity,h=this.numericFeature(d.WorldFeature.IntervalCountdown)*Math.abs(o-a),f={index:this.fabric.create_interval(e.index,t.index,!1,a,o,l,u,h),alpha:e,omega:t,intervalRole:i,scale:c,removed:!1};return this.intervals.push(f),f}},{key:"createRay",value:function(e,t,n){var a=I(e,t),i=r.RadialPull,o=$(n),c=lt(o),s=c.stiffness,l=c.linearDensity,u=this.numericFeature(d.WorldFeature.IntervalCountdown)*Math.abs(n-a),h={index:this.fabric.create_interval(e.index,t.index,!1,a,n,s,l,u),alpha:e,omega:t,intervalRole:i,scale:o,removed:!1};return this.intervals.push(h),h}},{key:"eliminateInterval",value:function(e){this.fabric.remove_interval(e),this.intervals.forEach((function(t){t.index>e&&t.index--}))}},{key:"fabric",get:function(){return this.instance.fabric}},{key:"stage",get:function(){return this.stage$.getValue()},set:function(e){this.instance.stage=e,e===d.Stage.Slack&&this.instance.snapshot(),this.stage$.next(e)}}]),e}();var ct,st=function(){function e(t,n,r){Object(Oe.a)(this,e),this.faces=t,this.mark=n,this.builder=r}return Object(Ce.a)(e,[{key:"execute",value:function(){switch(this.mark.action){case Le.Subtree:break;case Le.BaseFace:this.builder.faceToOrigin(this.faces[0]);break;case Le.JoinFaces:case Le.FaceDistance:this.builder.createRadialPulls(this.faces,this.mark);break;case Le.Anchor:}}}]),e}();function lt(e){return{stiffness:1e-4,linearDensity:Math.sqrt(1e-4)}}!function(e){e.Forward="Forward",e.Left="Left",e.Right="Right",e.MusclePeriod="Attack",e.AttackPeriod="Attack",e.DecayPeriod="Decay",e.TwitchNuance="TwitchNuance",e.TicksPerSlice="TicksPerSlice"}(ct||(ct={}));var ut=Object.keys(ct).filter((function(e){return function(e){switch(e){case ct.Forward:case ct.Left:case ct.Right:return!1;case ct.MusclePeriod:case ct.AttackPeriod:case ct.DecayPeriod:case ct.TwitchNuance:case ct.TicksPerSlice:return!0}}(ct[e])})).map((function(e){return ct[e]}));function ht(){return new mt(wt,[])}function ft(e){if(0===e.length)return ht();var t=e.map((function(e){var t=e.geneName,n=e.tosses,r=e.geneString;return{geneName:t,tosses:n,dice:r.split("").map((function(e){return pt[e]})).filter((function(e){return!!e}))}}));return new mt(wt,t)}function dt(e,t){var n=t.find((function(t){var n=t.geneName;return e===n}));if(n)return n;var r={geneName:e,tosses:0,dice:[]};return t.push(r),r}var mt=function(){function e(t,n){Object(Oe.a)(this,e),this.roll=t,this.genes=n}return Object(Ce.a)(e,[{key:"createReader",value:function(e){return new yt(dt(e,this.genes),this.roll)}},{key:"withMutations",value:function(t,n){var r=this,a=this.genes.map((function(e){return{geneName:e.geneName,tosses:e.tosses,dice:e.dice.slice()}}));(t.forEach((function(e){!function(e,t){if(0===t.dice.length)t.dice.push(e());else for(var n=Math.floor(Math.random()*t.dice.length),r=t.dice[n];t.dice[n]===r;)t.dice[n]=e();t.tosses++}((function(){return r.roll()}),dt(e,a))})),n)&&dt(n,a).tosses++;return new e(this.roll,a)}},{key:"toString",value:function(){return this.genes.map((function(e){return"(".concat(e.geneName,":").concat(e.tosses,")")})).join(", ")}},{key:"totalTwitches",get:function(){var e=this.genes.reduce((function(e,t){var n=t.tosses;return Math.max(e,n)}),0);return Math.floor(Math.pow(e,.66))+2}},{key:"geneData",get:function(){return this.genes.map((function(e){return{geneName:e.geneName,tosses:e.tosses,geneString:function(e){return e.map((function(e){return e.symbol})).join("")}(e.dice)}}))}},{key:"tosses",get:function(){return this.genes.reduce((function(e,t){return e+t.tosses}),0)}}]),e}(),gt=[{index:0,numeral:"1",symbol:"\u2680",featureDelta:1/1.1/1.1/1.1},{index:1,numeral:"2",symbol:"\u2681",featureDelta:1/1.1/1.1},{index:2,numeral:"3",symbol:"\u2682",featureDelta:1/1.1},{index:3,numeral:"4",symbol:"\u2683",featureDelta:1.1},{index:4,numeral:"5",symbol:"\u2684",featureDelta:1.1*1.1},{index:5,numeral:"6",symbol:"\u2685",featureDelta:1.1*1.1*1.1}],pt=function(){var e={};return gt.forEach((function(t){e[t.numeral]=t,e[t.symbol]=t})),e}();function vt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Math.floor(Et(n)*e)}function bt(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return Et(n)*e}var yt=function(){function e(t,n){Object(Oe.a)(this,e),this.gene=t,this.roll=n,this.cursor=0}return Object(Ce.a)(e,[{key:"readMuscleTwitch",value:function(e,t,n,r){var a=vt(2*e.length,this.next(),this.next(),this.next()),i=a%2===0,o=e[Math.floor(a/2)];return{when:vt(36,this.next(),this.next()),muscle:o,alternating:i,attack:(2+bt(6,this.next()))*t,decay:(2+bt(6,this.next()))*n,twitchNuance:r}}},{key:"modifyFeature",value:function(e){var t=e;0===this.gene.tosses&&this.gene.tosses++;for(var n=0;n<this.gene.tosses;n++)t*=.5*this.next().featureDelta+.5;return t}},{key:"next",value:function(){for(;this.gene.dice.length<this.cursor+1;)this.gene.dice.push(this.roll());return this.gene.dice[this.cursor++]}},{key:"length",get:function(){return this.gene.dice.length}}]),e}();function wt(){return gt[Math.floor(Math.random()*gt.length)]}function Et(e){if(0===e.length)throw new Error("No dice!");return e.reduce((function(e,t){return 6*e+t.index}),0)/Math.pow(6,e.length)}var St,kt=function(){function e(t){var n=this;Object(Oe.a)(this,e),this.state=t,this.cycleCount=0,this.twitchCount=0,this.config=void 0,this.ticks=0,this.twitchCycles={};var r=this.state.genome;this.config=function(e){var t=e.createReader(ct.MusclePeriod).modifyFeature(600);return{ticksPerSlice:e.createReader(ct.TicksPerSlice).modifyFeature(4),twitchNuance:e.createReader(ct.TwitchNuance).modifyFeature(.3),musclePeriod:t,attackPeriod:e.createReader(ct.AttackPeriod).modifyFeature(t),decayPeriod:e.createReader(ct.DecayPeriod).modifyFeature(t)}}(r);var a=r.totalTwitches;Ct.filter((function(e){return e!==St.Rest})).forEach((function(e){var i=Ft(e),o=r.createReader(i);n.twitchCycles[e]=new xt(o,n.config,t.muscles,a)}))}return Object(Ce.a)(e,[{key:"toString",value:function(){var e=this,t=Object.keys(this.twitchCycles).map((function(t){return e.twitchCycles[t]})).map((function(e){return e.toString()})).join("\n");return"Twitcher(".concat(t,")")}},{key:"tick",value:function(e){if(this.ticks--,this.ticks<0){this.ticks=this.config.ticksPerSlice;var t=this.state;if(t.timeSlice++,t.timeSlice>=36)return t.timeSlice=0,this.cycleCount++,!0;var n=this.twitchCycles[t.direction];n&&(this.twitchCount+=n.activate(t.timeSlice,e))}return!1}}]),e}(),xt=function(){function e(t,n,r,a){Object(Oe.a)(this,e),this.slices={};for(var i=Object(f.a)(r),o=function(e){i=i.filter((function(t){var n=t.faceIndex;return e.faceIndex!==n}))};a-- >0;){var c=n.attackPeriod,s=n.decayPeriod,l=n.twitchNuance,u=t.readMuscleTwitch(i,c,s,l);this.addTwitch(u.when,u),o(u.muscle);var h=Tt(u.muscle,i),d=u.alternating?(u.when+18)%36:u.when;this.addTwitch(d,Object(Me.a)({},u,{muscle:h,when:d})),o(h)}}return Object(Ce.a)(e,[{key:"toString",value:function(){var e=this,t=Object.keys(this.slices).map((function(t){return e.slices[t]})).map((function(e){return e.map((function(e){return"".concat(e.when,":").concat(e.muscle.faceIndex)})).join(";")})).join(",");return"Cycle(".concat(t,")")}},{key:"activate",value:function(e,t){var n=this.slices[e];return n?(n.forEach((function(e){var n=e.muscle,r=e.attack,a=e.decay,i=e.twitchNuance;return t(n,r,a,i)})),n.length):0}},{key:"addTwitch",value:function(e,t){var n=this.slices[e];n?n.push(t):this.slices[e]=[t]}}]),e}(),Pt="'Gorillagotchi':(A(4,S80,Mb0),b(4,S80,Mb0),a(2,S70,Md0),B(2,Md0,S70)):0=face-distance-60",jt="'Satoshi Tree':(2,S85,b(4,S85,MA0),c(4,S85,MA0),d(4,S85,MA0)):0=subtree(b(3, S85),c(3, S85),d(3, S85))";!function(e){e.Rest="Rest",e.Forward="Forward",e.Left="Left",e.Right="Right"}(St||(St={}));var Ot,Ct=Object.keys(St).map((function(e){return St[e]}));function Ft(e){switch(e){case St.Forward:return ct.Forward;case St.Left:return ct.Left;case St.Right:return ct.Right;default:throw new Error("No gene for direction ".concat(e))}}function Vt(e,t,n){return{patch:e,targetPatch:e.adjacent[e.rotation],instance:t,muscles:[],extremities:[],genome:n,direction:St.Rest,directionHistory:[],autopilot:!1,timeSlice:0,reachedTarget:!1,twitchesPerCycle:30}}!function(e){e.FrontLeft="front-left",e.FrontRight="front-right",e.BackLeft="back-left",e.BackRight="back-right"}(Ot||(Ot={}));var Mt=function(){function e(t,n){Object(Oe.a)(this,e),this.state=t,this.embryo=n,this.twitcher=void 0,n||(this.twitcher=new kt(this.state))}return Object(Ce.a)(e,[{key:"snapshot",value:function(){this.state.instance.snapshot()}},{key:"recycled",value:function(t,n){var r=ft(n||this.patch.storedGenes[0]);return new e(Object(Me.a)({},this.state,{instance:t,genome:r,directionHistory:[]}))}},{key:"getCycleCount",value:function(e){return this.twitcher?e?Math.floor(this.twitcher.twitchCount/this.state.twitchesPerCycle):this.twitcher.cycleCount:0}},{key:"adoptFabric",value:function(e){return this.state.instance.adoptFabric(e)}},{key:"getExtremity",value:function(e){var t=this.state.extremities.find((function(t){return t.limb===e}));if(!t)throw new Error("No extremity found");return t}},{key:"mutatedGeneData",value:function(){var e=this,t=Ct.map((function(t){var n=e.state.directionHistory.filter((function(e){return e===t})).length;return{dir:t,count:n}})).filter((function(e){return e.count>0})).map((function(e){return e.dir})).map(Ft),n=Math.random()>.95?ut[Math.floor(Math.random()*ut.length)]:void 0;return this.state.genome.withMutations(t,n).geneData}},{key:"getMidpoint",value:function(e){e||(e=new u.Vector3);var t=this.state.instance.view;return e.set(t.midpoint_x(),t.midpoint_y(),t.midpoint_z()),e}},{key:"iterate",value:function(e){var t=this,n=this.state.instance.view;if(e&&e.set(n.midpoint_x(),n.midpoint_y(),n.midpoint_z()),this.embryo)return!0;if(this.twitcher){this.twitcher.tick((function(e,n,r,a){return t.twitch(e,n,r,a)}))&&this.state.autopilot&&(this.reachedTarget?this.direction=St.Rest:this.checkDirection())}return!0}},{key:"showFrozen",value:function(){this.instance.showFrozen(this.reachedTarget)}},{key:"checkDirection",value:function(){var e=this.state;this.reachedTarget?this.direction=St.Rest:(e.direction=this.directionToTarget,e.directionHistory.push(e.direction))}},{key:"twitch",value:function(e,t,n,r){this.state.instance.fabric.twitch_face(e.faceIndex,t,n,r)}},{key:"quaternionForDirection",value:function(e){var t=this;return(new u.Quaternion).setFromUnitVectors(m,function(){var n=t.state.instance;switch(e){case St.Rest:case St.Forward:return n.forward;case St.Left:return n.left;case St.Right:return n.right}}())}},{key:"twitcherString",get:function(){return this.twitcher?this.twitcher.toString():"no twitcher"}},{key:"growing",get:function(){return!!this.embryo}},{key:"genome",get:function(){return this.state.genome},set:function(e){this.state.genome=e}},{key:"patch",get:function(){return this.state.patch}},{key:"instance",get:function(){return this.state.instance}},{key:"autopilot",get:function(){return this.state.autopilot},set:function(e){this.state.autopilot=e,e&&this.checkDirection()}},{key:"direction",get:function(){return this.state.direction},set:function(e){this.state.direction=e,this.autopilot=!1}},{key:"fabricClone",get:function(){return this.state.instance.fabricClone}},{key:"view",get:function(){return this.state.instance.view}},{key:"age",get:function(){return this.state.instance.fabric.age}},{key:"distanceFromTarget",get:function(){return this.getMidpoint().distanceTo(this.target)}},{key:"target",get:function(){return this.state.targetPatch.center}},{key:"showDirection",get:function(){return this.state.direction!==St.Rest}},{key:"directionQuaternion",get:function(){return this.quaternionForDirection(this.state.direction)}},{key:"reachedTarget",get:function(){return this.distanceFromTarget<4}},{key:"topJointLocation",get:function(){var e=this.state.instance.floatView.jointLocations;return new u.Vector3(e[9],e[10],e[11])}},{key:"directionToTarget",get:function(){var e=this.toTarget,t=this.state.instance;t.refreshFloatView();var n=e.dot(t.forward),r=e.dot(t.right);return r>0?n>r?St.Forward:St.Right:n>-r?St.Forward:St.Left}},{key:"toTarget",get:function(){var e=new u.Vector3,t=this.state.instance.view,n=new u.Vector3(t.midpoint_x(),t.midpoint_y(),t.midpoint_z());return e.subVectors(this.target,n),e.y=0,e.normalize(),e}}]),e}();function Tt(e,t){var n=e.name,r=e.limb,a=e.distance,i=k.NNN,o=function(e){switch(e){case Ot.BackRight:return Ot.BackLeft;case Ot.BackLeft:return Ot.BackRight;case Ot.FrontRight:return Ot.FrontLeft;case Ot.FrontLeft:return Ot.FrontRight;default:throw new Error("Strange limb")}}(r),c=t.find((function(e){return e.limb===o&&e.distance===a&&e.faceName===i}));if(!c)throw new Error("Unable to find opposite muscle to ".concat(n));return c}function Rt(e,t){switch(e){case d.WorldFeature.IterationsPerFrame:return 2*t;case d.WorldFeature.Gravity:return t;case d.WorldFeature.Drag:return 5*t;case d.WorldFeature.PretensingCountdown:return.5*t;case d.WorldFeature.PretenstFactor:return t;case d.WorldFeature.PushOverPull:return.25;default:return t}}function At(e,t){switch(e){case d.WorldFeature.Gravity:return 5*t;case d.WorldFeature.IntervalCountdown:return.1*t;case d.WorldFeature.Antigravity:return.3*t;case d.WorldFeature.Drag:return 0;case d.WorldFeature.PretenstFactor:return 5*t;case d.WorldFeature.PretensingCountdown:return.02*t;default:return t}}var Dt,Nt=[5,6,7,8,9,10],It=8,Lt=8;!function(e){e.WinnersRun="Winners run",e.ChallengersBorn="Challengers born",e.ChallengersReborn="Challengers reborn",e.ChallengersRun="Challengers run",e.WinnersStored="Winners stored",e.EvolutionAdvance="Evolution advance",e.EvolutionDone="Evolution done",e.EvolutionHarder="Evolution harder"}(Dt||(Dt={}));var _t=function(){function e(t,n,r,a){if(Object(Oe.a)(this,e),this.evolvingGotchi=t,this.createInstance=n,this.useTwitches=r,this.cyclePattern=a,this.snapshotsSubject=new l.BehaviorSubject([]),this.winners=[],this.challengersVisible=!1,this.challengers=[],this.phase=Dt.WinnersRun,this.cyclePatternIndex=void 0,this.currentCycle=0,this.currentMaxCycles=void 0,this.gotchiMidpoint=new u.Vector3,t.embryo)throw new Error("Cannot create evolution from gotchi which is not pretenst");t.checkDirection(),this.currentMaxCycles=this.cyclePattern[this.cyclePatternIndex=0];for(var i=[],o=t.patch.storedGenes;i.length<It;)i.push(this.createAutoGotchi(ft(o[i.length%o.length])));this.winners=i.map((function(e,t){return{gotchi:e,name:Wt(t),proximityHistory:[],persisted:!0}}))}return Object(Ce.a)(e,[{key:"iterate",value:function(){var e=this;switch(this.phase){case Dt.WinnersRun:var t=0,n=!1;if(this.winners.forEach((function(r){var a=r.gotchi,i=a.getCycleCount(e.useTwitches);i>t&&(t=i),i<e.currentMaxCycles&&(a.iterate(),n=!0)})),t>this.currentCycle&&(Bt(this.winners,this.currentCycle),this.currentCycle=t),!n)!this.winners.find((function(e){return!e.gotchi.reachedTarget}))?this.phase=Dt.EvolutionDone:(this.winners.forEach((function(e){return e.gotchi.showFrozen()})),this.phase=0===this.challengers.length?Dt.ChallengersBorn:Dt.ChallengersReborn,this.currentCycle=0);break;case Dt.ChallengersBorn:for(var r=[];r.length<Lt;){var a=ft(this.winners[r.length%this.winners.length].gotchi.genome.geneData);r.push(this.createAutoGotchi(a.withMutations([Ft(this.evolvingGotchi.direction)])))}this.challengers=r.map((function(t,n){return t.autopilot=!0,{gotchi:t,name:"".concat(Wt(n+e.winners.length)).concat(Wt(n%e.winners.length)),proximityHistory:[],persisted:!1}})),this.phase=Dt.ChallengersRun;break;case Dt.ChallengersReborn:var i=0;this.challengers=this.challengers.map((function(t,n){var r=i++%e.winners.length,a=e.winners[r],o=t.gotchi.adoptFabric(e.evolvingGotchi.fabricClone),c=t.gotchi.recycled(o,a.gotchi.mutatedGeneData()),s="".concat(a.name).concat(Wt(n));return c.autopilot=!0,{gotchi:c,name:s,proximityHistory:[],persisted:!1}})),this.phase=Dt.ChallengersRun;break;case Dt.ChallengersRun:this.challengersVisible=!0;var o=!1,c=0;if(this.challengers.forEach((function(t){var n=t.gotchi,r=(t.name,n.getCycleCount(e.useTwitches));r>c&&(c=r),r<e.currentMaxCycles&&(n.iterate(),o=!0)})),c>this.currentCycle){var s=[].concat(Object(f.a)(this.winners),Object(f.a)(this.challengers));Bt(s,this.currentCycle),this.broadcastSnapshot(s.map((function(t){return zt(t,e.currentCycle)}))),this.currentCycle=c}o||(this.phase=Dt.WinnersStored);break;case Dt.WinnersStored:var l=this.splitEvolvers(this.currentCycle),u=l.winners,h=l.losers;this.evolvingGotchi.patch.storedGenes=u.map((function(e){return e.gotchi.genome.geneData})),u.forEach((function(e){return e.persisted=!0})),h.forEach((function(e){return e.persisted=!1})),this.broadcastSnapshot(u.map((function(t){return zt(t,e.currentCycle)}))),this.winners=u,this.challengers=h,this.challengersVisible=!1,this.phase=Dt.EvolutionAdvance;break;case Dt.EvolutionAdvance:if(this.cyclePatternIndex===this.cyclePattern.length-1){var d=!this.winners.find((function(e){return!e.gotchi.reachedTarget}));this.phase=d?Dt.EvolutionHarder:Dt.EvolutionDone}else this.cyclePatternIndex++,this.currentMaxCycles=this.cyclePattern[this.cyclePatternIndex],this.currentCycle=0,this.phase=Dt.WinnersRun;break;case Dt.EvolutionDone:case Dt.EvolutionHarder:}return this.phase}},{key:"getMidpoint",value:function(e){var t=this;return this.winners.forEach((function(n){var r=n.gotchi;return e.add(r.getMidpoint(t.gotchiMidpoint))})),e.multiplyScalar(1/this.winners.length),e}},{key:"splitEvolvers",value:function(e){var t=[],n=[],r=[].concat(Object(f.a)(this.winners),Object(f.a)(this.challengers));return Bt(r,e),r.forEach((function(e,r){r<It?t.push(e):n.push(e)})),{cycleCount:e,winners:t,losers:n}}},{key:"broadcastSnapshot",value:function(e){var t=this.currentCycle,n=this.cyclePatternIndex,r={cycle:t,cyclePattern:this.cyclePattern,cycleIndex:n,evolverSnapshots:e},a=this.snapshotsSubject.getValue(),i=a.findIndex((function(e){return r.cycleIndex===e.cycleIndex}));if(i<0)this.snapshotsSubject.next([].concat(Object(f.a)(a),[r]));else if(i===a.length-1){var o=Object(f.a)(a);o[i]=r,this.snapshotsSubject.next(o)}else this.snapshotsSubject.next([r])}},{key:"createAutoGotchi",value:function(e){var t=this.createInstance(!1,this.evolvingGotchi.fabricClone),n=this.evolvingGotchi.recycled(t,e.geneData);return n.autopilot=!0,n}},{key:"withReducedCyclePattern",get:function(){var t=Object(f.a)(this.cyclePattern);if(t.pop(),!(t.length<3))return new e(this.evolvingGotchi,this.createInstance,this.useTwitches,t)}},{key:"target",get:function(){return this.evolvingGotchi.target}}]),e}();function Bt(e,t){e.forEach((function(e){e.proximityHistory.length===t&&e.proximityHistory.push(e.gotchi.distanceFromTarget)})),e.sort((function(e,n){return e.proximityHistory[t]-n.proximityHistory[t]}))}function zt(e,t){var n=e.gotchi,r=e.proximityHistory,a=e.persisted,i=e.name,o=r[t];if(void 0===o)throw new Error("Cannot snapshot");var c=n.genome.tosses;return{name:i,proximity:o,reachedTarget:n.reachedTarget,tosses:c,persisted:a}}function Wt(e){return String.fromCharCode(65+e)}function Gt(e){var t=e.snapshots;return c.createElement("div",{className:"text-monospace d-inline-flex"},t.map((function(e){return c.createElement("div",{key:e.cycleIndex,className:"float-left p-1 m-1",style:{borderStyle:"solid",borderWidth:"2px"}},c.createElement(Ut,{snapshot:e}),c.createElement("div",{className:"m-2"},e.evolverSnapshots.map((function(e,t){for(var n=e.name,r=e.reachedTarget,a=e.persisted,i=e.proximity,o=e.tosses,s=[],l=n.length-1;l>0;)s.push(c.createElement(K.k,{key:"".concat(n,"-").concat(l)})),l--;var u=r?c.createElement(K.M,null):void 0;return c.createElement("div",{key:"competitor-".concat(t),style:{color:a?r?"#ffffff":"#2cd710":"#c2c2c2",backgroundColor:a?r?"#b1b1b1":"#848383":"#555454",borderRadius:"0.2em",marginBottom:"1px",padding:"2px",display:"block",whiteSpace:"nowrap"}},"".concat(Wt(t)," ").concat(i.toFixed(3)," ").concat(n).concat(o),"\xa0",s,u)}))))})))}function Ut(e){var t=e.snapshot,n=t.cyclePattern,r=t.cycleIndex,a=t.cycle;return c.createElement("div",{className:"p-1 my-2 w-100 text-center"},n.map((function(e,t){return c.createElement("span",{key:"cycle-".concat(t),style:{color:"black",backgroundColor:t===r?"#24f00f":"#cbc7c7",margin:"0.1em",padding:"0.2em",borderRadius:"0.3em",borderStyle:"solid",borderWidth:"1px"}},t===r&&a<n[r]?"".concat(a+1,"/").concat(e):e)})))}var $t=[{x:0,y:0},{x:2,y:0},{x:1,y:-1},{x:-1,y:-1},{x:-2,y:0},{x:-1,y:1},{x:1,y:1},{x:4,y:0},{x:3,y:-1},{x:2,y:-2},{x:0,y:-2},{x:-2,y:-2},{x:-3,y:-1},{x:-4,y:0},{x:-3,y:1},{x:-2,y:2},{x:0,y:2},{x:2,y:2},{x:3,y:1},{x:6,y:0},{x:5,y:-1},{x:4,y:-2},{x:3,y:-3},{x:1,y:-3},{x:-1,y:-3},{x:-3,y:-3},{x:-4,y:-2},{x:-5,y:-1},{x:-6,y:0},{x:-5,y:1},{x:-4,y:2},{x:-3,y:3},{x:-1,y:3},{x:1,y:3},{x:3,y:3},{x:4,y:2},{x:5,y:1}],Jt=[{x:2,y:0},{x:1,y:-1},{x:-1,y:-1},{x:-2,y:0},{x:-1,y:1},{x:1,y:1}],Ht=Math.sin(60*Math.PI/180),qt=12.5/Ht,Qt=qt*Ht,Zt=1.5*qt,Yt=[new u.Vector3(0,0,-qt),new u.Vector3(-Ht*qt,0,-qt/2),new u.Vector3(-Ht*qt,0,qt/2),new u.Vector3(0,0,qt),new u.Vector3(Ht*qt,0,qt/2),new u.Vector3(Ht*qt,0,-qt/2)],Xt=new u.Color("#4b4b4b"),Kt=new u.Color("#59431e"),en=new u.Vector3(0,1,0),tn=new u.Vector3(0,500,0),nn=new u.Color("#fff1d1");var rn,an=function(){var e=new u.Geometry;return e.vertices=function(){var e=function(){return new u.Vector3(0,0,0)},t=e(),n=e().addScaledVector(g,1.5*-.2).addScaledVector(m,3),r=e().addScaledVector(g,-.2).addScaledVector(m,3),a=e().addScaledVector(g,.2).addScaledVector(m,3),i=e().addScaledVector(g,.2*1.5).addScaledVector(m,3),o=e().addScaledVector(m,3*1.3);return[t,r,t,a,i,o,n,o,i,a,n,r]}(),e}(),on=function(){function e(t,n,r){Object(Oe.a)(this,e),this.island=t,this.coords=n,this.patchCharacter=r,this.gotchi=void 0,this.satoshiTree=void 0,this.center=void 0,this.name=void 0,this.adjacent=[],this.rotation=0,this.center=new u.Vector3(n.x*Qt,0,n.y*Zt),this.name="(".concat(n.x,",").concat(n.y,")")}return Object(Ce.a)(e,[{key:"createGotchi",value:function(e){var t=this.island.source.newGotchi(this,e,ft(this.storedGenes[0]));return this.gotchi=t,t}},{key:"createNewSatoshiTree",value:function(e){var t=this.island.source.newSatoshiTree(this,e);return this.satoshiTree=t,t}},{key:"onClick",get:function(){var e=this;return function(){e.satoshiTree?(e.satoshiTree.removeRandomInterval(),console.log("remove",e.name)):(e.rotation=(e.rotation+1)%6,console.log("rotate",e.name,e.rotation))}}},{key:"storedGenes",get:function(){var e=localStorage.getItem(this.name);return e?JSON.parse(e):[ht().geneData]},set:function(e){localStorage.setItem(this.name,JSON.stringify(e))}},{key:"positionArray",get:function(){for(var e=this,t=new Float32Array(54),n=0,r=function(r){var a=(new u.Vector3).copy(e.center).addScaledVector(r,.99),i=a.x,o=a.y,c=a.z;t[n++]=i,t[n++]=o,t[n++]=c},a=0;a<6;a++){var i=(a+1)%6;r(new u.Vector3),r(Yt[a]),r(Yt[i])}return t}},{key:"normalArray",get:function(){for(var e=new Float32Array(54),t=0,n=function(n){var r=n.x,a=n.y,i=n.z;e[t++]=r,e[t++]=a,e[t++]=i},r=0;r<6;r++){var a=(r+1)%6;n(en),n((new u.Vector3).add(en).addScaledVector(Yt[r],.9/25).normalize()),n((new u.Vector3).add(en).addScaledVector(Yt[a],.9/25).normalize())}return e}}]),e}();!function(e){e.FaunaPatch="Fauna",e.FloraPatch="Flora"}(rn||(rn={}));var cn,sn=function(){function e(t,n,r){Object(Oe.a)(this,e),this.source=t,this.name=n,this.patches=[],this._seed=void 0,this._seed=r%2147483647,this.fill()}return Object(Ce.a)(e,[{key:"findPatch",value:function(e){return this.patches.find((function(t){return n=t.coords,r=e,n.x===r.x&&n.y===r.y;var n,r}))}},{key:"fill",value:function(){var e=this;this.createSurroundedPatch({x:0,y:0}),this.patches.forEach((function(t){var n=t.coords;Jt.forEach((function(r){var a=r.x,i=r.y;t.adjacent.push(e.findPatch({x:a+n.x,y:i+n.y}))}))}))}},{key:"createSurroundedPatch",value:function(e){var t=this,n=this.getOrCreatePatch(e);return $t.map((function(n){return t.getOrCreatePatch((a=e,{x:(r=n).x+a.x,y:r.y+a.y}));var r,a})),n}},{key:"getOrCreatePatch",value:function(e){var t=this.findPatch(e);if(t)return t;var n=this.next()>.5?rn.FaunaPatch:rn.FloraPatch,r=new on(this,e,n);return this.patches.push(r),r}},{key:"next",value:function(){return this._seed=16807*this._seed%2147483647,(this._seed-1)/2147483646}},{key:"midpoint",get:function(){return this.patches.reduce((function(e,t){return e.add(t.center)}),new u.Vector3).multiplyScalar(1/this.patches.length)}}]),e}();function ln(e){var t=e.island,n=e.satoshiTrees,r=e.happening,a=e.gotchi,i=e.evolution,o=e.evolutionPhase,s=e.countdownToEvolution,l=e.stopEvolution,h=Object(ee.d)().camera,f=document.getElementById("view-container"),d=Object(c.useState)(Date.now()),m=Object(X.a)(d,2),g=m[0],p=m[1],v=Object(c.useState)(Date.now()),b=Object(X.a)(v,2),y=b[0],w=b[1],E=new u.Vector3;Object(ee.c)((function(){var e=S.current,t=function(t){var n=e.object.position,r=(new u.Vector3).subVectors(n,e.target),a=t-r.length();r.normalize(),n.add(r.multiplyScalar(.003*a)),n.y+=.01*(3-n.y)};switch(r){case cn.Developing:a&&t((a.iterate(E),6));break;case cn.Resting:a&&t(function(e){return e.iterate(E),10}(a));break;case cn.Running:a&&t(function(e){return e.iterate(E),6}(a));break;case cn.Evolving:i&&(t(function(e){switch(e.iterate()){case Dt.EvolutionDone:console.log("Evolution DONE"),l();break;case Dt.EvolutionHarder:console.log("Evolution advance..."),l(e.withReducedCyclePattern)}return e.getMidpoint(E),15}(i)),o(i.phase))}e.target.add((new u.Vector3).subVectors(E,e.target).multiplyScalar(.01)),e.update();var c=Math.floor(Math.random()*n.length);n[c].iterate();var h=Math.floor((y-g)/1e3),f=Date.now();w(f);var d=Math.floor((f-g)/1e3);r===cn.Resting&&h<d&&s(20-d)}));var S=Object(ee.e)((function(e){e.minPolarAngle=0,e.maxPolarAngle=Math.PI/2,e.minDistance=.1,e.maxDistance=9e3,e.zoomSpeed=.5,e.enableZoom=!0,e.target.set(E.x,E.y,E.z),e.update()}),[]);return Object(c.useEffect)((function(){S.current.autoRotate=r===cn.Evolving,p(Date.now()),w(Date.now())}),[r]),c.createElement("group",null,c.createElement("orbit",{ref:S,args:[h,f]}),c.createElement("scene",null,i&&r===cn.Evolving?c.createElement(un,{evolution:i}):a?c.createElement(hn,{gotchi:a,faces:!0}):void 0,t.patches.map((function(e){var t=e.positionArray,n=e.normalArray;return c.createElement("mesh",{key:"patch-".concat(e.name),onClick:e.onClick},c.createElement("meshPhongMaterial",{attach:"material",color:e.patchCharacter===rn.FaunaPatch?Xt:Kt}),c.createElement("bufferGeometry",{attach:"geometry"},c.createElement("bufferAttribute",{attachObject:["attributes","position"],array:t,count:t.length/3,itemSize:3}),c.createElement("bufferAttribute",{attachObject:["attributes","normal"],array:n,count:n.length/3,itemSize:3})))})),n.map((function(e){return c.createElement(fn,{key:"tree-".concat(e.name),satoshiTree:e})})),c.createElement("pointLight",{distance:1e3,decay:.1,position:tn}),c.createElement("hemisphereLight",{name:"Hemi",color:nn})))}function un(e){var t=e.evolution,n=new u.Vector3;t.getMidpoint(n);var r=t.target;return c.createElement("group",null,t.winners.map((function(e,t){var n=e.gotchi;return c.createElement(hn,{key:"evolving-".concat(t),gotchi:n,faces:!1})})),t.challengersVisible?t.challengers.map((function(e,n){var r=e.gotchi;return c.createElement(hn,{key:"evolving-".concat(n+t.winners.length),gotchi:r,faces:!1})})):void 0,c.createElement("lineSegments",null,c.createElement("bufferGeometry",{attach:"geometry"},c.createElement("bufferAttribute",{attachObject:["attributes","position"],array:new Float32Array([n.x,0,n.z,n.x,6,n.z,n.x,6,n.z,r.x,6,r.z,r.x,6,r.z,r.x,0,r.z]),count:6,itemSize:3,onUpdate:function(e){return e.needsUpdate=!0}})),c.createElement("lineBasicMaterial",{attach:"material",color:"#cace02"})))}function hn(e){var t=e.gotchi,n=e.faces,r=t.topJointLocation,a=t.target,i=t.state,o=t.showDirection,s=i.instance.floatView;return c.createElement("group",null,c.createElement("lineSegments",{geometry:s.lineGeometry,onUpdate:function(e){return e.geometry.computeBoundingSphere()}},c.createElement("lineBasicMaterial",{attach:"material",vertexColors:!0})),n?c.createElement("mesh",{geometry:s.faceGeometry,onUpdate:function(e){return e.geometry.computeBoundingSphere()}},c.createElement("meshPhongMaterial",{attach:"material",transparent:!0,side:u.DoubleSide,opacity:.6,color:"white"})):void 0,o?c.createElement("group",null,c.createElement("lineSegments",null,c.createElement("bufferGeometry",{attach:"geometry"},c.createElement("bufferAttribute",{attachObject:["attributes","position"],array:new Float32Array([r.x,r.y,r.z,a.x,r.y,a.z]),count:2,itemSize:3,onUpdate:function(e){return e.needsUpdate=!0}})),c.createElement("lineBasicMaterial",{attach:"material",color:"#cecb05"})),c.createElement("lineSegments",{geometry:an,quaternion:t.directionQuaternion,position:t.topJointLocation},c.createElement("lineBasicMaterial",{attach:"material",color:"#05cec0"}))):void 0)}function fn(e){var t=e.satoshiTree.instance.floatView;return c.createElement("mesh",{geometry:t.faceGeometry},c.createElement("meshPhongMaterial",{attach:"material",side:u.DoubleSide,color:"green"}))}function dn(e){var t=e.island,n=e.homePatch,r=e.createInstance,a=Object(c.useState)((function(){return t.patches.filter((function(e){return e.patchCharacter===rn.FloraPatch})).map((function(e){return e.createNewSatoshiTree(r(!0))}))})),i=Object(X.a)(a,1)[0],o=Object(c.useState)((function(){return n.createGotchi(r(!1))})),s=Object(X.a)(o,2),l=s[0],u=s[1],h=Object(c.useState)(cn.Developing),f=Object(X.a)(h,2),m=f[0],g=f[1],p=Object(c.useState)(!0),v=Object(X.a)(p,2),b=v[0],y=v[1],w=Object(c.useState)([]),S=Object(X.a)(w,2),k=S[0],x=S[1],P=Object(c.useState)(-1),O=Object(X.a)(P,2),F=O[0],V=O[1],M=Object(c.useState)(void 0),T=Object(X.a)(M,2),R=T[0],A=T[1],D=Object(c.useState)(Dt.WinnersRun),N=Object(X.a)(D,2),I=N[0],L=N[1],_=Object(c.useState)(void 0),B=Object(X.a)(_,2),z=B[0],W=B[1];Object(c.useEffect)((function(){if(l&&l.embryo){g(cn.Developing);var e=l.embryo.stage$.subscribe((function(e){z===d.Stage.Pretenst&&g(cn.Resting),W(e)}));return function(){return e.unsubscribe()}}W(void 0)}),[l]),Object(c.useEffect)((function(){if(R){var e=R.snapshotsSubject.subscribe(x);return function(){return e.unsubscribe()}}}),[R]);var G=function(e,t){A(R?R.withReducedCyclePattern:new _t(e,r,!1,t)),g(cn.Evolving)};return c.createElement("div",{id:"view-container",style:{position:"absolute",left:0,right:0,height:"100%"}},c.createElement(ee.a,{key:t.name,style:{backgroundColor:"black"}},c.createElement(pn,null),c.createElement(ln,{island:t,satoshiTrees:i,happening:m,gotchi:l,evolution:R,evolutionPhase:function(e){e!==I&&L(e)},countdownToEvolution:function(e){V(e),l&&0===e&&G(l,Nt)},stopEvolution:function(e){A(e),e||(u(n.createGotchi(r(!1))),g(cn.Developing))}})),l?m===cn.Developing?z?c.createElement("div",{id:"bottom-middle"},c.createElement("div",{className:"py-2 px-3 text-center"},c.createElement(K.e,null)," ",j(z))):c.createElement("h1",null,"nothing"):c.createElement(mn,{gotchi:l,happening:m,evolutionCountdown:F,evoDetails:b,toRunning:function(){g(cn.Running),l.autopilot=!0},toEvolving:function(){g(cn.Evolving),V(-1),G(l,Nt)},toRebirth:function(){u(n.createGotchi(r(!1))),g(cn.Developing)},toRest:function(){g(cn.Resting),l.direction=St.Rest},toggleEvoDetails:function(){return y(!b)}}):c.createElement("h1",null,"no gotchi"),R?c.createElement(c.Fragment,null,c.createElement("div",{id:"top-middle"},k.length<=0||b?c.createElement("strong",{className:"p-2"},I):c.createElement(Ut,{snapshot:k[k.length-1]})),c.createElement(gn,{happening:m,evolution:R,snapshots:k,evoDetails:b})):void 0,c.createElement("div",{id:"bottom-right"},c.createElement(te.a,{vertical:!1,className:"w-100"},c.createElement(ne.a,{onClick:function(){return C(E.Design)}},c.createElement(K.G,null)))))}function mn(e){var t=e.gotchi,n=e.happening,r=e.evoDetails,a=e.evolutionCountdown,i=e.toRunning,o=e.toRest,s=e.toEvolving,l=e.toRebirth,u=e.toggleEvoDetails,h=function(){switch(n){case cn.Developing:return c.createElement("h1",null,"developing");case cn.Resting:return t?c.createElement(te.a,{className:"w-100"},c.createElement(ne.a,{color:"success",onClick:i},c.createElement(K.E,null)),c.createElement(ne.a,{color:"success",onClick:s},c.createElement(K.k,null)," ",a>=0?a:""),c.createElement(ne.a,{color:"success",onClick:l},c.createElement(K.e,null))):void 0;case cn.Running:return t?c.createElement(te.a,{className:"w-100"},c.createElement(ne.a,{color:"success",onClick:o},c.createElement(K.M,null)," Rest")):void 0;case cn.Evolving:return t?c.createElement(te.a,{className:"w-100"},c.createElement(ne.a,{color:"success",onClick:l},c.createElement(K.e,null)),c.createElement(ne.a,{color:r?"success":"secondary",onClick:u},c.createElement(K.k,null),"\xa0",r?c.createElement(K.m,null):c.createElement(K.n,null))):void 0}}();return h?c.createElement("div",{id:"bottom-middle"},h):c.createElement("h1",null,n)}function gn(e){var t=e.happening,n=e.evolution,r=e.snapshots,a=e.evoDetails;switch(t){case cn.Developing:case cn.Running:case cn.Resting:return c.createElement("div",null);case cn.Evolving:return n&&r.length>0&&a?c.createElement("div",{id:"evolution-stats"},c.createElement(Gt,{snapshots:r})):c.createElement("div",null)}}function pn(e){var t=Object(c.useRef)(),n=Object(ee.d)().setDefaultCamera;return Object(c.useEffect)((function(){var e=t.current;if(!e)throw new Error("No camera");e.fov=50,e.position.set(10,10,10),n(e)}),[]),Object(ee.c)((function(){var e=t.current;if(!e)throw new Error("No camera");e.updateMatrixWorld()})),c.createElement("perspectiveCamera",Object.assign({ref:t},e))}!function(e){e[e.Developing=0]="Developing",e[e.Resting=1]="Resting",e[e.Running=2]="Running",e[e.Evolving=3]="Evolving"}(cn||(cn={}));var vn=function(){function e(t,n){Object(Oe.a)(this,e),this.name=t,this.tensegrity=n,this.shapingTime=60,this.deadInterval=void 0}return Object(Ce.a)(e,[{key:"removeRandomInterval",value:function(){this.deadInterval||this.tensegrity.stage$.getValue()!==d.Stage.Pretenst||(this.deadInterval=this.tensegrity.intervals[Math.floor(Math.random()*this.tensegrity.intervals.length)])}},{key:"iterate",value:function(){var e=this.tensegrity.stage$.getValue();this.tensegrity.iterate();var t=d.Stage.Slack;switch(e===d.Stage.Pretensing&&t===d.Stage.Pretenst||void 0!==t&&t!==e&&d.Stage.Pretensing,this.deadInterval&&(this.tensegrity.removeInterval(this.deadInterval),this.deadInterval=void 0),t){case d.Stage.Shaping:return this.shapingTime<=0||this.shapingTime--,!1;case d.Stage.Pretensing:case d.Stage.Pretenst:return!0;default:return!1}}},{key:"instance",get:function(){return this.tensegrity.instance}}]),e}(),bn=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function yn(){if("serviceWorker"in navigator){if(new URL("/app",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/app","/service-worker.js");bn?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):wn(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):wn(e)}))}}function wn(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var En=function(){function e(t){Object(Oe.a)(this,e),this.sphere=t}return Object(Ce.a)(e,[{key:"build",value:function(){var e=this;switch(kn.forEach((function(t){return e.sphere.hubAt(new u.Vector3(t[0],t[1],t[2]))})),this.edgeVertexCount){case 0:this.build30Edges();break;case 1:var t=this.build60Edges();this.buildSmallFaces(t);break;default:var n=this.buildEdges();this.buildFaces(n)}var r=this.sphere.hubs[0].spokes[0].push,a=.28*I(r.alpha,r.omega);return this.sphere.hubs.forEach((function(t){return t.spokes.forEach((function(n){return e.sphere.pullsForSpoke(t,n,a)}))})),this.sphere.fabric.set_altitude(this.sphere.location.y),this.sphere}},{key:"push",value:function(e,t,n){if(n){var r=(new u.Vector3).copy(e.location).lerp(t.location,.5),a=this.sphere.hubAt(r);return this.sphere.pushBetween(e,a),this.sphere.pushBetween(a,t),{hubA:e,hubB:t,hubMid:a}}return this.sphere.pushBetween(e,t),{hubA:e,hubB:t}}},{key:"build60Edges",value:function(){var e=this,t=[];return xn.forEach((function(n){var r=e.push(e.vertices[n[0]],e.vertices[n[1]],!0).hubMid;r&&t.push(r)})),t}},{key:"build30Edges",value:function(){var e=this;xn.forEach((function(t){return e.push(e.vertices[t[0]],e.vertices[t[1]])}))}},{key:"buildEdges",value:function(){var e=this,t=[];return xn.forEach((function(n){var r,a,i=[];t.push(i);for(var o=0;o<e.edgeVertexCount;o++){a=r;var c=e.vertices[n[0]],s=e.vertices[n[1]],l=c.location,h=s.location,f=(new u.Vector3).lerpVectors(l,h,(o+1)/e.sphere.frequency);r=e.sphere.hubAt(f),i.push(r),a?(e.push(r,a),o===e.edgeVertexCount-1&&e.push(r,s)):e.push(r,c)}})),On.forEach((function(n){for(var r=0;r<n.length;r++){var a=(r+1)%n.length,i=1===n[r][1]?0:e.edgeVertexCount-1,o=1===n[a][1]?0:e.edgeVertexCount-1,c=t[n[r][0]][i],s=t[n[a][0]][o];e.push(c,s)}})),t}},{key:"buildSmallFaces",value:function(e){var t=this;jn.forEach((function(n){var r=e[Math.abs(n[0])],a=e[Math.abs(n[1])],i=e[Math.abs(n[2])];t.push(r,a),t.push(a,i),t.push(i,r)}))}},{key:"buildFaces",value:function(e){for(var t=[],n=0;n<this.edgeVertexCount-1;n++)t.push([]);for(var r=new u.Vector3,a=new u.Vector3,i=0;i<Pn.length;i++){for(var o=this.vertices[Pn[i][0]].location,c=1;c<this.edgeVertexCount;c++){var s=this.vertices[Pn[i][1]];r.lerpVectors(o,s.location,c/this.sphere.frequency),r.sub(o),t[c-1]=[];for(var l=1;l<this.edgeVertexCount-c+1;l++){var h=this.vertices[Pn[i][2]];a.lerpVectors(o,h.location,l/this.sphere.frequency),a.sub(o);var f=(new u.Vector3).copy(o);f.add(r),f.add(a),t[c-1].push(this.sphere.hubAt(f))}}for(var d=0;d<t.length;d++)for(var m=0;m<t[d].length;m++)if(m<t[d].length-1&&this.push(t[d][m],t[d][m+1]),d>0){var g=t[d][m];this.push(g,t[d-1][m]),this.push(g,t[d-1][m+1])}for(var p=[],v=[],b=[],y=0;y<this.edgeVertexCount-1;y++){var w=t.length-y-1;p.push(t[jn[i][0]>=0?y:w][0]);var E=t[jn[i][1]<0?y:w];v.push(E[E.length-1]),b.push(t[0][jn[i][2]<0?y:w])}var S=[];S.push(p),S.push(v),S.push(b);for(var k=0;k<S.length;k++)for(var x=e[Math.abs(jn[i][k])],P=0;P<t.length;P++){var j=S[k][P];this.push(j,x[P]),this.push(j,x[P+1])}}}},{key:"vertices",get:function(){return this.sphere.hubs}},{key:"edgeVertexCount",get:function(){return this.sphere.frequency-1}}]),e}(),Sn=.5257311121191336,kn=[[+Sn,0,.85065080835204],[+Sn,0,-.85065080835204],[.85065080835204,+Sn,0],[-.85065080835204,+Sn,0],[0,.85065080835204,+Sn],[0,-.85065080835204,+Sn],[-Sn,0,-.85065080835204],[-Sn,0,.85065080835204],[-.85065080835204,-Sn,0],[.85065080835204,-Sn,0],[0,-.85065080835204,-Sn],[0,.85065080835204,-Sn]],xn=[[0,2],[0,4],[0,5],[0,7],[0,9],[1,10],[1,11],[1,2],[1,6],[1,9],[2,11],[2,4],[2,9],[3,11],[3,4],[3,6],[3,7],[3,8],[4,11],[4,7],[5,10],[5,7],[5,8],[5,9],[6,10],[6,11],[6,8],[7,8],[8,10],[9,10]],Pn=[[0,2,4],[0,2,9],[0,4,7],[0,5,7],[0,5,9],[1,2,11],[1,2,9],[1,6,10],[1,6,11],[1,9,10],[2,4,11],[3,4,11],[3,4,7],[3,6,11],[3,6,8],[3,7,8],[5,7,8],[5,8,10],[5,9,10],[6,8,10]],jn=[[0,11,-1],[0,12,-4],[1,19,-3],[2,21,-3],[2,23,-4],[7,10,-6],[7,12,-9],[8,24,-5],[8,25,-6],[9,29,-5],[11,18,-10],[14,18,-13],[14,19,-16],[15,25,-13],[15,26,-17],[16,27,-17],[21,27,-22],[22,28,-20],[23,29,-20],[26,28,-24]],On=[[[0,1],[1,1],[3,1],[2,1],[4,1]],[[7,1],[6,1],[8,1],[5,1],[9,1]],[[10,1],[11,1],[0,-1],[12,1],[7,-1]],[[14,1],[13,1],[15,1],[17,1],[16,1]],[[18,1],[11,-1],[1,-1],[19,1],[14,-1]],[[21,1],[22,1],[20,1],[23,1],[2,-1]],[[26,1],[24,1],[8,-1],[25,1],[15,-1]],[[27,1],[16,-1],[19,-1],[3,-1],[21,-1]],[[28,1],[22,-1],[27,-1],[17,-1],[26,-1]],[[4,-1],[23,-1],[29,1],[9,-1],[12,-1]],[[28,-1],[20,-1],[29,-1],[5,-1],[24,-1]],[[6,-1],[10,-1],[18,-1],[13,-1],[25,-1]]];function Cn(e,t){switch(e){case d.WorldFeature.Drag:case d.WorldFeature.VisualStrain:return 0;default:return t}}var Fn=n(263),Vn=n(218),Mn=n(219),Tn=-1,Rn=0,An=1,Dn=2,Nn=3,In=4,Ln=5,_n={type:"change"},Bn={type:"start"},zn={type:"end"},Wn=function(e){function t(e,n){var r;return Object(Oe.a)(this,t),(r=Object(Fn.a)(this,Object(Vn.a)(t).call(this))).object=void 0,r.element=void 0,r.window=void 0,r.enabled=void 0,r.target=void 0,r.enableZoom=void 0,r.zoomSpeed=void 0,r.minDistance=void 0,r.maxDistance=void 0,r.enableRotate=void 0,r.rotateSpeed=void 0,r.enablePan=void 0,r.keyPanSpeed=void 0,r.autoRotate=void 0,r.autoRotateSpeed=void 0,r.minZoom=void 0,r.maxZoom=void 0,r.minPolarAngle=void 0,r.maxPolarAngle=void 0,r.minAzimuthAngle=void 0,r.maxAzimuthAngle=void 0,r.keys=void 0,r.mouseButtons=void 0,r.enableDamping=void 0,r.dampingFactor=void 0,r.spherical=void 0,r.sphericalDelta=void 0,r.scale=void 0,r.target0=void 0,r.position0=void 0,r.zoom0=void 0,r.state=void 0,r.panOffset=void 0,r.zoomChanged=void 0,r.rotateStart=void 0,r.rotateEnd=void 0,r.rotateDelta=void 0,r.panStart=void 0,r.panEnd=void 0,r.panDelta=void 0,r.dollyStart=void 0,r.dollyEnd=void 0,r.dollyDelta=void 0,r.updateLastPosition=void 0,r.updateOffset=void 0,r.updateQuat=void 0,r.updateLastQuaternion=void 0,r.updateQuatInverse=void 0,r.panLeftV=void 0,r.panUpV=void 0,r.panInternalOffset=void 0,r.onMouseUp=void 0,r.onMouseDown=void 0,r.onMouseMove=void 0,r.onMouseWheel=void 0,r.onTouchStart=void 0,r.onTouchEnd=void 0,r.onTouchMove=void 0,r.object=e,r.element=n,r.window=window,r.enabled=!0,r.target=new u.Vector3,r.minDistance=0,r.maxDistance=1/0,r.minZoom=0,r.maxZoom=1/0,r.minPolarAngle=0,r.maxPolarAngle=Math.PI,r.minAzimuthAngle=-1/0,r.maxAzimuthAngle=1/0,r.enableDamping=!1,r.dampingFactor=.25,r.enableZoom=!0,r.zoomSpeed=.5,r.enableRotate=!0,r.rotateSpeed=1,r.enablePan=!0,r.keyPanSpeed=7,r.autoRotate=!1,r.autoRotateSpeed=1,r.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},r.mouseButtons={ORBIT:u.MOUSE.LEFT,ZOOM:u.MOUSE.MIDDLE,PAN:u.MOUSE.RIGHT},r.target0=r.target.clone(),r.position0=r.object.position.clone(),r.zoom0=r.object.zoom,r.updateOffset=new u.Vector3,r.updateQuat=(new u.Quaternion).setFromUnitVectors(r.object.up,new u.Vector3(0,1,0)),r.updateQuatInverse=r.updateQuat.clone().inverse(),r.updateLastPosition=new u.Vector3,r.updateLastQuaternion=new u.Quaternion,r.state=Tn,r.scale=1,r.spherical=new u.Spherical,r.sphericalDelta=new u.Spherical,r.panOffset=new u.Vector3,r.zoomChanged=!1,r.rotateStart=new u.Vector2,r.rotateEnd=new u.Vector2,r.rotateDelta=new u.Vector2,r.panStart=new u.Vector2,r.panEnd=new u.Vector2,r.panDelta=new u.Vector2,r.dollyStart=new u.Vector2,r.dollyEnd=new u.Vector2,r.dollyDelta=new u.Vector2,r.panLeftV=new u.Vector3,r.panUpV=new u.Vector3,r.panInternalOffset=new u.Vector3,r.onMouseDown=function(e){if(e.preventDefault(),r.enabled){if(e.button===r.mouseButtons.ORBIT){if(!r.enableRotate)return;r.rotateStart.set(e.clientX,e.clientY),r.state=Rn}else if(e.button===r.mouseButtons.ZOOM){if(!r.enableZoom)return;r.dollyStart.set(e.clientX,e.clientY),r.state=An}else if(e.button===r.mouseButtons.PAN){if(!r.enablePan)return;r.panStart.set(e.clientX,e.clientY),r.state=Dn}r.state!==Tn&&(document.addEventListener("mousemove",r.onMouseMove,!1),document.addEventListener("mouseup",r.onMouseUp,!1),r.dispatchEvent(Bn))}},r.onMouseMove=function(e){if(e.preventDefault(),r.enabled)if(r.state===Rn){if(!r.enableRotate)return;r.rotateEnd.set(e.clientX,e.clientY),r.rotateDelta.subVectors(r.rotateEnd,r.rotateStart),r.rotateLeft(2*Math.PI*r.rotateDelta.x/r.element.clientWidth*r.rotateSpeed),r.rotateUp(2*Math.PI*r.rotateDelta.y/r.element.clientHeight*r.rotateSpeed),r.rotateStart.copy(r.rotateEnd),r.update()}else if(r.state===An){if(!r.enableZoom)return;r.dollyEnd.set(e.clientX,e.clientY),r.dollyDelta.subVectors(r.dollyEnd,r.dollyStart),r.dollyDelta.y>0?r.dollyIn(r.getZoomScale()):r.dollyDelta.y<0&&r.dollyOut(r.getZoomScale()),r.dollyStart.copy(r.dollyEnd),r.update()}else if(r.state===Dn){if(!r.enablePan)return;r.panEnd.set(e.clientX,e.clientY),r.panDelta.subVectors(r.panEnd,r.panStart),r.pan(r.panDelta.x,r.panDelta.y),r.panStart.copy(r.panEnd),r.update()}},r.onMouseUp=function(e){e.preventDefault(),r.enabled&&(document.removeEventListener("mousemove",r.onMouseMove,!1),document.removeEventListener("mouseup",r.onMouseUp,!1),r.dispatchEvent(zn),r.state=Tn)},r.onMouseWheel=function(e){e.preventDefault(),r.enabled&&r.enableZoom&&(r.state===Tn||r.state===Rn)&&(e.stopPropagation(),e.deltaY<0?r.dollyOut(r.getZoomScale()):e.deltaY>0&&r.dollyIn(r.getZoomScale()),r.update(),r.dispatchEvent(Bn),r.dispatchEvent(zn))},r.onTouchStart=function(e){if(e.preventDefault(),r.enabled){switch(e.touches.length){case 1:if(!r.enableRotate)return;r.rotateStart.set(e.touches[0].pageX,e.touches[0].pageY),r.state=Nn;break;case 2:if(!r.enableZoom)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);r.dollyStart.set(0,a),r.state=In;break;case 3:if(!r.enablePan)return;r.panStart.set(e.touches[0].pageX,e.touches[0].pageY),r.state=Ln;break;default:r.state=Tn}r.state!==Tn&&r.dispatchEvent(Bn)}},r.onTouchMove=function(e){if(e.preventDefault(),r.enabled)switch(e.touches.length){case 1:if(!r.enableRotate)return;if(r.state!==Nn)return;r.rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY),r.rotateDelta.subVectors(r.rotateEnd,r.rotateStart),r.rotateLeft(2*Math.PI*r.rotateDelta.x/r.element.clientWidth*r.rotateSpeed),r.rotateUp(2*Math.PI*r.rotateDelta.y/r.element.clientHeight*r.rotateSpeed),r.rotateStart.copy(r.rotateEnd),r.update();break;case 2:if(!r.enableZoom)return;if(r.state!==In)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);r.dollyEnd.set(0,a),r.dollyDelta.subVectors(r.dollyEnd,r.dollyStart),r.dollyDelta.y>0?r.dollyOut(r.getZoomScale()):r.dollyDelta.y<0&&r.dollyIn(r.getZoomScale()),r.dollyStart.copy(r.dollyEnd),r.update();break;case 3:if(!r.enablePan)return;if(r.state!==Ln)return;r.panEnd.set(e.touches[0].pageX,e.touches[0].pageY),r.panDelta.subVectors(r.panEnd,r.panStart),r.pan(r.panDelta.x,r.panDelta.y),r.panStart.copy(r.panEnd),r.update();break;default:r.state=Tn}},r.onTouchEnd=function(e){e.preventDefault(),r.enabled&&(r.dispatchEvent(zn),r.state=Tn)},r.element.addEventListener("mousedown",r.onMouseDown,{capture:!0}),r.element.addEventListener("wheel",r.onMouseWheel,{capture:!0}),r.element.addEventListener("touchstart",r.onTouchStart,{capture:!0}),r.element.addEventListener("touchend",r.onTouchEnd,{capture:!0}),r.element.addEventListener("touchmove",r.onTouchMove,{capture:!0}),r.update(),r}return Object(Mn.a)(t,e),Object(Ce.a)(t,[{key:"update",value:function(){var e=this.object.position;return this.updateOffset.copy(e).sub(this.target),this.updateOffset.applyQuaternion(this.updateQuat),this.spherical.setFromVector3(this.updateOffset),this.autoRotate&&this.state===Tn&&this.rotateLeft(this.getAutoRotationAngle()),this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi,this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),this.target.add(this.panOffset),this.updateOffset.setFromSpherical(this.spherical),this.updateOffset.applyQuaternion(this.updateQuatInverse),e.copy(this.target).add(this.updateOffset),this.object.lookAt(this.target),this.enableDamping?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor):this.sphericalDelta.set(0,0,0),this.scale=1,this.panOffset.set(0,0,0),!!(this.zoomChanged||this.updateLastPosition.distanceToSquared(this.object.position)>1e-6||8*(1-this.updateLastQuaternion.dot(this.object.quaternion))>1e-6)&&(this.dispatchEvent(_n),this.updateLastPosition.copy(this.object.position),this.updateLastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0)}},{key:"panLeft",value:function(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}},{key:"panUp",value:function(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}},{key:"pan",value:function(e,t){var n=this.element,r=this.object.position;this.panInternalOffset.copy(r).sub(this.target);var a=this.panInternalOffset.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*a/n.clientHeight,this.object.matrix),this.panUp(2*t*a/n.clientHeight,this.object.matrix)}},{key:"dollyIn",value:function(e){this.scale/=e}},{key:"dollyOut",value:function(e){this.scale*=e}},{key:"getAutoRotationAngle",value:function(){return 2*Math.PI/60/60*this.autoRotateSpeed}},{key:"getZoomScale",value:function(){return Math.pow(.95,this.zoomSpeed)}},{key:"rotateLeft",value:function(e){this.sphericalDelta.theta-=e}},{key:"rotateUp",value:function(e){this.sphericalDelta.phi-=e}},{key:"getPolarAngle",value:function(){return this.spherical.phi}},{key:"getAzimuthalAngle",value:function(){return this.spherical.theta}},{key:"dispose",value:function(){this.element.removeEventListener("mousedown",this.onMouseDown,!1),this.element.removeEventListener("wheel",this.onMouseWheel,!1),this.element.removeEventListener("touchstart",this.onTouchStart,!1),this.element.removeEventListener("touchend",this.onTouchEnd,!1),this.element.removeEventListener("touchmove",this.onTouchMove,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1)}},{key:"reset",value:function(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(_n),this.update(),this.state=Tn}}]),t}(u.EventDispatcher);Object(ee.b)({Orbit:Wn});var Gn=[1,2,3,4,5,6,7,8];function Un(e){var t=e.createSphere,n=Object(c.useState)(!1),r=Object(X.a)(n,2),a=r[0],i=r[1],o=Object(c.useState)((function(){if(location.hash.startsWith("#sphere-")){var e=parseInt(location.hash.substring("#sphere-".length),10);if(Gn.find((function(t){return t===e})))return e}return 1})),s=Object(X.a)(o,2),l=s[0],u=s[1],h=Object(c.useState)((function(){return t(l)})),f=Object(X.a)(h,2),d=f[0],m=f[1];return Object(c.useEffect)((function(){location.hash="sphere-".concat(d.frequency)}),[d]),Object(c.useEffect)((function(){m(t(l))}),[l]),c.createElement("div",{id:"view-container",style:{position:"absolute",left:0,right:0,height:"100%"}},c.createElement("div",{id:"bottom-middle"},c.createElement(te.a,null,Gn.map((function(e){return c.createElement(ne.a,{color:"info",key:"Frequency".concat(e),disabled:e===l,onClick:function(){return u(e)}},e)})))),c.createElement("div",{id:"bottom-right"},c.createElement(te.a,null,c.createElement(ne.a,{onClick:function(){return le(d.fabricOutput)}},c.createElement(K.l,null)),c.createElement(ne.a,{onClick:function(){return i(!a)}},c.createElement(K.g,null)),c.createElement(ne.a,{onClick:function(){return C(E.Design)}},c.createElement(K.G,null)))),c.createElement(ee.a,{style:{backgroundColor:"black"}},c.createElement(qn,null),d?c.createElement($n,{sphere:d,polygons:a}):c.createElement("h1",null,"No Sphere")))}function $n(e){var t=e.sphere,n=e.polygons,r=Object(ee.d)().camera,a=document.getElementById("view-container"),i=Object(ee.e)((function(e){e.minPolarAngle=0,e.maxPolarAngle=Math.PI/2,e.minDistance=1,e.maxDistance=1e4,e.enableZoom=!0,e.update()}),[]),o=Object(c.useState)(0),s=Object(X.a)(o,2),l=s[0],h=s[1];return Object(ee.c)((function(){var e=i.current;0===l&&(e.autoRotate=!0,e.target.copy(t.location)),n||t.iterate();var r=(new u.Vector3).subVectors(t.instance.midpoint,e.target).multiplyScalar(.1);e.target.add(r),e.update(),h(l+1)})),c.createElement("group",null,c.createElement("orbit",{ref:i,args:[r,a]}),c.createElement("scene",null,n?c.createElement(Hn,{sphere:t}):c.createElement("lineSegments",{key:"lines",geometry:t.instance.floatView.lineGeometry,material:fe,onUpdate:function(e){return e.geometry.computeBoundingSphere()}}),c.createElement(Ee,null),c.createElement("ambientLight",{color:new u.Color("white"),intensity:.8}),c.createElement("directionalLight",{color:new u.Color("#FFFFFF"),intensity:2})))}var Jn=new u.CylinderGeometry(1,1,1,12,1,!1);function Hn(e){var t=e.sphere;return c.createElement("group",null,t.pulls.map((function(e){var n=t.instance.unitVector(e.index),a=(new u.Quaternion).setFromUnitVectors(p,n),i=I(e.alpha,e.omega),o=new u.Vector3(.005,i,.005);return c.createElement("mesh",{key:"T".concat(e.index),geometry:Jn,position:e.location(),rotation:(new u.Euler).setFromQuaternion(a),scale:o,material:pe(r.PhiTriangle),matrixWorldNeedsUpdate:!0})})),"}",t.pushes.map((function(e){var n=t.instance.unitVector(e.index),a=(new u.Quaternion).setFromUnitVectors(p,n),i=I(e.alpha,e.omega),o=new u.Vector3(.012,i,.012);return c.createElement("mesh",{key:"C".concat(e.index),geometry:Jn,position:e.location(),rotation:(new u.Euler).setFromQuaternion(a),scale:o,material:pe(r.RootPush),matrixWorldNeedsUpdate:!0})})),"}")}function qn(e){var t=Object(c.useRef)(),n=Object(ee.d)().setDefaultCamera;return Object(c.useEffect)((function(){var e=t.current;if(!e)throw new Error("No camera");e.fov=50,e.position.set(0,4,2.5),n(e)}),[]),Object(ee.c)((function(){var e=t.current;if(!e)throw new Error("No camera");e.updateMatrixWorld()})),c.createElement("perspectiveCamera",Object.assign({ref:t},e))}function Qn(e){var t=e.push;return e.reverse?t.omega:t.alpha}function Zn(e){var t=e.push;return e.reverse?t.alphaHub:t.omegaHub}var Yn=function(){function e(t,n,r,a,i,o){Object(Oe.a)(this,e),this.location=t,this.radius=n,this.frequency=r,this.twist=a,this.numericFeature=i,this.instance=o,this.joints=[],this.pushes=[],this.pulls=[],this.hubs=[],this.instance.clear()}return Object(Ce.a)(e,[{key:"hubAt",value:function(e){e.normalize().multiplyScalar(this.radius);var t={index:this.hubs.length,location:e,spokes:[]};return this.hubs.push(t),t}},{key:"pushBetween",value:function(e,t){var n=this,r=(new u.Vector3).addVectors(e.location,t.location).normalize(),a=(new u.Quaternion).setFromAxisAngle(r,this.twist),i=(new u.Vector3).copy(e.location).applyQuaternion(a),o=(new u.Vector3).copy(t.location).applyQuaternion(a),c=Math.sqrt(1e-5),s=e.location.distanceTo(t.location),l=this.createJoint(i),h=this.createJoint(o),f={index:this.fabric.create_interval(l.index,h.index,!0,s,s,1e-5,c,0),alpha:l,omega:h,alphaHub:e,omegaHub:t,location:function(){return(new u.Vector3).addVectors(n.instance.jointLocation(l.index),n.instance.jointLocation(h.index)).multiplyScalar(.5)}};return this.pushes.push(f),e.spokes.push({reverse:!1,push:f}),t.spokes.push({reverse:!0,push:f}),f}},{key:"pullsForSpoke",value:function(e,t,n){var r=this,a=[],i=function(e,t,n){if(!r.pullExists(e,t)){var i=Math.sqrt(1e-6),o=I(e,t),c={index:r.fabric.create_interval(e.index,t.index,!1,o,n,1e-6,i,100),alpha:e,omega:t,location:function(){return(new u.Vector3).addVectors(r.instance.jointLocation(e.index),r.instance.jointLocation(t.index)).multiplyScalar(.5)}};a.push(c),r.pulls.push(c)}},o=Qn(this.nextSpoke(e,t,!1)),c=this.nextSpoke(Zn(t),t,!1);return i(Qn(t),o,n),i(o,Qn(c),function(e){var t=e.push;return t.omegaHub.location.distanceTo(t.alphaHub.location)}(t)-2*n),a}},{key:"iterate",value:function(){if(!this.instance.iterate())switch(this.instance.stage){case d.Stage.Growing:new En(this).build(),this.instance.stage=d.Stage.Shaping;break;case d.Stage.Shaping:this.fabric.age>8e3&&(this.instance.stage=d.Stage.Slack);break;case d.Stage.Slack:this.instance.stage=d.Stage.Pretensing;break;case d.Stage.Pretensing:}}},{key:"createJoint",value:function(e){var t={index:this.fabric.create_joint(e.x,e.y,e.z),instance:this.instance};return this.joints.push(t),this.instance.refreshFloatView(),t}},{key:"nextSpoke",value:function(e,t,n){var r=t.push,a=e.spokes.find((function(e){return e.push.index===r.index}));if(!a)throw new Error("Cannot find current spoke when looking for next");var i=Zn(a).location,o=V(i,e.location),c=(new u.Vector3).crossVectors(e.location,o).normalize();this.twist<0!==n&&c.multiplyScalar(-1);var s=e.spokes.filter((function(e){return e.push.index!==a.push.index}));if(e.spokes.length!==s.length+1)throw new Error("Did not delete");var l=s.filter((function(t){return V(Zn(t).location,e.location).dot(c)>0})).sort((function(e,t){var n=Zn(e).location.distanceToSquared(i);return Zn(t).location.distanceToSquared(i)-n})).pop();if(!l)throw new Error("Couldn't find closest!");return l}},{key:"pullExists",value:function(e,t){return!!this.pulls.find((function(n){return n.alpha.index===e.index&&n.omega.index===t.index||n.alpha.index===t.index&&n.omega.index===e.index}))}},{key:"fabric",get:function(){return this.instance.fabric}},{key:"fabricOutput",get:function(){var e=this;this.instance.refreshFloatView();var t=this.instance.floatView.idealLengths,n=this.instance.floatView.strains,a=this.instance.floatView.stiffnesses,i=this.instance.floatView.linearDensities;return{name:"sphere",joints:this.joints.map((function(e){var t=N(e);return{index:e.index,x:t.x,y:t.z,z:t.y}})),intervals:[].concat(Object(f.a)(this.pushes.map((function(o){var c=.012/e.frequency,s=.015*c/.012,l=I(o.alpha,o.omega)-2*s,u=o.alpha.index,h=o.omega.index;if(u>=e.joints.length||h>=e.joints.length)throw new Error("Joint not found ".concat(u,",").concat(h,":").concat(e.joints.length));return{index:o.index,joints:[u,h],type:"Push",strain:n[o.index],stiffness:a[o.index],linearDensity:i[o.index],role:w(r.Push),scale:1,idealLength:t[o.index],isPush:!0,length:l,radius:c,jointRadius:s}}))),Object(f.a)(this.pulls.map((function(o){var c=.005/e.frequency,s=I(o.alpha,o.omega)+.03,l=o.alpha.index,u=o.omega.index;if(l>=e.joints.length||u>=e.joints.length)throw new Error("Joint not found ".concat(l,",").concat(u,":").concat(e.joints.length));return{index:o.index,joints:[l,u],type:"Pull",strain:n[o.index],stiffness:a[o.index],linearDensity:i[o.index],role:w(r.Push),scale:1,idealLength:t[o.index],isPush:!1,length:s,radius:c,jointRadius:.015}}))))}}}]),e}(),Xn=n(650),Kn=n(651),er=n(656),tr=n(652),nr=n(653),rr=n(654),ar=n(646);function ir(e){var t=e.tensegrity,n=(e.worldFeatures,e.storedState$),r=Object(c.useState)(n.getValue().polygons),a=Object(X.a)(r,2),i=a[0],o=a[1],s=Object(c.useState)(n.getValue().visibleRoles),l=Object(X.a)(s,2),u=l[0],h=l[1];function d(){if(!t)throw new Error("No tensegrity");return t.getFabricOutput(.012,.005,.015)}return Object(c.useEffect)((function(){var e=n.subscribe((function(e){o(e.polygons),h(e.visibleRoles)}));return function(){return e.unsubscribe()}}),[]),c.createElement(c.Fragment,null,t?c.createElement(Mr,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(K.E,null)," Take"),c.createElement(te.a,{vertical:!1,className:"w-100 my-2"},c.createElement(ne.a,{onClick:function(){return se(d())},disabled:!i},c.createElement(K.l,null)," Download CSV ",c.createElement(K.p,null)),c.createElement(ne.a,{onClick:function(){return le(d())},disabled:!i},c.createElement(K.l,null)," Download JSON ",c.createElement(K.o,null)))):void 0,c.createElement(Mr,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(K.m,null)," Show/Hide"),c.createElement("div",null,"Roles"),c.createElement(te.a,{size:"sm",className:"w-100 my-2"},x.map((function(e){return c.createElement(ne.a,{key:"viz".concat(e),style:{backgroundColor:u.indexOf(e)>=0?ge(e):"#747474"},disabled:!i,onClick:function(){u.indexOf(e)<0?Te(n,{visibleRoles:[].concat(Object(f.a)(u),[e])}):Te(n,{visibleRoles:u.filter((function(t){return t!==e}))})}},w(e))}))),t?c.createElement(c.Fragment,null,c.createElement(or,{push:!0,disabled:!i,storedState$:n,strainLimits:t.instance.floatView.strainLimits}),c.createElement(or,{push:!1,disabled:!i,storedState$:n,strainLimits:t.instance.floatView.strainLimits})):void 0))}function or(e){var t=e.push,n=e.disabled,r=e.strainLimits,a=e.storedState$,i=[0,1e3],o=Object(c.useState)([1e3*(t?a.getValue().pushBottom:a.getValue().pullBottom),1e3*(t?a.getValue().pushTop:a.getValue().pullTop)]),s=Object(X.a)(o,2),l=s[0],u=s[1],h=Object(c.useState)(0),f=Object(X.a)(h,2),d=f[0],m=f[1],g=Object(c.useState)(0),p=Object(X.a)(g,2),v=p[0],b=p[1];return Object(c.useEffect)((function(){function e(e){var n=t?r[1]:r[2];return n+e*((t?r[0]:r[3])-n)}if(t){var n=l[0]/1e3;m(e(n));var i=l[1]/1e3;b(e(i)),a.next(Object(Me.a)({},a.getValue(),{pushBottom:n,pushTop:i}))}else{var o=l[0]/1e3;m(e(o));var c=l[1]/1e3;b(e(c)),a.next(Object(Me.a)({},a.getValue(),{pullBottom:o,pullTop:c}))}}),[l]),c.createElement("div",{style:{height:"4em",width:"100%"},className:"my-2"},c.createElement("div",{className:"float-right",style:{color:n?"gray":"white"}},"".concat(F(d)," ").concat(F(v))),c.createElement("div",null,t?"Push":"Pull"," Strain"),c.createElement(ar.c,{disabled:n,mode:1,step:1,domain:i,rootStyle:mr,onChange:function(e){return u(e)},values:l},c.createElement(ar.b,null,(function(e){var t=e.getRailProps;return c.createElement("div",Object.assign({style:{position:"absolute",width:"100%",height:14,borderRadius:7,cursor:"pointer",backgroundColor:n?ur:lr}},t()))})),c.createElement(ar.a,null,(function(e){var t=e.handles,n=e.getHandleProps;return c.createElement("div",{className:"slider-handles"},t.map((function(e,t){return c.createElement(cr,{key:e.id,handle:e,domain:i,getHandleProps:n,top:1===t})})))})),c.createElement(ar.d,{right:!1},(function(e){var t=e.tracks,r=e.getTrackProps;return c.createElement("div",{className:"slider-tracks"},t.map((function(e,t){var a=e.id,i=e.source,o=e.target;return c.createElement(sr,{key:a,source:i,target:o,getTrackProps:r,color:fr(t,n)})})))}))))}function cr(e){var t=e.domain,n=e.handle,r=e.getHandleProps,a=e.top,i=t[0],o=t[1],s=n.id,l=n.value,u=n.percent;return c.createElement("div",Object.assign({role:"slider","aria-valuemin":i,"aria-valuemax":o,"aria-valuenow":l,style:{left:"".concat(u,"%"),position:"absolute",marginLeft:"-11px",marginTop:"-6px",zIndex:2,width:24,height:24,cursor:"pointer",borderRadius:2,boxShadow:"1px 1px 1px 1px rgba(0, 0, 0, 0.2)",backgroundColor:hr(a)}},r(s)))}function sr(e){var t=e.source,n=e.target,r=e.getTrackProps,a=e.color;return c.createElement("div",Object.assign({style:{position:"absolute",height:14,zIndex:1,backgroundColor:a,borderRadius:2,cursor:"pointer",left:"".concat(t.percent,"%"),width:"".concat(n.percent-t.percent,"%")}},r()))}var lr="#9B9B9B",ur="#767676";function hr(e){return e?"#c6161690":"#597fe790"}function fr(e,t){return t?ur:0===e?lr:"white"}var dr,mr={margin:"4%",position:"relative",width:"92%"};function gr(e){var t=e.feature,n=e.disabled,r=Object(c.useState)((function(){return t.percent})),a=Object(X.a)(r,2),i=a[0],o=a[1];return Object(c.useEffect)((function(){var e=t.observable.subscribe((function(e){var t=e.percent;return o(t)}));return function(){return e.unsubscribe()}}),[]),c.createElement("div",{className:"my-2"},c.createElement("div",{className:"float-right",style:{color:n?"gray":"white"}},t.formatted),c.createElement("div",null,t.config.name),c.createElement(te.a,{className:"w-100"},t.percentChoices.map((function(e){var r=i===e?"#000000":"#919191";return c.createElement(ne.a,{disabled:n,size:"sm",style:{color:"white",backgroundColor:r},key:"".concat(t.config.name,":").concat(e),onClick:function(){return t.percent=e}},function(e){return e<=100?"".concat(e,"%"):"".concat(e/100,"x")}(e))}))))}function pr(e){var t=e.worldFeatures,n=e.tensegrity,r=e.storedState$,a=Object(c.useState)(n.stage$.getValue()),i=Object(X.a)(a,2),o=i[0],s=i[1];Object(c.useEffect)((function(){var e=n.stage$.subscribe(s);return function(){return e.unsubscribe()}}),[n]);var l=Object(c.useState)(r.getValue().polygons),u=Object(X.a)(l,2),h=u[0],f=u[1];return Object(c.useEffect)((function(){var e=r.subscribe((function(e){f(e.polygons)}));return function(){return e.unsubscribe()}}),[]),c.createElement("div",null,c.createElement(Mr,null,c.createElement(gr,{feature:t[d.WorldFeature.VisualStrain],disabled:h}),c.createElement(gr,{feature:t[d.WorldFeature.PushOverPull]})),c.createElement(Mr,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(K.L,null)," Shaping"),c.createElement(gr,{feature:t[d.WorldFeature.ShapingPretenstFactor],disabled:o!==d.Stage.Shaping}),c.createElement(gr,{feature:t[d.WorldFeature.ShapingDrag],disabled:o!==d.Stage.Shaping}),c.createElement(te.a,{className:"w-100 my-3"},c.createElement(ne.a,{disabled:o!==d.Stage.Shaping,onClick:function(){return n.fabric.centralize()}},c.createElement(K.j,null)," Centralize"))),c.createElement(Mr,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(K.r,null)," Pretenst"),c.createElement(gr,{feature:t[d.WorldFeature.PretenstFactor],disabled:o!==d.Stage.Pretenst}),c.createElement(gr,{feature:t[d.WorldFeature.Gravity],disabled:o!==d.Stage.Pretenst}),c.createElement(gr,{feature:t[d.WorldFeature.Drag],disabled:o!==d.Stage.Pretenst}),c.createElement(te.a,{className:"w-100 my-3"},c.createElement(ne.a,{disabled:o!==d.Stage.Pretenst,onClick:function(){return n.fabric.set_altitude(1)}},c.createElement(K.t,null)," Nudge"),c.createElement(ne.a,{disabled:o!==d.Stage.Pretenst,onClick:function(){return n.fabric.set_altitude(10)}},c.createElement(K.A,null)," Drop"))))}function vr(e){var t=e.tensegrity,n=e.stageTransition,r=e.disabled,a=Object(c.useState)(t.stage),i=Object(X.a)(a,2),o=i[0],s=i[1];function l(e){return!(!r&&o!==d.Stage.Pretensing)||o!==e}switch(Object(c.useEffect)((function(){var e=t.stage$.subscribe(s);return function(){return e.unsubscribe()}}),[t]),n){case dr.CaptureLengthsToSlack:return c.createElement(ne.a,{className:"my-1 w-100",disabled:l(d.Stage.Shaping),onClick:function(){return t.do((function(e){return e.stage=d.Stage.Slack}))}},"Capture Lengths ",c.createElement(K.g,null),"( ",c.createElement(br,{stage:d.Stage.Shaping})," )",c.createElement(K.c,null),"( ",c.createElement(K.e,null),c.createElement(br,{stage:d.Stage.Slack})," ) New Slack");case dr.CurrentLengthsToPretenst:return c.createElement(ne.a,{className:"my-1 w-100",disabled:l(d.Stage.Shaping),onClick:function(){return t.do((function(e){return e.stage=d.Stage.Pretenst}))}},"Current Lengths ",c.createElement(br,{stage:d.Stage.Shaping})," ",c.createElement(K.c,null),c.createElement(br,{stage:d.Stage.Pretenst})," Pretenst");case dr.SlackToPretensing:return c.createElement(ne.a,{className:"my-1 w-100",disabled:l(d.Stage.Slack),onClick:function(){return t.do((function(e){return e.stage=d.Stage.Pretensing}))}},"Slack ",c.createElement(br,{stage:d.Stage.Slack})," ",c.createElement(K.c,null)," ",c.createElement(br,{stage:d.Stage.Pretenst})," Pretenst");case dr.SlackToShaping:return c.createElement(te.a,{vertical:!0,className:"w-100 my-1"},c.createElement(ne.a,{className:"my-1 w-100",disabled:l(d.Stage.Slack),onClick:function(){return t.do((function(e){return e.stage=d.Stage.Shaping}))}},"Slack ",c.createElement(br,{stage:d.Stage.Slack})," ",c.createElement(K.c,null)," ",c.createElement(br,{stage:d.Stage.Shaping})," Shaping"));case dr.CapturePretenstToSlack:return c.createElement(ne.a,{className:"my-1 w-100",disabled:l(d.Stage.Pretenst),onClick:function(){return t.do((function(e){return e.stage=d.Stage.Slack}))}},"Capture pretenst ",c.createElement(K.g,null)," ( ",c.createElement(br,{stage:d.Stage.Pretenst})," ) ",c.createElement(K.c,null)," ( ",c.createElement(K.e,null),c.createElement(br,{stage:d.Stage.Slack})," ) New Slack");case dr.CaptureStrainForStiffness:return c.createElement(ne.a,{className:"my-1 w-100",disabled:l(d.Stage.Pretenst),onClick:function(){return t.do((function(e){e.stage=d.Stage.Slack,e.strainToStiffness()}))}},"Capture Strain ",c.createElement(K.g,null)," ( ",c.createElement(br,{stage:d.Stage.Pretenst})," ",c.createElement(K.w,null)," ) ",c.createElement(K.c,null),"( ",c.createElement(br,{stage:d.Stage.Slack})," ",c.createElement(K.h,null)," ) Slack Stiffness")}}function br(e){switch(e.stage){case d.Stage.Growing:return c.createElement(K.F,null);case d.Stage.Shaping:return c.createElement(K.H,null);case d.Stage.Slack:return c.createElement(K.M,null);case d.Stage.Pretensing:return c.createElement(K.i,null);case d.Stage.Pretenst:return c.createElement(K.u,null);default:throw new Error("Stage?")}}function yr(e){var t=e.worldFeatures,n=e.tensegrity,r=e.storedState$,a=Object(c.useState)(r.getValue()),i=Object(X.a)(a,2),o=i[0],s=i[1],l=Object(c.useState)(r.getValue().polygons),u=Object(X.a)(l,2),h=u[0],f=u[1];function m(){return h}return Object(c.useEffect)((function(){var e=[r.subscribe((function(e){f(e.polygons),s(e)}))];return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[]),c.createElement("div",null,c.createElement(Mr,null,c.createElement(vr,{tensegrity:n,stageTransition:dr.CaptureLengthsToSlack,disabled:m()}),c.createElement(vr,{tensegrity:n,stageTransition:dr.CurrentLengthsToPretenst,disabled:m()}),c.createElement(vr,{tensegrity:n,stageTransition:dr.SlackToShaping,disabled:m()})),c.createElement(Mr,null,c.createElement(gr,{key:"pc",feature:t[d.WorldFeature.PretensingCountdown]}),c.createElement("div",null,"Surface"),c.createElement(te.a,{size:"sm",className:"w-100 my-2"},Object.keys(d.SurfaceCharacter).map((function(e){return c.createElement(ne.a,{key:"SurfaceCharacter[".concat(e,"]"),active:o.surfaceCharacter===d.SurfaceCharacter[e],onClick:function(){return Te(r,{surfaceCharacter:d.SurfaceCharacter[e]})}},e)}))),c.createElement(vr,{tensegrity:n,stageTransition:dr.SlackToPretensing,disabled:m()})),c.createElement(Mr,null,c.createElement(vr,{tensegrity:n,stageTransition:dr.CapturePretenstToSlack,disabled:m()}),c.createElement(vr,{tensegrity:n,stageTransition:dr.CaptureStrainForStiffness,disabled:m()})))}!function(e){e[e.CaptureLengthsToSlack=0]="CaptureLengthsToSlack",e[e.CurrentLengthsToPretenst=1]="CurrentLengthsToPretenst",e[e.SlackToPretensing=2]="SlackToPretensing",e[e.SlackToShaping=3]="SlackToShaping",e[e.CapturePretenstToSlack=4]="CapturePretenstToSlack",e[e.CaptureStrainForStiffness=5]="CaptureStrainForStiffness"}(dr||(dr={}));var wr,Er=n(659),Sr=n(658),kr=n(657),xr=n(648),Pr=n(649);function jr(e){var t=e.worldFeatures,n=e.rootTenscript,r=e.tensegrity,a=e.runTenscript,i=e.storedState$,o=Object(c.useState)(r&&!r.tenscript.fromUrl?r.tenscript:n),s=Object(X.a)(o,2),l=s[0],u=s[1],h=Object(c.useState)(""),f=Object(X.a)(h,2),m=f[0],g=f[1],p=Object(c.useState)(!1),v=Object(X.a)(p,2),b=v[0],y=v[1];return c.createElement("div",{id:"tenscript-panel",style:{flexDirection:"column",position:"relative",backgroundColor:"rgba(0,0,0,1)",height:"100%"}},c.createElement(Mr,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(K.F,null)," Tenscript"),c.createElement("div",{id:"code-and-run",style:{flexDirection:"column",height:"available"}},c.createElement(Or,{tenscript:l,setTenscript:u,error:m,setError:g}),c.createElement(te.a,{className:"w-100 my-2"},c.createElement(ne.a,{color:m.length>0?"warning":"success",disabled:m.length>0,onClick:function(){return a(l)}},0===m.length?c.createElement("span",null,"Execute ",c.createElement(K.B,null)," tenscript"):c.createElement("span",null,c.createElement(K.f,null)," ",m)))),c.createElement(Er.a,{className:"w-100 my-2",isOpen:b,toggle:function(){return y(!b)}},c.createElement(Sr.a,{color:"info",style:{borderRadius:"1.078em"}},"Explore ",c.createElement(K.v,null)," existing designs"),c.createElement(kr.a,null,Ye.map((function(e,t){return c.createElement(xr.a,{key:"Boot".concat(t),onClick:function(){return a(e)}},e.name)}))))),c.createElement(Mr,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(K.i,null)," Time"),c.createElement(gr,{key:"it",feature:t[d.WorldFeature.IterationsPerFrame]}),c.createElement(gr,{key:"ic",feature:t[d.WorldFeature.IntervalCountdown]})),c.createElement(Mr,null,c.createElement("h6",{className:"w-100 text-center"},"Special ",c.createElement(K.D,null)," versions"),c.createElement(te.a,{vertical:!1,className:"w-100"},c.createElement(ne.a,{onClick:function(){return C(E.Sphere)}},c.createElement(K.q,null)),c.createElement(ne.a,{onClick:function(){Te(i,{demoCount:0,fullScreen:!0,rotating:!0}),a(Ye[0])}},c.createElement(K.B,null)))))}function Or(e){var t=e.tenscript,n=e.setTenscript,r=e.error,a=e.setError,i=Object(c.useState)(""),o=Object(X.a)(i,2),s=o[0],l=o[1];function u(e){l(e),function(e){var t=Qe(a,!1,e);t&&(a(""),n(t))}(e)}return Object(c.useEffect)((function(){return l(t.code)}),[]),c.createElement("div",{className:"my-2 p-2 w-100",style:{backgroundColor:"#757575",color:"#ffffff",borderStyle:"solid",borderRadius:"1em",borderColor:0===r.length?"black":"#f0ad4e",borderWidth:"2px"}},c.createElement("h6",{className:"w-100 text-center"},c.createElement("i",null,'"',t.name,'"')),c.createElement(Pr.a,{style:{borderRadius:"1em",height:"17em"},type:"textarea",id:"tenscript",value:s,onChange:function(e){return u(e.target.value)}}))}function Cr(e){var t=e.tensegrity,n=e.selection,a=e.selectionMode,i=e.setSelectionMode,o=e.clearSelection,s=Object(c.useState)(r.PhiPush),l=Object(X.a)(s,2),u=l[0],h=l[1],f=function(e,r,a){return function(){n.intervals.forEach((function(n){var i=P(n.intervalRole);i&&!r||!i&&!a||t.changeIntervalScale(n,e?1.03:1/1.03)}))}};function m(e){return e?0===function(e){switch(e){case wr.Joints:return n.joints.length;case wr.Intervals:return n.intervals.length;case wr.Faces:return n.faces.length;default:return 0}}(e):0===n.joints.length&&0===n.intervals.length&&0===n.faces.length}function g(e){var t=e.item,n=e.disabled;return c.createElement(ne.a,{color:t===a?"success":"secondary",disabled:n,onClick:function(){return i(t)}},c.createElement("span",null,t))}return c.createElement("div",null,c.createElement(Mr,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(K.s,null)," Manual"),c.createElement(te.a,{size:"sm",className:"w-100 my-2"},c.createElement(g,{item:wr.SelectNone}),c.createElement(g,{item:wr.Faces}),c.createElement(g,{item:wr.Intervals}),c.createElement(g,{item:wr.Joints})),c.createElement(te.a,{size:"sm",className:"w-100 my-2"},c.createElement(ne.a,{disabled:m(wr.Intervals),onClick:f(!0,!0,!0)},"TC ",c.createElement(K.d,null)),c.createElement(ne.a,{disabled:m(wr.Intervals),onClick:f(!1,!0,!0)},"TC ",c.createElement(K.a,null)),c.createElement(ne.a,{disabled:m(wr.Intervals),onClick:f(!0,!1,!0)},"T",c.createElement(K.d,null)),c.createElement(ne.a,{disabled:m(wr.Intervals),onClick:f(!1,!1,!0)},"T ",c.createElement(K.a,null)),c.createElement(ne.a,{disabled:m(wr.Intervals),onClick:f(!0,!0,!1)},"C ",c.createElement(K.d,null)),c.createElement(ne.a,{disabled:m(wr.Intervals),onClick:f(!1,!0,!1)},"C ",c.createElement(K.a,null))),c.createElement(te.a,{size:"sm",className:"w-100 my-2"},c.createElement(ne.a,{disabled:0===n.joints.length||a!==wr.SelectNone,onClick:function(){return o()}},c.createElement(K.J,null)," Clear selection"),c.createElement(ne.a,{onClick:function(){return new it(t).replaceCrosses(t.numericFeature(d.WorldFeature.IntervalCountdown))}},c.createElement(K.x,null),c.createElement("span",null," Optimize"))),c.createElement(te.a,{size:"sm",className:"w-100 my-2"},c.createElement(ne.a,{disabled:0===n.joints.length||a!==wr.SelectNone},"do nothing"),c.createElement(ne.a,{onClick:function(){return t.do((function(e){return e.builder.createRadialPulls([])}))}},c.createElement("span",null," Distance75")),c.createElement(ne.a,{onClick:function(){return new it(t).replaceCrosses(t.numericFeature(d.WorldFeature.IntervalCountdown))}},c.createElement(K.x,null),c.createElement("span",null," Optimize")))),c.createElement(Mr,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(K.w,null)," Interval Lengths"),c.createElement(te.a,{className:"my-2 w-100"},x.map((function(e,t){return c.createElement(ne.a,{size:"sm",key:"IntervalRole[".concat(t,"]"),onClick:function(){return h(e)},color:u===e?"success":"secondary"},w(e))}))),c.createElement(Fr,{tensegrity:t,intervalRole:u})))}function Fr(e){var t=e.tensegrity,n=e.intervalRole,r=e.disabled;var a=function(e,r){return function(){t.intervals.filter((function(e){return e.intervalRole===n})).forEach((function(n){return t.changeIntervalScale(n,function(){var t=r?1.01:1.05;return e?t:1/t}())}))}};return c.createElement("div",{className:"my-2"},c.createElement("div",{className:"float-right",style:{color:r?"gray":"white"}},"[",F(b(n)),"]"),c.createElement("div",null,w(n,!0)),c.createElement(te.a,{className:"w-100"},c.createElement(ne.a,{disabled:r,onClick:a(!0,!1)},c.createElement(K.C,null),c.createElement(K.C,null)),c.createElement(ne.a,{disabled:r,onClick:a(!0,!0)},c.createElement(K.C,null)),c.createElement(ne.a,{disabled:r,onClick:a(!1,!0)},c.createElement(K.z,null)),c.createElement(ne.a,{disabled:r,onClick:a(!1,!1)},c.createElement(K.z,null),c.createElement(K.z,null))))}!function(e){e.SelectNone="Select None",e.Joints="Joints",e.Intervals="Intervals",e.Faces="Faces"}(wr||(wr={}));function Vr(e){var t=e.worldFeatures,n=e.rootTenscript,r=e.shapeSelection,a=e.setShapeSelection,i=e.selection,o=e.clearSelection,s=e.tensegrity,l=e.runTenscript,u=e.toFullScreen,h=e.storedState$,f=Object(c.useState)(s?s.stage$.getValue():void 0),d=Object(X.a)(f,2),m=d[0],g=d[1];Object(c.useEffect)((function(){var e=s?s.stage$.subscribe(g):void 0;return function(){e&&e.unsubscribe()}}),[s]);var p=Object(c.useState)(h.getValue().controlTab),v=Object(X.a)(p,2),b=v[0],y=v[1];function w(e){var t=e.tab;return c.createElement(Xn.a,null,c.createElement(Kn.a,{active:b===t,onClick:function(){return Te(h,{controlTab:t})}},t))}function E(e){var u=e.tab,f=c.createElement(er.a,{color:"warning"},"No fabric");return c.createElement(tr.a,{id:"tab-pane",style:{height:"100%"},tabId:u},c.createElement((function(){switch(u){case Ve.Script:return c.createElement(jr,{worldFeatures:t,rootTenscript:n,tensegrity:s,runTenscript:l,storedState$:h});case Ve.Phase:return s?c.createElement(yr,{worldFeatures:t,tensegrity:s,storedState$:h}):f;case Ve.Shape:return s?c.createElement(Cr,{tensegrity:s,selection:i,selectionMode:r,setSelectionMode:a,clearSelection:o}):f;case Ve.Live:return s?c.createElement(pr,{worldFeatures:t,tensegrity:s,storedState$:h}):f;case Ve.Frozen:return s?c.createElement(ir,{tensegrity:s,worldFeatures:t,storedState$:h}):f}}),null))}return Object(c.useEffect)((function(){b!==Ve.Shape&&o()}),[b,m]),Object(c.useEffect)((function(){var e=h.subscribe((function(e){return y(e.controlTab)}));return function(){return e.unsubscribe()}}),[]),c.createElement("div",{className:"h-100"},c.createElement(nr.a,{tabs:!0,style:{backgroundColor:"#b2b2b2"}},Object.keys(Ve).map((function(e){return c.createElement(w,{key:"T".concat(e),tab:Ve[e]})}))),c.createElement(rr.a,{style:{flex:1,flexFlow:"auto",height:"100%"},id:"tab-content",activeTab:b},Object.keys(Ve).map((function(e){return c.createElement(E,{key:e,tab:Ve[e]})}))),c.createElement("div",{style:{position:"absolute",top:0,height:"100%",left:"25em",zIndex:10,width:"1em"}},c.createElement((function(){return c.createElement(ne.a,{style:{padding:0,margin:0,borderRadius:0,width:"1em"},className:"w-100 h-100",color:"dark",onClick:u},c.createElement(K.b,null))}),null)))}function Mr(e){var t=e.children,n=e.height;return c.createElement("div",{className:"m-3 p-2",style:{height:n,borderRadius:"1em",borderStyle:"solid",borderWidth:"0.1em",borderColor:"#45782e"}},t)}Object(ee.b)({Orbit:Wn});var Tr=new u.SphereGeometry(.05,32,8),Rr=new u.Vector3(1.1,1.1,1.1),Ar=new u.CylinderGeometry(1,1,1,12,1,!1),Dr=new u.Color("#ffffff"),Nr=new u.SphereGeometry(100,25,25).scale(1,1,1);function Ir(e){var t=e.pushOverPull,n=e.tensegrity,r=e.selection,a=e.setSelection,i=e.storedState$,o=e.shapeSelection,s=e.polygons,l=document.getElementById("view-container"),h=Object(c.useState)(0),f=Object(X.a)(h,2),m=f[0],g=f[1],p=Object(ee.d)().camera,v=p;if(!v)throw new Error("Wheres the camera tenseg?");var b=Object(c.useMemo)((function(){var e=(new u.TextureLoader).load("space.jpg");return new u.MeshPhongMaterial({map:e,side:u.BackSide})}),[]),y=Object(c.useState)(n.stage$.getValue()),w=Object(X.a)(y,2),E=w[0],S=w[1],k=Object(c.useState)(n.instance),x=Object(X.a)(k,2),P=x[0],j=x[1];Object(c.useEffect)((function(){var e=n.stage$.subscribe(S);return j(n.instance),g(0),function(){return e.unsubscribe()}}),[n]);var O=Object(c.useState)(i.getValue()),C=Object(X.a)(O,2),F=C[0],V=C[1];Object(c.useEffect)((function(){var e=i.subscribe((function(e){return V(e)}));return function(){return e.unsubscribe()}}),[]),Object(c.useEffect)((function(){M.current.autoRotate=F.rotating}),[F]);var M=Object(ee.e)((function(e){var t=new u.Vector3(0,1,0);v.position.set(t.x,1,t.z+4),v.lookAt(e.target),v.fov=60,v.far=200,v.near=.001,e.object=v,e.minPolarAngle=-.98*Math.PI/2,e.maxPolarAngle=.8*Math.PI,e.maxDistance=90,e.zoomSpeed=.5,e.enableZoom=!0,e.target.set(t.x,t.y,t.z),e.update()}),[]);function T(e){var t,i=Object(Me.a)({},r);r.joints.some((function(t){return t.index===e.index}))?i.joints=r.joints.filter((function(t){return t.index!==e.index})):i.joints.push(e),i.intervals=n.intervals.filter((t=i.joints,function(e){var n=e.alpha,r=e.omega;return t.some((function(e){return e.index===n.index||e.index===r.index}))})),a(i)}function R(e){var t=Object(Me.a)({},r);r.intervals.some((function(t){return t.index===e.index}))?t.intervals=r.intervals.filter((function(t){return t.index!==e.index})):t.intervals.push(e),a(t)}return Object(ee.c)((function(){var e,t=P.view,a=r.joints.length>0?(e=r.joints).reduce((function(e,t){return e.add(N(t))}),new u.Vector3).multiplyScalar(1/e.length):new u.Vector3(t.midpoint_x(),t.midpoint_y(),t.midpoint_z()),c=(new u.Vector3).subVectors(a,M.current.target).multiplyScalar(.01);if(M.current.target.add(c),F.demoCount>=0){var l=p.position;l.y+=.01*(a.y-l.y);var h=l.distanceTo(a)-1.7*t.radius(),f=(new u.Vector3).subVectors(a,l).normalize().multiplyScalar(.01*h);l.add(f)}if(M.current.update(),!s&&o===wr.SelectNone){if(n.iterate())return void g(m-1);switch(E){case d.Stage.Growing:g(m-1);break;case d.Stage.Shaping:g(m<0?0:m+1),500===m&&F.demoCount>=0&&Te(i,{demoCount:F.demoCount+1,rotating:!0})}E===d.Stage.Pretensing&&(n.stage=d.Stage.Pretenst)}})),c.createElement("group",null,c.createElement("orbit",{ref:M,args:[v,l]}),c.createElement("scene",null,s?c.createElement("group",null,n.intervals.map((function(e){return c.createElement(_r,{key:"I".concat(e.index),pushOverPull:t,tensegrity:n,interval:e,selected:!1,storedState:F})})),"}"):c.createElement(c.Fragment,null,c.createElement("lineSegments",{key:"lines",geometry:n.instance.floatView.lineGeometry,material:fe}),c.createElement(Br,{tensegrity:n,stage:E,clickFace:function(e){return function(e){var t=Object(Me.a)({},r);r.intervals.some((function(t){return t.index===e.index}))?t.faces=r.faces.filter((function(t){return t.index!==e.index})):t.faces.push(e),a(t)}(e)}})),o!==wr.Intervals?void 0:n.intervals.map((function(e){return c.createElement(_r,{key:"I".concat(e.index),pushOverPull:t,tensegrity:n,interval:e,selected:!1,storedState:F,toggleInterval:function(){return R(e)}})})),o===wr.SelectNone?void 0:r.intervals.map((function(e){return c.createElement(_r,{key:"SI".concat(e.index),pushOverPull:t,tensegrity:n,interval:e,selected:!0,storedState:F,toggleInterval:function(){return R(e)}})})),o!==wr.Joints?void 0:n.joints.map((function(e){return c.createElement(Lr,{key:"J".concat(e.index),joint:e,selected:!1,toggleJoint:function(){return T(e)}})})),o===wr.SelectNone?void 0:r.joints.map((function(e){return c.createElement(Lr,{key:"SJ".concat(e.index),joint:e,selected:!0,toggleJoint:function(){return T(e)}})})),c.createElement(Ee,null),c.createElement("mesh",{key:"space",geometry:Nr,material:b}),c.createElement("ambientLight",{color:Dr,intensity:.8}),c.createElement("directionalLight",{color:new u.Color("#FFFFFF"),intensity:2})))}function Lr(e){var t=e.joint,n=e.selected,r=e.toggleJoint;return c.createElement("mesh",{key:"SJ".concat(t.index),geometry:Tr,position:N(t),material:n?de:me,matrixWorldNeedsUpdate:!0,scale:n?Rr:void 0,onPointerDown:r})}function _r(e){var t=e.pushOverPull,n=e.tensegrity,r=e.interval,a=e.selected,i=e.storedState,o=e.toggleInterval,s=function(e,t){if(void 0===t.visibleRoles.find((function(t){return t===e.intervalRole})))return!1;var n=function(e){var t=e.alpha,n=e.index;return t.instance.floatView.strainNuances[n]}(e);return P(e.intervalRole)?n>=t.pushBottom&&n<=t.pushTop:n>=t.pullBottom&&n<=t.pullTop}(r,i)?pe(r.intervalRole):ve,l=100*n.instance.floatView.stiffnesses[r.index]*(P(r.intervalRole)?t.numeric:1)*(a?3:1),h=n.instance.unitVector(r.index),f=(new u.Quaternion).setFromUnitVectors(p,h),d=_(r),m=new u.Vector3(l,d,l);return c.createElement("mesh",{geometry:Ar,position:L(r),rotation:(new u.Euler).setFromQuaternion(f),scale:m,material:s,matrixWorldNeedsUpdate:!0,onPointerDown:o})}function Br(e){var t=e.tensegrity,n=e.stage,r=e.clickFace,a=Object(ee.d)().raycaster,i=Object(c.useRef)(),o=Object(c.useState)(),s=Object(X.a)(o,2),l=s[0],h=s[1];return c.createElement("mesh",{key:"faces",ref:i,onPointerDown:function(e){return h(e)},onPointerUp:function(e){var o=i.current;if(!function(e){return e===d.Stage.Growing||e===d.Stage.Slack}(n)&&l&&o){var c=l.clientX-e.clientX,s=l.clientY-e.clientY;if(!(c*c+s*s>100)){var u=a.intersectObjects([o],!0).map((function(e){return e.faceIndex})).map((function(e){if(void 0!==e)return t.faces[e]})).reverse().pop();h(void 0),u&&r(u)}}},geometry:t.instance.floatView.faceGeometry},c.createElement("meshPhongMaterial",{attach:"material",transparent:!0,side:u.FrontSide,opacity:.4,color:"white"}))}function zr(e){if(O()!==E.Design)C(O());else{var t=function(){var e=location.hash.substring(1);try{return Qe((function(e){return console.error(e)}),!0,decodeURIComponent(e))}catch(t){console.error("Code error",t)}}();if(t)return t;if(e.demoCount>=0)return Ye[e.demoCount%Ye.length]}}function Wr(e){var t=e.createInstance,n=e.worldFeatures,r=e.storedState$,a=Object(c.useMemo)((function(){return t(!1)}),[]),i=Object(c.useState)(),o=Object(X.a)(i,2),s=o[0],l=o[1],h=Object(c.useState)(H),f=Object(X.a)(h,2),m=f[0],g=f[1],p=Object(c.useState)((function(){var e=zr(r.getValue());return e||(Te(r,{demoCount:0,fullScreen:!0,rotating:!0}),Ye[0])})),v=Object(X.a)(p,2),b=v[0],y=v[1];Object(c.useEffect)((function(){location.hash.startsWith("#`")||(location.hash=b.code)}),[b]);var w=Object(c.useState)(r.getValue().rotating),E=Object(X.a)(w,2),S=E[0],k=E[1],x=Object(c.useState)(wr.SelectNone),P=Object(X.a)(x,2),j=P[0],O=P[1],C=Object(c.useState)(r.getValue().fullScreen),F=Object(X.a)(C,2),V=F[0],M=F[1],T=Object(c.useState)(r.getValue().demoCount),R=Object(X.a)(T,2),A=R[0],D=R[1],N=Object(c.useState)(r.getValue().polygons),I=Object(X.a)(N,2),L=I[0],_=I[1];function B(e){if(a){location.hash=e.code,Te(r,{polygons:!1});l(new ot(new u.Vector3,G(),(function(e){return r.getValue().featureValues[e].numeric}),a,e))}}function z(e){Te(r,{fullScreen:e})}return Object(c.useEffect)((function(){var e=r.subscribe((function(e){M(e.fullScreen),e.demoCount<0?D(e.demoCount):e.demoCount>A&&(A+1===Ye.length?(y(Ye[0]),setTimeout((function(){Te(r,{demoCount:-1,fullScreen:!1,rotating:!1})}),200)):(D(e.demoCount),y(Ye[e.demoCount]))),_(e.polygons),k(e.rotating),a.world.set_surface_character(e.surfaceCharacter)}));return function(){return e.unsubscribe()}}),[s]),Object(c.useEffect)((function(){var e=Object.keys(n).map((function(e){return n[e]})).map((function(e){return e.observable.subscribe((function(){s&&s.instance.applyFeature(e)}))}));return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[s]),Object(c.useEffect)((function(){var e=setTimeout((function(){return B(b)}),200);return function(){return clearTimeout(e)}}),[b]),c.createElement(c.Fragment,null,V?A>=0?void 0:c.createElement(ne.a,{id:"to-full-screen",color:"dark",onClick:function(){return z(!1)}},c.createElement(K.c,null),c.createElement("br",null),c.createElement(K.K,null),c.createElement("br",null),c.createElement(K.c,null)):c.createElement("div",{id:"left-side",style:{visibility:V?"collapse":"visible",width:"25em"}},c.createElement(Vr,{worldFeatures:n,rootTenscript:b,tensegrity:s,selection:m,shapeSelection:j,setShapeSelection:O,clearSelection:function(){return g(H)},runTenscript:B,toFullScreen:function(){return z(!0)},storedState$:r})),c.createElement("div",{style:{position:"absolute",left:V?0:"26em",right:0,height:"100%"}},s?c.createElement("div",{className:"h-100"},c.createElement(Gr,{tensegrity:s}),A>=0?c.createElement("div",{id:"bottom-right"},c.createElement(te.a,null,c.createElement(ne.a,{color:"success",onClick:function(){Te(r,{demoCount:-1,fullScreen:!1,rotating:!1})}},c.createElement(K.G,null)," Exit demo"))):c.createElement("div",null,c.createElement("div",{id:"bottom-right"},c.createElement(te.a,null,c.createElement(ne.a,{color:S?"warning":"secondary",onClick:function(){return Te(r,{rotating:!S})}},c.createElement(K.I,null)))),c.createElement("div",{id:"bottom-left"},c.createElement(te.a,null,c.createElement(ne.a,{disabled:!L,color:L?"secondary":"success",onClick:function(){return Te(r,{polygons:!1})}},c.createElement(K.E,null)),c.createElement(ne.a,{disabled:L,color:L?"success":"secondary",onClick:function(){return Te(r,{polygons:!0})}},c.createElement(K.y,null))))),c.createElement("div",{id:"view-container",className:"h-100"},c.createElement(ee.a,{style:{backgroundColor:"black",borderStyle:"solid",borderColor:L||j!==wr.SelectNone?"#f0ad4e":"black",cursor:j!==wr.SelectNone?"pointer":"all-scroll",borderWidth:"2px"}},c.createElement(Ir,{pushOverPull:n[d.WorldFeature.PushOverPull],tensegrity:s,selection:m,setSelection:g,shapeSelection:j,polygons:L,storedState$:r})))):c.createElement("div",{id:"tensegrity-view",className:"h-100"},c.createElement("div",{style:{position:"relative",top:"50%",left:"50%"}},c.createElement(ne.a,{onClick:function(){return B(b)}},c.createElement("h6",null,b.name),c.createElement("h1",null,c.createElement(K.B,null)))))))}function Gr(e){var t=e.tensegrity,n=Object(c.useState)(t.stage$.getValue()),r=Object(X.a)(n,2),a=r[0],i=r[1];return Object(c.useEffect)((function(){var e=t.stage$.subscribe(i);return function(){return e.unsubscribe()}}),[t]),c.createElement("div",{id:"top-middle"},c.createElement("span",null,j(a))," ",c.createElement("i",null,'"',t.tenscript.name,'"'))}n.d(t,"startReact",(function(){return Hr}));var Ur=function(e){throw new Error("Unable to compile: ".concat(e))},$r=function(e){var t=Qe(Ur,!1,e);if(!t)throw new Error("Unable to build body");return t};function Jr(e){var t=document.getElementById("root");s.render(e,t)}function Hr(e,t,n){return qr.apply(this,arguments)}function qr(){return(qr=Object(o.a)(i.a.mark((function e(t,n,r){var a,o,s,h,f,d,m,g,p,v,b,w,S;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=function(e,a){return new Fe(t,200,e?r:n,a)},e.t0=O(),e.next=e.t0===E.Gotchi?4:e.t0===E.Bridge?10:e.t0===E.Sphere?19:24;break;case 4:return location.hash="gotchi",o=function(e,t,n,r){return y.forEach((function(n){return e.world.set_float_value(n,t(n))})),new ot(n,G(),t,e,$r(r))},s=new sn({newGotchi:function(e,n,r){var a=Vt(e,n,r);return new Mt(a,0!==n.fabric.age?void 0:o(n,(function(e){return Rt(e,t.default_world_feature(e))}),e.center,Pt))},newSatoshiTree:function(e,n){return new vn(e.name,o(n,(function(e){return At(e,t.default_world_feature(e))}),e.center,jt))}},"Pretenst Island",1001010),Jr(c.createElement(dn,{island:s,homePatch:s.patches[0],createInstance:a})),e.abrupt("break",29);case 10:return location.hash="bridge",h=function(e){return Z(e,t.default_world_feature(e))},f=a(!0),y.forEach((function(e){return f.world.set_float_value(e,h(e))})),d=$r(Q()),m=$(3.5),g=new ot(new u.Vector3,m,h,f,d),Jr(c.createElement(Se,{tensegrity:g})),e.abrupt("break",29);case 19:return p=function(e){return Cn(e,t.default_world_feature(e))},v=new u.Vector3(0,3,0),b=function(e){var t=a(!1);return y.forEach((function(e){return t.world.set_float_value(e,p(e))})),new Yn(v,.7,e,.52,p,t)},Jr(c.createElement(Un,{createSphere:b})),e.abrupt("break",29);case 24:return(w=new l.BehaviorSubject(Ae(De,t.default_world_feature))).subscribe((function(e){return Re(e)})),S=Ie(w,t.default_world_feature),Jr(c.createElement(Wr,{createInstance:a,worldFeatures:S,storedState$:w})),e.abrupt("break",29);case 29:yn();case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}}]);
//# sourceMappingURL=4.d4fc6ca8.chunk.js.map