(window.webpackJsonppretenst=window.webpackJsonppretenst||[]).push([[4],{567:function(e,t){},569:function(e,t){},8:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(1),c=n(10),o=n(80),s=n(81),l=n(74),u=n(34),f=n(35),d=n(7);var h=Object.keys(d.FabricFeature).filter((function(e){return isNaN(parseInt(e,10))})).map((function(e){return d.FabricFeature[e]}));function m(e){switch(e){case d.IntervalRole.NexusPush:return"Nex Push";case d.IntervalRole.ColumnPush:return"Col Push";case d.IntervalRole.Triangle:return"Tri";case d.IntervalRole.Ring:return"Ring";case d.IntervalRole.NexusCross:return"Nex Cross";case d.IntervalRole.ColumnCross:return"Col Cross";case d.IntervalRole.BowMid:return"Bow Mid";case d.IntervalRole.BowEnd:return"Bow End";case d.IntervalRole.FacePull:return"Face Pull";default:return"?"}}var p=Object.keys(d.IntervalRole).filter((function(e){return e.length>1&&d.IntervalRole[e]!==d.IntervalRole.FacePull})).map((function(e){return d.IntervalRole[e]}));function b(e){return e===d.IntervalRole.ColumnPush||e===d.IntervalRole.NexusPush}function v(e){switch(e){case d.FabricFeature.NexusPushLength:return d.IntervalRole.NexusPush;case d.FabricFeature.ColumnPushLength:return d.IntervalRole.ColumnPush;case d.FabricFeature.TriangleLength:return d.IntervalRole.Triangle;case d.FabricFeature.RingLength:return d.IntervalRole.Ring;case d.FabricFeature.NexusCrossLength:return d.IntervalRole.NexusCross;case d.FabricFeature.ColumnCrossLength:return d.IntervalRole.ColumnCross;case d.FabricFeature.BowMidLength:return d.IntervalRole.BowMid;case d.FabricFeature.BowEndLength:return d.IntervalRole.BowEnd;default:return}}var g,E,w,S,y=n(43),P=n(29),O=1.61803398875,k=Math.sqrt(2);function F(e){var t=new P.Vector3;switch(e){case g.XP:return t.setX(1);case g.XN:return t.setX(-1);case g.YP:return t.setY(1);case g.YN:return t.setY(-1);case g.ZP:return t.setZ(1);case g.ZN:return t.setZ(-1);default:return t}}function N(e,t){return F(e).multiplyScalar(k/2).addScaledVector(F(t),k/2/O)}!function(e){e[e.XP=0]="XP",e[e.XN=1]="XN",e[e.YP=2]="YP",e[e.YN=3]="YN",e[e.ZP=4]="ZP",e[e.ZN=5]="ZN"}(g||(g={})),function(e){e[e.XPA=0]="XPA",e[e.XPO=1]="XPO",e[e.XNA=2]="XNA",e[e.XNO=3]="XNO",e[e.YPA=4]="YPA",e[e.YPO=5]="YPO",e[e.YNA=6]="YNA",e[e.YNO=7]="YNO",e[e.ZPA=8]="ZPA",e[e.ZPO=9]="ZPO",e[e.ZNA=10]="ZNA",e[e.ZNO=11]="ZNO"}(E||(E={})),function(e){e[e.NNN=0]="NNN",e[e.PNN=1]="PNN",e[e.NPN=2]="NPN",e[e.NNP=3]="NNP",e[e.NPP=4]="NPP",e[e.PNP=5]="PNP",e[e.PPN=6]="PPN",e[e.PPP=7]="PPP"}(w||(w={})),function(e){e[e.NN=0]="NN",e[e.PN=1]="PN",e[e.NP=2]="NP",e[e.PP=3]="PP"}(S||(S={}));var j=[{alpha:N(g.ZN,g.XP),omega:N(g.ZP,g.XP)},{alpha:N(g.ZN,g.XN),omega:N(g.ZP,g.XN)},{alpha:N(g.XN,g.YP),omega:N(g.XP,g.YP)},{alpha:N(g.XN,g.YN),omega:N(g.XP,g.YN)},{alpha:N(g.YN,g.ZP),omega:N(g.YP,g.ZP)},{alpha:N(g.YN,g.ZN),omega:N(g.YP,g.ZN)}],x=[{name:w.NNN,opposite:w.PPP,negative:!0,ring:S.NN,pushEnds:[E.YNA,E.XNA,E.ZNA],ringMember:[S.NP,S.PN,S.PP]},{name:w.PNN,opposite:w.NPP,negative:!1,ring:S.PP,pushEnds:[E.XNA,E.YPA,E.ZNO],ringMember:[S.PN,S.NN,S.NP]},{name:w.NPN,opposite:w.PNP,negative:!1,ring:S.PN,pushEnds:[E.XNO,E.YNA,E.ZPA],ringMember:[S.PP,S.NP,S.NN]},{name:w.NNP,opposite:w.PPN,negative:!1,ring:S.NP,pushEnds:[E.XPA,E.YNO,E.ZNA],ringMember:[S.NN,S.PN,S.PP]},{name:w.NPP,opposite:w.PNN,negative:!0,ring:S.PP,pushEnds:[E.YNO,E.XPO,E.ZPA],ringMember:[S.PN,S.NP,S.NN]},{name:w.PNP,opposite:w.NPN,negative:!0,ring:S.PN,pushEnds:[E.YPO,E.XPA,E.ZNO],ringMember:[S.PP,S.NN,S.NP]},{name:w.PPN,opposite:w.NNP,negative:!0,ring:S.NP,pushEnds:[E.YPA,E.XNO,E.ZPO],ringMember:[S.NN,S.PP,S.PN]},{name:w.PPP,opposite:w.NNN,negative:!1,ring:S.NN,pushEnds:[E.XPO,E.YPO,E.ZPO],ringMember:[S.NP,S.PP,S.PN]}];function C(e){return x[e].opposite}function V(e){return e||{_:100}}function R(e){return e._/100}function M(e){return{_:100*e}}function T(e,t,n){var a=j.reduce((function(e,t){return e.push((new P.Vector3).add(t.alpha)),e.push((new P.Vector3).add(t.omega)),e}),[]),r=C(e),i=x[r].pushEnds.map((function(e){return a[e]})).reverse(),c=i.reduce((function(e,t){return e.add(t)}),new P.Vector3).multiplyScalar(1/3),o=(new P.Vector3).subVectors(i[0],c).normalize(),s=(new P.Vector3).sub(c).normalize(),l=(new P.Vector3).crossVectors(s,o).normalize(),u=(new P.Matrix4).makeBasis(o,s,l),f=R(t),d=(new P.Matrix4).getInverse(u).setPosition(n).scale(new P.Vector3(f,f,f));return a.map((function(e){return e.applyMatrix4(d)}))}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _="ABCDabcd";function L(e){return _.indexOf(e)>=0}var D="0123456789";function z(e){return D.indexOf(e)>=0}function B(e,t,n){switch(t){case"A":e.A=n;break;case"B":e.B=n;break;case"C":e.C=n;break;case"D":e.D=n;break;case"b":e.b=n;break;case"c":e.c=n;break;case"d":e.d=n;break;case"a":e.a=n;break;default:throw new Error("Unexpected direction directionChar: "+t)}}function Y(e,t,n){switch(t){case"A":e.MA=n;break;case"B":e.MB=n;break;case"C":e.MC=n;break;case"D":e.MD=n;break;case"a":e.Ma=n;break;case"b":e.Mb=n;break;case"c":e.Mc=n;break;case"d":e.Md=n;break;default:throw new Error("Unexpected direction directionChar: "+t)}}function Z(e,t,n){function a(e){if(!e.match(/^\d+$/))throw new Error("Not a number: ".concat(e));return parseInt(e,10)}try{if(!n||0===n.length)return void e("No code to parse");var r=function e(t){function n(e,t){var n=e.indexOf(","),a=n>=0;if("("!==e.charAt(0))return a?{content:e.substring(0,n),skip:n}:{content:e,skip:e.length};var r=function(e){if("("!==e.charAt(0))throw new Error('Code must start with "(": '.concat(e," ").concat(e.charAt(0)));for(var t=0,n=0;n<e.length;n++){var a=e.charAt(n);if("("===a)t++;else if(")"===a&&0===--t)return n}throw new Error("No matching end bracket: |".concat(e,"|"))}(e);return{content:t?e.substring(1,r):e.substring(0,r+1),skip:r+1}}var r=n(t,!0).content,i={};function c(t){var a=n(r.substring(t),!1),i=a.content,c=a.skip;return{codeTree:e(i),skip:c}}for(var o=0;o<r.length;o++){var s=r.charAt(o);if(L(s)){var l=c(o+1);if(!l.codeTree)throw new Error("No subtree: ".concat(r.substring(o)));B(i,s,l.codeTree),o+=l.skip}else if(z(s)){var u=n(r,!1);i._=a(u.content),o+=u.skip}else switch(s){case"S":var f=n(r.substring(o+1),!0);i.S={_:a(f.content)},o+=f.skip;break;case"M":var d=r.charAt(o+1),h=n(r.substring(o+2),!0);Y(i,d,{_:a(h.content)}),o+=h.skip+1;break;case",":case" ":break;default:throw new Error("Unexpected character: ".concat(s))}}return 0===Object.keys(i).length?void 0:i}(function(e){return e.replace(/[\n\r\t ]/g,"")}(n));if(!r)return;return function(e,t,n){return{name:e,tree:t,code:JSON.stringify(t).replace(/[_.:"]/g,"").replace(/[{]/g,"(").replace(/[}]/g,")").replace(/([ABCDabcdSM])\((\d*)\)/g,(function(e){return"".concat(arguments.length<=1?void 0:arguments[1]).concat(arguments.length<=2?void 0:arguments[2])})),fromUrl:n}}(function(e){var t=e.split(":");if(2===t.length)return t[1];return e.split("").filter((function(e){return L(e)||z(e)})).join("")}(n),r,t)}catch(i){return void e(i.message)}}function X(e){throw new Error("Unable to parse: ".concat(e))}function U(e,t){var n=e.split(":");return 2===n.length?"".concat(n[0],":").concat(t.trim()):"".concat(e,":").concat(t)}var $,G=["(0):Zen","(1):One","(6):Six","(16,S90):Axoneme","(b1,a1):Knee","(b3,a3):Leg","(a1,b1,c1,d1):Nexus","(A2,B(3,b(2,S90),S80),C(3,c(2,S90),S80),D(3,d(2,S90),S80)):Tripod with Knees","(A(8, S85, MA1), a(8, S85, MA1)):Bulge Ring","(a1,b(3,S85,MA1),c(3,S85,MA1),d(3,S85,MA1)):Convergence Three","(a1,b(10,S85,MA1),c(10,S85,MA1),d(10,S85,MA1)):Convergence Ten","(B(7,S80,MA1),C(2,S120,MA0),D(7,S80,MA1)):Halo by Crane","(B(5,S75),C(5,S75),D(5,S75)):Pretenst Lander","(a(1,MA0),c(3,b(3,d(3,c(3,b(3,d(1,MA0))))))):Zig Zag Loop","(B2, C2, D2, A(2, b2, c2, d2)):Crystal Interstitial","(a(2,b(2,c(2,d(1,MA11)),d(2,c(1,MA10))),c(2,d(2,b(1,MA13)),b(2,d(1,MA12))),d(2,b(2,c(1,MA15)),c(2,b(1,MA14)))),b(2,d(2,Mc13),c(2,Md14)),c(2,b(2,Md15),d(2,Mb10)),d(2,c(2,Mb11),b(2,Mc12))): Diamond","(a(3,b(3,c(3,d(2,MA11)),d(3,c(2,MA10))),c(3,d(3,b(2,MA13)),b(3,d(2,MA12))),d(3,b(3,c(2,MA15)),c(3,b(2,MA14)))),b(3,d(3,Mc13),c(3,Md14)),c(3,b(3,Md15),d(3,Mb10)),d(3,c(3,Mb11),b(3,Mc12))):Diamond2"].map((function(e){return Z(X,!1,e)}));function Q(e,t){var n=[];return e.forEach((function(e){var a=e.brick,r=e.tree,i=e.fabric;function c(e,n,a,r){var c=e.base===w.PPP?C(a):a,o=i.builder.createConnectedBrick(e,c,r);return 0===n._&&function(e,n){function a(n,a){if(a){var r=e.base===w.NNN?e.faces[n]:e.faces[C(n)];if(r.removed)throw new Error("!! trying to use a face that was removed");t(a._,r)}}a(w.PPP,n.MA),a(w.NPP,n.Mb),a(w.PNP,n.Mc),a(w.PPN,n.Md),a(w.PNN,n.MB),a(w.NPN,n.MC),a(w.NNP,n.MD),a(w.NNN,n.Ma)}(o,n),{tree:n,brick:o,fabric:i}}var o=r._;if(o){var s=o-1;n.push(c(a,A({},r,{_:s}),w.PPP,V(r.S)))}else l(a,w.PPP,r.A),l(a,w.NPP,r.b),l(a,w.PNP,r.c),l(a,w.PPN,r.d),l(a,w.PNN,r.B),l(a,w.NPN,r.C),l(a,w.NNP,r.D),l(a,w.NNN,r.a);function l(e,t,a){if(a){var r=V(a.S),i=A({},a,{_:a._?a._-1:void 0});n.push(c(e,i,t,r))}}})),n}function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.Grow="Grow",e.Shape="Shape",e.Realize="Realize",e.View="View",e.Strain="Strain"}($||($={}));var J="2020-02-22";function q(e){return Object.keys(e.recentCode).map((function(t){var n=e.recentCode[t],a=Z((function(e){return console.error(e)}),!1,n);if(!a)throw new Error("Unable to read recent tenscript code: ".concat(n));return a}))}function K(e){switch(e){case d.IntervalRole.NexusPush:return d.FabricFeature.NexusPushLength;case d.IntervalRole.ColumnPush:return d.FabricFeature.ColumnPushLength;case d.IntervalRole.Triangle:return d.FabricFeature.TriangleLength;case d.IntervalRole.Ring:return d.FabricFeature.RingLength;case d.IntervalRole.NexusCross:return d.FabricFeature.NexusCrossLength;case d.IntervalRole.ColumnCross:return d.FabricFeature.ColumnCrossLength;case d.IntervalRole.BowMid:case d.IntervalRole.BowEnd:return d.FabricFeature.BowMidLength;default:throw new Error("role?")}}function ee(e,t){return H({},e,{nonce:e.nonce+1},t)}var te="State";function ne(e,t){var n=localStorage.getItem(te);if(n){var a=JSON.parse(n);if(a.version===J)return a}return function(e,t){var n=h.map(e).reduce((function(e,n){return e[n.feature]={percent:100,numeric:t(n.feature)},e}),{});return{version:J,nonce:0,surfaceCharacter:d.SurfaceCharacter.Frozen,featureValues:n,recentCode:{},controlTab:$.Grow,fullScreen:!0,ellipsoids:!1,rotating:!1,showPushes:!0,showPulls:!0}}(e,t)}function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function re(e){switch(e){case d.FabricFeature.Gravity:return{feature:e,name:"Gravity",percents:[0,10,50,100,200,500]};case d.FabricFeature.Drag:return{feature:e,name:"Drag",percents:[0,10,50,100,150,200]};case d.FabricFeature.PretenstFactor:return{feature:e,name:"Pretenst factor",percents:[0,50,90,100,125,150,200]};case d.FabricFeature.IterationsPerFrame:return{feature:e,name:"Iterations per frame",percents:[10,25,50,100,200,300,500]};case d.FabricFeature.IntervalCountdown:return{feature:e,name:"Interval Countdown",percents:[10,20,30,100,150,400,1e3]};case d.FabricFeature.RealizingCountdown:return{feature:e,name:"Slack to Pretenst countdown",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.SlackThreshold:return{feature:e,name:"Slack threshold",percents:[.01,.1,1,10,100,1e3]};case d.FabricFeature.ShapingPretenstFactor:return{feature:e,name:"Pretenst factor",percents:[0,1,2,3,5,10,20,50,100]};case d.FabricFeature.ShapingStiffnessFactor:return{feature:e,name:"Stiffness factor",percents:[100,150,200,250,300,400,500]};case d.FabricFeature.ShapingDrag:return{feature:e,name:"Drag",percents:[0,10,50,100,200,500]};case d.FabricFeature.MaxStrain:return{feature:e,name:"Maximum Strain",percents:[1,2,3,5,8,13,21,34,55,100]};case d.FabricFeature.VisualStrain:return{feature:e,name:"Visual Strain",percents:[0,10,50,100,200,300,500,1e3,1e4,1e5]};case d.FabricFeature.PushOverPull:return{feature:e,name:"Compression/Tension",percents:[10,20,30,50,100,200,300,500,1e3]};case d.FabricFeature.NexusPushLength:return{feature:e,name:"Nexus Push",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.ColumnPushLength:return{feature:e,name:"Column Push",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.TriangleLength:return{feature:e,name:"Triangle",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.RingLength:return{feature:e,name:"Ring",percents:[10,80,90,100,110,120,130]};case d.FabricFeature.NexusCrossLength:return{feature:e,name:"Nexus Cross",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.ColumnCrossLength:return{feature:e,name:"Column Cross",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.BowMidLength:return{feature:e,name:"Bow Mid",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.BowEndLength:return{feature:e,name:"Bow End",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.PushRadius:return{feature:e,name:"Push Radius",percents:[5,25,50,100,150,200,300]};case d.FabricFeature.PullRadius:return{feature:e,name:"Pull Radius",percents:[5,25,50,100,150,200,300]};case d.FabricFeature.JointRadius:return{feature:e,name:"Joint Radius",percents:[5,25,50,100,150,200,300]};case d.FabricFeature.MaxStiffness:return{feature:e,name:"Maximum Stiffness",percents:[5,25,50,100,150,200,500]};default:throw new Error("Feature?")}}var ie=function(){function e(t,n,a){Object(u.a)(this,e),this.config=t,this.defaultValue=n,this.value$=void 0;var r=a.getValue().featureValues[t.feature],i=void 0!==r?r:{numeric:this.defaultValue,percent:100};this.value$=new s.BehaviorSubject(i),this.value$.subscribe((function(e){var n=a.getValue(),r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n.featureValues);r[t.feature]=e,a.next(ee(n,{featureValues:r}))}))}return Object(f.a)(e,[{key:"value",get:function(){return this.value$.getValue()}},{key:"title",get:function(){return this.config.name}},{key:"percentChoices",get:function(){return this.config.percents}},{key:"numeric",get:function(){return this.value$.getValue().numeric}},{key:"formatted",get:function(){var e=this.numeric,t=e.toExponential(5),n=t.indexOf("e+0");return n>0?t.substring(0,n):Math.max(t.indexOf("e-1"),t.indexOf("e-2"))>0?e.toFixed(5):Math.max(t.indexOf("e+1"),t.indexOf("e+2"))>0?e.toFixed(1):t}},{key:"percent",get:function(){return this.value$.getValue().percent},set:function(e){this.value$.next({numeric:this.defaultValue*e/100,percent:e})}},{key:"observable",get:function(){return this.value$}},{key:"fabricFeature",get:function(){return this.config.feature}}]),e}();function ce(e,t){var n={};return h.map(re).forEach((function(a){n[a.feature]=new ie(a,t(a.feature),e)})),n}var oe=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function se(){if("serviceWorker"in navigator){if(new URL("/app",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/app","/service-worker.js");oe?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):le(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):le(e)}))}}function le(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var ue=n(31),fe=n(623),de=n(112),he=n(548),me=n(613),pe=function(e,t,n){var a=3*t;return n?(n.set(e[a],e[a+1],e[a+2]),n):new P.Vector3(e[a],e[a+1],e[a+2])};function be(e,t){return{lineColors:ve((function(e){return t.copy_line_colors_to(e)}),(function(){return 3*e.get_interval_count()*2})),lineLocations:ve((function(e){return t.copy_line_locations_to(e)}),(function(){return 3*e.get_interval_count()*2})),faceNormals:ve((function(e){return t.copy_face_normals_to(e)}),(function(){return 3*e.get_face_count()*3})),faceLocations:ve((function(e){return t.copy_face_vertex_locations_to(e)}),(function(){return 3*e.get_face_count()*3})),jointLocations:ve((function(e){return t.copy_joint_locations_to(e)}),(function(){return 3*e.get_joint_count()})),jointVelocities:ve((function(e){return t.copy_joint_velocities_to(e)}),(function(){return 3*e.get_joint_count()})),unitVectors:ve((function(e){return t.copy_unit_vectors_to(e)}),(function(){return 3*e.get_interval_count()})),idealLengths:ve((function(e){return t.copy_ideal_lengths_to(e)}),(function(){return e.get_interval_count()})),strains:ve((function(e){return t.copy_strains_to(e)}),(function(){return e.get_interval_count()})),strainNuances:ve((function(e){return t.copy_strain_nuances_to(e)}),(function(){return e.get_interval_count()})),stiffnesses:ve((function(e){return t.copy_stiffnesses_to(e)}),(function(){return e.get_interval_count()})),linearDensities:ve((function(e){return t.copy_linear_densities_to(e)}),(function(){return e.get_interval_count()}))}}function ve(e,t){var n=new Float32Array(t());return e(n),n}var ge=function(){function e(t,n){Object(u.a)(this,e),this.fabric=void 0,this.world=void 0,this.view=void 0,this.floatView=void 0,this.featuresToApply=[],this.world=t.World.new(),this.fabric=t.Fabric.new(n),this.view=t.View.on_fabric(this.fabric),this.floatView=be(this.fabric,this.view)}return Object(f.a)(e,[{key:"iterate",value:function(e){var t=this,n=this.fabric.iterate(e,this.world);return this.fabric.render_to(this.view,this.world),this.featuresToApply.length>0&&(this.featuresToApply.forEach((function(e){return t.world.set_float_value(e.fabricFeature,e.numeric)})),this.featuresToApply=[]),this.floatView=be(this.fabric,this.view),n}},{key:"refreshFloatView",value:function(){this.fabric.render_to(this.view,this.world),this.floatView=be(this.fabric,this.view)}},{key:"clear",value:function(){this.fabric.clear(),this.refreshFloatView()}},{key:"applyFeature",value:function(e){this.featuresToApply.push(e)}},{key:"jointLocation",value:function(e){return pe(this.floatView.jointLocations,e)}},{key:"apply",value:function(e){this.fabric.apply_matrix4(new Float32Array(e.toArray()))}},{key:"unitVector",value:function(e){return pe(this.floatView.unitVectors,e)}}]),e}(),Ee=function(){function e(t,n,a){Object(u.a)(this,e),this.numericFeature=t,this.fabric=n,this._stage=void 0,this._stage=a}return Object(f.a)(e,[{key:"withStage",value:function(t,n){return this.transition(t,n),this._stage=t,new e(this.numericFeature,this.fabric,t)}},{key:"transition",value:function(e,t){switch(this._stage){case d.Stage.Growing:switch(e){case d.Stage.Shaping:return void this.fabric.save()}break;case d.Stage.Shaping:switch(e){case d.Stage.Slack:return void(t&&t.adoptLengths&&(this.fabric.instance.fabric.adopt_lengths(),this.fabric.save()));case d.Stage.Realizing:return}break;case d.Stage.Slack:switch(e){case d.Stage.Shaping:case d.Stage.Realizing:return}break;case d.Stage.Realizing:switch(e){case d.Stage.Realized:return}break;case d.Stage.Realized:switch(e){case d.Stage.Slack:if(t&&t.strainToStiffness){var n=this.numericFeature(d.FabricFeature.PushOverPull),a=function(e,t){var n=e.instance.floatView.strains,a=e.instance.floatView.stiffnesses,r=function(e){return e.reduce((function(e,t){return e+n[t.index]}),0)/e.length},i=e.intervals,c=i.filter((function(e){return e.isPush})),o=r(c),s=i.filter((function(e){return!e.isPush})),l=r(s),u=(-t*o+l)/2,f=i.map((function(e){return 1+(n[e.index]*(e.isPush?-t:1)-u)/u})),d=a.map((function(e,t){return e*f[t]})),h=d.map(we);return{newStiffnesses:d,newLinearDensities:h}}(this.fabric,n),r=a.newStiffnesses,i=a.newLinearDensities;this.fabric.restore();var c=this.fabric.instance;throw r.forEach((function(e,t){return c.floatView.stiffnesses[t]=e})),i.forEach((function(e,t){return c.floatView.linearDensities[t]=e})),new Error("setting these values isn't going to work!")}return t&&t.adoptLengths?(this.fabric.instance.fabric.adopt_lengths(),void this.fabric.save()):void this.fabric.restore()}}throw new Error("No transition ".concat(d.Stage[this._stage]," to ").concat(d.Stage[e]))}},{key:"stage",get:function(){return this._stage}}]),e}();function we(e){return Math.sqrt(e)}var Se=n(544);function ye(e){return.6*e}var Pe=function(){function e(t,n){Object(u.a)(this,e),this.fabric=t,this.numericFeature=n,this.faceMarks={}}return Object(f.a)(e,[{key:"createBrickAt",value:function(e,t){var n=T(w.PPP,t,e);return this.createBrick(n,w.NNN,t)}},{key:"createConnectedBrick",value:function(e,t,n){var a=e.faces[t],r=R(e.scale),i=r*R(n),c=this.createBrickOnFace(a,M(i)),o=c.faces[c.base],s=this.numericFeature(d.FabricFeature.IntervalCountdown);return this.connectFaces(a,o,M((r+i)/2),s),c}},{key:"uprightOnSingleMarkedFace",value:function(){var e=this.faceMarkLists.find((function(e){return 1===e.length}));e&&this.uprightAtOrigin(e[0])}},{key:"checkFacePulls",value:function(e,t){var n=this;if(0===e.length)return e;return e.filter((function(e){var a=e.alpha,r=e.omega,i=e.scaleFactor;return!(a.location().distanceTo(r.location())<=10*ye(i))||(function(e){var t=e.alpha,a=e.omega,r=e.scaleFactor,i=n.numericFeature(d.FabricFeature.IntervalCountdown);n.connectFaces(t,a,M(r),i)}(e),t(e),!1)}))}},{key:"optimize",value:function(){var e=this,t=this.fabric,n=[],a=function(e){var n=t.intervals.filter((function(e){return e.isPush})).find((function(t){return t.alpha.index===e||t.omega.index===e}));if(!n)throw new Error("Cannot find ".concat(e));return{interval:n,joint:n.alpha.index===e?n.alpha:n.omega}},r=t.intervals.filter((function(e){return e.intervalRole===d.IntervalRole.ColumnCross||e.intervalRole===d.IntervalRole.NexusCross}));r.forEach((function(e,t){var i=e.alpha.index,c=e.omega.index,o=a(i),s=a(c),l=e.alpha.location(),u=e.omega.location(),f=l.distanceTo(u),d=(new P.Vector3).addVectors(l,u).multiplyScalar(.5);r.forEach((function(r,h){var m=r.alpha.index,p=r.omega.index;if(!(t>=h||i===m||i===p||c===m||c===p)){var b,v,g,E,w,S=a(m),y=a(p),O=function(e,t){return e.interval.index===t.interval.index};if(O(o,S))b=o.interval,v=e.alpha,g=e.omega,E=r.alpha,w=r.omega;else if(O(o,y))b=o.interval,v=e.alpha,g=e.omega,E=r.omega,w=r.alpha;else if(O(s,S))b=s.interval,v=e.omega,g=e.alpha,E=r.alpha,w=r.omega;else{if(!O(s,y))return;b=s.interval,v=e.omega,g=e.alpha,E=r.omega,w=r.alpha}var k=r.alpha.location(),F=r.omega.location(),N=k.distanceTo(F),j=(new P.Vector3).addVectors(k,F).multiplyScalar(.5),x=l.distanceTo(j)/N,C=u.distanceTo(j)/N,V=k.distanceTo(d)/f,R=F.distanceTo(d)/f,M=0,T=function(e){e<.5&&M++};if(T(x),T(C),T(V),T(R),!(M<2)){var I=b.scale;n.push({scale:I,a:v,x:g,b:E,y:w})}}}))}));var i=this.numericFeature(d.FabricFeature.IntervalCountdown);n.forEach((function(n){var a=n.scale,r=n.a,c=n.x,o=n.b,s=n.y;t.createInterval(c,s,d.IntervalRole.BowMid,a,i);var l=t.findInterval(r,c),u=t.findInterval(r,s),f=t.findInterval(o,c),h=t.findInterval(o,s);if(!(l&&f&&u&&h))throw new Error("Cannot find intervals during optimize");t.removeInterval(l),t.removeInterval(h),e.fabric.changeIntervalRole(u,d.IntervalRole.BowEnd,a,i),e.fabric.changeIntervalRole(f,d.IntervalRole.BowEnd,a,i)}))}},{key:"uprightAtOrigin",value:function(e){var t=this.faceToOrigin(e);this.fabric.instance.apply(t)}},{key:"createFacePulls",value:function(e){var t=this,n=function(){var n,a=t.createBrickAt((n=e.map((function(e){return e.location()}))).reduce((function(e,t){return e.add(t)}),new P.Vector3).multiplyScalar(1/n.length),M(function(e){return e.reduce((function(e,t){return e+R(t.brick.scale)}),0)/e.length}(e)));return e.map((function(e){var n=a.faces.filter((function(t){var n=t.negative;return!t.removed&&n!==e.negative})).reduce((function(t,n){return t.location().distanceTo(e.location())<n.location().distanceTo(e.location())?t:n}));return n.removed=!0,t.fabric.createFacePull(n,e)}))};switch(e.length){case 2:return e[0].negative===e[1].negative?n():[this.fabric.createFacePull(e[0],e[1])];case 3:return n();default:return[]}}},{key:"createBrickOnFace",value:function(e,t){var n=x[e.triangle].negative,a=e.brick,r=e.triangle;this.fabric.instance.refreshFloatView();var i=a.faces[r].joints.map((function(e){return e.location()})),c=i.reduce((function(e,t){return e.add(t)}),new P.Vector3).multiplyScalar(1/3),o=(new P.Vector3).addVectors(i[0],i[1]).multiplyScalar(.5),s=(new P.Vector3).subVectors(o,c).normalize(),l=(new P.Vector3).subVectors(i[1],c).normalize(),u=(new P.Vector3).add(s).multiplyScalar(s.dot(l)),f=l.sub(u).normalize(),d=(new P.Vector3).crossVectors(f,s).normalize(),h=(new P.Matrix4).makeBasis(s,d,f).setPosition(c),m=T(n?w.NNN:w.PPP,t,new P.Vector3(0,0,0)).map((function(e){return e.applyMatrix4(h)})),p=n?w.PPP:w.NNN;return this.createBrick(m,p,t)}},{key:"createBrick",value:function(e,t,n){var a,r=this,i=this.numericFeature(d.FabricFeature.IntervalCountdown),c=function(e,t,n){return{index:e,base:t,scale:n,joints:[],pushes:[],pulls:[],crosses:[],rings:[[],[],[],[]],faces:[],negativeAdjacent:0,postiveeAdjacent:0}}(this.fabric.bricks.length,t,n);this.fabric.bricks.push(c);var o=e.map((function(e,t){return r.fabric.createJointIndex(e)}));this.fabric.instance.refreshFloatView(),j.forEach((function(e,t){Object(Se.a)(e);var a=o[2*t],s=o[2*t+1],l={index:a,oppositeIndex:s,location:function(){return r.fabric.instance.jointLocation(a)}},u={index:s,oppositeIndex:a,location:function(){return r.fabric.instance.jointLocation(s)}};c.pushes.push(r.fabric.createInterval(l,u,d.IntervalRole.NexusPush,n,i))})),c.pushes.forEach((function(e){return c.joints.push(e.alpha,e.omega)}));var s=c.pushes.reduce((function(e,t){return e.push(t.alpha,t.omega),e}),[]);return(a=this.fabric.joints).push.apply(a,Object(y.a)(s)),x.forEach((function(e){for(var t=e.pushEnds.map((function(e){return s[e]})),a=0;a<3;a++){var o=t[a],l=t[(a+1)%3],u=r.fabric.createInterval(o,l,d.IntervalRole.Triangle,n,i);c.pulls.push(u),c.rings[e.ringMember[a]].push(u)}})),x.forEach((function(e){var t=r.fabric.createFace(c,e.name);c.faces.push(t)})),this.fabric.instance.refreshFloatView(),c}},{key:"faceToOrigin",value:function(e){var t=e.joints.map((function(e){return e.location()})),n=t.reduce((function(e,t){return e.add(t)}),new P.Vector3).multiplyScalar(1/3),a=(new P.Vector3).subVectors(t[1],n).normalize(),r=(new P.Vector3).subVectors(t[0],n).normalize(),i=(new P.Vector3).crossVectors(r,a).normalize();r.crossVectors(a,i).normalize();var c=(new P.Matrix4).makeBasis(a,i,r).setPosition(n);return(new P.Matrix4).getInverse(c)}},{key:"facesToRing",value:function(e,t){if(e.negative===t.negative)throw new Error("Polarity not opposite");var n=(new P.Vector3).subVectors(e.joints[0].location(),e.location()).normalize(),a=t.joints.map((function(e,a){return[(new P.Vector3).subVectors(e.location(),t.location()).normalize().dot(n),a]})).sort((function(e,t){return t[0]-e[0]})).pop();if(!a)throw new Error("No opposite joint");var r=[[1,0,2],[2,1,0],[0,2,1]][a[1]];return[e.joints[0],t.joints[r[0]],e.joints[1],t.joints[r[1]],e.joints[2],t.joints[r[2]]]}},{key:"connectFaces",value:function(e,t,n,a){var r=this;if(e.negative===t.negative)throw new Error("Same polarity!");for(var i=this.facesToRing(e,t),c=function(e){return e.negativeAdjacent>1||e.postiveeAdjacent>1},o=function(e,t,i){return r.fabric.createInterval(e,t,i,n,a)},s=0;s<i.length;s++){var l=i[(s+5)%6],u=i[s],f=i[(s+1)%6];o(u,f,d.IntervalRole.Ring);var h=function(e,t,n){var a=r.fabric.joints[t.oppositeIndex],i=c(n.brick)?d.IntervalRole.NexusCross:d.IntervalRole.ColumnCross;o(e,a,i)};e.negative?h(l,u,e):h(f,u,t)}var m=function(e){var t=e.brick.scale,n=e.triangle,i=e.brick;e.negative?i.negativeAdjacent++:i.postiveeAdjacent++,x.filter((function(e){return e.opposite!==n&&e.negative!==x[n].negative})).forEach((function(e){return i.faces[e.name].canGrow=!1})),r.fabric.removeFace(e,!0);var o=x[n].ring;c(i)?(i.pulls.filter((function(e){return!e.removed})).forEach((function(e){return r.fabric.changeIntervalRole(e,d.IntervalRole.Triangle,t,a)})),i.crosses.forEach((function(e){return r.fabric.changeIntervalRole(e,d.IntervalRole.NexusCross,t,a)}))):i.rings[o].filter((function(e){return!e.removed})).forEach((function(e){return r.fabric.changeIntervalRole(e,d.IntervalRole.Ring,t,a)}));var s=c(i)?d.IntervalRole.NexusPush:d.IntervalRole.ColumnPush;i.pushes.filter((function(e){return!e.removed})).forEach((function(e){return r.fabric.changeIntervalRole(e,s,t,a)}))};m(e),m(t)}},{key:"markFace",get:function(){var e=this;return function(t,n){var a=e.faceMarks[t];a?a.push(n):e.faceMarks[t]=[n]}}},{key:"initialFacePulls",get:function(){var e=this;return this.faceMarkLists.filter((function(e){return 2===e.length||3===e.length})).reduce((function(t,n){return[].concat(Object(y.a)(t),Object(y.a)(e.createFacePulls(n)))}),[])}},{key:"faceMarkLists",get:function(){var e=this;return Object.keys(this.faceMarks).map((function(t){return e.faceMarks[t]}))}}]),e}(),Oe=65535;function ke(e){return R(e)/1e4}var Fe,Ne,je=function(){function e(t,n,a,r){Object(u.a)(this,e),this.roleDefaultLength=t,this.numericFeature=n,this.instance=a,this.tenscript=r,this.life$=void 0,this.joints=[],this.intervals=[],this.facePulls=[],this.faces=[],this.bricks=[],this.activeTenscript=void 0,this.facesToConnect=void 0,this.builder=void 0,this.backup=void 0,this.instance.clear(),this.life$=new s.BehaviorSubject(new Ee(n,this,d.Stage.Growing)),this.builder=new Pe(this,n);var i=this.builder.createBrickAt(new P.Vector3,V());this.bricks=[i],this.activeTenscript=[{tree:this.tenscript.tree,brick:i,fabric:this}]}return Object(f.a)(e,[{key:"save",value:function(){console.log("Saving backup"),this.backup=this.instance.fabric.copy()}},{key:"restore",value:function(){if(!this.backup)throw new Error("No backup");console.log("Restoring from backup"),this.instance.fabric.restore(this.backup)}},{key:"toStage",value:function(e,t){e!==this.life.stage&&this.life$.next(this.life.withStage(e,t))}},{key:"connectFaces",value:function(e){this.facesToConnect=e}},{key:"createJointIndex",value:function(e){return this.instance.fabric.create_joint(e.x,e.y,e.z)}},{key:"createFacePull",value:function(e,t){var n=e.location().distanceTo(t.location()),a=ke(V()),r=we(a),i=(R(e.brick.scale)+R(t.brick.scale))/2,c=ye(i),o={index:this.instance.fabric.create_interval(e.index,t.index,d.IntervalRole.FacePull,n,c,a,r,function(e){var t=6e3*e;return t>Oe?Oe:t}(n)),alpha:e,omega:t,distance:n,scaleFactor:i,removed:!1};return this.facePulls.push(o),o}},{key:"removeFacePull",value:function(e){this.facePulls=this.facePulls.filter((function(t){return t.index!==e.index})),this.instance.fabric.remove_interval(e.index),this.facePulls.forEach((function(t){t.index>e.index&&t.index--})),this.intervals.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0}},{key:"createInterval",value:function(e,t,n,a,r){var i=e.location().distanceTo(t.location()),c=R(a)*this.roleDefaultLength(n),o=ke(a),s=we(o),l={index:this.instance.fabric.create_interval(e.index,t.index,n,i,c,o,s,r),intervalRole:n,scale:a,alpha:e,omega:t,removed:!1,isPush:b(n),location:function(){return(new P.Vector3).addVectors(e.location(),t.location()).multiplyScalar(.5)}};return this.intervals.push(l),l}},{key:"changeIntervalScale",value:function(e,t){e.scale=M(R(e.scale)*t),this.instance.fabric.multiply_rest_length(e.index,t,100)}},{key:"changeIntervalRole",value:function(e,t,n,a){e.intervalRole=t,this.instance.fabric.set_interval_role(e.index,t),this.instance.fabric.change_rest_length(e.index,R(n)*this.roleDefaultLength(t),a)}},{key:"removeInterval",value:function(e){this.intervals=this.intervals.filter((function(t){return t.index!==e.index})),this.instance.fabric.remove_interval(e.index),this.intervals.forEach((function(t){t.index>e.index&&t.index--})),this.facePulls.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0}},{key:"createFace",value:function(e,t){var n=x[t],a=n.negative,r=n.pushEnds,i=r.map((function(t){var n=e.pushes.find((function(n){var a=e.joints[t];return a.index===n.alpha.index||a.index===n.omega.index}));if(void 0===n)throw new Error;return n})),c=[0,1,2].map((function(n){return e.pulls[3*t+n]})),o=r.map((function(t){return e.joints[t]})),s={index:this.instance.fabric.create_face(o[0].index,o[1].index,o[2].index),canGrow:!0,negative:a,removed:!1,brick:e,triangle:t,joints:o,pushes:i,pulls:c,location:function(){return o.reduce((function(e,t){return e.add(t.location())}),new P.Vector3).multiplyScalar(1/3)}};return this.faces.push(s),s}},{key:"removeFace",value:function(e,t){var n=this;this.instance.fabric.remove_face(e.index),this.faces=this.faces.filter((function(t){return t.index!==e.index})),this.faces.forEach((function(t){t.index>e.index&&t.index--})),this.facePulls.forEach((function(t){t.alpha.index>e.index&&t.alpha.index--,t.omega.index>e.index&&t.omega.index--})),e.removed=!0,t&&e.pulls.forEach((function(e){return n.removeInterval(e)}))}},{key:"startTightening",value:function(e){this.facePulls=e}},{key:"iterate",value:function(){var e=this,t=this.instance.iterate(this.life$.getValue().stage);if(t===d.Stage.Busy)return t;var n=this.activeTenscript;if(n){if(n.length>0&&(this.activeTenscript=Q(n,this.builder.markFace),this.instance.fabric.centralize()),0===n.length&&(this.activeTenscript=void 0,this.builder.uprightOnSingleMarkedFace(),this.instance.refreshFloatView(),t===d.Stage.Growing)){var a=this.instance.fabric.finish_growing();return this.facePulls=this.builder.initialFacePulls,a}return d.Stage.Growing}var r=this.facesToConnect;return r&&(this.facesToConnect=void 0,this.builder.createFacePulls(r)),this.facePulls=this.builder.checkFacePulls(this.facePulls,(function(t){return e.removeFacePull(t)})),t}},{key:"findInterval",value:function(e,t){return this.intervals.find((function(n){return n.alpha.index===e.index&&n.omega.index===t.index||n.alpha.index===t.index&&n.omega.index===e.index}))}},{key:"life",get:function(){return this.life$.getValue()}},{key:"submergedJoints",get:function(){return this.joints.filter((function(e){return e.location().y<0}))}},{key:"facesGeometry",get:function(){var e=new P.Float32BufferAttribute(this.instance.floatView.faceLocations,3),t=new P.Float32BufferAttribute(this.instance.floatView.faceNormals,3),n=new P.BufferGeometry;return n.addAttribute("position",e),n.addAttribute("normal",t),n.computeBoundingSphere(),n}},{key:"linesGeometry",get:function(){var e=new P.Float32BufferAttribute(this.instance.floatView.lineLocations,3),t=new P.Float32BufferAttribute(this.instance.floatView.lineColors,3),n=new P.BufferGeometry;return n.addAttribute("position",e),n.addAttribute("color",t),n.computeBoundingSphere(),n}},{key:"output",get:function(){var e=function(e){return e.toFixed(5).replace(/[.]/,",")},t=this.instance.floatView.idealLengths,n=this.instance.floatView.strains,a=this.instance.floatView.stiffnesses,r=this.instance.floatView.linearDensities;return{name:this.tenscript.name,joints:this.joints.map((function(t){var n=t.location();return{index:(t.index+1).toString(),x:e(n.x),y:e(n.z),z:e(n.y)}})),intervals:this.intervals.map((function(i){var c="".concat(i.alpha.index+1,",").concat(i.omega.index+1),o=e(n[i.index]),s=i.isPush?"Push":"Pull",l=a[i.index],u=e(l),f=r[i.index],d=e(f),h=i.intervalRole.toFixed(0),m=t[i.index];return{joints:c,type:s,strainString:o,stiffness:l,stiffnessString:u,linearDensity:f,linearDensityString:d,isPush:b(i.intervalRole),role:h,length:m}})).sort((function(e,t){return e.isPush&&!t.isPush?-1:!e.isPush&&t.isPush?1:e.stiffness-t.stiffness}))}}}]),e}(),xe=n(618),Ce=n(619),Ve=n(624),Re=n(620),Me=n(621),Te=n(622),Ie=["#ff0012","#fb5c06","#e28a00","#d4b500","#afd200","#80da52","#4edd83","#00ddad","#00c4d7","#00a5ff","#007bff","#2329f7"].reverse().map((function(e){return new P.Color(e)})),Ae=!0,_e=new P.MeshPhongMaterial({color:new P.Color("#1c1608"),side:P.DoubleSide}),Le=new P.LineBasicMaterial({vertexColors:P.VertexColors}),De=new P.LineBasicMaterial({color:new P.Color("#cace02")}),ze=new P.MeshPhongMaterial({lights:Ae,color:new P.Color("white"),side:P.DoubleSide,transparent:!0,opacity:.2}),Be=new P.MeshPhongMaterial({color:new P.Color("#91934f"),lights:!0}),Ye=new P.MeshPhongMaterial({color:new P.Color("#e83ada"),lights:!0}),Ze=Ie.map((function(e){return new P.MeshLambertMaterial({color:e,lights:Ae})}));function Xe(e){switch(e){case d.IntervalRole.NexusPush:return"#6541b4";case d.IntervalRole.ColumnPush:return"#2f3aca";case d.IntervalRole.Triangle:return"#a29d3e";case d.IntervalRole.Ring:return"#e83ada";case d.IntervalRole.NexusCross:return"#59ebcb";case d.IntervalRole.ColumnCross:return"#299995";case d.IntervalRole.BowMid:return"#f101e9";case d.IntervalRole.BowEnd:return"#cb01c3";case d.IntervalRole.FacePull:return"#bf0105";default:return}}function Ue(e){var t=function(e){return new P.Color(Xe(e))}(e);return new P.MeshLambertMaterial({color:t,lights:Ae})}function $e(e){var t=e.feature,n=e.disabled,a=Object(c.useState)((function(){return t.percent})),r=Object(ue.a)(a,2),i=r[0],o=r[1];Object(c.useEffect)((function(){var e=t.observable.subscribe((function(e){var t=e.percent;return o(t)}));return function(){return e.unsubscribe()}}),[]);var s=Xe(v(t.fabricFeature)),l=s||"#919191";return c.createElement("div",{className:"my-2"},c.createElement("div",{className:"float-right",style:{color:n?"gray":"white"}},t.formatted),c.createElement("div",null,t.config.name),c.createElement(me.a,{className:"w-100"},t.percentChoices.map((function(e){var a=i===e?"#000000":l;return c.createElement(he.a,{disabled:n,size:"sm",style:{color:"white",backgroundColor:a},key:"".concat(t.config.name,":").concat(e),onClick:function(){return t.percent=e}},function(e){return e<=100?"".concat(e,"%"):"".concat(e/100,"x")}(e))}))))}function Ge(e){var t=e.fabric,n=e.stageTransition,a=e.disabled,r=Object(c.useState)(t.life),i=Object(ue.a)(r,2),o=i[0],s=i[1];function l(e){return!(!a&&o.stage!==d.Stage.Busy&&o.stage!==d.Stage.Realizing)||o.stage!==e}switch(Object(c.useEffect)((function(){var e=t.life$.subscribe(s);return function(){return e.unsubscribe()}}),[t]),n){case Fe.CaptureLengthsToSlack:return c.createElement(he.a,{className:"my-1 w-100",disabled:l(d.Stage.Shaping),onClick:function(){return t.toStage(d.Stage.Slack,{adoptLengths:!0})}},"Capture Lengths ",c.createElement(fe.j,null)," (",c.createElement(Qe,{stage:d.Stage.Shaping})," ) ",c.createElement(fe.d,null)," ( ",c.createElement(fe.f,null),c.createElement(Qe,{stage:d.Stage.Slack})," ) New Slack");case Fe.CurrentLengthsToSlack:return c.createElement(he.a,{className:"my-1 w-100",disabled:l(d.Stage.Shaping),onClick:function(){return t.toStage(d.Stage.Slack)}},"Current Lengths ",c.createElement(Qe,{stage:d.Stage.Shaping})," ",c.createElement(fe.d,null),c.createElement(Qe,{stage:d.Stage.Slack})," Slack");case Fe.SlackToRealizing:return c.createElement(he.a,{className:"my-1 w-100",disabled:l(d.Stage.Slack),onClick:function(){return t.toStage(d.Stage.Realizing)}},"Slack ",c.createElement(Qe,{stage:d.Stage.Slack})," ",c.createElement(fe.d,null)," ",c.createElement(Qe,{stage:d.Stage.Realized})," Realized");case Fe.SlackToShaping:return c.createElement(me.a,{vertical:!0,className:"w-100 my-1"},c.createElement(he.a,{className:"my-1 w-100",disabled:l(d.Stage.Slack),onClick:function(){return t.toStage(d.Stage.Shaping)}},"Slack ",c.createElement(Qe,{stage:d.Stage.Slack})," ",c.createElement(fe.d,null)," ",c.createElement(Qe,{stage:d.Stage.Shaping})," Shaping"));case Fe.CaptureRealizedToSlack:return c.createElement(he.a,{className:"my-1 w-100",disabled:l(d.Stage.Realized),onClick:function(){return t.toStage(d.Stage.Slack,{adoptLengths:!0})}},"Capture realized ",c.createElement(fe.j,null)," ( ",c.createElement(Qe,{stage:d.Stage.Realized})," ) ",c.createElement(fe.d,null)," ( ",c.createElement(fe.f,null),c.createElement(Qe,{stage:d.Stage.Slack})," ) New Slack");case Fe.CaptureStrainForStiffness:return c.createElement(he.a,{className:"my-1 w-100",disabled:l(d.Stage.Realized),onClick:function(){return t.toStage(d.Stage.Slack,{strainToStiffness:!0})}},"Capture Strain ",c.createElement(fe.j,null)," ( ",c.createElement(Qe,{stage:d.Stage.Realized})," ",c.createElement(fe.E,null)," ) ",c.createElement(fe.d,null),"( ",c.createElement(Qe,{stage:d.Stage.Slack})," ",c.createElement(fe.k,null)," ) Slack Stiffness")}}function Qe(e){switch(e.stage){case d.Stage.Busy:return c.createElement(fe.n,null);case d.Stage.Growing:return c.createElement(fe.L,null);case d.Stage.Shaping:return c.createElement(fe.Q,null);case d.Stage.Slack:return c.createElement(fe.S,null);case d.Stage.Realizing:return c.createElement(fe.n,null);case d.Stage.Realized:return c.createElement(fe.A,null);default:throw new Error("Stage?")}}function We(e){var t=e.floatFeatures,n=e.fabric,a=e.selectedIntervals,r=e.setFabric,i=e.shapeSelection,o=e.setShapeSelection,s=e.selectedFaces,l=e.clearSelectedFaces,u=e.storedState$,f=Object(c.useState)(!1),h=Object(ue.a)(f,2),b=h[0],v=h[1];Object(c.useEffect)((function(){n.instance.world.set_push_and_pull(b)}),[b]);var g=Object(c.useState)(u.getValue().ellipsoids),E=Object(ue.a)(g,2),w=E[0],S=E[1];Object(c.useEffect)((function(){var e=[u.subscribe((function(e){return S(e.ellipsoids)}))];return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[]);var y=Object(c.useState)(n.life),P=Object(ue.a)(y,2),O=P[0],k=P[1];Object(c.useEffect)((function(){var e=n.life$.subscribe(k);return function(){return e.unsubscribe()}}),[n]);var F=Object(c.useState)(t[d.FabricFeature.NexusPushLength]),N=Object(ue.a)(F,2),j=N[0],x=N[1],C=function(e,t,r){return function(){a&&a.forEach((function(a){a.isPush&&!t||!a.isPush&&!r||n.changeIntervalScale(a,e?1.03:1/1.03)}))}};function V(){return w||O.stage!==d.Stage.Shaping}function R(e,t){return!(!V()&&i===t)||(s.length<e||w)}function M(){return w||i!==Ne.None}return c.createElement("div",null,c.createElement(vt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(fe.a,null)," Phase"),c.createElement(Ge,{fabric:n,stageTransition:Fe.CaptureLengthsToSlack,disabled:M()}),c.createElement(Ge,{fabric:n,stageTransition:Fe.CurrentLengthsToSlack,disabled:M()}),c.createElement(Ge,{fabric:n,stageTransition:Fe.SlackToShaping,disabled:M()})),c.createElement(vt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(fe.y,null)," Manual"),c.createElement(me.a,{size:"sm",className:"w-100 my-2"},c.createElement(he.a,{color:i===Ne.Intervals?"warning":"secondary",disabled:w&&i===Ne.None||0===s.length,onClick:function(){var e=i===Ne.Intervals?Ne.None:Ne.Intervals;o(e)}},c.createElement("span",null,c.createElement(fe.b,null)," Adjust ",c.createElement(fe.e,null))),c.createElement(he.a,{disabled:R(1,Ne.Intervals),onClick:C(!0,!0,!0)},"TC ",c.createElement(fe.e,null)),c.createElement(he.a,{disabled:R(1,Ne.Intervals),onClick:C(!1,!0,!0)},"TC ",c.createElement(fe.b,null)),c.createElement(he.a,{disabled:R(1,Ne.Intervals),onClick:C(!0,!1,!0)},"T",c.createElement(fe.e,null)),c.createElement(he.a,{disabled:R(1,Ne.Intervals),onClick:C(!1,!1,!0)},"T ",c.createElement(fe.b,null)),c.createElement(he.a,{disabled:R(1,Ne.Intervals),onClick:C(!0,!0,!1)},"C ",c.createElement(fe.e,null)),c.createElement(he.a,{disabled:R(1,Ne.Intervals),onClick:C(!1,!0,!1)},"C ",c.createElement(fe.b,null))),c.createElement(me.a,{size:"sm",className:"w-100 my-2"},c.createElement(he.a,{disabled:0===s.length||V()&&i!==Ne.None,onClick:function(){return l()}},c.createElement(fe.O,null)," Clear selection"),c.createElement(he.a,{disabled:R(1,Ne.Faces),onClick:function(){n.builder.uprightAtOrigin(s[0]),n.instance.refreshFloatView(),l()}},c.createElement(fe.o,null),c.createElement("span",null," Upright")),c.createElement(he.a,{disabled:R(2,Ne.Faces),onClick:function(){n.connectFaces(s),l(),o(Ne.None),r(n)}},c.createElement(fe.D,null),c.createElement("span",null," Connect")),c.createElement(he.a,{disabled:V(),onClick:function(){return n.builder.optimize()}},c.createElement(fe.F,null),c.createElement("span",null," Bows")))),c.createElement(vt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(fe.Q,null)," Adjustments"),c.createElement($e,{feature:t[d.FabricFeature.ShapingPretenstFactor],disabled:V()}),c.createElement($e,{feature:t[d.FabricFeature.ShapingDrag],disabled:V()}),c.createElement($e,{feature:t[d.FabricFeature.ShapingStiffnessFactor],disabled:V()}),c.createElement(me.a,{size:"sm",className:"w-100 my-2"},c.createElement(he.a,{disabled:V(),color:b?"secondary":"success",onClick:function(){return v(!1)}},c.createElement(fe.l,null),": T or C"),c.createElement(he.a,{disabled:V(),color:b?"success":"secondary",onClick:function(){return v(!0)}},c.createElement(fe.r,null),": T=C"))),c.createElement(vt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(fe.E,null)," Default Lengths"),c.createElement($e,{key:j.title,feature:j,disabled:V()}),c.createElement(me.a,{className:"my-2"},p.map((function(e){return{intervalRole:e,feature:t[K(e)]}})).map((function(e){var t=e.intervalRole,n=e.feature;return c.createElement(he.a,{size:"sm",key:"IntervalRole[".concat(t,"]"),onClick:function(){return x(n)},color:j.fabricFeature===n.fabricFeature?"success":"secondary"},m(t))})))))}function He(e){var t=e.floatFeatures,n=e.fabric,a=e.shapeSelection,r=e.storedState$,i=Object(c.useState)(r.getValue()),o=Object(ue.a)(i,2),s=o[0],l=o[1],u=Object(c.useState)(r.getValue().ellipsoids),f=Object(ue.a)(u,2),h=f[0],m=f[1];Object(c.useEffect)((function(){var e=[r.subscribe((function(e){m(s.ellipsoids),l(e)}))];return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[]);var p=Object(c.useState)(n.life),b=Object(ue.a)(p,2),v=b[0],g=b[1];function E(){return h||a!==Ne.None||v.stage<d.Stage.Slack}function w(){return h||a!==Ne.None}return Object(c.useEffect)((function(){var e=n.life$.subscribe(g);return function(){return e.unsubscribe()}}),[n]),c.createElement("div",null,c.createElement(vt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(fe.a,null)," Phase"),c.createElement(Ge,{fabric:n,stageTransition:Fe.SlackToRealizing,disabled:w()}),c.createElement(Ge,{fabric:n,stageTransition:Fe.CaptureRealizedToSlack,disabled:w()})),c.createElement(vt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(fe.x,null)," Environment"),c.createElement($e,{feature:t[d.FabricFeature.PretenstFactor],disabled:E()}),c.createElement("div",{className:"float-right",style:{color:E()?"gray":"white"}},d.SurfaceCharacter[s.surfaceCharacter]),c.createElement("div",null,"Surface"),c.createElement(me.a,{size:"sm",className:"w-100"},Object.keys(d.SurfaceCharacter).map((function(e){return c.createElement(he.a,{key:"SurfaceCharacter[".concat(e,"]"),disabled:E(),active:s.surfaceCharacter===d.SurfaceCharacter[e],onClick:function(){return t={surfaceCharacter:d.SurfaceCharacter[e]},void r.next(ee(r.getValue(),t));var t}},e)}))),c.createElement($e,{feature:t[d.FabricFeature.Gravity],disabled:E()}),c.createElement($e,{feature:t[d.FabricFeature.Drag],disabled:E()})),c.createElement(vt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(fe.g,null)," Compression vs Tension"),c.createElement(Ge,{fabric:n,stageTransition:Fe.CaptureStrainForStiffness,disabled:w()}),c.createElement($e,{feature:t[d.FabricFeature.PushOverPull],disabled:E()})))}!function(e){e[e.CaptureLengthsToSlack=0]="CaptureLengthsToSlack",e[e.CurrentLengthsToSlack=1]="CurrentLengthsToSlack",e[e.SlackToRealizing=2]="SlackToRealizing",e[e.SlackToShaping=3]="SlackToShaping",e[e.CaptureRealizedToSlack=4]="CaptureRealizedToSlack",e[e.CaptureStrainForStiffness=5]="CaptureStrainForStiffness"}(Fe||(Fe={})),function(e){e[e.None=0]="None",e[e.Faces=1]="Faces",e[e.Intervals=2]="Intervals"}(Ne||(Ne={}));var Je=.7,qe=1.4,Ke=3.5,et=[d.FabricFeature.MaxStrain,d.FabricFeature.MaxStiffness,d.FabricFeature.VisualStrain,d.FabricFeature.SlackThreshold];function tt(e){var t=new P.Geometry,n=function(e,t){return new P.Vector3(e,t,0)};return t.vertices=[n(0,-Ke),n(0,Ke),n(-Je,Ke),n(Je,Ke),n(-Je,-Ke),n(Je,-Ke)],e&&t.vertices.push(n(-Je,0),n(Je,0)),t}function nt(e,t,n,a,r){var i=new Float32Array(2*n.length*3),c=0;e.forEach((function(e){var t=(n[e.index]-a)/(r-a),o=t<-1?-1:t>1?1:t;i[c++]=-Je*qe,i[c++]=o*Ke,i[c++]=0,i[c++]=Je*qe,i[c++]=o*Ke,i[c++]=0}));var o=new P.BufferGeometry;return o.addAttribute("position",new P.Float32BufferAttribute(i,3)),o.addAttribute("color",new P.Float32BufferAttribute(t,3)),o}function at(e){var t=e.floatFeatures,n=e.fabric,a=e.storedState$,r=Object(c.useRef)();return c.createElement(c.Fragment,null,c.createElement(vt,{height:"50%"},c.createElement("div",{style:{position:"absolute",left:"6em"}},"Strain"),c.createElement("div",{style:{position:"absolute",right:"5em"}},"Stiffness"),c.createElement((function(){var e=Object(c.useState)(0),t=Object(ue.a)(e,2),i=t[0],o=t[1],s=Object(c.useState)(a.getValue().featureValues[d.FabricFeature.MaxStrain].numeric),l=Object(ue.a)(s,2),u=l[0],f=l[1],h=Object(c.useState)(a.getValue().featureValues[d.FabricFeature.MaxStiffness].numeric),m=Object(ue.a)(h,2),p=m[0],b=m[1];Object(c.useEffect)((function(){var e=a.subscribe((function(e){f(e.featureValues[d.FabricFeature.MaxStrain].numeric),b(e.featureValues[d.FabricFeature.MaxStiffness].numeric)}));return function(){return e.unsubscribe()}}),[n]),Object(c.useEffect)((function(){var e=setInterval((function(){var e=n.instance.fabric.age;i<e&&o(e)}),1e3);return function(){return clearTimeout(e)}}),[]);var v=n.instance;function g(e){var t=e.position,n=e.intervals,a=e.floats,r=e.mid,i=e.max,o=e.middleTick;return c.createElement("group",{position:new P.Vector3(t,-.15,0)},c.createElement("lineSegments",{geometry:nt(n,v.floatView.lineColors,a,r,i),material:Le}),c.createElement("lineSegments",{geometry:tt(o),material:De}))}return c.createElement(de.a,null,c.createElement("orthographicCamera",{position:new P.Vector3(0,0,-1),ref:r}),c.createElement("scene",null,c.createElement(g,{position:-1.5,intervals:n.intervals,floats:v.floatView.strains,mid:0,max:u,middleTick:!0}),c.createElement(g,{position:1.5,intervals:n.intervals,floats:v.floatView.stiffnesses,mid:0,max:p,middleTick:!1})))}),null)),c.createElement(vt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(fe.M,null)," Adjustments"),et.map((function(e){return c.createElement($e,{key:"FabricFeature[".concat(e,"]"),feature:t[e],disabled:!1})}))))}var rt=n(625),it=n(614),ct=n(615),ot=n(616),st=n(617);function lt(e){var t=e.rootTenscript,n=e.setRootTenscript,a=e.fabric,r=e.runTenscript,i=e.storedState$,o=Object(c.useState)(a&&!a.tenscript.fromUrl?a.tenscript:t),s=Object(ue.a)(o,2),l=s[0],u=s[1],f=Object(c.useState)(""),d=Object(ue.a)(f,2),h=d[0],m=d[1],p=Object(c.useState)(!1),b=Object(ue.a)(p,2),v=b[0],g=b[1],E=Object(c.useState)(q(i.getValue())),w=Object(ue.a)(E,2),S=w[0],y=w[1],P=Object(c.useState)(!1),O=Object(ue.a)(P,2),k=O[0],F=O[1];function N(e){var t=function(e,t){var n=t.code,a=t.name,r=H({},e.recentCode);return r[a]=U(n,a),ee(e,{recentCode:r})}(i.getValue(),e);y(q(t)),i.next(t)}return c.createElement("div",{id:"tenscript-panel",style:{flexDirection:"column",position:"relative",backgroundColor:"rgba(0,0,0,1)",height:"100%"}},c.createElement(vt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(fe.L,null)," Tenscript"),c.createElement("div",{id:"code-and-run",style:{flexDirection:"column",height:"available"}},c.createElement(ut,{tenscript:l,setTenscript:u,error:h,setError:m}),c.createElement(me.a,{className:"w-100 my-2"},c.createElement(he.a,{color:h.length>0?"warning":"success",disabled:h.length>0,onClick:function(){return r(l)}},0===h.length?c.createElement("span",null,"Execute ",c.createElement(fe.H,null)," tenscript"):c.createElement("span",null,c.createElement(fe.i,null)," ",h))))),c.createElement(vt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(fe.h,null)," Storage"),0===S.length?void 0:c.createElement(rt.a,{className:"w-100 my-2",isOpen:v,toggle:function(){return g(!v)}},c.createElement(it.a,{style:{borderRadius:"1.078em"}},v?c.createElement(fe.J,null):c.createElement(fe.I,null)," Recent"),c.createElement(ct.a,null,S.map((function(e,t){return c.createElement(ot.a,{key:"Recent".concat(t),onClick:function(){return r(e)}},e.name)})))),c.createElement(me.a,{className:"w-100 my-2"},c.createElement(he.a,{disabled:l.code===t.code,onClick:function(){n(l),N(l)}},"Save ",c.createElement(fe.B,null)," for later")),c.createElement(rt.a,{className:"w-100 my-2",isOpen:k,toggle:function(){return F(!k)}},c.createElement(it.a,{color:"info",style:{borderRadius:"1.078em"}},"Explore ",c.createElement(fe.C,null)," existing designs"),c.createElement(ct.a,null,G.map((function(e,t){return c.createElement(ot.a,{key:"Boot".concat(t),onClick:function(){return r(e)}},e.name)}))))))}function ut(e){var t=e.tenscript,n=e.setTenscript,a=e.error,r=e.setError,i=Object(c.useState)(""),o=Object(ue.a)(i,2),s=o[0],l=o[1];function u(e){l(e),function(e){var t=Z(r,!1,e);t&&(r(""),n(t))}(e)}return Object(c.useEffect)((function(){return l(t.code)}),[]),c.createElement("div",{className:"my-2 p-2 w-100",style:{backgroundColor:"#757575",color:"#ffffff",borderStyle:"solid",borderRadius:"1em",borderColor:0===a.length?"black":"#f0ad4e",borderWidth:"2px"}},c.createElement("h6",{className:"w-100 text-center"},c.createElement("i",null,'"',t.name,'"')),c.createElement(st.a,{style:{borderRadius:"1em",height:"20em"},type:"textarea",id:"tenscript",value:s,onChange:function(e){return u(e.target.value)}}))}var ft=n(561),dt=n(562),ht=n.n(dt);function mt(e){var t=e.floatFeatures,n=e.fabric,a=e.visibleRoles,r=e.setVisibleRoles,i=e.storedState$,o=Object(c.useState)(i.getValue().ellipsoids),s=Object(ue.a)(o,2),l=s[0],u=s[1],f=Object(c.useState)(i.getValue().showPushes),h=Object(ue.a)(f,2),b=h[0],v=h[1],g=Object(c.useState)(i.getValue().showPulls),E=Object(ue.a)(g,2),w=E[0],S=E[1];Object(c.useEffect)((function(){var e=i.subscribe((function(e){u(e.ellipsoids),v(e.showPushes),S(e.showPulls)}));return function(){return e.unsubscribe()}}),[]);var P=Object(c.useState)(n.life),O=Object(ue.a)(P,2),k=O[0],F=O[1];function N(e){var t=e.pushes,n=e.pulls,a=e.children;return c.createElement(he.a,{style:{color:"white"},color:t===b&&n===w?"success":"secondary",onClick:function(){i.next(ee(i.getValue(),{showPulls:n,showPushes:t}))}},a)}return Object(c.useEffect)((function(){var e=n.life$.subscribe(F);return function(){return e.unsubscribe()}}),[n]),c.createElement("div",null,c.createElement(vt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(fe.t,null)," Coloring"),c.createElement(me.a,{className:"w-100 my-2"},c.createElement(N,{pushes:!0,pulls:!0},c.createElement("span",null,c.createElement(fe.w,null)," All")),c.createElement(N,{pushes:!1,pulls:!0},c.createElement("span",null,c.createElement(fe.R,null)," Pulls")),c.createElement(N,{pushes:!0,pulls:!1},c.createElement("span",null,c.createElement(fe.s,null)," Pushes")),c.createElement(N,{pushes:!1,pulls:!1},c.createElement("span",null,c.createElement(fe.m,null)," Roles")))),c.createElement(vt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(fe.j,null)," Snapshot"),c.createElement(me.a,{size:"sm"},p.map((function(e){return c.createElement(he.a,{color:a.indexOf(e)<0?"secondary":"success",key:"viz".concat(e),onClick:function(){a.indexOf(e)<0?r([].concat(Object(y.a)(a),[e])):r(a.filter((function(t){return t!==e})))},disabled:!l},m(e))}))),c.createElement($e,{key:"pushrad",feature:t[d.FabricFeature.PushRadius],disabled:!l}),c.createElement($e,{key:"pullrad",feature:t[d.FabricFeature.PullRadius],disabled:!l}),c.createElement($e,{key:"jointrad",feature:t[d.FabricFeature.JointRadius],disabled:!l})),c.createElement(vt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(fe.n,null)," Time"),c.createElement($e,{key:"it",feature:t[d.FabricFeature.IterationsPerFrame],disabled:l}),c.createElement($e,{key:"ic",feature:t[d.FabricFeature.IntervalCountdown],disabled:l}),c.createElement($e,{key:"pc",feature:t[d.FabricFeature.RealizingCountdown],disabled:l})),c.createElement(vt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(fe.v,null)," Perturb"),c.createElement(me.a,{className:"w-100"},c.createElement(he.a,{disabled:k.stage!==d.Stage.Realized,onClick:function(){return n.instance.fabric.set_altitude(1)}},c.createElement(fe.z,null)," Nudge"),c.createElement(he.a,{disabled:k.stage!==d.Stage.Realized,onClick:function(){return n.instance.fabric.set_altitude(10)}},c.createElement(fe.G,null)," Drop"),c.createElement(he.a,{disabled:l,onClick:function(){return n.instance.fabric.centralize()}},c.createElement(fe.p,null)," Centralize"))),c.createElement(vt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(fe.K,null)," Take"),c.createElement(me.a,{vertical:!0,className:"w-100"},c.createElement(he.a,{onClick:function(){return function(e){var t=e.output,n=new ht.a;n.file("joints.csv",function(e){var t=[];return t.push(["index","x","y","z"]),e.joints.forEach((function(e){return t.push([e.index,e.x,e.y,e.z])})),t.map((function(e){return e.join(";")})).join("\n")}(t)),n.file("intervals.csv",function(e){var t=[];return t.push(["joints","type","strain","stiffness","linear density","role","length"]),e.intervals.forEach((function(e){t.push(['"=""'.concat(e.joints,'"""'),e.type,e.strainString,e.stiffnessString,e.linearDensityString,e.role,e.length.toFixed(8)])})),t.map((function(e){return e.join(";")})).join("\n")}(t)),n.file("submerged.csv",function(e){var t=[];return t.push(["joints"]),t.push(['"=""'.concat(e.submergedJoints.map((function(e){return e.index+1})),'"""')]),t.map((function(e){return e.join(";")})).join("\n")}(e)),n.generateAsync({type:"blob",mimeType:"application/zip"}).then((function(e){var t=(new Date).toISOString().replace(/[.].*/,"").replace(/[:T_]/g,"-");ft.saveAs(e,"pretenst-".concat(t,".zip"))}))}(n)}},c.createElement(fe.q,null)," Download CSV ",c.createElement(fe.u,null)))))}var pt="25em";function bt(e){var t=e.floatFeatures,n=e.rootTenscript,a=e.setRootTenscript,r=e.shapeSelection,i=e.setShapeSelection,o=e.selectedFaces,s=e.clearSelectedFaces,l=e.selectedIntervals,u=e.fabric,f=e.setFabric,d=e.runTenscript,h=e.visibleRoles,m=e.setVisibleRoles,p=e.toFullScreen,b=e.storedState$,v=Object(c.useState)(u?u.life:void 0),g=Object(ue.a)(v,2),E=g[0],w=g[1];Object(c.useEffect)((function(){var e=u?u.life$.subscribe(w):void 0;return function(){e&&e.unsubscribe()}}),[u]);var S=Object(c.useState)(b.getValue().controlTab),y=Object(ue.a)(S,2),P=y[0],O=y[1];function k(e){var t=e.tab;return c.createElement(xe.a,null,c.createElement(Ce.a,{active:P===t,onClick:function(){return b.next(ee(b.getValue(),{controlTab:t}))}},t))}function F(e){var p=e.tab,v=c.createElement(Ve.a,{color:"warning"},"No fabric");return c.createElement(Re.a,{id:"tab-pane",style:{height:"100%"},tabId:p},c.createElement((function(){switch(p){case $.Grow:return c.createElement(lt,{rootTenscript:n,setRootTenscript:a,fabric:u,runTenscript:d,storedState$:b});case $.Shape:return u?c.createElement(We,{floatFeatures:t,fabric:u,setFabric:f,selectedIntervals:l,shapeSelection:r,setShapeSelection:i,selectedFaces:o,clearSelectedFaces:s,storedState$:b}):v;case $.Realize:return u?c.createElement(He,{floatFeatures:t,fabric:u,shapeSelection:r,storedState$:b}):v;case $.View:return u?c.createElement(mt,{floatFeatures:t,fabric:u,visibleRoles:h,setVisibleRoles:m,storedState$:b}):v;case $.Strain:return u?c.createElement(at,{floatFeatures:t,fabric:u,storedState$:b}):v}}),null))}return Object(c.useEffect)((function(){P!==$.Shape&&s()}),[P,E]),Object(c.useEffect)((function(){var e=b.subscribe((function(e){return O(e.controlTab)}));return function(){return e.unsubscribe()}}),[]),c.createElement("div",{className:"h-100"},c.createElement(Me.a,{tabs:!0,style:{backgroundColor:"#b2b2b2"}},Object.keys($).map((function(e){return c.createElement(k,{key:"T".concat(e),tab:$[e]})}))),c.createElement(Te.a,{style:{flex:1,flexFlow:"auto",height:"100%"},id:"tab-content",activeTab:P},Object.keys($).map((function(e){return c.createElement(F,{key:e,tab:$[e]})}))),c.createElement("div",{style:{position:"absolute",top:0,height:"100%",left:pt,zIndex:10,width:"1em"}},c.createElement((function(){return c.createElement(he.a,{style:{padding:0,margin:0,borderRadius:0,width:"1em"},className:"w-100 h-100",color:"dark",onClick:p},c.createElement(fe.c,null))}),null)))}function vt(e){var t=e.children,n=e.height;return c.createElement("div",{className:"m-3 p-2",style:{height:n,borderRadius:"1em",borderStyle:"solid",borderWidth:"0.1em",borderColor:"#45782e"}},t)}var gt=n(612),Et=n(610),wt=n(611),St={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},yt={type:"change"},Pt={type:"start"},Ot={type:"end"},kt=function(e){function t(e,n){var a;return Object(u.a)(this,t),(a=Object(gt.a)(this,Object(Et.a)(t).call(this))).object=void 0,a.element=void 0,a.window=void 0,a.enabled=void 0,a.target=void 0,a.enableZoom=void 0,a.zoomSpeed=void 0,a.minDistance=void 0,a.maxDistance=void 0,a.enableRotate=void 0,a.rotateSpeed=void 0,a.enablePan=void 0,a.keyPanSpeed=void 0,a.autoRotate=void 0,a.autoRotateSpeed=void 0,a.minZoom=void 0,a.maxZoom=void 0,a.minPolarAngle=void 0,a.maxPolarAngle=void 0,a.minAzimuthAngle=void 0,a.maxAzimuthAngle=void 0,a.keys=void 0,a.mouseButtons=void 0,a.enableDamping=void 0,a.dampingFactor=void 0,a.spherical=void 0,a.sphericalDelta=void 0,a.scale=void 0,a.target0=void 0,a.position0=void 0,a.zoom0=void 0,a.state=void 0,a.panOffset=void 0,a.zoomChanged=void 0,a.rotateStart=void 0,a.rotateEnd=void 0,a.rotateDelta=void 0,a.panStart=void 0,a.panEnd=void 0,a.panDelta=void 0,a.dollyStart=void 0,a.dollyEnd=void 0,a.dollyDelta=void 0,a.updateLastPosition=void 0,a.updateOffset=void 0,a.updateQuat=void 0,a.updateLastQuaternion=void 0,a.updateQuatInverse=void 0,a.panLeftV=void 0,a.panUpV=void 0,a.panInternalOffset=void 0,a.onMouseUp=void 0,a.onMouseDown=void 0,a.onMouseMove=void 0,a.onMouseWheel=void 0,a.onTouchStart=void 0,a.onTouchEnd=void 0,a.onTouchMove=void 0,a.object=e,a.element=n,a.window=window,a.enabled=!0,a.target=new P.Vector3,a.minDistance=0,a.maxDistance=1/0,a.minZoom=0,a.maxZoom=1/0,a.minPolarAngle=0,a.maxPolarAngle=Math.PI,a.minAzimuthAngle=-1/0,a.maxAzimuthAngle=1/0,a.enableDamping=!1,a.dampingFactor=.25,a.enableZoom=!0,a.zoomSpeed=1,a.enableRotate=!0,a.rotateSpeed=1,a.enablePan=!0,a.keyPanSpeed=7,a.autoRotate=!1,a.autoRotateSpeed=2,a.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},a.mouseButtons={ORBIT:P.MOUSE.LEFT,ZOOM:P.MOUSE.MIDDLE,PAN:P.MOUSE.RIGHT},a.target0=a.target.clone(),a.position0=a.object.position.clone(),a.zoom0=a.object.zoom,a.updateOffset=new P.Vector3,a.updateQuat=(new P.Quaternion).setFromUnitVectors(a.object.up,new P.Vector3(0,1,0)),a.updateQuatInverse=a.updateQuat.clone().inverse(),a.updateLastPosition=new P.Vector3,a.updateLastQuaternion=new P.Quaternion,a.state=St.NONE,a.scale=1,a.spherical=new P.Spherical,a.sphericalDelta=new P.Spherical,a.panOffset=new P.Vector3,a.zoomChanged=!1,a.rotateStart=new P.Vector2,a.rotateEnd=new P.Vector2,a.rotateDelta=new P.Vector2,a.panStart=new P.Vector2,a.panEnd=new P.Vector2,a.panDelta=new P.Vector2,a.dollyStart=new P.Vector2,a.dollyEnd=new P.Vector2,a.dollyDelta=new P.Vector2,a.panLeftV=new P.Vector3,a.panUpV=new P.Vector3,a.panInternalOffset=new P.Vector3,a.onMouseDown=function(e){if(e.preventDefault(),a.enabled){if(e.button===a.mouseButtons.ORBIT){if(!a.enableRotate)return;a.rotateStart.set(e.clientX,e.clientY),a.state=St.ROTATE}else if(e.button===a.mouseButtons.ZOOM){if(!a.enableZoom)return;a.dollyStart.set(e.clientX,e.clientY),a.state=St.DOLLY}else if(e.button===a.mouseButtons.PAN){if(!a.enablePan)return;a.panStart.set(e.clientX,e.clientY),a.state=St.PAN}a.state!==St.NONE&&(document.addEventListener("mousemove",a.onMouseMove,!1),document.addEventListener("mouseup",a.onMouseUp,!1),a.dispatchEvent(Pt))}},a.onMouseMove=function(e){if(e.preventDefault(),a.enabled)if(a.state===St.ROTATE){if(!a.enableRotate)return;a.rotateEnd.set(e.clientX,e.clientY),a.rotateDelta.subVectors(a.rotateEnd,a.rotateStart),a.rotateLeft(2*Math.PI*a.rotateDelta.x/a.element.clientWidth*a.rotateSpeed),a.rotateUp(2*Math.PI*a.rotateDelta.y/a.element.clientHeight*a.rotateSpeed),a.rotateStart.copy(a.rotateEnd),a.update()}else if(a.state===St.DOLLY){if(!a.enableZoom)return;a.dollyEnd.set(e.clientX,e.clientY),a.dollyDelta.subVectors(a.dollyEnd,a.dollyStart),a.dollyDelta.y>0?a.dollyIn(a.getZoomScale()):a.dollyDelta.y<0&&a.dollyOut(a.getZoomScale()),a.dollyStart.copy(a.dollyEnd),a.update()}else if(a.state===St.PAN){if(!a.enablePan)return;a.panEnd.set(e.clientX,e.clientY),a.panDelta.subVectors(a.panEnd,a.panStart),a.pan(a.panDelta.x,a.panDelta.y),a.panStart.copy(a.panEnd),a.update()}},a.onMouseUp=function(e){e.preventDefault(),a.enabled&&(document.removeEventListener("mousemove",a.onMouseMove,!1),document.removeEventListener("mouseup",a.onMouseUp,!1),a.dispatchEvent(Ot),a.state=St.NONE)},a.onMouseWheel=function(e){e.preventDefault(),a.enabled&&a.enableZoom&&(a.state===St.NONE||a.state===St.ROTATE)&&(e.stopPropagation(),e.deltaY<0?a.dollyOut(a.getZoomScale()):e.deltaY>0&&a.dollyIn(a.getZoomScale()),a.update(),a.dispatchEvent(Pt),a.dispatchEvent(Ot))},a.onTouchStart=function(e){if(e.preventDefault(),a.enabled){switch(e.touches.length){case 1:if(!a.enableRotate)return;a.rotateStart.set(e.touches[0].pageX,e.touches[0].pageY),a.state=St.TOUCH_ROTATE;break;case 2:if(!a.enableZoom)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);a.dollyStart.set(0,r),a.state=St.TOUCH_DOLLY;break;case 3:if(!a.enablePan)return;a.panStart.set(e.touches[0].pageX,e.touches[0].pageY),a.state=St.TOUCH_PAN;break;default:a.state=St.NONE}a.state!==St.NONE&&a.dispatchEvent(Pt)}},a.onTouchMove=function(e){if(e.preventDefault(),a.enabled)switch(e.touches.length){case 1:if(!a.enableRotate)return;if(a.state!==St.TOUCH_ROTATE)return;a.rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY),a.rotateDelta.subVectors(a.rotateEnd,a.rotateStart),a.rotateLeft(2*Math.PI*a.rotateDelta.x/a.element.clientWidth*a.rotateSpeed),a.rotateUp(2*Math.PI*a.rotateDelta.y/a.element.clientHeight*a.rotateSpeed),a.rotateStart.copy(a.rotateEnd),a.update();break;case 2:if(!a.enableZoom)return;if(a.state!==St.TOUCH_DOLLY)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);a.dollyEnd.set(0,r),a.dollyDelta.subVectors(a.dollyEnd,a.dollyStart),a.dollyDelta.y>0?a.dollyOut(a.getZoomScale()):a.dollyDelta.y<0&&a.dollyIn(a.getZoomScale()),a.dollyStart.copy(a.dollyEnd),a.update();break;case 3:if(!a.enablePan)return;if(a.state!==St.TOUCH_PAN)return;a.panEnd.set(e.touches[0].pageX,e.touches[0].pageY),a.panDelta.subVectors(a.panEnd,a.panStart),a.pan(a.panDelta.x,a.panDelta.y),a.panStart.copy(a.panEnd),a.update();break;default:a.state=St.NONE}},a.onTouchEnd=function(e){e.preventDefault(),a.enabled&&(a.dispatchEvent(Ot),a.state=St.NONE)},a.element.addEventListener("mousedown",a.onMouseDown,{capture:!0}),a.element.addEventListener("wheel",a.onMouseWheel,{capture:!0}),a.element.addEventListener("touchstart",a.onTouchStart,{capture:!0}),a.element.addEventListener("touchend",a.onTouchEnd,{capture:!0}),a.element.addEventListener("touchmove",a.onTouchMove,{capture:!0}),a.update(),a}return Object(wt.a)(t,e),Object(f.a)(t,[{key:"update",value:function(){var e=this.object.position;return this.updateOffset.copy(e).sub(this.target),this.updateOffset.applyQuaternion(this.updateQuat),this.spherical.setFromVector3(this.updateOffset),this.autoRotate&&this.state===St.NONE&&this.rotateLeft(this.getAutoRotationAngle()),this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi,this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),this.target.add(this.panOffset),this.updateOffset.setFromSpherical(this.spherical),this.updateOffset.applyQuaternion(this.updateQuatInverse),e.copy(this.target).add(this.updateOffset),this.object.lookAt(this.target),this.enableDamping?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor):this.sphericalDelta.set(0,0,0),this.scale=1,this.panOffset.set(0,0,0),!!(this.zoomChanged||this.updateLastPosition.distanceToSquared(this.object.position)>1e-6||8*(1-this.updateLastQuaternion.dot(this.object.quaternion))>1e-6)&&(this.dispatchEvent(yt),this.updateLastPosition.copy(this.object.position),this.updateLastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0)}},{key:"panLeft",value:function(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}},{key:"panUp",value:function(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}},{key:"pan",value:function(e,t){var n=this.element,a=this.object.position;this.panInternalOffset.copy(a).sub(this.target);var r=this.panInternalOffset.length();r*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*r/n.clientHeight,this.object.matrix),this.panUp(2*t*r/n.clientHeight,this.object.matrix)}},{key:"dollyIn",value:function(e){this.scale/=e}},{key:"dollyOut",value:function(e){this.scale*=e}},{key:"getAutoRotationAngle",value:function(){return 2*Math.PI/60/60*this.autoRotateSpeed}},{key:"getZoomScale",value:function(){return Math.pow(.95,this.zoomSpeed)}},{key:"rotateLeft",value:function(e){this.sphericalDelta.theta-=e}},{key:"rotateUp",value:function(e){this.sphericalDelta.phi-=e}},{key:"getPolarAngle",value:function(){return this.spherical.phi}},{key:"getAzimuthalAngle",value:function(){return this.spherical.theta}},{key:"dispose",value:function(){this.element.removeEventListener("mousedown",this.onMouseDown,!1),this.element.removeEventListener("wheel",this.onMouseWheel,!1),this.element.removeEventListener("touchstart",this.onTouchStart,!1),this.element.removeEventListener("touchend",this.onTouchEnd,!1),this.element.removeEventListener("touchmove",this.onTouchMove,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1)}},{key:"reset",value:function(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(yt),this.update(),this.state=St.NONE}}]),t}(P.EventDispatcher),Ft=[new P.Vector3(0,0,-20),new P.Vector3(-17.32,0,-10),new P.Vector3(-17.32,0,10),new P.Vector3(0,0,20),new P.Vector3(17.32,0,10),new P.Vector3(17.32,0,-10)],Nt=new P.Color("tan"),jt=6,xt=new P.Vector3(0,1,0),Ct=.03;function Vt(){var e=Object(c.useMemo)((function(){return function(){var e=new P.Geometry;return function(e,t){e.push.apply(e,Object(y.a)(Ft.map((function(e){return new P.Vector3(e.x,e.y,e.z)})))),e.push(new P.Vector3);for(var n=0;n<jt;n++){var a=(n+1)%jt,r=[xt,(new P.Vector3).add(xt).addScaledVector(Ft[n],Ct).normalize(),(new P.Vector3).add(xt).addScaledVector(Ft[a],Ct).normalize()];t.push(new P.Face3(jt,n,a,r,Nt))}}(e.vertices,e.faces),e.vertices.forEach((function(e){return e.sub(new P.Vector3(0,.01,0))})),e.computeBoundingSphere(),e}()}),[]);return c.createElement("mesh",{name:"Spots",geometry:e,material:_e})}Object(de.b)({Orbit:kt});var Rt=new P.SphereGeometry(1,32,8),Mt=new P.CylinderGeometry(1,1,1,12,1,!1),Tt=new P.CylinderGeometry(.5,.5,1,6,1,!1),It=new P.CylinderGeometry(1,1,.85,12,1,!1),At=new P.Color("#ffffff"),_t=100,Lt=1,Dt=new P.SphereGeometry(_t,25,25).scale(Lt,Lt,Lt),zt=.01,Bt=4,Yt=new P.Vector3(0,1,0);function Zt(e){var t=e.fabric,n=e.fabricError,a=e.selectedIntervals,r=e.selectedFaces,i=e.setSelectedFaces,o=e.storedState$,s=e.shapeSelection,l=e.ellipsoids,u=e.visibleRoles,f=document.getElementById("view-container"),h=Object(c.useState)(0),m=Object(ue.a)(h,2),p=m[0],b=m[1],v=Object(de.d)().camera,g=Object(c.useMemo)((function(){var e=(new P.TextureLoader).load("space.jpg");return new P.MeshPhongMaterial({map:e,side:P.BackSide})}),[]),E=Object(c.useState)(t.life),w=Object(ue.a)(E,2),S=w[0],O=w[1];Object(c.useEffect)((function(){var e=t.life$.subscribe(O);return function(){return e.unsubscribe()}}),[t]);var k=Object(c.useState)(o.getValue()),F=Object(ue.a)(k,2),N=F[0],j=F[1];Object(c.useEffect)((function(){var e=o.subscribe((function(e){return j(e)}));return function(){return e.unsubscribe()}}),[]),Object(c.useEffect)((function(){x.current.autoRotate=N.rotating}),[N]);var x=Object(de.e)((function(e){var t=new P.Vector3(0,Bt,0);v.position.set(t.x,Bt,t.z+4*Bt),v.lookAt(x.current.target),v.fov=60,v.far=2*_t,v.near=.001,e.object=v,e.minPolarAngle=-.98*Math.PI/2,e.maxPolarAngle=.8*Math.PI,e.maxDistance=_t*Lt*.9,e.zoomSpeed=.5,e.enableZoom=!0,e.target.set(t.x,t.y,t.z),e.update()}),[]);return Object(de.c)((function(){try{var e=t.instance,a=e.view,r=new P.Vector3(a.midpoint_x(),a.midpoint_y(),a.midpoint_z()),i=(new P.Vector3).subVectors(r,x.current.target).multiplyScalar(zt);if(x.current.target.add(i),x.current.update(),!l&&s!==Ne.Faces){var c=t.iterate();S.stage===d.Stage.Realizing&&c===d.Stage.Realized?setTimeout((function(){return t.toStage(d.Stage.Realized,{})})):c!==S.stage&&S.stage!==d.Stage.Realizing&&c!==d.Stage.Busy&&setTimeout((function(){return t.toStage(c,{})}))}b(e.fabric.age)}catch(o){n(o)}}),!0,[t,p,S,s,l]),c.createElement("group",null,c.createElement("orbit",{ref:x,args:[v,f]}),c.createElement("scene",null,l?c.createElement($t,{key:"ellipsoid",fabric:t,selectedIntervals:a,storedState:N,visibleRoles:u}):c.createElement(Gt,{key:"lines",fabric:t,selectedIntervals:a,storedState:N}),s!==Ne.Faces?void 0:c.createElement(Qt,{key:"faces",fabric:t,stage:S.stage,selectFace:function(e){r.some((function(t){return t.index===e.index}))?i(r.filter((function(t){return t.index!==e.index}))):i([].concat(Object(y.a)(r),[e]))}}),r.map((function(e){return c.createElement(Xt,{key:"Face".concat(e.index),fabric:t,face:e})})),c.createElement(Vt,null),c.createElement("mesh",{key:"space",geometry:Dt,material:g}),c.createElement("ambientLight",{color:At,intensity:.8}),c.createElement("directionalLight",{color:new P.Color("#FFFFFF"),intensity:2})))}function Xt(e){e.fabric;var t=e.face,n=R(t.brick.scale)/8;return c.createElement("mesh",{geometry:Rt,position:t.location(),material:Be,scale:new P.Vector3(n,n,n)})}function Ut(e){var t=e.fabric,n=e.interval,a=e.storedState,r=Ue(n.intervalRole);if((a.showPushes||a.showPulls)&&(r=function(e){var t=Math.floor(e*Ze.length);return Ze[t>=Ze.length?Ze.length-1:t]}(t.instance.floatView.strainNuances[n.index]),(!a.showPushes||!a.showPulls)&&(a.showPushes&&!n.isPush||a.showPulls&&n.isPush)))return c.createElement("group",null);var i=t.instance.floatView.linearDensities[n.index],o=a.featureValues[n.isPush?d.FabricFeature.PushRadius:d.FabricFeature.PullRadius].numeric*i,s=t.instance.unitVector(n.index),l=(new P.Quaternion).setFromUnitVectors(Yt,s),u=n.alpha.location().distanceTo(n.omega.location()),f=o*a.featureValues[d.FabricFeature.JointRadius].numeric,h=new P.Vector3(o,u+(n.isPush?2*-f:0),o),m=new P.Vector3(f,f,f);return c.createElement(c.Fragment,null,n.isPush?c.createElement(c.Fragment,null,c.createElement("mesh",{geometry:Tt,position:n.location(),rotation:(new P.Euler).setFromQuaternion(l),scale:h,material:r,matrixWorldNeedsUpdate:!0}),c.createElement("mesh",{geometry:It,position:n.location(),rotation:(new P.Euler).setFromQuaternion(l),scale:h,material:r,matrixWorldNeedsUpdate:!0}),c.createElement("mesh",{geometry:Rt,position:n.alpha.location(),material:Ye,scale:m,matrixWorldNeedsUpdate:!0}),c.createElement("mesh",{geometry:Rt,position:n.omega.location(),material:Ye,scale:m,matrixWorldNeedsUpdate:!0})):c.createElement("mesh",{geometry:Mt,position:n.location(),rotation:(new P.Euler).setFromQuaternion(l),scale:h,material:r,matrixWorldNeedsUpdate:!0}))}function $t(e){var t=e.fabric,n=e.visibleRoles,a=e.selectedIntervals,r=e.storedState;return c.createElement("group",null,a.length>0?a.map((function(e){return c.createElement(Ut,{key:"SI".concat(e.index),fabric:t,interval:e,storedState:r})})):t.intervals.map((function(e){return n.indexOf(e.intervalRole)<0?void 0:c.createElement(Ut,{key:"I".concat(e.index),fabric:t,interval:e,storedState:r})})),"}")}function Gt(e){var t=e.fabric,n=e.selectedIntervals,a=e.storedState;return c.createElement("group",null,c.createElement("lineSegments",{key:"lines",geometry:t.linesGeometry,material:Le}),n.map((function(e){return c.createElement(Ut,{key:"SI".concat(e.index),fabric:t,interval:e,storedState:a})})))}function Qt(e){var t=e.fabric,n=e.stage,a=e.selectFace,r=Object(de.d)().raycaster,i=Object(c.useRef)(),o=Object(c.useState)(),s=Object(ue.a)(o,2),l=s[0],u=s[1];return c.createElement("mesh",{key:"faces",ref:i,onPointerDown:function(e){return u(e)},onPointerUp:function(e){var c=i.current;if(!function(e){return e===d.Stage.Growing||e===d.Stage.Slack}(n)&&l&&c){var o=l.clientX-e.clientX,s=l.clientY-e.clientY;if(!(o*o+s*s>100)){var f=r.intersectObjects([c],!0).map((function(e){return e.faceIndex})).map((function(e){if(void 0!==e)return t.faces[e]})).reverse().pop();u(void 0),f&&a(f)}}},geometry:t.facesGeometry,material:ze})}var Wt="25em",Ht="26em";function Jt(e){var t=function(){var e=location.hash.substring(1);try{return Z((function(e){return console.error(e)}),!0,decodeURIComponent(e))}catch(t){console.error("Code error",t)}}();if(t)return t;var n=q(e);return n.length>0?n[0]:G[0]}function qt(e){var t=e.eig,n=e.floatFeatures,a=e.storedState$,r=Object(c.useMemo)((function(){return new ge(t,100)}),[]),i=Object(c.useState)(),o=Object(ue.a)(i,2),s=o[0],l=o[1],u=Object(c.useState)([]),f=Object(ue.a)(u,2),h=f[0],m=f[1],b=Object(c.useState)([]),g=Object(ue.a)(b,2),E=g[0],w=g[1];Object(c.useEffect)((function(){return m(E.reduce((function(e,t){var n=function(t){return!e.some((function(e){return t.index===e.index}))},a=t.pulls.filter(n),r=t.pushes.filter(n);return[].concat(Object(y.a)(e),Object(y.a)(r),Object(y.a)(a))}),[]))}),[E]);var S=Object(c.useState)((function(){return Jt(a.getValue())})),P=Object(ue.a)(S,2),O=P[0],k=P[1];Object(c.useEffect)((function(){0===location.hash.length&&(location.hash=U(O.code,O.name))}),[O]);var F=Object(c.useState)(p),N=Object(ue.a)(F,2),j=N[0],x=N[1],C=Object(c.useState)(a.getValue().rotating),V=Object(ue.a)(C,2),M=V[0],T=V[1],I=Object(c.useState)(Ne.None),A=Object(ue.a)(I,2),_=A[0],L=A[1],D=Object(c.useState)(a.getValue().fullScreen),z=Object(ue.a)(D,2),B=z[0],Y=z[1],Z=Object(c.useState)(a.getValue().ellipsoids),X=Object(ue.a)(Z,2),$=X[0],G=X[1];function Q(e){if(r){location.hash=U(e.code,e.name),n[d.FabricFeature.ShapingPretenstFactor].percent=100,n[d.FabricFeature.ShapingDrag].percent=100,n[d.FabricFeature.ShapingStiffnessFactor].percent=100,a.next(ee(a.getValue(),{ellipsoids:!1}));l(new je((function(e){return function(e,t){if(t===d.IntervalRole.FacePull)throw new Error;return e[K(t)].numeric}(n,e)}),(function(e){return a.getValue().featureValues[e].numeric}),r,e))}}function W(e){a.next(ee(a.getValue(),{fullScreen:e}))}return Object(c.useEffect)((function(){return x(p)}),[$]),Object(c.useEffect)((function(){var e=a.subscribe((function(e){Y(e.fullScreen),G(e.ellipsoids),T(e.rotating),s&&(r.world.set_coloring(e.showPushes,e.showPulls),r.world.set_surface_character(e.surfaceCharacter))}));return function(){return e.unsubscribe()}}),[s]),Object(c.useEffect)((function(){var e=Object.keys(n).map((function(e){return n[e]})).map((function(e){return e.observable.subscribe((function(t){if(s){s.instance.applyFeature(e);var n=v(e.config.feature);void 0!==n&&s.intervals.filter((function(e){return e.intervalRole===n})).forEach((function(t){var n=e.numeric*R(t.scale);s.instance.fabric.change_rest_length(t.index,n,500)}))}}))}));return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[s]),Object(c.useEffect)((function(){var e=setTimeout((function(){s||Q(O)}),200);return function(){return clearTimeout(e)}}),[O]),c.createElement(c.Fragment,null,B?c.createElement(he.a,{id:"to-full-screen",color:"dark",onClick:function(){return W(!1)}},c.createElement(fe.d,null),c.createElement("br",null),c.createElement(fe.P,null),c.createElement("br",null),c.createElement(fe.d,null)):c.createElement("div",{id:"left-side",style:{visibility:B?"collapse":"visible",width:Wt}},c.createElement(bt,{floatFeatures:n,rootTenscript:O,setRootTenscript:k,fabric:s,setFabric:l,selectedIntervals:h,shapeSelection:_,setShapeSelection:L,selectedFaces:E,clearSelectedFaces:function(){return w([])},runTenscript:Q,toFullScreen:function(){return W(!0)},visibleRoles:j,setVisibleRoles:x,storedState$:a})),c.createElement("div",{style:{position:"absolute",left:B?0:Ht,right:0,height:"100%"}},s?c.createElement("div",{className:"h-100"},c.createElement(Kt,{fabric:s}),c.createElement("div",{id:"bottom-middle"},c.createElement(me.a,null,c.createElement(he.a,{color:$?"warning":"secondary",onClick:function(){return a.next(ee(a.getValue(),{ellipsoids:!$}))}},c.createElement(fe.j,null)),c.createElement(he.a,{color:_===Ne.Faces?"warning":"secondary",disabled:$&&_===Ne.None,onClick:function(){return L(_!==Ne.Faces?Ne.Faces:Ne.None)}},c.createElement("span",null,c.createElement(fe.y,null))),c.createElement(he.a,{color:M?"warning":"secondary",onClick:function(){return a.next(ee(a.getValue(),{rotating:!M}))}},c.createElement(fe.N,null)))),c.createElement("div",{id:"view-container",className:"h-100"},c.createElement(de.a,{style:{backgroundColor:"black",borderStyle:"solid",borderColor:_===Ne.Faces||$?"#f0ad4e":"black",cursor:_===Ne.Faces?"pointer":"all-scroll",borderWidth:"2px"}},c.createElement(Zt,{fabric:s,fabricError:function(e){console.error(e);var t=s.tenscript;l(void 0),setTimeout((function(){return Q(t)}),1e3)},selectedIntervals:h,selectedFaces:E,setSelectedFaces:w,shapeSelection:_,ellipsoids:$,visibleRoles:j,storedState$:a})))):c.createElement("div",{id:"tensegrity-view",className:"h-100"},c.createElement("div",{style:{position:"relative",top:"50%",left:"50%"}},c.createElement(he.a,{onClick:function(){return Q(O)}},c.createElement("h6",null,O.name),c.createElement("h1",null,c.createElement(fe.H,null)))))))}function Kt(e){var t=e.fabric,n=Object(c.useState)(t.life),a=Object(ue.a)(n,2),r=a[0],i=a[1];return Object(c.useEffect)((function(){var e=t.life$.subscribe(i);return function(){return e.unsubscribe()}}),[t]),c.createElement("div",{id:"top-middle"},c.createElement("span",null,d.Stage[r.stage])," ",c.createElement("i",null,'"',t.tenscript.name,'"'))}function en(e){return tn.apply(this,arguments)}function tn(){return(tn=Object(i.a)(r.a.mark((function e(t){var n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=document.getElementById("root"),(a=new s.BehaviorSubject(ne(re,t.default_fabric_feature))).subscribe((function(e){return t=e,void localStorage.setItem(te,JSON.stringify(t));var t})),o.render(c.createElement(qt,{eig:t,floatFeatures:ce(a,t.default_fabric_feature),storedState$:a}),n),se();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n.d(t,"startReact",(function(){return en}))}}]);
//# sourceMappingURL=4.5e25d9e5.chunk.js.map