(window.webpackJsonppretenst=window.webpackJsonppretenst||[]).push([[4],{567:function(e,t){},569:function(e,t){},8:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(1),c=n(10),o=n(80),s=n(81),l=n(74),u=n(32),f=n(33),d=n(7);var h=Object.keys(d.FabricFeature).filter((function(e){return isNaN(parseInt(e,10))})).map((function(e){return d.FabricFeature[e]}));function m(e){switch(e){case d.IntervalRole.NexusPush:return"NP";case d.IntervalRole.ColumnPush:return"CP";case d.IntervalRole.Triangle:return"TR";case d.IntervalRole.Ring:return"RI";case d.IntervalRole.NexusCross:return"NC";case d.IntervalRole.ColumnCross:return"CC";case d.IntervalRole.BowMid:return"BM";case d.IntervalRole.BowEnd:return"BE";case d.IntervalRole.FacePull:return"FP";default:return"?"}}var p=Object.keys(d.IntervalRole).filter((function(e){return d.IntervalRole[e]!==d.IntervalRole.FacePull})).map((function(e){return d.IntervalRole[e]}));function g(e){return e===d.IntervalRole.ColumnPush||e===d.IntervalRole.NexusPush}function v(e){switch(e){case d.FabricFeature.NexusPushLength:return d.IntervalRole.NexusPush;case d.FabricFeature.ColumnPushLength:return d.IntervalRole.ColumnPush;case d.FabricFeature.TriangleLength:return d.IntervalRole.Triangle;case d.FabricFeature.RingLength:return d.IntervalRole.Ring;case d.FabricFeature.NexusCrossLength:return d.IntervalRole.NexusCross;case d.FabricFeature.ColumnCrossLength:return d.IntervalRole.ColumnCross;case d.FabricFeature.BowMidLength:return d.IntervalRole.BowMid;case d.FabricFeature.BowEndLength:return d.IntervalRole.BowEnd;default:return}}var b,E,y,w=n(39),S=n(544),P=n(27),O=1.61803398875,F=Math.sqrt(2);!function(e){e[e.XP=0]="XP",e[e.XN=1]="XN",e[e.YP=2]="YP",e[e.YN=3]="YN",e[e.ZP=4]="ZP",e[e.ZN=5]="ZN"}(b||(b={})),function(e){e[e.XPA=0]="XPA",e[e.XPO=1]="XPO",e[e.XNA=2]="XNA",e[e.XNO=3]="XNO",e[e.YPA=4]="YPA",e[e.YPO=5]="YPO",e[e.YNA=6]="YNA",e[e.YNO=7]="YNO",e[e.ZPA=8]="ZPA",e[e.ZPO=9]="ZPO",e[e.ZNA=10]="ZNA",e[e.ZNO=11]="ZNO"}(E||(E={})),function(e){e[e.NNN=0]="NNN",e[e.PNN=1]="PNN",e[e.NPN=2]="NPN",e[e.NNP=3]="NNP",e[e.NPP=4]="NPP",e[e.PNP=5]="PNP",e[e.PPN=6]="PPN",e[e.PPP=7]="PPP"}(y||(y={}));var N,k=[y.NNN,y.PNN,y.NPN,y.NNP,y.NPP,y.PNP,y.PPN,y.PPP],j="aBCDbcdA";function x(e,t){if(e.alpha.index===t.index)return e.omega;if(e.omega.index===t.index)return e.alpha;throw new Error("Other of what?")}function C(e,t){var n=t.filter((function(t){return t.alpha.index===e.index||t.omega.index===e.index})),r=n.find((function(e){return e.isPush}));if(!r)throw new Error("No push on joint");var a=function(t){return(new P.Vector3).subVectors(x(t,e).location(),e.location()).normalize()},i=a(r);n.sort((function(e,t){var n=a(e).dot(i),r=a(t).dot(i);return n<r?1:n>r?-1:0})),n.shift();var c=a(n[0]),o=(new P.Vector3).addScaledVector(i,c.dot(i)),s=(new P.Vector3).subVectors(c,o).normalize(),l=(new P.Quaternion).setFromUnitVectors(i,s),u=(new P.Vector3).crossVectors(i,s);return n.map((function(t){var n=a(t),r=(new P.Vector3).addScaledVector(i,n.dot(i)),c=(new P.Vector3).subVectors(n,r).normalize(),o=(new P.Vector3).crossVectors(i,n),s=(new P.Quaternion).setFromUnitVectors(i,c),f=180*Math.acos(i.dot(n))/Math.PI,d=l.angleTo(s)*(u.dot(o)>0?180:-180)/Math.PI;return{interval:t.index,role:m(t.intervalRole),joint:x(t,e).index,separation:f,rotation:d}}))}function V(e){return(new P.Matrix4).getInverse(function(e){var t=e.joints.map((function(e){return e.location()})),n=t.reduce((function(e,t){return e.add(t)}),new P.Vector3).multiplyScalar(1/3),r=(new P.Vector3).subVectors(t[1],n).normalize(),a=(new P.Vector3).subVectors(t[0],n).normalize(),i=(new P.Vector3).crossVectors(a,r).normalize();return a.crossVectors(r,i).normalize(),(new P.Matrix4).makeBasis(r,i,a).setPosition(n)}(e))}function R(e){var t=new P.Vector3;switch(e){case b.XP:return t.setX(1);case b.XN:return t.setX(-1);case b.YP:return t.setY(1);case b.YN:return t.setY(-1);case b.ZP:return t.setZ(1);case b.ZN:return t.setZ(-1);default:return t}}function T(e,t){return R(e).multiplyScalar(F/2).addScaledVector(R(t),F/2/O)}!function(e){e[e.NN=0]="NN",e[e.PN=1]="PN",e[e.NP=2]="NP",e[e.PP=3]="PP"}(N||(N={}));var M=[{alpha:T(b.ZN,b.XP),omega:T(b.ZP,b.XP)},{alpha:T(b.ZN,b.XN),omega:T(b.ZP,b.XN)},{alpha:T(b.XN,b.YP),omega:T(b.XP,b.YP)},{alpha:T(b.XN,b.YN),omega:T(b.XP,b.YN)},{alpha:T(b.YN,b.ZP),omega:T(b.YP,b.ZP)},{alpha:T(b.YN,b.ZN),omega:T(b.YP,b.ZN)}],I=[{name:y.NNN,opposite:y.PPP,negative:!0,ring:N.NN,pushEnds:[E.YNA,E.XNA,E.ZNA],ringMember:[N.NP,N.PN,N.PP]},{name:y.PNN,opposite:y.NPP,negative:!1,ring:N.PP,pushEnds:[E.XNA,E.YPA,E.ZNO],ringMember:[N.PN,N.NN,N.NP]},{name:y.NPN,opposite:y.PNP,negative:!1,ring:N.PN,pushEnds:[E.XNO,E.YNA,E.ZPA],ringMember:[N.PP,N.NP,N.NN]},{name:y.NNP,opposite:y.PPN,negative:!1,ring:N.NP,pushEnds:[E.XPA,E.YNO,E.ZNA],ringMember:[N.NN,N.PN,N.PP]},{name:y.NPP,opposite:y.PNN,negative:!0,ring:N.PP,pushEnds:[E.YNO,E.XPO,E.ZPA],ringMember:[N.PN,N.NP,N.NN]},{name:y.PNP,opposite:y.NPN,negative:!0,ring:N.PN,pushEnds:[E.YPO,E.XPA,E.ZNO],ringMember:[N.PP,N.NN,N.NP]},{name:y.PPN,opposite:y.NNP,negative:!0,ring:N.NP,pushEnds:[E.YPA,E.XNO,E.ZPO],ringMember:[N.NN,N.PP,N.PN]},{name:y.PPP,opposite:y.NNN,negative:!1,ring:N.NN,pushEnds:[E.XPO,E.YPO,E.ZPO],ringMember:[N.NP,N.PP,N.PN]}];function A(e){return I[e].opposite}function _(e){return e||{_:100}}function L(e){return e._/100}function D(e){return{_:100*e}}function z(e,t,n){var r=!!t.joints.find((function(t){return t.index===e.index})),a=!!n.joints.find((function(t){return t.index===e.index}));if(r&&!a)return t;if(a&&!r)return n;throw new Error("Neither contained joint")}function B(e,t,n){var r=M.reduce((function(e,t){return e.push((new P.Vector3).add(t.alpha)),e.push((new P.Vector3).add(t.omega)),e}),[]),a=A(e),i=I[a].pushEnds.map((function(e){return r[e]})).reverse(),c=i.reduce((function(e,t){return e.add(t)}),new P.Vector3).multiplyScalar(1/3),o=(new P.Vector3).subVectors(i[0],c).normalize(),s=(new P.Vector3).sub(c).normalize(),l=(new P.Vector3).crossVectors(s,o).normalize(),u=(new P.Matrix4).makeBasis(o,s,l),f=L(t),d=(new P.Matrix4).getInverse(u).setPosition(n).scale(new P.Vector3(f,f,f));return r.map((function(e){return e.applyMatrix4(d)}))}function Y(e){return.6*e}var Z=function(){function e(t){Object(u.a)(this,e),this.tensegrity=t}return Object(f.a)(e,[{key:"createBrickAt",value:function(e,t){var n=B(y.PPP,t,e);return this.createBrick(n,y.NNN,t)}},{key:"createConnectedBrick",value:function(e,t,n){var r=e.faces[t],a=L(e.scale),i=a*L(n),c=this.createBrickOnFace(r,D(i)),o=c.faces[c.base],s=this.tensegrity.numericFeature(d.FabricFeature.IntervalCountdown);return this.connectFaces(r,o,D((a+i)/2),s),c}},{key:"checkFacePulls",value:function(e,t){var n=this;if(0===e.length)return e;return e.filter((function(e){var r=e.alpha,a=e.omega,i=e.scaleFactor;return!(r.location().distanceTo(a.location())<=10*Y(i))||(function(e){var t=e.alpha,r=e.omega,a=e.scaleFactor,i=n.tensegrity.numericFeature(d.FabricFeature.IntervalCountdown);n.connectFaces(t,r,D(a),i)}(e),t(e),!1)}))}},{key:"uprightAtOrigin",value:function(e){this.tensegrity.instance.apply(V(e))}},{key:"createFacePulls",value:function(e){var t=this,n=function(){var n,r=t.createBrickAt((n=e.map((function(e){return e.location()}))).reduce((function(e,t){return e.add(t)}),new P.Vector3).multiplyScalar(1/n.length),D(function(e){return e.reduce((function(e,t){return e+L(t.brick.scale)}),0)/e.length}(e)));return e.map((function(e){var n=r.faces.filter((function(t){var n=t.negative;return!t.removed&&n!==e.negative})).reduce((function(t,n){return t.location().distanceTo(e.location())<n.location().distanceTo(e.location())?t:n}));return n.removed=!0,t.tensegrity.createFacePull(n,e)}))};switch(e.length){case 2:return e[0].negative===e[1].negative?n():[this.tensegrity.createFacePull(e[0],e[1])];case 3:return n();default:return[]}}},{key:"createBrickOnFace",value:function(e,t){var n=I[e.triangle].negative,r=e.brick,a=e.triangle;this.tensegrity.instance.refreshFloatView();var i=r.faces[a].joints.map((function(e){return e.location()})),c=i.reduce((function(e,t){return e.add(t)}),new P.Vector3).multiplyScalar(1/3),o=(new P.Vector3).addVectors(i[0],i[1]).multiplyScalar(.5),s=(new P.Vector3).subVectors(o,c).normalize(),l=(new P.Vector3).subVectors(i[1],c).normalize(),u=(new P.Vector3).add(s).multiplyScalar(s.dot(l)),f=l.sub(u).normalize(),d=(new P.Vector3).crossVectors(f,s).normalize(),h=(new P.Matrix4).makeBasis(s,d,f).setPosition(c),m=B(n?y.NNN:y.PPP,t,new P.Vector3(0,0,0)).map((function(e){return e.applyMatrix4(h)})),p=n?y.PPP:y.NNN;return this.createBrick(m,p,t)}},{key:"createBrick",value:function(e,t,n){var r,a=this,i=this.tensegrity.numericFeature(d.FabricFeature.IntervalCountdown),c=function(e,t,n){return{index:e,base:t,scale:n,joints:[],pushes:[],pulls:[],crosses:[],rings:[[],[],[],[]],faces:[],negativeAdjacent:0,postiveeAdjacent:0}}(this.tensegrity.bricks.length,t,n);this.tensegrity.bricks.push(c);var o=e.map((function(e,t){return a.tensegrity.createLeftJoint(e)}));this.tensegrity.instance.refreshFloatView(),M.forEach((function(e,t){Object(S.a)(e);var r=o[2*t],s=o[2*t+1],l={index:r,oppositeIndex:s,location:function(){return a.tensegrity.instance.jointLocation(r)}},u={index:s,oppositeIndex:r,location:function(){return a.tensegrity.instance.jointLocation(s)}};c.pushes.push(a.tensegrity.createInterval(l,u,d.IntervalRole.NexusPush,n,i))})),c.pushes.forEach((function(e){return c.joints.push(e.alpha,e.omega)}));var s=c.pushes.reduce((function(e,t){return e.push(t.alpha,t.omega),e}),[]);return(r=this.tensegrity.joints).push.apply(r,Object(w.a)(s)),I.forEach((function(e){for(var t=e.pushEnds.map((function(e){return s[e]})),r=0;r<3;r++){var o=t[r],l=t[(r+1)%3],u=a.tensegrity.createInterval(o,l,d.IntervalRole.Triangle,n,i);c.pulls.push(u),c.rings[e.ringMember[r]].push(u)}})),I.forEach((function(e){var t=a.tensegrity.createFace(c,e.name);c.faces.push(t)})),this.tensegrity.instance.refreshFloatView(),c}},{key:"facesToRing",value:function(e,t){if(e.negative===t.negative)throw new Error("Polarity not opposite");var n=(new P.Vector3).subVectors(e.joints[0].location(),e.location()).normalize(),r=t.joints.map((function(e,r){return[(new P.Vector3).subVectors(e.location(),t.location()).normalize().dot(n),r]})).sort((function(e,t){return t[0]-e[0]})).pop();if(!r)throw new Error("No opposite joint");var a=[[1,0,2],[2,1,0],[0,2,1]][r[1]];return[e.joints[0],t.joints[a[0]],e.joints[1],t.joints[a[1]],e.joints[2],t.joints[a[2]]]}},{key:"connectFaces",value:function(e,t,n,r){var a=this;if(e.negative===t.negative)throw new Error("Same polarity!");[e,t].forEach((function(e){a.tensegrity.removeFace(e,!0),e.negative?e.brick.postiveeAdjacent++:e.brick.negativeAdjacent++}));for(var i=this.facesToRing(e,t),c=function(e,t,i){return a.tensegrity.createInterval(e,t,i,n,r)},o=0;o<i.length;o++){var s=i[(o+5)%6],l=i[o],u=i[(o+1)%6];c(l,u,d.IntervalRole.Ring);var f=function(n,r){var i=a.tensegrity.joints[r.oppositeIndex];z(i,e.brick,t.brick).crosses.push(c(n,i,d.IntervalRole.ColumnCross))};e.negative?f(s,l):f(u,l)}[e,t].forEach((function(e){var t=e.triangle,n=e.brick,i=function(e,t){return e.filter((function(e){return!e.removed&&e.intervalRole!==t})).forEach((function(e){return a.tensegrity.changeIntervalRole(e,t,n.scale,r)}))};!function(e){return e.negativeAdjacent>1||e.postiveeAdjacent>1}(n)?(i(n.rings[I[t].ring],d.IntervalRole.Ring),i(n.crosses,d.IntervalRole.ColumnCross),i(n.pushes,d.IntervalRole.ColumnPush)):(i(n.pulls,d.IntervalRole.Triangle),i(n.crosses,d.IntervalRole.NexusCross),i(n.pushes,d.IntervalRole.NexusPush))}))}}]),e}();function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $(e){return JSON.stringify(e).replace(/[_.:"]/g,"").replace(/[{]/g,"(").replace(/[}]/g,")").replace(/([ABCDabcdSM])\((\d*)\)/g,(function(e){return"".concat(arguments.length<=1?void 0:arguments[1]).concat(arguments.length<=2?void 0:arguments[2])}))}function G(e){return j.indexOf(e)>=0}function W(e,t){return t["M".concat(j[e])]}function Q(e){return"0123456789".indexOf(e)>=0}function H(e){if(!e.match(/^\d+$/))throw new Error("Not a number: ".concat(e));return parseInt(e,10)}function J(e,t){var n=e.indexOf(","),r=n>=0;if("("!==e.charAt(0))return r?{content:e.substring(0,n),skip:n}:{content:e,skip:e.length};var a=function(e){if("("!==e.charAt(0))throw new Error('Code must start with "(": '.concat(e," ").concat(e.charAt(0)));for(var t=0,n=0;n<e.length;n++){var r=e.charAt(n);if("("===r)t++;else if(")"===r&&0===--t)return n}throw new Error("No matching end bracket: |".concat(e,"|"))}(e);return{content:t?e.substring(1,a):e.substring(0,a+1),skip:a+1}}function q(e,t,n){function r(e){var t=J(e,!0).content,n={};function a(e){var n=J(t.substring(e),!1),a=n.content,i=n.skip;return{codeTree:r(a),skip:i}}for(var i=0;i<t.length;i++){var c=t.charAt(i);if(G(c)){var o=a(i+1);if(!o.codeTree)throw new Error("No subtree: ".concat(t.substring(i)));n[c]=o.codeTree,i+=o.skip}else if(Q(c)){var s=J(t,!1);n._=H(s.content),i+=s.skip}else switch(c){case"S":var l=J(t.substring(i+1),!0);n.S={_:H(l.content)},i+=l.skip;break;case"M":var u=t.charAt(i+1),f=J(t.substring(i+2),!0);n["M".concat(u)]={_:H(f.content)},i+=f.skip+1;break;case",":case" ":break;default:throw new Error("Unexpected character: ".concat(c))}}return 0===Object.keys(n).length?void 0:n}try{if(!n||0===n.length)return void e("No code to parse");var a=function(e){var t=e.replace(/[\n\r\t]/g,"").split(":"),n=t.find((function(e){return e.startsWith("'")&&e.endsWith("'")})),r=t.find((function(e){return e.startsWith("(")&&e.endsWith(")")})),a={};return t.filter((function(e){return e.match(/^\d+=.*$/)})).forEach((function(e){var t=e.indexOf("="),n=Number(e.substring(0,t));a[n]=e.substring(t+1)})),{name:n?n.replace(/'/g,""):(new Date).toDateString(),mainCode:r||"(0)",markCode:a}}(n),i=a.name,c=a.mainCode,o=a.markCode,s=r(c);if(!s)return;var l={};return Object.keys(o).forEach((function(e){return l[e]=r(o[e])})),function(e,t,n,r){var a=$(t),i=Object.keys(n).map((function(e){return"".concat(e,"=").concat($(n[e]))})).join(":"),c=i.length>0?":".concat(i):"";return{name:e,tree:t,markTrees:n,code:"'".concat(e,"':").concat(a).concat(c),fromUrl:r}}(i,s,l,t)}catch(u){return void e(u.message)}}function K(e){throw new Error("Unable to parse: ".concat(e))}var ee,te=["(0):'Zen'","(1):'One'","(6):'Six'","(16,S90):'Axoneme'","(b1,a1):'Knee'","(b3,a3):'Leg'","(a1,b1,c1,d1):'Nexus'","(A2,B(3,b(2,S90),S80),C(3,c(2,S90),S80),D(3,d(2,S90),S80)):'Tripod with Knees'","(A(8, S85, MA1), a(8, S85, MA1)):'Bulge Ring'","(a1,b(3,S85,MA1),c(3,S85,MA1),d(3,S85,MA1)):'Convergence Three'","(a1,b(10,S85,MA1),c(10,S85,MA1),d(10,S85,MA1)):'Convergence Ten'","(B(7,S80,MA1),C(2,S120,MA0),D(7,S80,MA1)):'Halo by Crane'","(B(5,S75),C(5,S75),D(5,S75)):'Pretenst Lander'","(a(1,MA0),c(3,b(3,d(3,c(3,b(3,d(1,MA0))))))):'Zig Zag Loop'","(B2, C2, D2, A(2, b2, c2, d2)):'Crystal Interstitial'","(a(2,b(2,c(2,d(1,MA11)),d(2,c(1,MA10))),c(2,d(2,b(1,MA13)),b(2,d(1,MA12))),d(2,b(2,c(1,MA15)),c(2,b(1,MA14)))),b(2,d(2,Mc13),c(2,Md14)),c(2,b(2,Md15),d(2,Mb10)),d(2,c(2,Mb11),b(2,Mc12))):' Diamond'","(a(3,b(3,c(3,d(2,MA11)),d(3,c(2,MA10))),c(3,d(3,b(2,MA13)),b(3,d(2,MA12))),d(3,b(3,c(2,MA15)),c(3,b(2,MA14)))),b(3,d(3,Mc13),c(3,Md14)),c(3,b(3,Md15),d(3,Mb10)),d(3,c(3,Mb11),b(3,Mc12))):'Diamond2'","(3,b(2,MA0),c(2,MA0),d(2,MA0)):0=(b2,c2,d2):'Composed'","'Galapagotchi1':(A(3,S90),b(3,S90),a(2,S90),B(2,S90))"].map((function(e){return q(K,!1,e)}));function ne(e,t){var n=[];return e.forEach((function(e){var r=e.brick,a=e.tree,i=e.tensegrity;function c(e,t,n,r){var a,c,o=e.base===y.PPP?A(n):n,s=new Z(i).createConnectedBrick(e,o,r);return 0===t._&&(a=s,c=t,k.forEach((function(e){var t=W(e,c);if(t){var n=a.base===y.NNN?a.faces[e]:a.faces[A(e)];if(n.removed)throw new Error("!! trying to use a face that was removed");n.mark=t}}))),{tree:t,brick:s,tensegrity:i}}var o=a._;if(o){var s=o-1;n.push(c(r,U({},a,{_:s}),y.PPP,_(a.S)))}else k.forEach((function(e){var i=function(e,t){return t[j[e]]}(e,a),o=W(e,a),s=o?t[o._]:void 0;if(i){var l=U({},i,{_:i._?i._-1:void 0});n.push(c(r,l,e,_(i.S)))}else s&&(!function(e,t){t["M".concat(j[e])]=void 0}(e,a),n.push(c(r,s,e,_(s.S))))}))})),n}function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.Grow="Grow",e.Shape="Shape",e.Realize="Realize",e.View="View",e.Strain="Strain"}(ee||(ee={}));var ie="2020-02-25x";function ce(e){return Object.keys(e.recentCode).map((function(t){var n=e.recentCode[t],r=q((function(e){return console.error(e)}),!1,n);if(!r)throw new Error("Unable to read recent tenscript code: ".concat(n));return r}))}function oe(e){switch(e){case d.IntervalRole.NexusPush:return d.FabricFeature.NexusPushLength;case d.IntervalRole.ColumnPush:return d.FabricFeature.ColumnPushLength;case d.IntervalRole.Triangle:return d.FabricFeature.TriangleLength;case d.IntervalRole.Ring:return d.FabricFeature.RingLength;case d.IntervalRole.NexusCross:return d.FabricFeature.NexusCrossLength;case d.IntervalRole.ColumnCross:return d.FabricFeature.ColumnCrossLength;case d.IntervalRole.BowMid:return d.FabricFeature.BowMidLength;case d.IntervalRole.BowEnd:return d.FabricFeature.BowEndLength;default:throw new Error("role?")}}function se(e,t){return ae({},e,{nonce:e.nonce+1},t)}var le="State";function ue(e,t){var n=localStorage.getItem(le);if(n){var r=JSON.parse(n);if(r.version===ie)return r}return function(e,t){var n=h.map(e).reduce((function(e,n){return e[n.feature]={percent:100,numeric:t(n.feature)},e}),{});return{version:ie,nonce:0,surfaceCharacter:d.SurfaceCharacter.Frozen,featureValues:n,recentCode:{},controlTab:ee.Grow,fullScreen:!0,ellipsoids:!1,rotating:!1,showPushes:!0,showPulls:!0}}(e,t)}function fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function de(e){switch(e){case d.FabricFeature.Gravity:return{feature:e,name:"Gravity",percents:[0,10,50,100,200,500]};case d.FabricFeature.Drag:return{feature:e,name:"Drag",percents:[0,10,50,100,150,200]};case d.FabricFeature.PretenstFactor:return{feature:e,name:"Pretenst factor",percents:[0,50,90,100,125,150,200]};case d.FabricFeature.IterationsPerFrame:return{feature:e,name:"Iterations per frame",percents:[10,25,50,100,200,300,500]};case d.FabricFeature.IntervalCountdown:return{feature:e,name:"Interval Countdown",percents:[10,20,30,100,150,400,1e3]};case d.FabricFeature.RealizingCountdown:return{feature:e,name:"Slack to Pretenst countdown",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.SlackThreshold:return{feature:e,name:"Slack threshold",percents:[.01,.1,1,10,100,1e3]};case d.FabricFeature.ShapingPretenstFactor:return{feature:e,name:"Pretenst factor",percents:[0,1,2,3,5,10,20,50,100]};case d.FabricFeature.ShapingStiffnessFactor:return{feature:e,name:"Stiffness factor",percents:[100,150,200,250,300,400,500]};case d.FabricFeature.ShapingDrag:return{feature:e,name:"Drag",percents:[0,10,50,100,200,500]};case d.FabricFeature.MaxStrain:return{feature:e,name:"Maximum Strain",percents:[1,2,3,5,8,13,21,34,55,100]};case d.FabricFeature.VisualStrain:return{feature:e,name:"Visual Strain",percents:[0,10,50,100,200,300,500,1e3,2e3,3e3]};case d.FabricFeature.PushOverPull:return{feature:e,name:"Compression/Tension",percents:[10,20,30,50,100,200,300,500,1e3]};case d.FabricFeature.NexusPushLength:return{feature:e,name:"Nexus Push",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.ColumnPushLength:return{feature:e,name:"Column Push",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.TriangleLength:return{feature:e,name:"Triangle",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.RingLength:return{feature:e,name:"Ring",percents:[10,80,90,100,110,120,130]};case d.FabricFeature.NexusCrossLength:return{feature:e,name:"Nexus Cross",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.ColumnCrossLength:return{feature:e,name:"Column Cross",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.BowMidLength:return{feature:e,name:"Bow Mid",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.BowEndLength:return{feature:e,name:"Bow End",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.PushRadius:return{feature:e,name:"Push Radius",percents:[5,25,50,100,150,200,300]};case d.FabricFeature.PullRadius:return{feature:e,name:"Pull Radius",percents:[5,25,50,100,150,200,300]};case d.FabricFeature.JointRadius:return{feature:e,name:"Joint Radius",percents:[5,25,50,100,150,200,300]};case d.FabricFeature.MaxStiffness:return{feature:e,name:"Maximum Stiffness",percents:[5,25,50,100,150,200,500]};default:throw new Error("Feature?")}}var he=function(){function e(t,n,r){Object(u.a)(this,e),this.config=t,this.defaultValue=n,this.value$=void 0;var a=r.getValue().featureValues[t.feature],i=void 0!==a?a:{numeric:this.defaultValue,percent:100};this.value$=new s.BehaviorSubject(i),this.value$.subscribe((function(e){var n=r.getValue(),a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fe(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n.featureValues);a[t.feature]=e,r.next(se(n,{featureValues:a}))}))}return Object(f.a)(e,[{key:"value",get:function(){return this.value$.getValue()}},{key:"title",get:function(){return this.config.name}},{key:"percentChoices",get:function(){return this.config.percents}},{key:"numeric",get:function(){return this.value$.getValue().numeric}},{key:"formatted",get:function(){var e=this.numeric,t=e.toExponential(5),n=t.indexOf("e+0");return n>0?t.substring(0,n):Math.max(t.indexOf("e-1"),t.indexOf("e-2"))>0?e.toFixed(5):Math.max(t.indexOf("e+1"),t.indexOf("e+2"))>0?e.toFixed(1):t}},{key:"percent",get:function(){return this.value$.getValue().percent},set:function(e){this.value$.next({numeric:this.defaultValue*e/100,percent:e})}},{key:"observable",get:function(){return this.value$}},{key:"fabricFeature",get:function(){return this.config.feature}}]),e}();function me(e,t){var n={};return h.map(de).forEach((function(r){n[r.feature]=new he(r,t(r.feature),e)})),n}var pe=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ge(){if("serviceWorker"in navigator){if(new URL("/app",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/app","/service-worker.js");pe?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ve(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):ve(e)}))}}function ve(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var be=n(31),Ee=n(623),ye=n(112),we=n(548),Se=n(613),Pe=function(e,t,n){var r=3*t;return n?(n.set(e[r],e[r+1],e[r+2]),n):new P.Vector3(e[r],e[r+1],e[r+2])};function Oe(e,t){return{lineColors:Fe((function(e){return t.copy_line_colors_to(e)}),(function(){return 3*e.get_interval_count()*2})),lineLocations:Fe((function(e){return t.copy_line_locations_to(e)}),(function(){return 3*e.get_interval_count()*2})),faceNormals:Fe((function(e){return t.copy_face_normals_to(e)}),(function(){return 3*e.get_face_count()*3})),faceLocations:Fe((function(e){return t.copy_face_vertex_locations_to(e)}),(function(){return 3*e.get_face_count()*3})),jointLocations:Fe((function(e){return t.copy_joint_locations_to(e)}),(function(){return 3*e.get_joint_count()})),jointVelocities:Fe((function(e){return t.copy_joint_velocities_to(e)}),(function(){return 3*e.get_joint_count()})),unitVectors:Fe((function(e){return t.copy_unit_vectors_to(e)}),(function(){return 3*e.get_interval_count()})),idealLengths:Fe((function(e){return t.copy_ideal_lengths_to(e)}),(function(){return e.get_interval_count()})),strains:Fe((function(e){return t.copy_strains_to(e)}),(function(){return e.get_interval_count()})),strainNuances:Fe((function(e){return t.copy_strain_nuances_to(e)}),(function(){return e.get_interval_count()})),stiffnesses:Fe((function(e){return t.copy_stiffnesses_to(e)}),(function(){return e.get_interval_count()})),linearDensities:Fe((function(e){return t.copy_linear_densities_to(e)}),(function(){return e.get_interval_count()}))}}function Fe(e,t){var n=new Float32Array(t());return e(n),n}var Ne=function(){function e(t,n){Object(u.a)(this,e),this.fabric=void 0,this.world=void 0,this.view=void 0,this.floatView=void 0,this.featuresToApply=[],this.world=t.World.new(),this.fabric=t.Fabric.new(n),this.view=t.View.on_fabric(this.fabric),this.floatView=Oe(this.fabric,this.view)}return Object(f.a)(e,[{key:"iterate",value:function(e){var t=this,n=this.fabric.iterate(e,this.world);return this.view.render(this.fabric,this.world),this.featuresToApply.length>0&&(this.featuresToApply.forEach((function(e){return t.world.set_float_value(e.fabricFeature,e.numeric)})),this.featuresToApply=[]),this.floatView=Oe(this.fabric,this.view),n}},{key:"refreshFloatView",value:function(){this.view.render(this.fabric,this.world),this.floatView=Oe(this.fabric,this.view)}},{key:"clear",value:function(){this.fabric.clear(),this.refreshFloatView()}},{key:"applyFeature",value:function(e){this.featuresToApply.push(e)}},{key:"jointLocation",value:function(e){return Pe(this.floatView.jointLocations,e)}},{key:"apply",value:function(e){this.fabric.apply_matrix4(new Float32Array(e.toArray()))}},{key:"unitVector",value:function(e){return Pe(this.floatView.unitVectors,e)}}]),e}(),ke=function(){function e(t){Object(u.a)(this,e),this.tensegrity=t}return Object(f.a)(e,[{key:"replaceCrossedNexusCrosses",value:function(e){var t=this,n=this.tensegrity,r=[],a=function(e){var t=n.intervals.filter((function(e){return e.isPush})).find((function(t){return t.alpha.index===e||t.omega.index===e}));if(!t)throw new Error("Cannot find ".concat(e));return{interval:t,joint:t.alpha.index===e?t.alpha:t.omega}},i=n.intervals.filter((function(e){return e.intervalRole===d.IntervalRole.NexusCross}));i.forEach((function(e,t){var n=e.alpha.index,c=e.omega.index,o=a(n),s=a(c),l=e.alpha.location(),u=e.omega.location(),f=l.distanceTo(u),d=(new P.Vector3).addVectors(l,u).multiplyScalar(.5);i.forEach((function(i,h){var m=i.alpha.index,p=i.omega.index;if(!(t>=h||n===m||n===p||c===m||c===p)){var g,v,b,E,y,w=a(m),S=a(p),O=function(e,t){return e.interval.index===t.interval.index};if(O(o,w))g=o.interval,v=e.alpha,b=e.omega,E=i.alpha,y=i.omega;else if(O(o,S))g=o.interval,v=e.alpha,b=e.omega,E=i.omega,y=i.alpha;else if(O(s,w))g=s.interval,v=e.omega,b=e.alpha,E=i.alpha,y=i.omega;else{if(!O(s,S))return;g=s.interval,v=e.omega,b=e.alpha,E=i.omega,y=i.alpha}var F=i.alpha.location(),N=i.omega.location(),k=F.distanceTo(N),j=(new P.Vector3).addVectors(F,N).multiplyScalar(.5),x=l.distanceTo(j)/k,C=u.distanceTo(j)/k,V=F.distanceTo(d)/f,R=N.distanceTo(d)/f,T=0,M=function(e){e<.5&&T++};if(M(x),M(C),M(V),M(R),!(T<2)){var I=g.scale;r.push({scale:I,a:v,x:b,b:E,y:y})}}}))})),r.forEach((function(r){var a=r.scale,i=r.a,c=r.x,o=r.b,s=r.y;n.createInterval(c,s,d.IntervalRole.BowMid,a,e);var l=n.findInterval(i,c),u=n.findInterval(i,s),f=n.findInterval(o,c),h=n.findInterval(o,s);if(!(l&&f&&u&&h))throw new Error("Cannot find intervals during optimize");n.removeInterval(l),n.removeInterval(h),t.tensegrity.changeIntervalRole(u,d.IntervalRole.BowEnd,a,e),t.tensegrity.changeIntervalRole(f,d.IntervalRole.BowEnd,a,e)}))}},{key:"stiffnessesFromStrains",value:function(){var e=this.tensegrity.numericFeature(d.FabricFeature.PushOverPull),t=function(e,t){var n=e.instance.floatView.strains,r=function(e){return e.reduce((function(e,t){return e+n[t.index]}),0)/e.length},a=e.intervals,i=a.filter((function(e){return e.isPush})),c=r(i),o=a.filter((function(e){return!e.isPush})),s=r(o),l=(-t*c+s)/2,u=a.map((function(e){return 1+(n[e.index]*(e.isPush?-t:1)-l)/l}));return e.instance.floatView.stiffnesses.map((function(e,t){return e*u[t]}))}(this.tensegrity,e);this.tensegrity.restore(),this.tensegrity.instance.fabric.copy_stiffnesses(t)}}]),e}();var je=function(){function e(t,n,r){Object(u.a)(this,e),this.numericFeature=t,this.tensegrity=n,this._stage=void 0,this._stage=r}return Object(f.a)(e,[{key:"withStage",value:function(t,n){return this.transition(t,n),this._stage=t,new e(this.numericFeature,this.tensegrity,t)}},{key:"transition",value:function(e,t){switch(this._stage){case d.Stage.Growing:switch(e){case d.Stage.Shaping:return void this.tensegrity.save()}break;case d.Stage.Shaping:switch(e){case d.Stage.Slack:return void(t&&t.adoptLengths&&(this.tensegrity.instance.fabric.adopt_lengths(),this.tensegrity.save()));case d.Stage.Realizing:return}break;case d.Stage.Slack:switch(e){case d.Stage.Shaping:case d.Stage.Realizing:return}break;case d.Stage.Realizing:switch(e){case d.Stage.Realized:return}break;case d.Stage.Realized:switch(e){case d.Stage.Slack:if(t){if(t.strainToStiffness)return void new ke(this.tensegrity).stiffnessesFromStrains();if(t.adoptLengths)return this.tensegrity.instance.fabric.adopt_lengths(),void this.tensegrity.save()}}}throw new Error("No transition ".concat(d.Stage[this._stage]," to ").concat(d.Stage[e]))}},{key:"stage",get:function(){return this._stage}}]),e}(),xe=65535;function Ce(e){return L(e)/1e4}var Ve,Re,Te=function(){function e(t,n,r,a){Object(u.a)(this,e),this.roleDefaultLength=t,this.numericFeature=n,this.instance=r,this.tenscript=a,this.life$=void 0,this.joints=[],this.intervals=[],this.facePulls=[],this.faces=[],this.bricks=[],this.activeTenscript=void 0,this.facesToConnect=void 0,this.backup=void 0,this.instance.clear(),this.life$=new s.BehaviorSubject(new je(n,this,d.Stage.Growing));var i=new Z(this).createBrickAt(new P.Vector3,_());this.bricks=[i],this.activeTenscript=[{tree:this.tenscript.tree,brick:i,tensegrity:this}]}return Object(f.a)(e,[{key:"save",value:function(){this.backup=this.instance.fabric.copy()}},{key:"restore",value:function(){if(!this.backup)throw new Error("No backup");this.instance.fabric.restore(this.backup)}},{key:"toStage",value:function(e,t){e!==this.life.stage&&this.life$.next(this.life.withStage(e,t))}},{key:"connectFaces",value:function(e){this.facesToConnect=e}},{key:"createLeftJoint",value:function(e){return this.instance.fabric.create_joint(e.x,e.y,e.z)}},{key:"createFacePull",value:function(e,t){var n=e.location().distanceTo(t.location()),r=Ce(_()),a=(L(e.brick.scale)+L(t.brick.scale))/2,i=Y(a),c={index:this.instance.fabric.create_interval(e.index,t.index,d.IntervalRole.FacePull,n,i,r,function(e){var t=6e3*e;return t>xe?xe:t}(n)),alpha:e,omega:t,distance:n,scaleFactor:a,removed:!1};return this.facePulls.push(c),c}},{key:"removeFacePull",value:function(e){this.facePulls=this.facePulls.filter((function(t){return t.index!==e.index})),this.instance.fabric.remove_interval(e.index),this.facePulls.forEach((function(t){t.index>e.index&&t.index--})),this.intervals.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0}},{key:"createInterval",value:function(e,t,n,r,a){var i=e.location().distanceTo(t.location()),c=L(r)*this.roleDefaultLength(n),o=Ce(r),s={index:this.instance.fabric.create_interval(e.index,t.index,n,i,c,o,a),intervalRole:n,scale:r,alpha:e,omega:t,removed:!1,isPush:g(n),location:function(){return(new P.Vector3).addVectors(e.location(),t.location()).multiplyScalar(.5)}};return this.intervals.push(s),s}},{key:"changeIntervalScale",value:function(e,t){e.scale=D(L(e.scale)*t),this.instance.fabric.multiply_rest_length(e.index,t,100)}},{key:"changeIntervalRole",value:function(e,t,n,r){e.intervalRole=t,this.instance.fabric.set_interval_role(e.index,t),this.instance.fabric.change_rest_length(e.index,L(n)*this.roleDefaultLength(t),r)}},{key:"removeInterval",value:function(e){this.intervals=this.intervals.filter((function(t){return t.index!==e.index})),this.instance.fabric.remove_interval(e.index),this.intervals.forEach((function(t){t.index>e.index&&t.index--})),this.facePulls.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0}},{key:"createFace",value:function(e,t){var n=I[t],r=n.negative,a=n.pushEnds,i=a.map((function(t){var n=e.pushes.find((function(n){var r=e.joints[t];return r.index===n.alpha.index||r.index===n.omega.index}));if(void 0===n)throw new Error;return n})),c=[0,1,2].map((function(n){return e.pulls[3*t+n]})),o=a.map((function(t){return e.joints[t]})),s={index:this.instance.fabric.create_face(o[0].index,o[1].index,o[2].index),negative:r,removed:!1,brick:e,triangle:t,joints:o,pushes:i,pulls:c,location:function(){return o.reduce((function(e,t){return e.add(t.location())}),new P.Vector3).multiplyScalar(1/3)}};return this.faces.push(s),s}},{key:"removeFace",value:function(e,t){var n=this;this.instance.fabric.remove_face(e.index),this.faces=this.faces.filter((function(t){return t.index!==e.index})),this.faces.forEach((function(t){t.index>e.index&&t.index--})),this.facePulls.forEach((function(t){t.alpha.index>e.index&&t.alpha.index--,t.omega.index>e.index&&t.omega.index--})),e.removed=!0,t&&e.pulls.forEach((function(e){return n.removeInterval(e)}))}},{key:"startTightening",value:function(e){this.facePulls=e}},{key:"iterate",value:function(){var e=this,t=this.instance.iterate(this.life$.getValue().stage);if(t===d.Stage.Busy)return t;var n=this.activeTenscript,r=function(){return new Z(e)};if(n){if(n.length>0&&(this.activeTenscript=ne(n,this.tenscript.markTrees),this.instance.fabric.centralize()),0===n.length){this.activeTenscript=void 0;var a=this.faceMarks,i=Object.keys(a).find((function(e){return 1===a[e].length}));if(i&&r().uprightAtOrigin(a[i][0]),this.instance.refreshFloatView(),t===d.Stage.Growing){var c=this.instance.fabric.finish_growing();return this.facePulls=Object.keys(a).map((function(e){return a[e]})).filter((function(e){return 2===e.length||3===e.length})).reduce((function(e,t){return[].concat(Object(w.a)(e),Object(w.a)(r().createFacePulls(t)))}),[]),c}}return d.Stage.Growing}var o=this.facesToConnect;return o&&(this.facesToConnect=void 0,r().createFacePulls(o)),this.facePulls.length>0&&(this.facePulls=r().checkFacePulls(this.facePulls,(function(t){return e.removeFacePull(t)}))),t}},{key:"findInterval",value:function(e,t){return this.intervals.find((function(n){return n.alpha.index===e.index&&n.omega.index===t.index||n.alpha.index===t.index&&n.omega.index===e.index}))}},{key:"getFabricOutput",value:function(e){var t=this,n=this.instance.floatView.idealLengths,r=this.instance.floatView.strains,a=this.instance.floatView.stiffnesses,i=this.instance.floatView.linearDensities;return{name:this.tenscript.name,joints:this.joints.map((function(e){var n=e.location();return{index:e.index,x:n.x,y:n.z,z:n.y,jointCables:C(e,t.intervals)}})),intervals:this.intervals.map((function(t){var c=e.featureValues[t.isPush?d.FabricFeature.PushRadius:d.FabricFeature.PullRadius].numeric*i[t.index],o=c*e.featureValues[d.FabricFeature.JointRadius].numeric,s=t.alpha.location().distanceTo(t.omega.location())+(t.isPush?2*-o:2*o);return{index:t.index,joints:[t.alpha.index,t.omega.index],type:t.isPush?"Push":"Pull",strain:r[t.index],stiffness:a[t.index],linearDensity:i[t.index],role:m(t.intervalRole),idealLength:n[t.index],isPush:t.isPush,length:s,radius:c,jointRadius:o}}))}}},{key:"life",get:function(){return this.life$.getValue()}},{key:"faceMarks",get:function(){var e={};return this.faces.forEach((function(t){if(t.mark){var n=e[t.mark._];n?n.push(t):e[t.mark._]=[t]}})),e}},{key:"submergedJoints",get:function(){return this.joints.filter((function(e){return e.location().y<0}))}},{key:"facesGeometry",get:function(){var e=new P.Float32BufferAttribute(this.instance.floatView.faceLocations,3),t=new P.Float32BufferAttribute(this.instance.floatView.faceNormals,3),n=new P.BufferGeometry;return n.addAttribute("position",e),n.addAttribute("normal",t),n.computeBoundingSphere(),n}},{key:"linesGeometry",get:function(){var e=new P.Float32BufferAttribute(this.instance.floatView.lineLocations,3),t=new P.Float32BufferAttribute(this.instance.floatView.lineColors,3),n=new P.BufferGeometry;return n.addAttribute("position",e),n.addAttribute("color",t),n.computeBoundingSphere(),n}}]),e}(),Me=n(618),Ie=n(619),Ae=n(624),_e=n(620),Le=n(621),De=n(622),ze=["#ff0012","#fb5c06","#e28a00","#d4b500","#afd200","#80da52","#4edd83","#00ddad","#00c4d7","#00a5ff","#007bff","#2329f7"].reverse().map((function(e){return new P.Color(e)})),Be=!0,Ye=new P.MeshPhongMaterial({color:new P.Color("#1c1608"),side:P.DoubleSide}),Ze=new P.LineBasicMaterial({vertexColors:P.VertexColors}),Xe=new P.LineBasicMaterial({color:new P.Color("#cace02")}),Ue=new P.MeshPhongMaterial({lights:Be,color:new P.Color("white"),side:P.DoubleSide,transparent:!0,opacity:.2}),$e=new P.MeshPhongMaterial({color:new P.Color("#91934f"),lights:!0}),Ge=new P.MeshPhongMaterial({color:new P.Color("#e83ada"),lights:!0}),We=ze.map((function(e){return new P.MeshLambertMaterial({color:e,lights:Be})}));function Qe(e){switch(e){case d.IntervalRole.NexusPush:return"#6541b4";case d.IntervalRole.ColumnPush:return"#2f3aca";case d.IntervalRole.Triangle:return"#c9c445";case d.IntervalRole.Ring:return"#e83ada";case d.IntervalRole.NexusCross:return"#59ebcb";case d.IntervalRole.ColumnCross:return"#299995";case d.IntervalRole.BowMid:return"#f14302";case d.IntervalRole.BowEnd:return"#c03b02";case d.IntervalRole.FacePull:return"#fe0105";default:return}}function He(e){var t=function(e){return new P.Color(Qe(e))}(e);return new P.MeshLambertMaterial({color:t,lights:Be})}function Je(e){var t=e.feature,n=e.disabled,r=Object(c.useState)((function(){return t.percent})),a=Object(be.a)(r,2),i=a[0],o=a[1];Object(c.useEffect)((function(){var e=t.observable.subscribe((function(e){var t=e.percent;return o(t)}));return function(){return e.unsubscribe()}}),[]);var s=Qe(v(t.fabricFeature)),l=s||"#919191";return c.createElement("div",{className:"my-2"},c.createElement("div",{className:"float-right",style:{color:n?"gray":"white"}},t.formatted),c.createElement("div",null,t.config.name),c.createElement(Se.a,{className:"w-100"},t.percentChoices.map((function(e){var r=i===e?"#000000":l;return c.createElement(we.a,{disabled:n,size:"sm",style:{color:"white",backgroundColor:r},key:"".concat(t.config.name,":").concat(e),onClick:function(){return t.percent=e}},function(e){return e<=100?"".concat(e,"%"):"".concat(e/100,"x")}(e))}))))}function qe(e){var t=e.tensegrity,n=e.stageTransition,r=e.disabled,a=Object(c.useState)(t.life),i=Object(be.a)(a,2),o=i[0],s=i[1];function l(e){return!(!r&&o.stage!==d.Stage.Busy&&o.stage!==d.Stage.Realizing)||o.stage!==e}switch(Object(c.useEffect)((function(){var e=t.life$.subscribe(s);return function(){return e.unsubscribe()}}),[t]),n){case Ve.CaptureLengthsToSlack:return c.createElement(we.a,{className:"my-1 w-100",disabled:l(d.Stage.Shaping),onClick:function(){return t.toStage(d.Stage.Slack,{adoptLengths:!0})}},"Capture Lengths ",c.createElement(Ee.j,null)," (",c.createElement(Ke,{stage:d.Stage.Shaping})," ) ",c.createElement(Ee.d,null)," ( ",c.createElement(Ee.f,null),c.createElement(Ke,{stage:d.Stage.Slack})," ) New Slack");case Ve.CurrentLengthsToSlack:return c.createElement(we.a,{className:"my-1 w-100",disabled:l(d.Stage.Shaping),onClick:function(){return t.toStage(d.Stage.Slack)}},"Current Lengths ",c.createElement(Ke,{stage:d.Stage.Shaping})," ",c.createElement(Ee.d,null),c.createElement(Ke,{stage:d.Stage.Slack})," Slack");case Ve.SlackToRealizing:return c.createElement(we.a,{className:"my-1 w-100",disabled:l(d.Stage.Slack),onClick:function(){return t.toStage(d.Stage.Realizing)}},"Slack ",c.createElement(Ke,{stage:d.Stage.Slack})," ",c.createElement(Ee.d,null)," ",c.createElement(Ke,{stage:d.Stage.Realized})," Realized");case Ve.SlackToShaping:return c.createElement(Se.a,{vertical:!0,className:"w-100 my-1"},c.createElement(we.a,{className:"my-1 w-100",disabled:l(d.Stage.Slack),onClick:function(){return t.toStage(d.Stage.Shaping)}},"Slack ",c.createElement(Ke,{stage:d.Stage.Slack})," ",c.createElement(Ee.d,null)," ",c.createElement(Ke,{stage:d.Stage.Shaping})," Shaping"));case Ve.CaptureRealizedToSlack:return c.createElement(we.a,{className:"my-1 w-100",disabled:l(d.Stage.Realized),onClick:function(){return t.toStage(d.Stage.Slack,{adoptLengths:!0})}},"Capture realized ",c.createElement(Ee.j,null)," ( ",c.createElement(Ke,{stage:d.Stage.Realized})," ) ",c.createElement(Ee.d,null)," ( ",c.createElement(Ee.f,null),c.createElement(Ke,{stage:d.Stage.Slack})," ) New Slack");case Ve.CaptureStrainForStiffness:return c.createElement(we.a,{className:"my-1 w-100",disabled:l(d.Stage.Realized),onClick:function(){return t.toStage(d.Stage.Slack,{strainToStiffness:!0})}},"Capture Strain ",c.createElement(Ee.j,null)," ( ",c.createElement(Ke,{stage:d.Stage.Realized})," ",c.createElement(Ee.F,null)," ) ",c.createElement(Ee.d,null),"( ",c.createElement(Ke,{stage:d.Stage.Slack})," ",c.createElement(Ee.k,null)," ) Slack Stiffness")}}function Ke(e){switch(e.stage){case d.Stage.Busy:return c.createElement(Ee.n,null);case d.Stage.Growing:return c.createElement(Ee.M,null);case d.Stage.Shaping:return c.createElement(Ee.R,null);case d.Stage.Slack:return c.createElement(Ee.T,null);case d.Stage.Realizing:return c.createElement(Ee.n,null);case d.Stage.Realized:return c.createElement(Ee.B,null);default:throw new Error("Stage?")}}function et(e){var t=e.floatFeatures,n=e.tensegrity,r=e.selectedIntervals,a=e.setFabric,i=e.shapeSelection,o=e.setShapeSelection,s=e.selectedFaces,l=e.clearSelectedFaces,u=e.storedState$,f=Object(c.useState)(!1),h=Object(be.a)(f,2),g=h[0],v=h[1];Object(c.useEffect)((function(){n.instance.world.set_push_and_pull(g)}),[g]);var b=Object(c.useState)(u.getValue().ellipsoids),E=Object(be.a)(b,2),y=E[0],w=E[1];Object(c.useEffect)((function(){var e=[u.subscribe((function(e){return w(e.ellipsoids)}))];return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[]);var S=Object(c.useState)(n.life),P=Object(be.a)(S,2),O=P[0],F=P[1];Object(c.useEffect)((function(){var e=n.life$.subscribe(F);return function(){return e.unsubscribe()}}),[n]);var N=Object(c.useState)(t[d.FabricFeature.NexusPushLength]),k=Object(be.a)(N,2),j=k[0],x=k[1],C=function(e,t,a){return function(){r&&r.forEach((function(r){r.isPush&&!t||!r.isPush&&!a||n.changeIntervalScale(r,e?1.03:1/1.03)}))}};function V(){return y||O.stage!==d.Stage.Shaping}function R(e,t){return!(!V()&&i===t)||(s.length<e||y)}function T(){return y||i!==Re.None}return c.createElement("div",null,c.createElement(Ft,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.a,null)," Phase"),c.createElement(qe,{tensegrity:n,stageTransition:Ve.CaptureLengthsToSlack,disabled:T()}),c.createElement(qe,{tensegrity:n,stageTransition:Ve.CurrentLengthsToSlack,disabled:T()}),c.createElement(qe,{tensegrity:n,stageTransition:Ve.SlackToShaping,disabled:T()})),c.createElement(Ft,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.z,null)," Manual"),c.createElement(Se.a,{size:"sm",className:"w-100 my-2"},c.createElement(we.a,{color:i===Re.Intervals?"warning":"secondary",disabled:y&&i===Re.None||0===s.length,onClick:function(){var e=i===Re.Intervals?Re.None:Re.Intervals;o(e)}},c.createElement("span",null,c.createElement(Ee.b,null)," Adjust ",c.createElement(Ee.e,null))),c.createElement(we.a,{disabled:R(1,Re.Intervals),onClick:C(!0,!0,!0)},"TC ",c.createElement(Ee.e,null)),c.createElement(we.a,{disabled:R(1,Re.Intervals),onClick:C(!1,!0,!0)},"TC ",c.createElement(Ee.b,null)),c.createElement(we.a,{disabled:R(1,Re.Intervals),onClick:C(!0,!1,!0)},"T",c.createElement(Ee.e,null)),c.createElement(we.a,{disabled:R(1,Re.Intervals),onClick:C(!1,!1,!0)},"T ",c.createElement(Ee.b,null)),c.createElement(we.a,{disabled:R(1,Re.Intervals),onClick:C(!0,!0,!1)},"C ",c.createElement(Ee.e,null)),c.createElement(we.a,{disabled:R(1,Re.Intervals),onClick:C(!1,!0,!1)},"C ",c.createElement(Ee.b,null))),c.createElement(Se.a,{size:"sm",className:"w-100 my-2"},c.createElement(we.a,{disabled:0===s.length||V()&&i!==Re.None,onClick:function(){return l()}},c.createElement(Ee.P,null)," Clear selection"),c.createElement(we.a,{disabled:R(1,Re.Faces),onClick:function(){new Z(n).uprightAtOrigin(s[0]),n.instance.refreshFloatView(),l()}},c.createElement(Ee.o,null),c.createElement("span",null," Upright")),c.createElement(we.a,{disabled:R(2,Re.Faces),onClick:function(){n.connectFaces(s),l(),o(Re.None),a(n)}},c.createElement(Ee.E,null),c.createElement("span",null," Connect")),c.createElement(we.a,{disabled:V(),onClick:function(){return new ke(n).replaceCrossedNexusCrosses(n.numericFeature(d.FabricFeature.IntervalCountdown))}},c.createElement(Ee.G,null),c.createElement("span",null," Bows")))),c.createElement(Ft,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.R,null)," Adjustments"),c.createElement(Je,{feature:t[d.FabricFeature.ShapingPretenstFactor],disabled:V()}),c.createElement(Je,{feature:t[d.FabricFeature.ShapingDrag],disabled:V()}),c.createElement(Je,{feature:t[d.FabricFeature.ShapingStiffnessFactor],disabled:V()}),c.createElement(Se.a,{size:"sm",className:"w-100 my-2"},c.createElement(we.a,{disabled:V(),color:g?"secondary":"success",onClick:function(){return v(!1)}},c.createElement(Ee.l,null),": T or C"),c.createElement(we.a,{disabled:V(),color:g?"success":"secondary",onClick:function(){return v(!0)}},c.createElement(Ee.r,null),": T=C"))),c.createElement(Ft,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.F,null)," Default Lengths"),c.createElement(Je,{key:j.title,feature:j,disabled:V()}),c.createElement(Se.a,{className:"my-2 w-100"},p.map((function(e){return{intervalRole:e,feature:t[oe(e)]}})).map((function(e){var t=e.intervalRole,n=e.feature;return c.createElement(we.a,{size:"sm",key:"IntervalRole[".concat(t,"]"),onClick:function(){return x(n)},color:j.fabricFeature===n.fabricFeature?"success":"secondary"},m(t))})))))}function tt(e){var t=e.floatFeatures,n=e.tensegrity,r=e.shapeSelection,a=e.storedState$,i=Object(c.useState)(a.getValue()),o=Object(be.a)(i,2),s=o[0],l=o[1],u=Object(c.useState)(a.getValue().ellipsoids),f=Object(be.a)(u,2),h=f[0],m=f[1];Object(c.useEffect)((function(){var e=[a.subscribe((function(e){m(s.ellipsoids),l(e)}))];return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[]);var p=Object(c.useState)(n.life),g=Object(be.a)(p,2),v=g[0],b=g[1];function E(){return h||r!==Re.None||v.stage<d.Stage.Slack}function y(){return h||r!==Re.None}return Object(c.useEffect)((function(){var e=n.life$.subscribe(b);return function(){return e.unsubscribe()}}),[n]),c.createElement("div",null,c.createElement(Ft,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.a,null)," Phase"),c.createElement(qe,{tensegrity:n,stageTransition:Ve.SlackToRealizing,disabled:y()}),c.createElement(qe,{tensegrity:n,stageTransition:Ve.CaptureRealizedToSlack,disabled:y()})),c.createElement(Ft,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.y,null)," Environment"),c.createElement(Je,{feature:t[d.FabricFeature.PretenstFactor],disabled:E()}),c.createElement("div",{className:"float-right",style:{color:E()?"gray":"white"}},d.SurfaceCharacter[s.surfaceCharacter]),c.createElement("div",null,"Surface"),c.createElement(Se.a,{size:"sm",className:"w-100"},Object.keys(d.SurfaceCharacter).map((function(e){return c.createElement(we.a,{key:"SurfaceCharacter[".concat(e,"]"),disabled:E(),active:s.surfaceCharacter===d.SurfaceCharacter[e],onClick:function(){return t={surfaceCharacter:d.SurfaceCharacter[e]},void a.next(se(a.getValue(),t));var t}},e)}))),c.createElement(Je,{feature:t[d.FabricFeature.Gravity],disabled:E()}),c.createElement(Je,{feature:t[d.FabricFeature.Drag],disabled:E()})),c.createElement(Ft,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.g,null)," Compression vs Tension"),c.createElement(qe,{tensegrity:n,stageTransition:Ve.CaptureStrainForStiffness,disabled:y()}),c.createElement(Je,{feature:t[d.FabricFeature.PushOverPull],disabled:E()})))}!function(e){e[e.CaptureLengthsToSlack=0]="CaptureLengthsToSlack",e[e.CurrentLengthsToSlack=1]="CurrentLengthsToSlack",e[e.SlackToRealizing=2]="SlackToRealizing",e[e.SlackToShaping=3]="SlackToShaping",e[e.CaptureRealizedToSlack=4]="CaptureRealizedToSlack",e[e.CaptureStrainForStiffness=5]="CaptureStrainForStiffness"}(Ve||(Ve={})),function(e){e[e.None=0]="None",e[e.Faces=1]="Faces",e[e.Intervals=2]="Intervals"}(Re||(Re={}));var nt=.7,rt=1.4,at=3.5,it=[d.FabricFeature.MaxStrain,d.FabricFeature.MaxStiffness,d.FabricFeature.VisualStrain,d.FabricFeature.SlackThreshold];function ct(e){var t=new P.Geometry,n=function(e,t){return new P.Vector3(e,t,0)};return t.vertices=[n(0,-at),n(0,at),n(-nt,at),n(nt,at),n(-nt,-at),n(nt,-at)],e&&t.vertices.push(n(-nt,0),n(nt,0)),t}function ot(e,t,n,r,a){var i=new Float32Array(2*n.length*3),c=0;e.forEach((function(e){var t=(n[e.index]-r)/(a-r),o=t<-1?-1:t>1?1:t;i[c++]=-nt*rt,i[c++]=o*at,i[c++]=0,i[c++]=nt*rt,i[c++]=o*at,i[c++]=0}));var o=new P.BufferGeometry;return o.addAttribute("position",new P.Float32BufferAttribute(i,3)),o.addAttribute("color",new P.Float32BufferAttribute(t,3)),o}function st(e){var t=e.floatFeatures,n=e.tensegrity,r=e.storedState$,a=Object(c.useRef)();return c.createElement(c.Fragment,null,c.createElement(Ft,{height:"50%"},c.createElement("div",{style:{position:"absolute",left:"6em"}},"Strain"),c.createElement("div",{style:{position:"absolute",right:"5em"}},"Stiffness"),c.createElement((function(){var e=Object(c.useState)(0),t=Object(be.a)(e,2),i=t[0],o=t[1],s=Object(c.useState)(r.getValue().featureValues[d.FabricFeature.MaxStrain].numeric),l=Object(be.a)(s,2),u=l[0],f=l[1],h=Object(c.useState)(r.getValue().featureValues[d.FabricFeature.MaxStiffness].numeric),m=Object(be.a)(h,2),p=m[0],g=m[1];Object(c.useEffect)((function(){var e=r.subscribe((function(e){f(e.featureValues[d.FabricFeature.MaxStrain].numeric),g(e.featureValues[d.FabricFeature.MaxStiffness].numeric)}));return function(){return e.unsubscribe()}}),[n]),Object(c.useEffect)((function(){var e=setInterval((function(){var e=n.instance.fabric.age;i<e&&o(e)}),1e3);return function(){return clearTimeout(e)}}),[]);var v=n.instance;function b(e){var t=e.position,n=e.intervals,r=e.floats,a=e.mid,i=e.max,o=e.middleTick;return c.createElement("group",{position:new P.Vector3(t,-.15,0)},c.createElement("lineSegments",{geometry:ot(n,v.floatView.lineColors,r,a,i),material:Ze}),c.createElement("lineSegments",{geometry:ct(o),material:Xe}))}return c.createElement(ye.a,null,c.createElement("orthographicCamera",{position:new P.Vector3(0,0,-1),ref:a}),c.createElement("scene",null,c.createElement(b,{position:-1.5,intervals:n.intervals,floats:v.floatView.strains,mid:0,max:u,middleTick:!0}),c.createElement(b,{position:1.5,intervals:n.intervals,floats:v.floatView.stiffnesses,mid:0,max:p,middleTick:!1})))}),null)),c.createElement(Ft,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.N,null)," Adjustments"),it.map((function(e){return c.createElement(Je,{key:"FabricFeature[".concat(e,"]"),feature:t[e],disabled:!1})}))))}var lt=n(625),ut=n(614),ft=n(615),dt=n(616),ht=n(617);function mt(e){var t=e.rootTenscript,n=e.setRootTenscript,r=e.tensegrity,a=e.runTenscript,i=e.storedState$,o=Object(c.useState)(r&&!r.tenscript.fromUrl?r.tenscript:t),s=Object(be.a)(o,2),l=s[0],u=s[1],f=Object(c.useState)(""),d=Object(be.a)(f,2),h=d[0],m=d[1],p=Object(c.useState)(!1),g=Object(be.a)(p,2),v=g[0],b=g[1],E=Object(c.useState)(ce(i.getValue())),y=Object(be.a)(E,2),w=y[0],S=y[1],P=Object(c.useState)(!1),O=Object(be.a)(P,2),F=O[0],N=O[1];function k(e){var t=function(e,t){var n=t.code,r=t.name,a=ae({},e.recentCode);return a[r]=n,se(e,{recentCode:a})}(i.getValue(),e);S(ce(t)),i.next(t)}return c.createElement("div",{id:"tenscript-panel",style:{flexDirection:"column",position:"relative",backgroundColor:"rgba(0,0,0,1)",height:"100%"}},c.createElement(Ft,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.M,null)," Tenscript"),c.createElement("div",{id:"code-and-run",style:{flexDirection:"column",height:"available"}},c.createElement(pt,{tenscript:l,setTenscript:u,error:h,setError:m}),c.createElement(Se.a,{className:"w-100 my-2"},c.createElement(we.a,{color:h.length>0?"warning":"success",disabled:h.length>0,onClick:function(){return a(l)}},0===h.length?c.createElement("span",null,"Execute ",c.createElement(Ee.I,null)," tenscript"):c.createElement("span",null,c.createElement(Ee.i,null)," ",h))))),c.createElement(Ft,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.h,null)," Storage"),0===w.length?void 0:c.createElement(lt.a,{className:"w-100 my-2",isOpen:v,toggle:function(){return b(!v)}},c.createElement(ut.a,{style:{borderRadius:"1.078em"}},v?c.createElement(Ee.K,null):c.createElement(Ee.J,null)," Recent"),c.createElement(ft.a,null,w.map((function(e,t){return c.createElement(dt.a,{key:"Recent".concat(t),onClick:function(){return a(e)}},e.name)})))),c.createElement(Se.a,{className:"w-100 my-2"},c.createElement(we.a,{disabled:l.code===t.code,onClick:function(){n(l),k(l)}},"Save ",c.createElement(Ee.C,null)," for later")),c.createElement(lt.a,{className:"w-100 my-2",isOpen:F,toggle:function(){return N(!F)}},c.createElement(ut.a,{color:"info",style:{borderRadius:"1.078em"}},"Explore ",c.createElement(Ee.D,null)," existing designs"),c.createElement(ft.a,null,te.map((function(e,t){return c.createElement(dt.a,{key:"Boot".concat(t),onClick:function(){return a(e)}},e.name)}))))))}function pt(e){var t=e.tenscript,n=e.setTenscript,r=e.error,a=e.setError,i=Object(c.useState)(""),o=Object(be.a)(i,2),s=o[0],l=o[1];function u(e){l(e),function(e){var t=q(a,!1,e);t&&(a(""),n(t))}(e)}return Object(c.useEffect)((function(){return l(t.code)}),[]),c.createElement("div",{className:"my-2 p-2 w-100",style:{backgroundColor:"#757575",color:"#ffffff",borderStyle:"solid",borderRadius:"1em",borderColor:0===r.length?"black":"#f0ad4e",borderWidth:"2px"}},c.createElement("h6",{className:"w-100 text-center"},c.createElement("i",null,'"',t.name,'"')),c.createElement(ht.a,{style:{borderRadius:"1em",height:"20em"},type:"textarea",id:"tenscript",value:s,onChange:function(e){return u(e.target.value)}}))}var gt=n(561),vt=n(562),bt=n.n(vt);function Et(e){return e.toFixed(5).replace(/[.]/,",")}function yt(){return(new Date).toISOString().replace(/[.].*/,"").replace(/[:T_]/g,"-")}function wt(e,t){var n=e.getFabricOutput(t),r=new bt.a;r.file("joints.csv",function(e){var t=[];return t.push(["index","x","y","z"]),e.joints.forEach((function(e){return t.push([(e.index+1).toFixed(0),Et(e.x),Et(e.y),Et(e.z)])})),t.map((function(e){return e.join(";")})).join("\n")}(n)),r.file("intervals.csv",function(e){var t=[];return t.push(["joints","type","strain","stiffness","linear density","role","length"]),e.intervals.forEach((function(e){t.push(['"=""'.concat(e.joints.map((function(e){return(e+1).toFixed(0)})),'"""'),e.type,Et(e.strain),Et(e.stiffness),Et(e.linearDensity),e.role,e.length.toFixed(8)])})),t.map((function(e){return e.join(";")})).join("\n")}(n)),r.file("submerged.csv",function(e){var t=[];return t.push(["joints"]),t.push(['"=""'.concat(e.submergedJoints.map((function(e){return e.index+1})),'"""')]),t.map((function(e){return e.join(";")})).join("\n")}(e)),r.generateAsync({type:"blob",mimeType:"application/zip"}).then((function(e){gt.saveAs(e,"pretenst-".concat(yt(),".zip"))}))}function St(e){var t=e.floatFeatures,n=e.tensegrity,r=e.visibleRoles,a=e.setVisibleRoles,i=e.storedState$,o=Object(c.useState)(i.getValue().ellipsoids),s=Object(be.a)(o,2),l=s[0],u=s[1],f=Object(c.useState)(i.getValue().showPushes),h=Object(be.a)(f,2),g=h[0],v=h[1],b=Object(c.useState)(i.getValue().showPulls),E=Object(be.a)(b,2),y=E[0],S=E[1];Object(c.useEffect)((function(){var e=i.subscribe((function(e){u(e.ellipsoids),v(e.showPushes),S(e.showPulls)}));return function(){return e.unsubscribe()}}),[]);var P=Object(c.useState)(n.life),O=Object(be.a)(P,2),F=O[0],N=O[1];function k(e){var t=e.pushes,n=e.pulls,r=e.children;return c.createElement(we.a,{style:{color:"white"},color:t===g&&n===y?"success":"secondary",onClick:function(){i.next(se(i.getValue(),{showPulls:n,showPushes:t}))}},r)}return Object(c.useEffect)((function(){var e=n.life$.subscribe(N);return function(){return e.unsubscribe()}}),[n]),c.createElement("div",null,c.createElement(Ft,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.t,null)," Coloring"),c.createElement(Se.a,{className:"w-100 my-2"},c.createElement(k,{pushes:!0,pulls:!0},c.createElement("span",null,c.createElement(Ee.x,null)," All")),c.createElement(k,{pushes:!1,pulls:!0},c.createElement("span",null,c.createElement(Ee.S,null)," Pulls")),c.createElement(k,{pushes:!0,pulls:!1},c.createElement("span",null,c.createElement(Ee.s,null)," Pushes")),c.createElement(k,{pushes:!1,pulls:!1},c.createElement("span",null,c.createElement(Ee.m,null)," Roles")))),c.createElement(Ft,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.j,null)," Snapshot"),c.createElement(Se.a,{size:"sm",className:"w-100"},p.map((function(e){return c.createElement(we.a,{color:r.indexOf(e)<0?"secondary":"success",key:"viz".concat(e),onClick:function(){r.indexOf(e)<0?a([].concat(Object(w.a)(r),[e])):a(r.filter((function(t){return t!==e})))},disabled:!l},m(e))}))),c.createElement(Je,{key:"pushrad",feature:t[d.FabricFeature.PushRadius],disabled:!l}),c.createElement(Je,{key:"pullrad",feature:t[d.FabricFeature.PullRadius],disabled:!l}),c.createElement(Je,{key:"jointrad",feature:t[d.FabricFeature.JointRadius],disabled:!l})),c.createElement(Ft,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.n,null)," Time"),c.createElement(Je,{key:"it",feature:t[d.FabricFeature.IterationsPerFrame],disabled:l}),c.createElement(Je,{key:"ic",feature:t[d.FabricFeature.IntervalCountdown],disabled:l}),c.createElement(Je,{key:"pc",feature:t[d.FabricFeature.RealizingCountdown],disabled:l})),c.createElement(Ft,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.w,null)," Perturb"),c.createElement(Se.a,{className:"w-100"},c.createElement(we.a,{disabled:F.stage!==d.Stage.Realized,onClick:function(){return n.instance.fabric.set_altitude(1)}},c.createElement(Ee.A,null)," Nudge"),c.createElement(we.a,{disabled:F.stage!==d.Stage.Realized,onClick:function(){return n.instance.fabric.set_altitude(10)}},c.createElement(Ee.H,null)," Drop"),c.createElement(we.a,{disabled:l,onClick:function(){return n.instance.fabric.centralize()}},c.createElement(Ee.p,null)," Centralize"))),c.createElement(Ft,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.L,null)," Take"),c.createElement(Se.a,{vertical:!1,className:"w-100"},c.createElement(we.a,{onClick:function(){return wt(n,i.getValue())}},c.createElement(Ee.q,null)," Download CSV ",c.createElement(Ee.v,null)),c.createElement(we.a,{onClick:function(){return function(e,t){var n=e.getFabricOutput(t),r=new bt.a;r.file("pretenst-".concat(yt(),".json"),JSON.stringify(n,void 0,2)),r.generateAsync({type:"blob",mimeType:"application/zip"}).then((function(e){gt.saveAs(e,"pretenst-".concat(yt(),".zip"))}))}(n,i.getValue())}},c.createElement(Ee.q,null)," Download JSON ",c.createElement(Ee.u,null)))))}var Pt="25em";function Ot(e){var t=e.floatFeatures,n=e.rootTenscript,r=e.setRootTenscript,a=e.shapeSelection,i=e.setShapeSelection,o=e.selectedFaces,s=e.clearSelectedFaces,l=e.selectedIntervals,u=e.tensegrity,f=e.setFabric,d=e.runTenscript,h=e.visibleRoles,m=e.setVisibleRoles,p=e.toFullScreen,g=e.storedState$,v=Object(c.useState)(u?u.life:void 0),b=Object(be.a)(v,2),E=b[0],y=b[1];Object(c.useEffect)((function(){var e=u?u.life$.subscribe(y):void 0;return function(){e&&e.unsubscribe()}}),[u]);var w=Object(c.useState)(g.getValue().controlTab),S=Object(be.a)(w,2),P=S[0],O=S[1];function F(e){var t=e.tab;return c.createElement(Me.a,null,c.createElement(Ie.a,{active:P===t,onClick:function(){return g.next(se(g.getValue(),{controlTab:t}))}},t))}function N(e){var p=e.tab,v=c.createElement(Ae.a,{color:"warning"},"No fabric");return c.createElement(_e.a,{id:"tab-pane",style:{height:"100%"},tabId:p},c.createElement((function(){switch(p){case ee.Grow:return c.createElement(mt,{rootTenscript:n,setRootTenscript:r,tensegrity:u,runTenscript:d,storedState$:g});case ee.Shape:return u?c.createElement(et,{floatFeatures:t,tensegrity:u,setFabric:f,selectedIntervals:l,shapeSelection:a,setShapeSelection:i,selectedFaces:o,clearSelectedFaces:s,storedState$:g}):v;case ee.Realize:return u?c.createElement(tt,{floatFeatures:t,tensegrity:u,shapeSelection:a,storedState$:g}):v;case ee.View:return u?c.createElement(St,{floatFeatures:t,tensegrity:u,visibleRoles:h,setVisibleRoles:m,storedState$:g}):v;case ee.Strain:return u?c.createElement(st,{floatFeatures:t,tensegrity:u,storedState$:g}):v}}),null))}return Object(c.useEffect)((function(){P!==ee.Shape&&s()}),[P,E]),Object(c.useEffect)((function(){var e=g.subscribe((function(e){return O(e.controlTab)}));return function(){return e.unsubscribe()}}),[]),c.createElement("div",{className:"h-100"},c.createElement(Le.a,{tabs:!0,style:{backgroundColor:"#b2b2b2"}},Object.keys(ee).map((function(e){return c.createElement(F,{key:"T".concat(e),tab:ee[e]})}))),c.createElement(De.a,{style:{flex:1,flexFlow:"auto",height:"100%"},id:"tab-content",activeTab:P},Object.keys(ee).map((function(e){return c.createElement(N,{key:e,tab:ee[e]})}))),c.createElement("div",{style:{position:"absolute",top:0,height:"100%",left:Pt,zIndex:10,width:"1em"}},c.createElement((function(){return c.createElement(we.a,{style:{padding:0,margin:0,borderRadius:0,width:"1em"},className:"w-100 h-100",color:"dark",onClick:p},c.createElement(Ee.c,null))}),null)))}function Ft(e){var t=e.children,n=e.height;return c.createElement("div",{className:"m-3 p-2",style:{height:n,borderRadius:"1em",borderStyle:"solid",borderWidth:"0.1em",borderColor:"#45782e"}},t)}var Nt=n(612),kt=n(610),jt=n(611),xt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},Ct={type:"change"},Vt={type:"start"},Rt={type:"end"},Tt=function(e){function t(e,n){var r;return Object(u.a)(this,t),(r=Object(Nt.a)(this,Object(kt.a)(t).call(this))).object=void 0,r.element=void 0,r.window=void 0,r.enabled=void 0,r.target=void 0,r.enableZoom=void 0,r.zoomSpeed=void 0,r.minDistance=void 0,r.maxDistance=void 0,r.enableRotate=void 0,r.rotateSpeed=void 0,r.enablePan=void 0,r.keyPanSpeed=void 0,r.autoRotate=void 0,r.autoRotateSpeed=void 0,r.minZoom=void 0,r.maxZoom=void 0,r.minPolarAngle=void 0,r.maxPolarAngle=void 0,r.minAzimuthAngle=void 0,r.maxAzimuthAngle=void 0,r.keys=void 0,r.mouseButtons=void 0,r.enableDamping=void 0,r.dampingFactor=void 0,r.spherical=void 0,r.sphericalDelta=void 0,r.scale=void 0,r.target0=void 0,r.position0=void 0,r.zoom0=void 0,r.state=void 0,r.panOffset=void 0,r.zoomChanged=void 0,r.rotateStart=void 0,r.rotateEnd=void 0,r.rotateDelta=void 0,r.panStart=void 0,r.panEnd=void 0,r.panDelta=void 0,r.dollyStart=void 0,r.dollyEnd=void 0,r.dollyDelta=void 0,r.updateLastPosition=void 0,r.updateOffset=void 0,r.updateQuat=void 0,r.updateLastQuaternion=void 0,r.updateQuatInverse=void 0,r.panLeftV=void 0,r.panUpV=void 0,r.panInternalOffset=void 0,r.onMouseUp=void 0,r.onMouseDown=void 0,r.onMouseMove=void 0,r.onMouseWheel=void 0,r.onTouchStart=void 0,r.onTouchEnd=void 0,r.onTouchMove=void 0,r.object=e,r.element=n,r.window=window,r.enabled=!0,r.target=new P.Vector3,r.minDistance=0,r.maxDistance=1/0,r.minZoom=0,r.maxZoom=1/0,r.minPolarAngle=0,r.maxPolarAngle=Math.PI,r.minAzimuthAngle=-1/0,r.maxAzimuthAngle=1/0,r.enableDamping=!1,r.dampingFactor=.25,r.enableZoom=!0,r.zoomSpeed=1,r.enableRotate=!0,r.rotateSpeed=1,r.enablePan=!0,r.keyPanSpeed=7,r.autoRotate=!1,r.autoRotateSpeed=2,r.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},r.mouseButtons={ORBIT:P.MOUSE.LEFT,ZOOM:P.MOUSE.MIDDLE,PAN:P.MOUSE.RIGHT},r.target0=r.target.clone(),r.position0=r.object.position.clone(),r.zoom0=r.object.zoom,r.updateOffset=new P.Vector3,r.updateQuat=(new P.Quaternion).setFromUnitVectors(r.object.up,new P.Vector3(0,1,0)),r.updateQuatInverse=r.updateQuat.clone().inverse(),r.updateLastPosition=new P.Vector3,r.updateLastQuaternion=new P.Quaternion,r.state=xt.NONE,r.scale=1,r.spherical=new P.Spherical,r.sphericalDelta=new P.Spherical,r.panOffset=new P.Vector3,r.zoomChanged=!1,r.rotateStart=new P.Vector2,r.rotateEnd=new P.Vector2,r.rotateDelta=new P.Vector2,r.panStart=new P.Vector2,r.panEnd=new P.Vector2,r.panDelta=new P.Vector2,r.dollyStart=new P.Vector2,r.dollyEnd=new P.Vector2,r.dollyDelta=new P.Vector2,r.panLeftV=new P.Vector3,r.panUpV=new P.Vector3,r.panInternalOffset=new P.Vector3,r.onMouseDown=function(e){if(e.preventDefault(),r.enabled){if(e.button===r.mouseButtons.ORBIT){if(!r.enableRotate)return;r.rotateStart.set(e.clientX,e.clientY),r.state=xt.ROTATE}else if(e.button===r.mouseButtons.ZOOM){if(!r.enableZoom)return;r.dollyStart.set(e.clientX,e.clientY),r.state=xt.DOLLY}else if(e.button===r.mouseButtons.PAN){if(!r.enablePan)return;r.panStart.set(e.clientX,e.clientY),r.state=xt.PAN}r.state!==xt.NONE&&(document.addEventListener("mousemove",r.onMouseMove,!1),document.addEventListener("mouseup",r.onMouseUp,!1),r.dispatchEvent(Vt))}},r.onMouseMove=function(e){if(e.preventDefault(),r.enabled)if(r.state===xt.ROTATE){if(!r.enableRotate)return;r.rotateEnd.set(e.clientX,e.clientY),r.rotateDelta.subVectors(r.rotateEnd,r.rotateStart),r.rotateLeft(2*Math.PI*r.rotateDelta.x/r.element.clientWidth*r.rotateSpeed),r.rotateUp(2*Math.PI*r.rotateDelta.y/r.element.clientHeight*r.rotateSpeed),r.rotateStart.copy(r.rotateEnd),r.update()}else if(r.state===xt.DOLLY){if(!r.enableZoom)return;r.dollyEnd.set(e.clientX,e.clientY),r.dollyDelta.subVectors(r.dollyEnd,r.dollyStart),r.dollyDelta.y>0?r.dollyIn(r.getZoomScale()):r.dollyDelta.y<0&&r.dollyOut(r.getZoomScale()),r.dollyStart.copy(r.dollyEnd),r.update()}else if(r.state===xt.PAN){if(!r.enablePan)return;r.panEnd.set(e.clientX,e.clientY),r.panDelta.subVectors(r.panEnd,r.panStart),r.pan(r.panDelta.x,r.panDelta.y),r.panStart.copy(r.panEnd),r.update()}},r.onMouseUp=function(e){e.preventDefault(),r.enabled&&(document.removeEventListener("mousemove",r.onMouseMove,!1),document.removeEventListener("mouseup",r.onMouseUp,!1),r.dispatchEvent(Rt),r.state=xt.NONE)},r.onMouseWheel=function(e){e.preventDefault(),r.enabled&&r.enableZoom&&(r.state===xt.NONE||r.state===xt.ROTATE)&&(e.stopPropagation(),e.deltaY<0?r.dollyOut(r.getZoomScale()):e.deltaY>0&&r.dollyIn(r.getZoomScale()),r.update(),r.dispatchEvent(Vt),r.dispatchEvent(Rt))},r.onTouchStart=function(e){if(e.preventDefault(),r.enabled){switch(e.touches.length){case 1:if(!r.enableRotate)return;r.rotateStart.set(e.touches[0].pageX,e.touches[0].pageY),r.state=xt.TOUCH_ROTATE;break;case 2:if(!r.enableZoom)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);r.dollyStart.set(0,a),r.state=xt.TOUCH_DOLLY;break;case 3:if(!r.enablePan)return;r.panStart.set(e.touches[0].pageX,e.touches[0].pageY),r.state=xt.TOUCH_PAN;break;default:r.state=xt.NONE}r.state!==xt.NONE&&r.dispatchEvent(Vt)}},r.onTouchMove=function(e){if(e.preventDefault(),r.enabled)switch(e.touches.length){case 1:if(!r.enableRotate)return;if(r.state!==xt.TOUCH_ROTATE)return;r.rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY),r.rotateDelta.subVectors(r.rotateEnd,r.rotateStart),r.rotateLeft(2*Math.PI*r.rotateDelta.x/r.element.clientWidth*r.rotateSpeed),r.rotateUp(2*Math.PI*r.rotateDelta.y/r.element.clientHeight*r.rotateSpeed),r.rotateStart.copy(r.rotateEnd),r.update();break;case 2:if(!r.enableZoom)return;if(r.state!==xt.TOUCH_DOLLY)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);r.dollyEnd.set(0,a),r.dollyDelta.subVectors(r.dollyEnd,r.dollyStart),r.dollyDelta.y>0?r.dollyOut(r.getZoomScale()):r.dollyDelta.y<0&&r.dollyIn(r.getZoomScale()),r.dollyStart.copy(r.dollyEnd),r.update();break;case 3:if(!r.enablePan)return;if(r.state!==xt.TOUCH_PAN)return;r.panEnd.set(e.touches[0].pageX,e.touches[0].pageY),r.panDelta.subVectors(r.panEnd,r.panStart),r.pan(r.panDelta.x,r.panDelta.y),r.panStart.copy(r.panEnd),r.update();break;default:r.state=xt.NONE}},r.onTouchEnd=function(e){e.preventDefault(),r.enabled&&(r.dispatchEvent(Rt),r.state=xt.NONE)},r.element.addEventListener("mousedown",r.onMouseDown,{capture:!0}),r.element.addEventListener("wheel",r.onMouseWheel,{capture:!0}),r.element.addEventListener("touchstart",r.onTouchStart,{capture:!0}),r.element.addEventListener("touchend",r.onTouchEnd,{capture:!0}),r.element.addEventListener("touchmove",r.onTouchMove,{capture:!0}),r.update(),r}return Object(jt.a)(t,e),Object(f.a)(t,[{key:"update",value:function(){var e=this.object.position;return this.updateOffset.copy(e).sub(this.target),this.updateOffset.applyQuaternion(this.updateQuat),this.spherical.setFromVector3(this.updateOffset),this.autoRotate&&this.state===xt.NONE&&this.rotateLeft(this.getAutoRotationAngle()),this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi,this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),this.target.add(this.panOffset),this.updateOffset.setFromSpherical(this.spherical),this.updateOffset.applyQuaternion(this.updateQuatInverse),e.copy(this.target).add(this.updateOffset),this.object.lookAt(this.target),this.enableDamping?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor):this.sphericalDelta.set(0,0,0),this.scale=1,this.panOffset.set(0,0,0),!!(this.zoomChanged||this.updateLastPosition.distanceToSquared(this.object.position)>1e-6||8*(1-this.updateLastQuaternion.dot(this.object.quaternion))>1e-6)&&(this.dispatchEvent(Ct),this.updateLastPosition.copy(this.object.position),this.updateLastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0)}},{key:"panLeft",value:function(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}},{key:"panUp",value:function(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}},{key:"pan",value:function(e,t){var n=this.element,r=this.object.position;this.panInternalOffset.copy(r).sub(this.target);var a=this.panInternalOffset.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*a/n.clientHeight,this.object.matrix),this.panUp(2*t*a/n.clientHeight,this.object.matrix)}},{key:"dollyIn",value:function(e){this.scale/=e}},{key:"dollyOut",value:function(e){this.scale*=e}},{key:"getAutoRotationAngle",value:function(){return 2*Math.PI/60/60*this.autoRotateSpeed}},{key:"getZoomScale",value:function(){return Math.pow(.95,this.zoomSpeed)}},{key:"rotateLeft",value:function(e){this.sphericalDelta.theta-=e}},{key:"rotateUp",value:function(e){this.sphericalDelta.phi-=e}},{key:"getPolarAngle",value:function(){return this.spherical.phi}},{key:"getAzimuthalAngle",value:function(){return this.spherical.theta}},{key:"dispose",value:function(){this.element.removeEventListener("mousedown",this.onMouseDown,!1),this.element.removeEventListener("wheel",this.onMouseWheel,!1),this.element.removeEventListener("touchstart",this.onTouchStart,!1),this.element.removeEventListener("touchend",this.onTouchEnd,!1),this.element.removeEventListener("touchmove",this.onTouchMove,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1)}},{key:"reset",value:function(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Ct),this.update(),this.state=xt.NONE}}]),t}(P.EventDispatcher),Mt=[new P.Vector3(0,0,-20),new P.Vector3(-17.32,0,-10),new P.Vector3(-17.32,0,10),new P.Vector3(0,0,20),new P.Vector3(17.32,0,10),new P.Vector3(17.32,0,-10)],It=new P.Color("tan"),At=6,_t=new P.Vector3(0,1,0),Lt=.03;function Dt(){var e=Object(c.useMemo)((function(){return function(){var e=new P.Geometry;return function(e,t){e.push.apply(e,Object(w.a)(Mt.map((function(e){return new P.Vector3(e.x,e.y,e.z)})))),e.push(new P.Vector3);for(var n=0;n<At;n++){var r=(n+1)%At,a=[_t,(new P.Vector3).add(_t).addScaledVector(Mt[n],Lt).normalize(),(new P.Vector3).add(_t).addScaledVector(Mt[r],Lt).normalize()];t.push(new P.Face3(At,n,r,a,It))}}(e.vertices,e.faces),e.vertices.forEach((function(e){return e.sub(new P.Vector3(0,.01,0))})),e.computeBoundingSphere(),e}()}),[]);return c.createElement("mesh",{name:"Spots",geometry:e,material:Ye})}Object(ye.b)({Orbit:Tt});var zt=new P.SphereGeometry(1,32,8),Bt=new P.CylinderGeometry(1,1,1,12,1,!1),Yt=new P.CylinderGeometry(.5,.5,1,6,1,!1),Zt=new P.CylinderGeometry(1,1,.85,12,1,!1),Xt=new P.Color("#ffffff"),Ut=100,$t=1,Gt=new P.SphereGeometry(Ut,25,25).scale($t,$t,$t),Wt=.01,Qt=4,Ht=new P.Vector3(0,1,0);function Jt(e){var t=e.tensegrity,n=e.fabricError,r=e.selectedIntervals,a=e.selectedFaces,i=e.setSelectedFaces,o=e.storedState$,s=e.shapeSelection,l=e.ellipsoids,u=e.visibleRoles,f=document.getElementById("view-container"),h=Object(c.useState)(0),m=Object(be.a)(h,2),p=m[0],g=m[1],v=Object(ye.d)().camera,b=Object(c.useMemo)((function(){var e=(new P.TextureLoader).load("space.jpg");return new P.MeshPhongMaterial({map:e,side:P.BackSide})}),[]),E=Object(c.useState)(t.life),y=Object(be.a)(E,2),S=y[0],O=y[1];Object(c.useEffect)((function(){var e=t.life$.subscribe(O);return function(){return e.unsubscribe()}}),[t]);var F=Object(c.useState)(o.getValue()),N=Object(be.a)(F,2),k=N[0],j=N[1];Object(c.useEffect)((function(){var e=o.subscribe((function(e){return j(e)}));return function(){return e.unsubscribe()}}),[]),Object(c.useEffect)((function(){x.current.autoRotate=k.rotating}),[k]);var x=Object(ye.e)((function(e){var t=new P.Vector3(0,Qt,0);v.position.set(t.x,Qt,t.z+4*Qt),v.lookAt(x.current.target),v.fov=60,v.far=2*Ut,v.near=.001,e.object=v,e.minPolarAngle=-.98*Math.PI/2,e.maxPolarAngle=.8*Math.PI,e.maxDistance=Ut*$t*.9,e.zoomSpeed=.5,e.enableZoom=!0,e.target.set(t.x,t.y,t.z),e.update()}),[]);return Object(ye.c)((function(){try{var e=t.instance,r=e.view,a=new P.Vector3(r.midpoint_x(),r.midpoint_y(),r.midpoint_z()),i=(new P.Vector3).subVectors(a,x.current.target).multiplyScalar(Wt);if(x.current.target.add(i),x.current.update(),!l&&s!==Re.Faces){var c=t.iterate();S.stage===d.Stage.Realizing&&c===d.Stage.Realized?setTimeout((function(){return t.toStage(d.Stage.Realized,{})})):c!==S.stage&&S.stage!==d.Stage.Realizing&&c!==d.Stage.Busy&&setTimeout((function(){return t.toStage(c,{})}))}g(e.fabric.age)}catch(o){n(o)}}),!0,[t,p,S,s,l]),c.createElement("group",null,c.createElement("orbit",{ref:x,args:[v,f]}),c.createElement("scene",null,l?c.createElement(en,{key:"ellipsoid",tensegrity:t,selectedIntervals:r,storedState:k,visibleRoles:u}):c.createElement(tn,{key:"lines",tensegrity:t,selectedIntervals:r,storedState:k}),s!==Re.Faces?void 0:c.createElement(nn,{key:"faces",tensegrity:t,stage:S.stage,selectFace:function(e){a.some((function(t){return t.index===e.index}))?i(a.filter((function(t){return t.index!==e.index}))):i([].concat(Object(w.a)(a),[e]))}}),a.map((function(e){return c.createElement(qt,{key:"Face".concat(e.index),tensegrity:t,face:e})})),c.createElement(Dt,null),c.createElement("mesh",{key:"space",geometry:Gt,material:b}),c.createElement("ambientLight",{color:Xt,intensity:.8}),c.createElement("directionalLight",{color:new P.Color("#FFFFFF"),intensity:2})))}function qt(e){e.tensegrity;var t=e.face,n=L(t.brick.scale)/8;return c.createElement("mesh",{geometry:zt,position:t.location(),material:$e,scale:new P.Vector3(n,n,n)})}function Kt(e){var t=e.tensegrity,n=e.interval,r=e.storedState,a=He(n.intervalRole);if((r.showPushes||r.showPulls)&&(a=function(e){var t=Math.floor(e*We.length);return We[t>=We.length?We.length-1:t]}(t.instance.floatView.strainNuances[n.index]),(!r.showPushes||!r.showPulls)&&(r.showPushes&&!n.isPush||r.showPulls&&n.isPush)))return c.createElement("group",null);var i=t.instance.floatView.linearDensities[n.index],o=r.featureValues[n.isPush?d.FabricFeature.PushRadius:d.FabricFeature.PullRadius].numeric*i,s=t.instance.unitVector(n.index),l=(new P.Quaternion).setFromUnitVectors(Ht,s),u=n.alpha.location().distanceTo(n.omega.location()),f=o*r.featureValues[d.FabricFeature.JointRadius].numeric,h=new P.Vector3(o,u+(n.isPush?2*-f:0),o),m=new P.Vector3(f,f,f);return c.createElement(c.Fragment,null,n.isPush?c.createElement(c.Fragment,null,c.createElement("mesh",{geometry:Yt,position:n.location(),rotation:(new P.Euler).setFromQuaternion(l),scale:h,material:a,matrixWorldNeedsUpdate:!0}),c.createElement("mesh",{geometry:Zt,position:n.location(),rotation:(new P.Euler).setFromQuaternion(l),scale:h,material:a,matrixWorldNeedsUpdate:!0}),c.createElement("mesh",{geometry:zt,position:n.alpha.location(),material:Ge,scale:m,matrixWorldNeedsUpdate:!0}),c.createElement("mesh",{geometry:zt,position:n.omega.location(),material:Ge,scale:m,matrixWorldNeedsUpdate:!0})):c.createElement("mesh",{geometry:Bt,position:n.location(),rotation:(new P.Euler).setFromQuaternion(l),scale:h,material:a,matrixWorldNeedsUpdate:!0}))}function en(e){var t=e.tensegrity,n=e.visibleRoles,r=e.selectedIntervals,a=e.storedState;return c.createElement("group",null,r.length>0?r.map((function(e){return c.createElement(Kt,{key:"SI".concat(e.index),tensegrity:t,interval:e,storedState:a})})):t.intervals.map((function(e){return n.indexOf(e.intervalRole)<0?void 0:c.createElement(Kt,{key:"I".concat(e.index),tensegrity:t,interval:e,storedState:a})})),"}")}function tn(e){var t=e.tensegrity,n=e.selectedIntervals,r=e.storedState;return c.createElement("group",null,c.createElement("lineSegments",{key:"lines",geometry:t.linesGeometry,material:Ze}),n.map((function(e){return c.createElement(Kt,{key:"SI".concat(e.index),tensegrity:t,interval:e,storedState:r})})))}function nn(e){var t=e.tensegrity,n=e.stage,r=e.selectFace,a=Object(ye.d)().raycaster,i=Object(c.useRef)(),o=Object(c.useState)(),s=Object(be.a)(o,2),l=s[0],u=s[1];return c.createElement("mesh",{key:"faces",ref:i,onPointerDown:function(e){return u(e)},onPointerUp:function(e){var c=i.current;if(!function(e){return e===d.Stage.Growing||e===d.Stage.Slack}(n)&&l&&c){var o=l.clientX-e.clientX,s=l.clientY-e.clientY;if(!(o*o+s*s>100)){var f=a.intersectObjects([c],!0).map((function(e){return e.faceIndex})).map((function(e){if(void 0!==e)return t.faces[e]})).reverse().pop();u(void 0),f&&r(f)}}},geometry:t.facesGeometry,material:Ue})}var rn="25em",an="26em";function cn(e){var t=function(){var e=location.hash.substring(1);try{return q((function(e){return console.error(e)}),!0,decodeURIComponent(e))}catch(t){console.error("Code error",t)}}();if(t)return t;var n=ce(e);return n.length>0?n[0]:te[0]}function on(e){var t=e.eig,n=e.floatFeatures,r=e.storedState$,a=Object(c.useMemo)((function(){return new Ne(t,100)}),[]),i=Object(c.useState)(),o=Object(be.a)(i,2),s=o[0],l=o[1],u=Object(c.useState)([]),f=Object(be.a)(u,2),h=f[0],m=f[1],g=Object(c.useState)([]),b=Object(be.a)(g,2),E=b[0],y=b[1];Object(c.useEffect)((function(){return m(E.reduce((function(e,t){var n=function(t){return!e.some((function(e){return t.index===e.index}))},r=t.pulls.filter(n),a=t.pushes.filter(n);return[].concat(Object(w.a)(e),Object(w.a)(a),Object(w.a)(r))}),[]))}),[E]);var S=Object(c.useState)((function(){return cn(r.getValue())})),P=Object(be.a)(S,2),O=P[0],F=P[1];Object(c.useEffect)((function(){0===location.hash.length&&(location.hash=O.code)}),[O]);var N=Object(c.useState)(p),k=Object(be.a)(N,2),j=k[0],x=k[1],C=Object(c.useState)(r.getValue().rotating),V=Object(be.a)(C,2),R=V[0],T=V[1],M=Object(c.useState)(Re.None),I=Object(be.a)(M,2),A=I[0],_=I[1],D=Object(c.useState)(r.getValue().fullScreen),z=Object(be.a)(D,2),B=z[0],Y=z[1],Z=Object(c.useState)(r.getValue().ellipsoids),X=Object(be.a)(Z,2),U=X[0],$=X[1];function G(e){if(a){location.hash=e.code,n[d.FabricFeature.ShapingPretenstFactor].percent=100,n[d.FabricFeature.ShapingDrag].percent=100,n[d.FabricFeature.ShapingStiffnessFactor].percent=100,r.next(se(r.getValue(),{ellipsoids:!1}));l(new Te((function(e){return function(e,t){if(t===d.IntervalRole.FacePull)throw new Error;return e[oe(t)].numeric}(n,e)}),(function(e){return r.getValue().featureValues[e].numeric}),a,e))}}function W(e){r.next(se(r.getValue(),{fullScreen:e}))}return Object(c.useEffect)((function(){return x(p)}),[U]),Object(c.useEffect)((function(){var e=r.subscribe((function(e){Y(e.fullScreen),$(e.ellipsoids),T(e.rotating),s&&(a.world.set_coloring(e.showPushes,e.showPulls),a.world.set_surface_character(e.surfaceCharacter))}));return function(){return e.unsubscribe()}}),[s]),Object(c.useEffect)((function(){var e=Object.keys(n).map((function(e){return n[e]})).map((function(e){return e.observable.subscribe((function(t){if(s){s.instance.applyFeature(e);var n=v(e.config.feature);void 0!==n&&s.intervals.filter((function(e){return e.intervalRole===n})).forEach((function(t){var n=e.numeric*L(t.scale);s.instance.fabric.change_rest_length(t.index,n,500)}))}}))}));return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[s]),Object(c.useEffect)((function(){var e=setTimeout((function(){s||G(O)}),200);return function(){return clearTimeout(e)}}),[O]),c.createElement(c.Fragment,null,B?c.createElement(we.a,{id:"to-full-screen",color:"dark",onClick:function(){return W(!1)}},c.createElement(Ee.d,null),c.createElement("br",null),c.createElement(Ee.Q,null),c.createElement("br",null),c.createElement(Ee.d,null)):c.createElement("div",{id:"left-side",style:{visibility:B?"collapse":"visible",width:rn}},c.createElement(Ot,{floatFeatures:n,rootTenscript:O,setRootTenscript:F,tensegrity:s,setFabric:l,selectedIntervals:h,shapeSelection:A,setShapeSelection:_,selectedFaces:E,clearSelectedFaces:function(){return y([])},runTenscript:G,toFullScreen:function(){return W(!0)},visibleRoles:j,setVisibleRoles:x,storedState$:r})),c.createElement("div",{style:{position:"absolute",left:B?0:an,right:0,height:"100%"}},s?c.createElement("div",{className:"h-100"},c.createElement(sn,{tensegrity:s}),c.createElement("div",{id:"bottom-middle"},c.createElement(Se.a,null,c.createElement(we.a,{color:U?"warning":"secondary",onClick:function(){return r.next(se(r.getValue(),{ellipsoids:!U}))}},c.createElement(Ee.j,null)),c.createElement(we.a,{color:A===Re.Faces?"warning":"secondary",disabled:U&&A===Re.None,onClick:function(){return _(A!==Re.Faces?Re.Faces:Re.None)}},c.createElement("span",null,c.createElement(Ee.z,null))),c.createElement(we.a,{color:R?"warning":"secondary",onClick:function(){return r.next(se(r.getValue(),{rotating:!R}))}},c.createElement(Ee.O,null)))),c.createElement("div",{id:"view-container",className:"h-100"},c.createElement(ye.a,{style:{backgroundColor:"black",borderStyle:"solid",borderColor:A===Re.Faces||U?"#f0ad4e":"black",cursor:A===Re.Faces?"pointer":"all-scroll",borderWidth:"2px"}},c.createElement(Jt,{tensegrity:s,fabricError:function(e){console.error(e);var t=s.tenscript;l(void 0),setTimeout((function(){return G(t)}),1e3)},selectedIntervals:h,selectedFaces:E,setSelectedFaces:y,shapeSelection:A,ellipsoids:U,visibleRoles:j,storedState$:r})))):c.createElement("div",{id:"tensegrity-view",className:"h-100"},c.createElement("div",{style:{position:"relative",top:"50%",left:"50%"}},c.createElement(we.a,{onClick:function(){return G(O)}},c.createElement("h6",null,O.name),c.createElement("h1",null,c.createElement(Ee.I,null)))))))}function sn(e){var t=e.tensegrity,n=Object(c.useState)(t.life),r=Object(be.a)(n,2),a=r[0],i=r[1];return Object(c.useEffect)((function(){var e=t.life$.subscribe(i);return function(){return e.unsubscribe()}}),[t]),c.createElement("div",{id:"top-middle"},c.createElement("span",null,d.Stage[a.stage])," ",c.createElement("i",null,'"',t.tenscript.name,'"'))}function ln(e){return un.apply(this,arguments)}function un(){return(un=Object(i.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=document.getElementById("root"),(r=new s.BehaviorSubject(ue(de,t.default_fabric_feature))).subscribe((function(e){return t=e,void localStorage.setItem(le,JSON.stringify(t));var t})),o.render(c.createElement(on,{eig:t,floatFeatures:me(r,t.default_fabric_feature),storedState$:r}),n),ge();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n.d(t,"startReact",(function(){return ln}))}}]);
//# sourceMappingURL=4.a28a572b.chunk.js.map