(window.webpackJsonppretenst=window.webpackJsonppretenst||[]).push([[5],{8:function(e,t,n){"use strict";n.r(t);var r,a=n(0),i=n.n(a),c=n(1),o=n(9),s=n(32),l=n(19),u=n(14),f=n(17),h=n(11),d=n(7),m=(new h.Vector3(1,0,0),new h.Vector3(0,0,1),new h.Vector3(0,1,0));!function(e){e[e.PushA=0]="PushA",e[e.PushB=1]="PushB",e[e.PullA=2]="PullA",e[e.PullB=3]="PullB",e[e.PullAA=4]="PullAA",e[e.PullBB=5]="PullBB",e[e.Radial=6]="Radial",e[e.Connector=7]="Connector",e[e.Distancer=8]="Distancer"}(r||(r={}));Object.keys(r).filter((function(e){return isNaN(parseInt(e,10))})).map((function(e){return r[e]}));function p(e){switch(e){case r.PushA:return 2.44948974278;case r.PushB:return 2.8025170768881464;case r.PullA:return 1;case r.PullB:return 1.732050807568877;case r.PullAA:return.5*p(r.PullA);case r.PullBB:return.5*p(r.PullB);default:throw new Error("Length for Role ".concat(r[e],"?"))}}var v=Object.keys(d.WorldFeature).filter((function(e){return isNaN(parseInt(e,10))})).map((function(e){return d.WorldFeature[e]}));function g(e){switch(e){case r.PushA:return"[A]";case r.PushB:return"[B]";case r.PullA:return"(a)";case r.PullB:return"(b)";case r.PullAA:return"(aa)";case r.PullBB:return"(bb)";default:return"?"}}var b,w=Object.keys(r).filter((function(e){switch(r[e]){case r.PushA:case r.PushB:case r.PullA:case r.PullB:case r.PullAA:case r.PullBB:return!0;default:return!1}})).map((function(e){return r[e]}));function y(e){switch(e){case r.PushA:case r.PushB:return!0}return!1}function E(e){var t=e.toExponential(3),n=t.indexOf("e+0");return n>0?t.substring(0,n):Math.max(t.indexOf("e-1"),t.indexOf("e-2"))>0?e.toFixed(3):Math.max(t.indexOf("e+1"),t.indexOf("e+2"),t.indexOf("e+3"))>0?e.toFixed(1):t}function k(e,t){return(new h.Vector3).subVectors(e,t).normalize()}function S(e){var t=new h.Vector3;return e.forEach((function(e){return t.add(e)})),t.multiplyScalar(1/e.length)}function j(e,t,n){var r=3*t;return n?(n.set(e[r],e[r+1],e[r+2]),n):new h.Vector3(e[r],e[r+1],e[r+2])}!function(e){e.Design="design",e.Gotchi="gotchi",e.Sphere="sphere"}(b||(b={}));var O=function(){function e(t,n,r,a){var i=this;Object(u.a)(this,e),this.fabric=void 0,this.world=void 0,this.view=void 0,this.floatView=function(){var e=new Float32Array(0);return{jointCount:0,intervalCount:0,faceCount:0,lineGeometry:new h.BufferGeometry,faceGeometry:new h.BufferGeometry,jointLocations:e,unitVectors:e,idealLengths:e,strains:e,strainLimits:new Float32Array(4),strainNuances:e,stiffnesses:e,linearDensities:e}}(),this.adoptFabric=void 0,this.midpoint=new h.Vector3(0,0,0),this.forward=new h.Vector3(1,0,0),this.right=new h.Vector3(0,0,1),this.left=new h.Vector3(0,0,-1),this.valuesToApply=[],this.fabricBackup=void 0,this.world=r,this.adoptFabric=function(e){return i.free(),i.fabric=e,i.view=t.View.on_fabric(e),i},this.adoptFabric(a||t.Fabric.new(n))}return Object(f.a)(e,[{key:"iterate",value:function(){var e=this.fabric.iterate(this.world);this.refreshFloatView();var t=this.valuesToApply.shift();return t&&this.world.set_float_value(t.feature,t.value),e}},{key:"showFrozen",value:function(e){this.updateFloatView(!0,e)}},{key:"snapshot",value:function(){console.log("snapshot"),this.fabricBackup=this.fabricClone}},{key:"restoreSnapshot",value:function(){console.log("restoreSnapshot");var e=this.fabricBackup;if(!e)throw new Error("Missing backup");this.adoptFabric(e.clone())}},{key:"refreshFloatView",value:function(){this.view.render(this.fabric,this.world),this.midpoint.set(this.view.midpoint_x(),this.view.midpoint_y(),this.view.midpoint_z()),this.updateFloatView(!1,!1)}},{key:"clear",value:function(){return this.fabric.clear(),this.refreshFloatView(),this}},{key:"applyFeature",value:function(e,t,n){this.valuesToApply.push({feature:e,percent:t,value:n})}},{key:"jointLocation",value:function(e){return j(this.floatView.jointLocations,e)}},{key:"apply",value:function(e){this.fabric.apply_matrix4(new Float32Array(e.toArray())),this.refreshFloatView()}},{key:"unitVector",value:function(e){return j(this.floatView.unitVectors,e)}},{key:"free",value:function(){var e=this.fabric;e&&e.free();var t=this.view;t&&t.free()}},{key:"updateFloatView",value:function(e,t){var n=this.fabric,r=this.view,a=n.get_joint_count(),i=n.get_interval_count(),c=n.get_face_count(),o=this.floatView;if(o.jointCount!==a||o.intervalCount!==i||o.faceCount!==c){o.jointCount=a,o.intervalCount=i,o.faceCount=c,o.lineGeometry.dispose(),o.lineGeometry=new h.BufferGeometry;var s=new Float32Array(3*i*2);r.copy_line_locations_to(s),o.lineGeometry.setAttribute("position",new h.Float32BufferAttribute(s,3));var l=new Float32Array(3*i*2);if(e)if(t){l.fill(0);for(var u=1;u<l.length;u+=3)l[u]=1}else l.fill(1);else r.copy_line_colors_to(l);o.lineGeometry.setAttribute("color",new h.Float32BufferAttribute(l,3)),o.faceGeometry.dispose(),o.faceGeometry=new h.BufferGeometry;var f=new Float32Array(3*c*3);r.copy_face_vertex_locations_to(f),o.faceGeometry.setAttribute("position",new h.Float32BufferAttribute(f,3));var d=new Float32Array(3*c*3);r.copy_face_normals_to(d),o.faceGeometry.setAttribute("normal",new h.Float32BufferAttribute(d,3)),o.jointLocations=new Float32Array(3*a),o.unitVectors=new Float32Array(3*i),o.idealLengths=new Float32Array(i),o.strains=new Float32Array(i),o.strainNuances=new Float32Array(i),o.stiffnesses=new Float32Array(i),o.linearDensities=new Float32Array(i)}else{var p=this.floatView.lineGeometry.attributes,v=this.floatView.faceGeometry.attributes;if(p.position){var g=p.position;r.copy_line_locations_to(g.array),g.needsUpdate=!0;var b=p.color,w=b.array;if(e)if(t){w.fill(0);for(var y=1;y<w.length;y+=3)w[y]=1}else w.fill(1);else r.copy_line_colors_to(w);b.needsUpdate=!0;var E=v.position;r.copy_face_vertex_locations_to(E.array),E.needsUpdate=!0;var k=v.normal;r.copy_face_normals_to(k.array),k.needsUpdate=!0}}r.copy_joint_locations_to(o.jointLocations),r.copy_unit_vectors_to(o.unitVectors),r.copy_ideal_lengths_to(o.idealLengths),r.copy_strains_to(o.strains),r.copy_strain_limits_to(o.strainLimits),r.copy_strain_nuances_to(o.strainNuances),r.copy_stiffnesses_to(o.stiffnesses),r.copy_linear_densities_to(o.linearDensities);var S=o.jointLocations;!function(e,t,n){var r=3*e,a=3*t;n.set(S[a]-S[r],S[a+1]-S[r+1],S[a+2]-S[r+2])}(2,1,this.forward),this.forward.y=0,this.forward.normalize(),this.right.crossVectors(this.forward,m).normalize(),this.left.set(0,0,0).sub(this.right)}},{key:"stage",get:function(){return this.fabric.get_stage()},set:function(e){this.fabric.request_stage(e,this.world)||console.error("Could not move to stage ".concat(e,"!"))}},{key:"fabricClone",get:function(){return this.fabric.clone()}}]),e}();var P=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function x(){if("serviceWorker"in navigator){if(new URL("/app",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/app","/service-worker.js");P?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):F(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):F(e)}))}}function F(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var A,C=n(10),V=n(129),_=n(24),B=n(15),R=n(78);!function(e){e.Left="Left",e.Right="Right",e.LeftRight="Left-Right",e.RightLeft="Right-Left"}(A||(A={}));var L;A.Left,A.Right,A.LeftRight,A.RightLeft;!function(e){e[e.a=0]="a",e[e.B=1]="B",e[e.C=2]="C",e[e.D=3]="D",e[e.b=4]="b",e[e.c=5]="c",e[e.d=6]="d",e[e.A=7]="A"}(L||(L={}));var M,T=[L.a,L.B,L.C,L.D,L.b,L.c,L.d,L.A];function N(e){return"aBCDbcdA".indexOf(e)>=0}function z(e){var t="aBCDbcdA".indexOf(e);if(t<0)throw new Error("[".concat(e,"] is not a face name"));return T[t]}function D(e){var t=e.push;if(!t)throw new Error("Expected push");return t}function I(e){var t=e.pulls;if(!t)throw new Error("no pulls");return t}function W(e){var t=e.instance,n=e.index;return t.jointLocation(n)}function G(e,t){return W(e).distanceTo(W(t))}function J(e,t){return n=e.index,r=t.index,n<r?"(".concat(n,",").concat(r,")"):"(".concat(r,",").concat(n,")");var n,r}function U(e){return J(e.alpha,e.omega)}function $(e){return function(t){return t.intervalRole===e}}function q(e){var t=e.alpha,n=e.omega;return W(t).add(W(n)).multiplyScalar(.5)}function H(e){return G(e.alpha,e.omega)}function Y(e,t,n){var r=e.alpha.instance.floatView,a={stiffness:r.stiffnesses[e.index]*(y(e.intervalRole)?t:1),strain:r.strains[e.index],length:H(e),idealLength:r.idealLengths[e.index]*(y(e.intervalRole)?1+n:1),linearDensity:r.linearDensities[e.index]};return e.stats=a,a}function K(e){var t=e.stats;if(!t)throw new Error;return t}function Q(e,t){return function(n){var r=n.alpha,a=n.omega;return r.index===e.index&&a.index===t.index||a.index===e.index&&r.index===t.index}}function X(e){if(!e.push)throw new Error("No push");var t=e.push;if(t.alpha.index===e.index)return t.omega;if(t.omega.index===e.index)return t.alpha;throw new Error("Big problem")}function Z(e,t){if(t.alpha.index===e.index)return t.omega;if(t.omega.index===e.index)return t.alpha;throw new Error("No other joint")}function ee(e){return S(e.ends.map(W))}function te(e){return e.reduce((function(e,t){return e.add(ee(t))}),new h.Vector3).multiplyScalar(1/e.length)}function ne(e){return e||{_:100}}function re(e){return e._/100}function ae(e){return{_:100*e}}function ie(){return{faces:[],intervals:[],joints:[]}}!function(e){e.None="None",e.Face="Face",e.Pulls="Pulls",e.Pushes="Pushes",e.Both="Both"}(M||(M={}));var ce,oe=function(){function e(t,n,r,a){Object(u.a)(this,e),this.tensegrity=t,this.spin=n,this.scale=r,this.faces=[],this.pushes=[],this.pulls=[];var i=a?3===a.length?a:le(a[0],3):le(new h.Vector3,3);switch(this.spin){case A.Left:this.createSingle(i,!0);break;case A.Right:this.createSingle(i,!1);break;case A.LeftRight:this.createDouble(i,!0);break;case A.RightLeft:this.createDouble(i,!1);break;default:throw new Error("Spin?")}}return Object(f.a)(e,[{key:"face",value:function(e){switch(this.faces.length){case 2:switch(e){case L.a:return this.faces[0];case L.A:return this.faces[1]}break;case 8:switch(e){case L.a:return this.faces[0];case L.B:return this.faces[2];case L.C:return this.faces[1];case L.D:return this.faces[3];case L.b:return this.faces[4];case L.c:return this.faces[5];case L.d:return this.faces[6];case L.A:return this.faces[7]}}throw new Error("Face ".concat(L[e]," not found in twist with ").concat(this.faces.length," faces"))}},{key:"createSingle",value:function(e,t){var n=this,a=se(e,this.scale,t),i=a.map((function(e){var t=e.alpha,r=e.omega;return{alpha:n.tensegrity.createJoint(t),omega:n.tensegrity.createJoint(r)}})),c=this.tensegrity.createJoint(S(a.map((function(e){return e.alpha})))),o=this.tensegrity.createJoint(S(a.map((function(e){return e.omega}))));this.tensegrity.instance.refreshFloatView(),i.forEach((function(e){var t=e.alpha,a=e.omega,i=n.tensegrity.createInterval(t,a,r.PushA,n.scale);n.pushes.push(i),t.push=a.push=i}));var s=function(e,t){var a,i=e.map((function(e){return n.tensegrity.createInterval(e,t,r.PullA,n.scale)}));(a=n.pulls).push.apply(a,Object(B.a)(i)),n.faces.push(n.tensegrity.createFace(e,i,n.spin,n.scale,t))};s(i.map((function(e){return e.alpha})),c),s(i.map((function(e){return e.omega})).reverse(),o),i.forEach((function(e,a){var c=e.alpha,o=i[(i.length+a+(t?-1:1))%i.length].omega;n.pulls.push(n.tensegrity.createInterval(c,o,r.PullB,n.scale))}))}},{key:"createDouble",value:function(e,t){var n=this,a=se(e,this.scale,t),i=se(a.map((function(e){return e.omega})),this.scale,!t),c=a.map((function(e){var t=e.alpha,r=e.omega;return{alpha:n.tensegrity.createJoint(t),omega:n.tensegrity.createJoint(r)}})),o=i.map((function(e){var t=e.alpha,r=e.omega;return{alpha:n.tensegrity.createJoint(t),omega:n.tensegrity.createJoint(r)}}));this.tensegrity.instance.refreshFloatView(),[].concat(Object(B.a)(c),Object(B.a)(o)).forEach((function(e){var t=e.alpha,a=e.omega,i=n.tensegrity.createInterval(t,a,r.PushB,n.scale);n.pushes.push(i),t.push=a.push=i}));var s=t?[[c[0].alpha,c[1].alpha,c[2].alpha],[c[2].alpha,c[1].omega,o[1].alpha],[c[0].alpha,c[2].omega,o[2].alpha],[c[1].alpha,c[0].omega,o[0].alpha],[o[1].omega,o[0].alpha,c[1].omega].reverse(),[o[2].omega,o[1].alpha,c[2].omega].reverse(),[o[0].omega,o[2].alpha,c[0].omega].reverse(),[o[0].omega,o[1].omega,o[2].omega].reverse()]:[[c[0].alpha,c[1].alpha,c[2].alpha],[c[2].alpha,c[0].omega,o[2].alpha].reverse(),[c[0].alpha,c[1].omega,o[0].alpha].reverse(),[c[1].alpha,c[2].omega,o[1].alpha].reverse(),[o[1].omega,o[2].alpha,c[2].omega],[o[2].omega,o[0].alpha,c[0].omega],[o[0].omega,o[1].alpha,c[1].omega],[o[0].omega,o[1].omega,o[2].omega].reverse()],l=s.map((function(e){return n.tensegrity.createJoint(S(e.map(W)))}));this.tensegrity.instance.refreshFloatView(),s.forEach((function(e,a){var i,c=l[a],o=e.map((function(e){return n.tensegrity.createInterval(e,c,r.PullA,n.scale)}));(i=n.pulls).push.apply(i,Object(B.a)(o));var s=t===[0,4,5,6].some((function(e){return e===a}))?A.Left:A.Right;n.faces.push(n.tensegrity.createFace(e,o,s,n.scale,c))}))}}]),e}();function se(e,t,n){for(var r=[],a=S(e),i=function(){return(new h.Vector3).copy(a)},c=re(t),o=function(e){for(var t=S(e),n=e.map((function(e){return(new h.Vector3).copy(e).sub(t)})),r=new h.Vector3,a=0;a<n.length;a++){var i=n[a],c=n[(a+1)%n.length];r.add((new h.Vector3).crossVectors(i,c).normalize())}return r.normalize()}(e).multiplyScalar(-c),s=function(t){var s=function(n){return k(e[(t+e.length+n)%e.length],a)},l=function(e,t){return n=s(e),r=s(t),(new h.Vector3).addVectors(n,r).normalize();var n,r},u=i().addScaledVector(l(0,1),c),f=i().add(o).addScaledVector(n?l(1,2):l(-1,0),c);r.push({alpha:u,omega:f})},l=0;l<e.length;l++)s(l);return r}function le(e,t){for(var n=[],r=0;r<t;r++){var a=r*Math.PI*2/t,i=Math.cos(a),c=Math.sin(a);n.push(new h.Vector3(i,0,c).add(e))}return n}function ue(e,t){try{var n=de(e.code.join());return n?(n.root=!0,n):void t("Nothing to compile")}catch(r){return void t(r.message)}}function fe(e,t,n){var r=t.spin,a=t.marks;if(!n)throw new Error("Create bud with no tree");var i=-1===n.forward;return{tree:n,twist:new oe(e,r,ne(),[new h.Vector3]),marks:he(a),reorient:i}}function he(e){var t={};return e&&Object.keys(e).forEach((function(n){var r=e[n];if(r.startsWith("subtree")){var a=de(r.substring("subtree".length));t[n]={action:ce.Subtree,tree:a}}else if(r.startsWith("base"))t[n]={action:ce.Base};else if(r.startsWith("join"))t[n]={action:ce.Join};else if(r.startsWith("distance-")){var i={_:parseInt(r.split("-")[1],10)};t[n]={action:ce.Distance,scale:i}}else if(r.startsWith("anchor")){var c=r.match(/anchor-\(([0-9.-]*),([0-9.-]*)\)-(\d*)-(\d*)/);if(!c)throw new Error("Unrecognized mark code: [".concat(r,"]"));var o=parseFloat(c[1]),s=parseFloat(c[2]),l=parseFloat(c[3]),u={_:parseInt(c[4],10)},f=new h.Vector3(o,-l,s);t[n]={action:ce.Anchor,point:f,scale:u}}})),t}function de(e){var t=we(e,!0).content,n=-1,r=ne(),a={},i={};function c(e){var n=we(t.substring(e),!1),r=n.content,a=n.skip;return{codeTree:de(r),skip:a}}function o(e,t){var n=i[e],r={_:t};n?n.push(r):i[e]=[r]}for(var s=0;s<t.length;s++){var l=t.charAt(s);if(N(l)){var u=c(s+1),f=u.codeTree;if(!f)throw new Error("No subtree: ".concat(t.substring(s)));a[z(l)]=f,s+=u.skip}else if(ge(l)){var h=we(t,!1);n=be(h.content),s+=h.skip}else switch(l){case"S":var d=we(t.substring(s+1),!0);r={_:be(d.content)},s+=d.skip;break;case"M":var m=t.charAt(s+1),p=we(t.substring(s+2),!0);o(z(m),be(p.content)),s+=p.skip+1;break;case",":case" ":case"\n":break;default:throw new Error("Unexpected character: ".concat(l))}}return new ve(n,r,a,i).nonEmpty}function me(e,t,n,r,a){var i,c,o=e.twist,s=e.marks,l=o.face(n),u=r?function(e){switch(e){case A.Left:return A.RightLeft;case A.Right:return A.LeftRight;default:throw new Error("Omni of omni?")}}(l.spin):function(e){switch(e){case A.Left:return A.Right;case A.Right:return A.Left;case A.LeftRight:return A.RightLeft;case A.RightLeft:return A.LeftRight}}(l.spin),f=ae(re(l.scale)*re(a)),h=o.tensegrity.createTwistOn(l,u,f);return 0===t.forward&&(i=h,c=t,T.forEach((function(e){var t,n=c.faceMarks(e);n&&(t=i.face(e).marks).push.apply(t,Object(B.a)(n))}))),{tree:t,twist:h,marks:s,reorient:!1}}function pe(e){var t=[];return e.forEach((function(e){var n=e.tree,r=e.marks,a=e.reorient,i=e.twist;if(n.forward>0){var c=n.decremented,o=n.needsOmniTwist&&0===c.forward;t.push(me(e,c,L.A,o,n.scale))}else{if(a)if(![L.A,L.a,L.B,L.b].some((function(e){return!n.subtree(e)}))){var s=i.tensegrity.joints.map(W);i.tensegrity.instance.apply(function(e,t){var n=k(e[0],e[1]),r=k(e[3],e[2]),a=k(e[5],e[4]),i=e.reduce((function(e,t){return e.add(t)}),new h.Vector3).multiplyScalar(1/e.length),c=(new h.Matrix4).makeBasis(n,r,a).setPosition(i),o=(new h.Matrix4).makeRotationZ(-.24*Math.PI),s=(new h.Matrix4).makeRotationY(-t*Math.PI/3);return c.multiply(o).multiply(s).invert()}(s,0))}T.forEach((function(a){var i=n.subtree(a);if(i){var c=i.decremented,o=i.needsOmniTwist&&0===i.forward;t.push(me(e,c,a,o,i.scale))}else{var s=n.faceMarks(a);s&&s.forEach((function(i){var c=r[i._];if(c&&c.action===ce.Subtree){var o=c.tree;if(!o)throw new Error("Missing subtree");n.deleteMark(a);var s=o.needsOmniTwist;t.push(me(e,o,a,s,ne(o.scale)))}}))}}))}})),t}!function(e){e[e.Subtree=0]="Subtree",e[e.Base=1]="Base",e[e.Join=2]="Join",e[e.Distance=3]="Distance",e[e.Anchor=4]="Anchor",e[e.None=5]="None"}(ce||(ce={}));var ve=function(){function e(t,n,r,a){Object(u.a)(this,e),this.forward=t,this.scale=n,this.subtrees=r,this.marks=a,this.root=void 0}return Object(f.a)(e,[{key:"subtree",value:function(e){return this.subtrees[e]}},{key:"faceMarks",value:function(e){return this.marks[e]}},{key:"deleteMark",value:function(e){delete this.marks[e]}},{key:"nonEmpty",get:function(){return-1===this.forward&&0===this.subtreeCode.length&&0===this.markCode.length?void 0:this}},{key:"decremented",get:function(){return this.forward>0?new e(this.forward-1,this.scale,this.subtrees,this.marks):this}},{key:"needsOmniTwist",get:function(){var e=this,t=T.filter((function(e){return e!==L.A&&e!==L.a}));return t.some((function(t){return e.subtrees[t]}))||t.some((function(t){return e.marks[t]}))}},{key:"code",get:function(){var e=this.forward>0,t=100!==this.scale._,n=this.subtreeCode,r=this.markCode;if(!this.root&&e&&!t&&0===n.length&&0===r.length)return this.forward.toString();var a=[];return e&&a.push(this.forward.toString()),t&&a.push("S".concat(this.scale._)),a.push.apply(a,Object(B.a)(n)),a.push.apply(a,Object(B.a)(r)),"(".concat(a.join(","),")")}},{key:"subtreeCode",get:function(){return Object.entries(this.subtrees).map((function(e){var t=Object(C.a)(e,2),n=t[0],r=t[1];return"".concat("aBCDbcdA"[n]).concat(r.code)}))}},{key:"markCode",get:function(){return Object.entries(this.marks).map((function(e){var t=Object(C.a)(e,2),n=t[0];return t[1].map((function(e){return"M".concat("aBCDbcdA"[n]).concat(e._)}))})).flat()}}]),e}();function ge(e){return"0123456789".indexOf(e)>=0}function be(e){if(!e.match(/^\d*$/))throw new Error("Not a number: ".concat(e));return 0===e.length?0:parseInt(e,10)}function we(e,t){var n=e.indexOf(","),r=n>=0;if("("!==e.charAt(0))return r?{content:e.substring(0,n),skip:n}:{content:e,skip:e.length};var a=function(e){if("("!==e.charAt(0))throw new Error('Code must start with "(": '.concat(e," ").concat(e.charAt(0)));for(var t=0,n=0;n<e.length;n++){var r=e.charAt(n);if("("===r)t++;else if(")"===r&&0===--t)return n}throw new Error("No matching end bracket: |".concat(e,"|"))}(e),i=t?e.substring(1,a):e.substring(0,a+1);return{content:i.length>0?i:"0",skip:a+1}}var ye,Ee,ke={},Se={},je=[{name:"Phi",spin:A.LeftRight,surfaceCharacter:d.SurfaceCharacter.Frozen,code:["()"],featureValues:ke,marks:Se},{name:"One",spin:A.Left,surfaceCharacter:d.SurfaceCharacter.Frozen,code:["(1)"],featureValues:ke,marks:Se},{name:"Axoneme",spin:A.Left,surfaceCharacter:d.SurfaceCharacter.Frozen,code:["(30,S95)"],featureValues:ke,marks:Se},{name:"Knee",spin:A.Left,surfaceCharacter:d.SurfaceCharacter.Frozen,code:["(3,b3)"],featureValues:ke,marks:Se},{name:"Jack",surfaceCharacter:d.SurfaceCharacter.Frozen,spin:A.LeftRight,code:["(a2,b2,c2,d2)"],featureValues:ke,marks:Se},{name:"Star",surfaceCharacter:d.SurfaceCharacter.Frozen,spin:A.LeftRight,code:["(a(15,S90),b(15,S90),c(15,S90),d(15,S90))"],featureValues:ke,marks:Se},{name:"Tripod with Knees",surfaceCharacter:d.SurfaceCharacter.Frozen,spin:A.RightLeft,code:["(A5,B(7,c(5,S90),S90),C(7,c(5,S90),S90),D(7,c(5,S90),S90))"],featureValues:ke,marks:Se},{name:"Pretenst Lander",surfaceCharacter:d.SurfaceCharacter.Bouncy,spin:A.LeftRight,code:["(B(15,S90,MA1),C(15,S90,MA1),D(15,S90,MA1))"],featureValues:ke,marks:{1:"distance-60"}},{name:"Zigzag",spin:A.LeftRight,surfaceCharacter:d.SurfaceCharacter.Frozen,code:["(d(3,MA1),c(7,b(7,d(7,d(7,d(7,d(3,MA1)))))))"],marks:{1:"join"},featureValues:ke},{name:"Bulge Ring",spin:A.Left,surfaceCharacter:d.SurfaceCharacter.Bouncy,code:["(A(15,S90,MA1), a(16,S90,MA1))"],marks:{1:"join"},featureValues:ke},{name:"Convergence",spin:A.LeftRight,surfaceCharacter:d.SurfaceCharacter.Frozen,code:["(a1,b(15,S92,MA1),c(15,S92,MA1),d(15,S92,MA1))"],marks:{1:"join"},featureValues:ke},{name:"Halo by Crane",spin:A.Left,surfaceCharacter:d.SurfaceCharacter.Frozen,code:["(5,S92,b(12,S92,MA1),d(11,S92,MA1))"],marks:{1:"join"},featureValues:ke},{name:"Thick Tripod",spin:A.LeftRight,surfaceCharacter:d.SurfaceCharacter.Frozen,code:["(A3,B(8,MA1),C(8,MA1),D(8,MA1))"],marks:{1:"distance-35"},featureValues:ke},{name:"Diamond",spin:A.RightLeft,surfaceCharacter:d.SurfaceCharacter.Frozen,code:["(","   a(5,","      b(5,b(5,b(2,MA3)),c(5,d(2,MA4))),","      c(5,b(5,b(2,MA1)),c(5,d(2,MA5))),","      d(5,b(5,b(2,MA6)),c(5,d(2,MA2)))","   ),","   b(5,b(5,b(2,MA2)),d(5,c(2,MA3))),","   c(5,b(5,b(2,MA5)),d(5,c(2,MA6))),","   d(5,b(5,b(2,MA4)),d(5,c(2,MA1)))",")"],marks:{1:"join",2:"join",3:"join",4:"join",5:"join",6:"join"},featureValues:ke},{name:"Composed Tree",spin:A.Left,surfaceCharacter:d.SurfaceCharacter.Frozen,code:["(6,b(4,MA1),c(4,MA1),d(4,MA1))"],marks:{1:"subtree(b5,c5,d5)"},featureValues:ke},{name:"Equus Lunae",spin:A.LeftRight,surfaceCharacter:d.SurfaceCharacter.Frozen,code:["(","  A(16,S95,Md0),","  b(16,S95,Mc0),","  a(16,S95,Mc0),","  B(16,S95,Md0)",")"],marks:{0:"distance-60"},featureValues:ke}].map((function(e){return ue(e,(function(t){throw new Error('Bootstrap compile error in "'.concat(e,'"! ').concat(t))})),e})),Oe=n(128);function Pe(e){var t=[],n=$(r.PullA),a=$(r.PullB),i=function(e,t){return function(e,t){return e.find((function(e){return t.find((function(t){return e.index===t.index}))}))}(I(e).filter(n).map((function(t){return Z(e,t)})),I(t).filter(n).map((function(e){return Z(t,e)})))};return e.withPulls((function(c){var o=function(e){var n=U(e);c[n]||(t.push(e),c[n]=e)},s=function(e){var t=function(e){var t=I(e).filter(a)[0],n=Z(e,t),c=X(e),o=Z(c,I(c).filter(a)[0]),s=i(e,o),l=i(n,c);if(s&&l){if(s.push&&!l.push){var u=X(n);if(!I(u).some(Q(s,u)))return}else if(l.push&&!s.push){var f=X(e);if(!I(f).some(Q(l,f)))return}return{alpha:s.push?s:e,omega:l.push?l:n,scale:t.scale,intervalRole:s.push&&l.push?r.PullBB:r.PullB}}}(e);t&&o(t)};e.intervals.filter($(r.PullB)).forEach((function(e){var t=e.alpha,n=e.omega;s(t),s(n)})),e.joints.filter((function(e){return e.push&&3===I(e).filter(n).length})).forEach((function(e){var t=I(e).filter(n).find((function(t){return!Z(e,t).push}));if(!t)throw new Error("no-push not found");var a=Z(e,t),i=I(e).filter(n).map((function(t){return Z(e,t)})).map((function(t){return{end:t,outwards:(new h.Vector3).subVectors(W(t),W(e)).normalize()}})),c=I(a).filter(n).map((function(e){return Z(a,e)})).map((function(t){return{end:t,outwards:(new h.Vector3).subVectors(W(t),W(e)).normalize()}}));i.map((function(e){var n=c.sort((function(t,n){return e.outwards.dot(n.outwards)-e.outwards.dot(t.outwards)}))[0],a=r.PullAA,i=t.scale,s={alpha:e.end,omega:n.end,scale:i,intervalRole:a};o(s)}))}))})),t}!function(e){e[e.NoOp=0]="NoOp",e[e.Faces=1]="Faces",e[e.Snelson=2]="Snelson",e[e.Bowtie=3]="Bowtie"}(ye||(ye={})),function(e){e[e.Bowtie=0]="Bowtie",e[e.Snelson=1]="Snelson"}(Ee||(Ee={}));var xe=function(){function e(t,n,r,a,i,c,o){Object(u.a)(this,e),this.location=t,this.scale=n,this.instance=r,this.countdown=a,this.postGrowthOperation=i,this.name=void 0,this.stage$=void 0,this.joints=[],this.intervals=[],this.connectors=[],this.distancers=[],this.faces=[],this.jobs=[],this.buds=void 0,this.marks={},this.instance.clear(),this.stage$=new Oe.a(this.fabric.get_stage()),this.marks=c.marks,this.name=c.name,this.buds=[fe(this,c,o)]}return Object(f.a)(e,[{key:"createJoint",value:function(e){var t={index:this.fabric.create_joint(e.x,e.y,e.z),instance:this.instance};return this.joints.push(t),t}},{key:"removeJoint",value:function(e){var t=e.index;this.fabric.remove_joint(t),this.joints=this.joints.filter((function(e){return e.index!==t})),e.index=-t,this.joints.forEach((function(e){return e.index=e.index>t?e.index-1:e.index})),this.instance.refreshFloatView()}},{key:"createRadialPull",value:function(e,t,n){var a=this,i=this.createJoint(ee(e)),c=this.createJoint(ee(t));this.instance.refreshFloatView();var o=this.creatAxis(i,c,n),s=e.ends.reduce((function(e,t){return e+G(i,t)}),0)/e.ends.length,l=t.ends.reduce((function(e,t){return e+G(c,t)}),0)/t.ends.length,u=e.ends.map((function(e){return a.createRay(i,e,s)})),f=t.ends.map((function(e){return a.createRay(c,e,l)})),h={alpha:e,omega:t,axis:o,alphaRays:u,omegaRays:f};switch(o.intervalRole){case r.Connector:this.connectors.push(h);break;case r.Distancer:this.distancers.push(h)}return h}},{key:"createInterval",value:function(e,t,n,r,a){var i=y(n),c=p(n)*re(r),o=0===c?0:G(e,t),s=void 0===a?1:a,l=this.countdown*Math.abs(c-o)*s,u=l<=0?0:1/l,f={index:this.fabric.create_interval(e.index,t.index,i,o,c,u),intervalRole:n,scale:r,alpha:e,omega:t,removed:!1};return this.intervals.push(f),f}},{key:"changeIntervalScale",value:function(e,t){e.scale=ae(re(e.scale)*t),this.fabric.multiply_rest_length(e.index,t,100)}},{key:"removeInterval",value:function(e){var t=e.index;this.intervals=this.intervals.filter((function(e){return e.index!==t})),this.fabric.remove_interval(t),this.intervals.forEach((function(e){e.index>t&&e.index--})),e.removed=!0}},{key:"createFace",value:function(e,t,n,r,a){var i=e[0],c=e[2],o=e[1],s=this.fabric.create_face(i.index,o.index,c.index),l=M.None,u={index:s,spin:n,scale:r,ends:e,pushes:[D(i),D(c),D(o)],pulls:t,faceSelection:l,marks:[],joint:a};return this.faces.push(u),u}},{key:"removeFace",value:function(e){var t=this;e.pulls.forEach((function(e){return t.removeInterval(e)})),e.pulls=[],e.joint&&this.removeJoint(e.joint),this.fabric.remove_face(e.index),this.faces=this.faces.filter((function(t){return t.index!==e.index})),this.faces.forEach((function(t){t.index>e.index&&t.index--}))}},{key:"turnFaceToTriangle",value:function(e){var t=this;e.pulls.forEach((function(e){return t.removeInterval(e)})),e.pulls=[],e.joint&&this.removeJoint(e.joint);for(var n=0;n<e.ends.length;n++){var a=e.ends[n],i=e.ends[(n+1)%e.ends.length];e.pulls.push(this.createInterval(a,i,r.PullB,e.scale))}}},{key:"triangleFaces",value:function(){var e=this;this.faces.forEach((function(t){return e.turnFaceToTriangle(t)}))}},{key:"withPulls",value:function(e){var t=function(e,t){e.pulls?e.pulls.push(t):e.pulls=[t]};this.intervals.filter((function(e){return!y(e.intervalRole)})).forEach((function(e){t(e.alpha,e),t(e.omega,e)}));var n={};this.intervals.forEach((function(e){return n[(r=e,J(r.alpha,r.omega))]={alpha:(t=e).alpha,omega:t.omega,scale:t.scale,intervalRole:t.intervalRole};var t,r})),e(n),this.joints.forEach((function(e){return e.pulls=void 0}))}},{key:"createPulls",value:function(e){var t=this;(function(){switch(e){case Ee.Bowtie:return Pe(t);case Ee.Snelson:return function(e){var t=[],n=function(e,t){var n=X(e),a=Z(e,t);if(n.push&&a.push){var i=I(n).filter($(r.PullA)).map((function(e){return Z(n,e)})),c=I(a).filter($(r.PullA)).map((function(e){return Z(a,e)})),o=i.find((function(e){return!!c.find((function(t){return e.index===t.index}))}));if(o&&o.push)return{alpha:e,omega:o,intervalRole:r.PullB,scale:t.scale}}};return e.withPulls((function(a){e.intervals.filter($(r.PullB)).forEach((function(e){var r=n(e.alpha,e);r&&(a[U(r)]||t.push(r));var i=n(e.omega,e);i&&(a[U(i)]||t.push(i))}))})),t}(t);default:throw new Error}})().forEach((function(e){var n=e.alpha,r=e.omega,a=e.intervalRole,i=e.scale;t.createInterval(n,r,a,i,5)}))}},{key:"removeSlackPulls",value:function(){var e=this;this.intervals.filter((function(e){return e.intervalRole===r.PullAA})).filter((function(e){return 0===e.alpha.instance.floatView.strains[e.index]})).forEach((function(t){return e.removeInterval(t)}))}},{key:"createTwistOn",value:function(e,t,n){var r=new oe(this,t,n,e.ends.map(W).reverse()),a=r.face(L.a);return this.connect(e,a),r}},{key:"do",value:function(e){this.jobs.push(e)}},{key:"iterate",value:function(){var e=this.instance.iterate();if(e)return e;var t=this.jobs.shift();if(t)return t(this),!0;if(this.stage===d.Stage.Growing){if(this.buds.length>0)return this.buds=pe(this.buds),0===this.buds.length&&function(e,t,n){var r=he(n),a={};return t.forEach((function(e){e.marks.forEach((function(t){var n=a[t._];n?n.push(e):a[t._]=[e]}))})),Object.entries(a).map((function(t){var n=Object(C.a)(t,1)[0],i=r[n]||r[-1],c=i||ce.None;return new Ae(e,a[n],c)}))}(this,this.faces,this.marks).forEach((function(e){return e.execute()})),!1;if(this.connectors.length>0)return this.connectors=this.checkConnectors(),!1;switch(this.stage=d.Stage.Shaping,this.postGrowthOperation){case ye.NoOp:break;case ye.Faces:this.triangleFaces();break;case ye.Snelson:this.createPulls(Ee.Snelson),this.triangleFaces();break;case ye.Bowtie:this.createPulls(Ee.Bowtie),this.triangleFaces()}}return!1}},{key:"strainToStiffness",value:function(){var e=this.instance.floatView,t=this.intervals.filter((function(e){return!y(e.intervalRole)&&(W(e.alpha).y>=0||W(e.omega).y>=0)})),n=e.strains,r=t.reduce((function(e,t){return e+n[t.index]}),0)/t.length,a=new Float32Array(e.stiffnesses);t.forEach((function(e){var t=(n[e.index]-r)/r;a[e.index]*=1+t})),this.instance.restoreSnapshot(),this.fabric.copy_stiffnesses(a)}},{key:"findInterval",value:function(e,t){return this.intervals.find(Q(e,t))}},{key:"createRadialPulls",value:function(e,t,n){var r=this,a=function(){var t=new oe(r,A.LeftRight,ae(function(e){return e.reduce((function(e,t){return e+re(t.scale)}),0)/e.length}(e)),[te(e)]);return r.instance.refreshFloatView(),e.map((function(e){var n=t.faces.filter((function(t){var n=t.spin;return t.pulls.length>0&&n!==e.spin})),a=ee(e),i=n.reduce((function(e,t){return ee(e).distanceTo(a)<ee(t).distanceTo(a)?e:t}));return r.createRadialPull(i,e)}))};switch(t){case ce.Distance:var i=n||ae(.75);if(!i)throw new Error("Missing pull scale");e.forEach((function(t,n){e.forEach((function(e,a){n<=a||r.createRadialPull(t,e,i)}))}));break;case ce.Join:switch(e.length){case 2:e[0].spin===e[1].spin?a():this.createRadialPull(e[0],e[1]);break;case 3:a()}}}},{key:"checkConnectors",value:function(){var e=this;if(0===this.connectors.length)return this.connectors;var t=function(t,n){!function(e,t){for(var n=Object(B.a)(e.ends).reverse(),r=t.ends,a=[],i=0;i<n.length;i++){for(var c=0,o=0;o<n.length;o++){var s=(o+i)%n.length;c+=G(n[o],r[s]),c+=G(r[s],n[(o+1)%n.length])}a.push(c)}var l=0,u=a[l];a.forEach((function(e,t){e<u&&(l=t,u=e)})),l>0&&(t.ends=t.ends.map((function(e,n){return Object(R.a)(e),t.ends[(n+l)%t.ends.length]})))}(t,n),e.connect(t,n)};return this.connectors.filter((function(n){var a=n.axis,i=n.alpha,c=n.omega,o=n.alphaRays,s=n.omegaRays;if(a.intervalRole===r.Connector&&G(a.alpha,a.omega)<=.05)return t(i,c),e.removeInterval(a),o.forEach((function(t){return e.removeInterval(t)})),s.forEach((function(t){return e.removeInterval(t)})),!1;return!0}))}},{key:"faceToOrigin",value:function(e){this.instance.apply(function(e){var t=e.ends.map(W),n=S(t),r=(new h.Vector3).subVectors(t[1],n).normalize(),a=(new h.Vector3).subVectors(t[0],n).normalize(),i=(new h.Vector3).crossVectors(r,a).normalize();return a.crossVectors(r,i).normalize(),(new h.Matrix4).makeBasis(r,i,a).setPosition(n).invert()}(e)),this.instance.refreshFloatView()}},{key:"connect",value:function(e,t){var n=Object(B.a)(e.ends).reverse(),a=t.ends,i=n.map(X),c=n,o=a,s=a.map(X);function l(e){return{a0:i[e],a1:i[(e+1)%i.length],b0:c[e],b1:c[(e+1)%c.length],c0:o[e],c1:o[(e+1)%o.length],cN1:o[(e+o.length-1)%o.length],d0:s[e],d1:s[(e+1)%s.length]}}for(var u=ae((re(e.scale)+re(t.scale))/2),f=[],h=0;h<c.length;h++){var d=l(h),m=d.b0,p=d.b1,v=d.c0;f.push(this.createInterval(m,v,r.PullA,u)),f.push(this.createInterval(v,p,r.PullA,u))}return this.removeFace(t),this.removeFace(e),f}},{key:"creatAxis",value:function(e,t,n){var a=G(e,t),i=n?r.Distancer:r.Connector,c=n?re(n)*a:.025,o=ne(),s=1/(this.countdown*Math.abs(c-a)),l={index:this.fabric.create_interval(e.index,t.index,!1,a,c,s),alpha:e,omega:t,intervalRole:i,scale:o,removed:!1};return this.intervals.push(l),l}},{key:"createRay",value:function(e,t,n){var a=G(e,t),i=r.Radial,c=ae(n),o=1/(this.countdown*Math.abs(n-a)),s={index:this.fabric.create_interval(e.index,t.index,!1,a,n,o),alpha:e,omega:t,intervalRole:i,scale:c,removed:!1};return this.intervals.push(s),s}},{key:"fabric",get:function(){return this.instance.fabric}},{key:"intervalsWithStats",get:function(){return this.intervals.filter((function(e){return e.stats}))}},{key:"stage",get:function(){return this.stage$.getValue()},set:function(e){var t=this;this.instance.stage=e,e===d.Stage.Slack&&(this.distancers.forEach((function(e){var n=e.axis,r=e.alphaRays,a=e.omegaRays;[n].concat(Object(B.a)(r),Object(B.a)(a)).forEach((function(e){return t.removeInterval(e)}))})),this.distancers=[],this.instance.snapshot()),this.stage$.next(e)}}]),e}();var Fe,Ae=function(){function e(t,n,r){Object(u.a)(this,e),this.tensegrity=t,this.faces=n,this.mark=r}return Object(f.a)(e,[{key:"execute",value:function(){switch(this.mark.action){case ce.Base:this.tensegrity.faceToOrigin(this.faces[0]);break;case ce.Join:case ce.Distance:this.tensegrity.createRadialPulls(this.faces,this.mark.action,this.mark.scale);break;case ce.Anchor:}}}]),e}(),Ce=n(79);function Ve(e,t,n,r,a){return{feature:e,name:t,featureStage:n,nuanceToPercent:function(e){return r*(1-e)+a*e},percentToNuance:function(e){return(e-r)/(a-r)},percentToValue:function(t){return Object(d.default_world_feature)(e)*t/100},valueToPercent:function(t){return t/Object(d.default_world_feature)(e)*100}}}function _e(e){switch(e){case d.WorldFeature.Gravity:return Ve(e,"Gravity",Fe.Postslack,0,1e3);case d.WorldFeature.Antigravity:return Ve(e,"-Antigravity",Fe.All,5,500);case d.WorldFeature.ShapingDrag:return Ve(e,"Shaping Drag",Fe.Preslack,0,500);case d.WorldFeature.ShapingStiffnessFactor:return Ve(e,"Shaping Stiffness",Fe.Preslack,10,1e3);case d.WorldFeature.Drag:return Ve(e,"Drag",Fe.Postslack,0,1e3);case d.WorldFeature.ShapingPretenstFactor:return Ve(e,"Shaping Pretenst",Fe.Preslack,0,1e3);case d.WorldFeature.PretenstFactor:return Ve(e,"Pretenst Factor",Fe.Postslack,0,500);case d.WorldFeature.StiffnessFactor:return Ve(e,"Stiffness",Fe.Postslack,1,300);case d.WorldFeature.IterationsPerFrame:return Ve(e,"Iterations/frame",Fe.All,2,500);case d.WorldFeature.IntervalCountdown:return Ve(e,"-Interval Countdown",Fe.Preslack,10,1e3);case d.WorldFeature.PretensingCountdown:return Ve(e,"-Pretenst countdown",Fe.All,50,200);case d.WorldFeature.VisualStrain:return Ve(e,"Visual strain",Fe.All,0,300);case d.WorldFeature.PushOverPull:return Ve(e,"Push/Pull",Fe.All,10,700);default:throw new Error("Feature?")}}!function(e){e[e.Preslack=0]="Preslack",e[e.Postslack=1]="Postslack",e[e.All=2]="All"}(Fe||(Fe={}));var Be=[Object(Ce.recoilPersist)({key:"pretenst-2021-02-27",storage:localStorage}).persistAtom],Re=Object(l.b)({key:"demoMode",default:!0,effects_UNSTABLE:Be}),Le=Object(l.b)({key:"startDemo",default:!1}),Me=Object(l.b)({key:"endDemo",default:!1}),Te=Object(l.b)({key:"postGrowth",default:ye.NoOp,effects_UNSTABLE:Be}),Ne=Object(l.b)({key:"bootstrapIndex",default:0,effects_UNSTABLE:Be}),ze=Object(l.b)({key:"tenscript",default:void 0,effects_UNSTABLE:Be});var De,Ie=Object(l.b)({key:"rotating",default:!1});!function(e){e.Lines="Lines",e.Selecting="Selecting",e.Frozen="Frozen"}(De||(De={}));var We=Object(l.b)({key:"viewMode",default:De.Lines}),Ge=(Object(l.b)({key:"surfaceCharacter",default:d.SurfaceCharacter.Frozen}),Object(l.b)({key:"visibleRoles",default:w})),Je=v.map((function(e){var t=_e(e);return{mapping:t,percentAtom:Object(l.b)({key:t.name,default:100,effects_UNSTABLE:Be})}}));var Ue=n(80),$e=n(121);function qe(){var e=Object(l.d)(Re),t=Object(C.a)(e,1)[0],n=Object(l.d)(We),r=Object(C.a)(n,2),a=r[0],i=r[1];function c(e){var n=e.item,r=e.children;return t?o.createElement("div",null):o.createElement(Ue.a,{disabled:n===a,color:n===a?"success":"secondary",onClick:function(){return i(n)}},r)}return o.createElement($e.a,null,o.createElement(c,{item:De.Lines},o.createElement(V.v,null)),o.createElement(c,{item:De.Selecting},o.createElement(V.p,null)),o.createElement(c,{item:De.Frozen},o.createElement(V.A,null)))}var He=n(131),Ye=n(132),Ke=n(133),Qe=n(122),Xe=n(118),Ze=[0,1e5];function et(e){var t=e.featureValue,n=e.apply,r=t.mapping,a=t.percentAtom,i=r.name,c=r.nuanceToPercent,s=r.percentToNuance,u=r.percentToValue,f=function(e){return[Math.floor(1e5*s(e))]},h=Object(l.d)(a),d=Object(C.a)(h,2),m=d[0],p=d[1],v=Object(o.useState)(f(m)),g=Object(C.a)(v,2),b=g[0],w=g[1];return Object(o.useEffect)((function(){p(Math.round(c(b[0]/1e5)))}),[b]),Object(o.useEffect)((function(){return n(r.feature,m,u(m))}),[m]),Object(o.useEffect)((function(){w(f(m))}),[t]),o.createElement("div",{className:"slider"},o.createElement("div",{className:"float-right mr-4"},o.createElement(V.d,{onClick:function(){return w(f(100))}})),o.createElement("div",{className:"ml-2 small my-1"},i," = ",function(e){return e<=100?"".concat(e.toFixed(0),"%"):"".concat((e/100).toFixed(1),"x")}(m)," (",E(u(m)),")"),o.createElement(Xe.c,{mode:1,step:1,domain:Ze,rootStyle:rt,values:b,onChange:function(e){return w(e)}},o.createElement(Xe.b,null,(function(e){var t=e.getRailProps;return o.createElement("div",Object.assign({className:"slider-rail"},t()))})),o.createElement(Xe.a,null,(function(e){var t=e.handles,n=e.getHandleProps;return o.createElement("div",{className:"slider-handles"},t.map((function(e,t){return o.createElement(tt,{key:e.id,handle:e,getHandleProps:n})})))})),o.createElement(Xe.d,{right:!1},(function(e){var t=e.tracks,n=e.getTrackProps;return o.createElement("div",{className:"slider-tracks"},t.map((function(e,t){var r=e.id,a=e.source,i=e.target;return o.createElement(nt,{key:r,source:a,target:i,getTrackProps:n})})))}))))}function tt(e){var t=e.handle,n=e.getHandleProps,r=Ze[0],a=Ze[1],i=t.id,c=t.value,s=t.percent;return o.createElement("div",Object.assign({role:"slider",className:"slider-handle",style:{left:"".concat(s,"%")},"aria-valuemin":r,"aria-valuemax":a,"aria-valuenow":c},n(i)))}function nt(e){var t=e.source,n=e.target,r=e.getTrackProps;return o.createElement("div",Object.assign({className:"slider-track",style:{left:"".concat(t.percent,"%"),width:"".concat(n.percent-t.percent,"%")}},r()))}var rt={margin:"1%",position:"relative",width:"98%"};function at(e){var t=e.tensegrity,n=Object(o.useState)(t.stage$.getValue()),r=Object(C.a)(n,2),a=r[0],i=r[1];Object(o.useEffect)((function(){var e=t.stage$.subscribe(i);return function(){return e.unsubscribe()}}),[t]);var c=Object(o.useState)(!1),s=Object(C.a)(c,2),l=s[0],u=s[1],f=Object(o.useState)(Je[d.WorldFeature.VisualStrain]),h=Object(C.a)(f,2),m=h[0],p=h[1];return o.createElement("div",{className:"w-100 d-flex"},o.createElement(He.a,{isOpen:l,toggle:function(){return u(!l)}},o.createElement(Ye.a,null,"Choose"),o.createElement(Ke.a,null,Je.filter(function(e){return function(t){var n=t.mapping;if(n.name.startsWith("-"))return!1;switch(n.featureStage){case Fe.Preslack:return e<d.Stage.Slack;case Fe.Postslack:return e>=d.Stage.Slack;default:return!0}}}(a)).map((function(e){return o.createElement(Qe.a,{key:"fitem-".concat(e.mapping.feature),onClick:function(){return p(e)}},e.mapping.name)})))),o.createElement(et,{featureValue:m,apply:function(e,n,r){t.instance.applyFeature(e,n,r)}}))}var it=n(101),ct=n(102),ot=n.n(ct);function st(e){return e.toFixed(5).replace(/[.]/,",")}function lt(){return(new Date).toISOString().replace(/[.].*/,"").replace(/[:T_]/g,"-")}function ut(e,t,n,r){var a=e.name,i=e.instance,c=e.joints,o=e.intervals;i.refreshFloatView();var s=i.floatView.idealLengths,l=i.floatView.strains,u=i.floatView.stiffnesses,f=i.floatView.linearDensities;return{name:a,joints:c.map((function(e){var t=W(e),n=function(e,t){var n=t.filter((function(t){return t.alpha.index===e.index||t.omega.index===e.index})),r=n.find((function(e){return y(e.intervalRole)}));if(!r)return[];var a=function(t){return(new h.Vector3).subVectors(W(Z(e,t)),W(e)).normalize()},i=a(r),c=n.map((function(t){return{interval:t,unit:a(t),hole:{index:0,interval:t.index,role:g(t.intervalRole),oppositeJoint:Z(e,t).index,chords:[]}}})).sort((function(e,t){var n=e.unit.dot(i),r=t.unit.dot(i);return n<r?1:n>r?-1:0}));return c.forEach((function(e,t){return e.hole.index=t})),c.forEach((function(e){var t;c.filter((function(t){return t.hole.index!==e.hole.index})).sort((t=e.unit,function(e,n){var r=e.unit.dot(t),a=n.unit.dot(t);return r<a?1:r>a?-1:0})).forEach((function(t){var n=Math.acos(e.unit.dot(t.unit)),r=2*Math.sin(n/2)*.015;e.hole.chords.push({holeIndex:t.hole.index,length:r})}))})),c.map((function(e){return e.hole}))}(e,o);return{index:e.index,radius:r,x:t.x,y:t.z,z:t.y,anchor:!1,holes:n}})),intervals:o.map((function(e){var r=y(e.intervalRole),a=r?t:n,i=H(e),o=e.alpha.index,h=e.omega.index;if(o>=c.length||h>=c.length)throw new Error("Joint not found ".concat(g(e.intervalRole),":").concat(o,",").concat(h,":").concat(c.length));return{index:e.index,joints:[o,h],type:r?"Push":"Pull",strain:l[e.index],stiffness:u[e.index],linearDensity:f[e.index],role:g(e.intervalRole),scale:e.scale._,idealLength:s[e.index],isPush:r,length:i,radius:a}}))}}function ft(e){var t=new ot.a;t.file("joints.csv",function(e){var t=[];return t.push(["index","x","y","z"]),e.joints.forEach((function(e){return t.push([(e.index+1).toFixed(0),st(e.x),st(e.y),st(e.z)])})),t.map((function(e){return e.join(";")})).join("\n")}(e)),t.file("intervals.csv",function(e){var t=[];return t.push(["joints","type","strain","stiffness","linear density","role","length"]),e.intervals.forEach((function(e){t.push(['"=""'.concat(e.joints.map((function(e){return(e+1).toFixed(0)})),'"""'),e.type,st(e.strain),st(e.stiffness),st(e.linearDensity),e.role,e.length.toFixed(8)])})),t.map((function(e){return e.join(";")})).join("\n")}(e)),t.file("submerged.csv",function(e){var t=[];return t.push(["joints"]),t.map((function(e){return e.join(";")})).join("\n")}()),t.generateAsync({type:"blob",mimeType:"application/zip"}).then((function(e){it.saveAs(e,"pretenst-".concat(lt(),".zip"))}))}function ht(e){var t=e.tensegrity,n=Object(o.useState)(t.stage$.getValue()),r=Object(C.a)(n,2),a=r[0],i=r[1];Object(o.useEffect)((function(){var e=t.stage$.subscribe(i);return function(){return e.unsubscribe()}}),[t]);var c=Object(l.d)(We),s=Object(C.a)(c,1)[0],u=Object(l.d)(Re),f=Object(C.a)(u,1)[0],h=Object(l.e)(Le),m=Object(l.e)(Me),p=Object(l.d)(Ie),v=Object(C.a)(p,2),g=v[0],b=v[1];return f?o.createElement($e.a,null,o.createElement(Ue.a,{color:"success",onClick:function(){b(!1),m(!0)}},o.createElement(V.y,null)," Exit demo")):o.createElement($e.a,null,s===De.Frozen?o.createElement(o.Fragment,null,o.createElement(Ue.a,{onClick:function(){return ft(ut(t,.012,.005,.015))}},o.createElement(V.k,null),o.createElement(V.n,null)),o.createElement(Ue.a,{onClick:function(){return function(e){var t=new ot.a;t.file("pretenst-".concat(lt(),".json"),JSON.stringify(e,void 0,2)),t.generateAsync({type:"blob",mimeType:"application/zip"}).then((function(e){it.saveAs(e,"pretenst-".concat(lt(),".zip"))}))}(ut(t,.012,.005,.015))}},o.createElement(V.k,null),o.createElement(V.m,null))):a<d.Stage.Slack?o.createElement(o.Fragment,null,o.createElement(Ue.a,{disabled:a!==d.Stage.Shaping,onClick:function(){return t.fabric.centralize()}},o.createElement(V.j,null))):a>d.Stage.Slack?o.createElement(o.Fragment,null,o.createElement(Ue.a,{disabled:a!==d.Stage.Pretenst,onClick:function(){return t.removeSlackPulls()}},o.createElement(V.D,null)),o.createElement(Ue.a,{disabled:a!==d.Stage.Pretenst,onClick:function(){return t.fabric.set_altitude(10)}},o.createElement(V.u,null))):void 0,o.createElement(Ue.a,{color:g?"warning":"secondary",onClick:function(){return b(!g)}},o.createElement(V.B,null)),o.createElement(Ue.a,{onClick:function(){h(!0)}},o.createElement(V.v,null)))}var dt=n(125),mt=n(130),pt=n(126),vt=n(119),gt=n(123),bt=n(124);function wt(e){var t=e.interval,n=t.alpha,r=t.omega,a=t.intervalRole,i=K(t);return o.createElement(gt.a,{className:"interval-stats",style:{width:"10em"},position:q(t)},o.createElement("div",{style:{position:"absolute",top:"0",left:"0",color:"red"}},o.createElement(V.t,null)),o.createElement(bt.a,{onClick:function(e){e.stopPropagation(),t.stats=void 0}},o.createElement("thead",null,o.createElement("tr",null,o.createElement("th",{colSpan:2},"(",n.index," ",o.createElement(V.c,null)," ",r.index,"): ",g(a)))),o.createElement("tbody",null,o.createElement("tr",null,o.createElement("td",{className:"text-right"},"Stiffness:"),o.createElement("td",null,i.stiffness.toFixed(8))),o.createElement("tr",null,o.createElement("td",{className:"text-right"},"Strain:"),o.createElement("td",null,i.strain.toFixed(8))),o.createElement("tr",null,o.createElement("td",{className:"text-right"},"Length:"),o.createElement("td",null,i.length.toFixed(8))),o.createElement("tr",null,o.createElement("td",{className:"text-right"},"Ideal Length:"),o.createElement("td",null,i.idealLength.toFixed(8))),o.createElement("tr",null,o.createElement("td",{className:"text-right"},"Linear Density:"),o.createElement("td",null,i.linearDensity.toFixed(8))))))}function yt(e){var t=e.interval,n=e.pushOverPull,r=e.pretenst,a=Object(o.useState)(K(t)),i=Object(C.a)(a,2),c=i[0],s=i[1];return Object(_.b)((function(){return s(Y(t,n,r))})),o.createElement(gt.a,{className:"interval-stats",style:{fontFamily:"fixed",padding:"0.1em",width:"7em",textAlign:"center"},position:q(t)},o.createElement("div",{onClick:function(e){e.stopPropagation(),t.stats=void 0}},c.strain.toFixed(8)))}var Et=["#fd0000","#c94f00","#d58e1c","#897c00","#6c8901","#1d6c01","#0e4e00","#007f67","#01808b","#005da3","#0015c7","#0000ff"].reverse().map((function(e){return(new h.Color).setHex(parseInt("".concat(e.substring(1)),16))})),kt=new h.LineBasicMaterial({vertexColors:!0}),St=new h.MeshBasicMaterial({color:new h.Color("#ffdf00"),side:h.DoubleSide,transparent:!0,opacity:.25,depthTest:!1});Et.map((function(e){return new h.MeshLambertMaterial({color:e})}));function jt(e){switch(e){case r.PushA:return"#0d1147";case r.PushB:return"#281a4c";case r.PullA:return"#a71313";case r.PullB:return"#6d6c6c";case r.PullAA:return"#13f3f3";case r.PullBB:return"#59ee37";default:return"#FFFFFF"}}function Ot(e){var t=function(e){return new h.Color(jt(e))}(e);return new h.MeshLambertMaterial({color:t})}var Pt=new h.MeshPhongMaterial({color:new h.Color("#101010"),side:h.DoubleSide,transparent:!0,opacity:.5}),xt=[new h.Vector3(0,0,-20),new h.Vector3(-17.32,0,-10),new h.Vector3(-17.32,0,10),new h.Vector3(0,0,20),new h.Vector3(17.32,0,10),new h.Vector3(17.32,0,-10)],Ft=new h.Color("tan"),At=new h.Vector3(0,1,0);function Ct(){var e=Object(o.useMemo)((function(){return function(){var e=new h.Geometry;return function(e,t){e.push.apply(e,Object(B.a)(xt.map((function(e){return new h.Vector3(e.x,e.y,e.z)})))),e.push(new h.Vector3);for(var n=0;n<6;n++){var r=(n+1)%6,a=[At,(new h.Vector3).add(At).addScaledVector(xt[n],.01).normalize(),(new h.Vector3).add(At).addScaledVector(xt[r],.01).normalize()];t.push(new h.Face3(6,n,r,a,Ft))}}(e.vertices,e.faces),e.vertices.forEach((function(e){return e.sub(new h.Vector3(0,.01,0))})),e}()}),[]);return o.createElement("mesh",{name:"Patches",geometry:e,material:Pt})}var Vt=new h.CylinderGeometry(1,1,1,12,1,!1),_t=new h.Color("#ffffff");function Bt(e){var t=e.tensegrity,n=e.runTenscript,r=e.selection,a=e.setSelection,i=Object(l.d)(Ge),c=Object(C.a)(i,1)[0],s=Object(l.d)(Je[d.WorldFeature.PushOverPull].percentAtom),u=Object(C.a)(s,1)[0],f=function(){return Je[d.WorldFeature.PushOverPull].mapping.percentToValue(u)},m=Object(l.d)(Je[d.WorldFeature.VisualStrain].percentAtom),p=Object(C.a)(m,1)[0],v=function(){return Je[d.WorldFeature.VisualStrain].mapping.percentToValue(p)},g=Object(l.d)(Je[d.WorldFeature.ShapingPretenstFactor].percentAtom),b=Object(C.a)(g,1)[0],w=Object(l.d)(Je[d.WorldFeature.PretenstFactor].percentAtom),y=Object(C.a)(w,1)[0],E=Object(l.d)(Re),k=Object(C.a)(E,2),S=k[0],j=k[1],O=Object(l.d)(Le),P=Object(C.a)(O,2),x=P[0],F=P[1],A=Object(l.d)(Me),V=Object(C.a)(A,2),R=V[0],L=V[1],T=Object(l.d)(Ne),N=Object(C.a)(T,2),z=N[0],D=N[1],I=Object(l.d)(We),G=Object(C.a)(I,1)[0],J=Object(l.d)(Ie),U=Object(C.a)(J,2),$=U[0],q=U[1],H=Object(o.useState)(0),K=Object(C.a)(H,2),Q=K[0],X=K[1],Z=Object(o.useState)(new h.Vector3(0,1,0)),ee=Object(C.a)(Z,2),ne=ee[0],re=ee[1],ae=Object(o.useState)(0),ie=Object(C.a)(ae,2),ce=ie[0],oe=ie[1],se=Object(o.useState)(t.stage$.getValue()),le=Object(C.a)(se,2),ue=le[0],fe=le[1];function he(e){var t=e.reduce((function(e,t){var n=function(t){return e[t.index]=t};switch(t.faceSelection){case M.Pulls:t.pulls.forEach(n);break;case M.Pushes:t.pushes.forEach(n);break;case M.Both:t.pulls.forEach(n),t.pushes.forEach(n)}return e}),{}),n=e.reduce((function(e,t){return t.ends.forEach((function(t){return e[t.index]=t})),e}),{}),r=Object.keys(t).map((function(e){return t[e]})),i=Object.keys(n).map((function(e){return n[e]}));a({faces:e,intervals:r,joints:i})}Object(o.useEffect)((function(){oe(ue<d.Stage.Pretenst?Je[d.WorldFeature.ShapingPretenstFactor].mapping.percentToValue(b):Je[d.WorldFeature.PretenstFactor].mapping.percentToValue(y))}),[ue]),Object(o.useEffect)((function(){D(0),X(0)}),[S]),Object(o.useEffect)((function(){var e=t.stage$.subscribe(fe);return function(){return e.unsubscribe()}}),[t]),Object(o.useEffect)((function(){var e=pe.current;e&&t&&e.position.set(0,1,2*t.instance.view.radius())}),[]);var de=function(e){return console.error("tensegrity view",e)};function me(e){e.stats?e.stats=void 0:Y(e,f(),ce)}Object(_.b)((function(){var e=pe.current;if(e&&t){if(x)return j(!0),n(je[0],ye.Bowtie,de),void F(!1);if(R)return j(!1),void L(!1);var a,i=t.instance.view,c=r.faces.length>0?te(r.faces):r.joints.length>0?(a=r.joints).reduce((function(e,t){return e.add(W(t))}),new h.Vector3).multiplyScalar(1/a.length):new h.Vector3(i.midpoint_x(),i.midpoint_y(),i.midpoint_z());re((new h.Vector3).subVectors(c,ne).multiplyScalar(.01).add(ne));var o=e.position;if(S||ue===d.Stage.Growing){o.y+=.01*(c.y-o.y);var s=o.distanceTo(c)-2.5*i.radius(),l=(new h.Vector3).subVectors(c,o).normalize().multiplyScalar(.01*s);o.add(l)}else o.y<0&&(o.y-=.01*o.y*20);if(G!==De.Frozen){if(t.iterate())return;if(S)switch(ue){case d.Stage.Shaping:200===Q?(t.stage=d.Stage.Slack,X(0)):X(Q+1);break;case d.Stage.Slack:30===Q?(t.stage=d.Stage.Pretensing,q(!1),X(0)):X(Q+1);break;case d.Stage.Pretenst:if(200===Q){var u=z+1;u===je.length?(D(0),j(!1),q(!1),n(je[0],ye.NoOp,de)):(D(u),q(!0),X(0),n(je[u],ye.Bowtie,de))}else X(Q+1)}ue===d.Stage.Pretensing&&(t.stage=d.Stage.Pretenst)}}}));var pe=Object(o.useRef)();return o.createElement("group",null,o.createElement(dt.a,{ref:pe,makeDefault:!0,onPointerMissed:void 0}),o.createElement(mt.a,{target:ne,autoRotate:$,enableKeys:!1,enablePan:!1,enableDamping:!1,minPolarAngle:.1*Math.PI,maxPolarAngle:.8*Math.PI,onPointerMissed:void 0}),o.createElement("scene",null,G===De.Frozen?o.createElement("group",null,t.intervals.filter((function(e){return c.some((function(t){return t===e.intervalRole}))})).map((function(e){return o.createElement(Lt,{key:"I".concat(e.index),pushOverPull:f(),visualStrain:v(),pretenstFactor:ce,tensegrity:t,interval:e,selected:!1,onPointerDown:function(t){t.stopPropagation(),me(e)}})})),"}"):o.createElement(o.Fragment,null,o.createElement("lineSegments",{geometry:t.instance.floatView.lineGeometry,material:kt,onUpdate:function(e){return e.geometry.computeBoundingSphere()}})),G!==De.Selecting?void 0:o.createElement(Mt,{tensegrity:t,stage:ue,clickFace:function(e){return function(e){switch(e.faceSelection){case M.None:e.faceSelection=M.Face,he([].concat(Object(B.a)(r.faces),[e]));break;case M.Face:e.faceSelection=M.Pulls,he(r.faces);break;case M.Pulls:e.faceSelection=M.Pushes,he(r.faces);break;case M.Pushes:e.faceSelection=M.Both,he(r.faces);break;case M.Both:e.faceSelection=M.None,he(r.faces.filter((function(t){return t.index!==e.index})))}}(e)}}),r.intervals.map((function(e){return o.createElement(Lt,{key:"SI".concat(e.index),pushOverPull:f(),visualStrain:v(),pretenstFactor:ce,tensegrity:t,interval:e,selected:!0,onPointerDown:function(t){t.stopPropagation(),me(e)}})})),G===De.Frozen?t.intervalsWithStats.map((function(e){return o.createElement(wt,{key:"S".concat(e.index),interval:e})})):t.intervalsWithStats.map((function(e){return o.createElement(yt,{key:"SL".concat(e.index),interval:e,pushOverPull:f(),pretenst:ce})})),r.faces.filter((function(e){return e.faceSelection===M.Face})).map((function(e){var t=new h.Geometry;return t.vertices=e.ends.map(W),t.faces.push(new h.Face3(0,1,2)),o.createElement("mesh",{key:"SJ".concat(e.index),geometry:t,material:St})})),G===De.Frozen?void 0:r.joints.map((function(e){var t="".concat(e.index);return o.createElement(Rt,{key:t,position:W(e),text:t})})),o.createElement(Ct,null),o.createElement(pt.a,null),o.createElement("ambientLight",{color:_t,intensity:.8}),o.createElement("directionalLight",{color:new h.Color("#FFFFFF"),intensity:2})))}function Rt(e){var t=e.position,n=e.text,r=Object(_.c)().camera,a=Object(o.useRef)();return Object(_.b)((function(){a.current&&a.current.quaternion.copy(r.quaternion)})),o.createElement(vt.a,{ref:a,fontSize:.1,position:t,anchorY:"middle",anchorX:"center",onPointerMissed:void 0},n)}function Lt(e){var t=e.pushOverPull,n=e.visualStrain,r=e.pretenstFactor,a=e.tensegrity,i=e.interval,c=e.selected,s=e.onPointerDown,l=c?St:Ot(i.intervalRole),u=y(i.intervalRole),f=a.instance.floatView.stiffnesses[i.index]*(u?t:1),d=.01*Math.sqrt(f)*(c?1.5:1),p=a.instance.unitVector(i.index),v=(new h.Quaternion).setFromUnitVectors(m,p),g=a.instance.floatView.strains[i.index],b=1+(u?r:0),w=a.instance.floatView.idealLengths[i.index]*b,E=0===g?H(i):w+g*w*(1-n),k=new h.Vector3(d,E<0?.01:E,d);return o.createElement("mesh",{geometry:Vt,position:q(i),rotation:(new h.Euler).setFromQuaternion(v),scale:k,material:l,matrixWorldNeedsUpdate:!0,onPointerDown:s})}function Mt(e){var t=e.tensegrity,n=e.stage,r=e.clickFace,a=Object(_.c)().raycaster,i=Object(o.useRef)(),c=Object(o.useState)(),s=Object(C.a)(c,2),l=s[0],u=s[1];return o.createElement("mesh",{key:"faces",ref:i,onPointerDown:function(e){e.stopPropagation(),u(e)},onPointerUp:function(e){e.stopPropagation();var c=i.current;if(!function(e){return e===d.Stage.Growing||e===d.Stage.Slack}(n)&&l&&c){var o=l.clientX-e.clientX,s=l.clientY-e.clientY;if(!(o*o+s*s>36)){var f=a.intersectObjects([c],!0).map((function(e){return e.faceIndex})).map((function(e){if(void 0!==e)return t.faces[e]})).reverse().pop();u(void 0),f&&r(f)}}},geometry:t.instance.floatView.faceGeometry},o.createElement("meshPhongMaterial",{attach:"material",transparent:!0,side:h.FrontSide,depthTest:!1,opacity:.2,color:"white"}))}var Tt,Nt=n(127);function zt(e){var t=e.runTenscript,n=Object(l.d)(ze),r=Object(C.a)(n,2),a=r[0],i=r[1],c=Object(l.d)(Te),s=Object(C.a)(c,1)[0],u=Object(o.useState)(""),f=Object(C.a)(u,2),h=f[0],d=f[1],m=Object(o.useState)(""),p=Object(C.a)(m,2),v=p[0],g=p[1],b=function(){return JSON.stringify(a,void 0,2)};return Object(o.useEffect)((function(){d(a?b():"")}),[a]),o.createElement("div",{id:"tenscript-panel",style:{flexDirection:"column",position:"relative",backgroundColor:"rgba(0,0,0,1)",height:"100%"}},o.createElement("div",null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(V.x,null)," Tenscript"),o.createElement("div",{id:"code-and-run",style:{flexDirection:"column",height:"available"}},o.createElement(Nt.a,{style:{borderRadius:"1em",height:"22em",marginBottom:"0.5em"},type:"textarea",id:"tenscript",value:h,onChange:function(e){return d(e.target.value)}}),o.createElement($e.a,{vertical:!0,className:"w-100 my-2"},0===v.length?void 0:o.createElement(Ue.a,{className:"my-2",color:"warning",onClick:function(){d(b()),g("")}},o.createElement(V.e,null),o.createElement("hr",null),v),o.createElement(Ue.a,{color:"success",onClick:function(){return function(){try{var e=JSON.parse(h);ue(e,g)&&(g(""),i(e),t(e,s,g))}catch(n){g(n.toString())}}()}},"Try it out!")))))}!function(e){e[e.CaptureLengthsToSlack=0]="CaptureLengthsToSlack",e[e.SlackToPretensingFrozen=1]="SlackToPretensingFrozen",e[e.SlackToPretensingSticky=2]="SlackToPretensingSticky",e[e.SlackToPretensingBouncy=3]="SlackToPretensingBouncy",e[e.CapturePretenstToSlack=4]="CapturePretenstToSlack",e[e.CaptureStrainForStiffness=5]="CaptureStrainForStiffness"}(Tt||(Tt={}));var Dt=Object.keys(Tt).filter((function(e){return isNaN(parseInt(e,10))})).map((function(e){return Tt[e]}));function It(e){var t=e.tensegrity,n=e.stageTransition,r=e.disabled,a=Object(o.useState)(t.stage),i=Object(C.a)(a,2),c=i[0],s=i[1];function l(e){return!(!r&&c!==d.Stage.Pretensing)||c!==e}switch(Object(o.useEffect)((function(){var e=t.stage$.subscribe(s);return function(){return e.unsubscribe()}}),[t]),n){case Tt.CaptureLengthsToSlack:return o.createElement(Ue.a,{disabled:l(d.Stage.Shaping),onClick:function(){return t.do((function(e){return e.stage=d.Stage.Slack}))}},o.createElement(V.f,null),o.createElement(V.b,null),o.createElement(Wt,{stage:d.Stage.Slack}));case Tt.SlackToPretensingFrozen:return o.createElement(Ue.a,{disabled:l(d.Stage.Slack),onClick:function(){return t.do((function(e){e.instance.world.set_surface_character(d.SurfaceCharacter.Frozen),e.stage=d.Stage.Pretensing}))}},o.createElement(Wt,{stage:d.Stage.Slack}),o.createElement(V.b,null),o.createElement(V.a,null),o.createElement(Wt,{stage:d.Stage.Pretenst}));case Tt.SlackToPretensingSticky:return o.createElement(Ue.a,{disabled:l(d.Stage.Slack),onClick:function(){return t.do((function(e){e.instance.world.set_surface_character(d.SurfaceCharacter.Sticky),e.stage=d.Stage.Pretensing}))}},o.createElement(Wt,{stage:d.Stage.Slack}),o.createElement(V.b,null),o.createElement(V.C,null),o.createElement(Wt,{stage:d.Stage.Pretenst}));case Tt.SlackToPretensingBouncy:return o.createElement(Ue.a,{disabled:l(d.Stage.Slack),onClick:function(){return t.do((function(e){e.instance.world.set_surface_character(d.SurfaceCharacter.Bouncy),e.stage=d.Stage.Pretensing}))}},o.createElement(Wt,{stage:d.Stage.Slack}),o.createElement(V.b,null),o.createElement(V.o,null),o.createElement(Wt,{stage:d.Stage.Pretenst}));case Tt.CapturePretenstToSlack:return o.createElement(Ue.a,{disabled:l(d.Stage.Pretenst),onClick:function(){return t.do((function(e){return e.stage=d.Stage.Slack}))}},o.createElement(Wt,{stage:d.Stage.Pretenst}),o.createElement(V.b,null),o.createElement(Wt,{stage:d.Stage.Slack}));case Tt.CaptureStrainForStiffness:return o.createElement(Ue.a,{disabled:l(d.Stage.Pretenst),onClick:function(){return t.do((function(e){e.stage=d.Stage.Slack,e.strainToStiffness()}))}},o.createElement(Wt,{stage:d.Stage.Pretenst}),o.createElement(V.b,null),o.createElement(Wt,{stage:d.Stage.Slack}),o.createElement(V.g,null))}}function Wt(e){switch(e.stage){case d.Stage.Growing:return o.createElement(V.x,null);case d.Stage.Shaping:return o.createElement(V.z,null);case d.Stage.Slack:return o.createElement(V.E,null);case d.Stage.Pretensing:return o.createElement(V.i,null);case d.Stage.Pretenst:return o.createElement(V.q,null);default:throw new Error("Stage?")}}function Gt(e){var t=e.tensegrity,n=e.runTenscript,r=Object(l.d)(We),a=Object(C.a)(r,1)[0],i=Object(l.e)(Ne),c=Object(l.d)(ze),s=Object(C.a)(c,1)[0],u=Object(l.d)(Te),f=Object(C.a)(u,2),h=f[0],d=f[1],m=Object(o.useState)(!1),p=Object(C.a)(m,2),v=p[0],g=p[1],b=Object(o.useState)(!1),w=Object(C.a)(b,2),y=w[0],E=w[1],k=function(e){s&&(d(e),n(s,e,(function(e){return console.error(e)})))},S=function(e){return h===e?"success":"secondary"};return o.createElement(o.Fragment,null,o.createElement($e.a,null,Dt.map((function(e){return o.createElement(It,{key:"strans-".concat(e),tensegrity:t,stageTransition:e,disabled:a===De.Frozen})}))),o.createElement("br",null),o.createElement($e.a,{className:"my-1"},o.createElement(Ue.a,{onClick:function(){return k(ye.NoOp)},color:S(ye.NoOp)},"0"),o.createElement(Ue.a,{onClick:function(){return k(ye.Faces)},color:S(ye.Faces)},"\u25b5"),o.createElement(Ue.a,{onClick:function(){return k(ye.Snelson)},color:S(ye.Snelson)},"S"),o.createElement(Ue.a,{onClick:function(){return k(ye.Bowtie)},color:S(ye.Bowtie)},"\u22c8")),o.createElement("br",null),o.createElement($e.a,null,o.createElement(He.a,{isOpen:y,toggle:function(){return E(!y)}},o.createElement(Ye.a,null,o.createElement(V.r,null)),o.createElement(Ke.a,null,je.map((function(e,t){return o.createElement(Qe.a,{key:"Boot".concat(t),onClick:function(){i(t),n(e,h,(function(){return console.error("impossible")}))}},e.name)})))),o.createElement(Ue.a,{color:v?"warning":"secondary",onClick:function(){return g(!v)}},o.createElement(V.l,null))),v?o.createElement(zt,{runTenscript:n}):void 0)}function Jt(e){var t=e.tensegrity,n=Object(o.useState)(t.stage$.getValue()),r=Object(C.a)(n,2),a=r[0],i=r[1];return Object(o.useEffect)((function(){var e=t.stage$.subscribe(i);return function(){return e.unsubscribe()}}),[t]),o.createElement("div",null,o.createElement("span",null,function(e){switch(e){case d.Stage.Growing:return"Growing";case d.Stage.Shaping:return"Shaping";case d.Stage.Slack:return"Slack";case d.Stage.Pretensing:return"Pretensing";default:return"Pretenst"}}(a))," ",o.createElement("i",null,'"',t.name,'"'))}function Ut(e){var t=e.tensegrity,n=e.selection,a=Object(l.d)(We),i=Object(C.a)(a,1)[0],c=Object(l.d)(Ge),s=Object(C.a)(c,2),u=s[0],f=s[1],h=Object(o.useState)(r.PullA),d=Object(C.a)(h,2),m=d[0],p=d[1],v=function(e){return function(){n.intervals.forEach((function(n){t.changeIntervalScale(n,e?1.03:1/1.03)}))}};switch(i){case De.Lines:return o.createElement(o.Fragment,null,o.createElement($e.a,null,w.map((function(e,t){return o.createElement(Ue.a,{key:"IntervalRole[".concat(t,"]"),onClick:function(){return p(e)},color:m===e?"success":"secondary"},g(e))}))),o.createElement($t,{tensegrity:t,intervalRole:m}));case De.Selecting:return o.createElement($e.a,null,o.createElement(Ue.a,{onClick:v(!0)},o.createElement(V.w,null)),o.createElement(Ue.a,{onClick:v(!1)},o.createElement(V.s,null)));case De.Frozen:return o.createElement($e.a,null,w.map((function(e){return o.createElement(Ue.a,{key:"viz".concat(e),onClick:function(){if(u.indexOf(e)<0)f([].concat(Object(B.a)(u),[e]));else{var t=u.filter((function(t){return t!==e}));f(t.length>0?t:w)}},color:u.some((function(t){return t===e}))?"success":"secondary"},g(e),o.createElement(V.h,{style:{color:jt(e)}}))})));default:return o.createElement("span",null,"?")}}function $t(e){var t=e.tensegrity,n=e.intervalRole,r=e.disabled;var a=function(e,r){return function(){t.intervals.filter((function(e){return e.intervalRole===n})).forEach((function(n){return t.changeIntervalScale(n,function(){var t=r?1.01:1.05;return e?t:1/t}())}))}};return o.createElement("div",{className:"text-right"},o.createElement($e.a,{className:"my-1"},o.createElement(Ue.a,{disabled:r,onClick:a(!0,!1)},o.createElement(V.w,null),o.createElement(V.w,null)),o.createElement(Ue.a,{disabled:r,onClick:a(!0,!0)},o.createElement(V.w,null)),o.createElement(Ue.a,{disabled:r,onClick:a(!1,!0)},o.createElement(V.s,null)),o.createElement(Ue.a,{disabled:r,onClick:a(!1,!1)},o.createElement(V.s,null),o.createElement(V.s,null))),o.createElement("br",null),o.createElement($e.a,null,o.createElement(Ue.a,null,g(n)," = [",E(p(n)),"]")))}function qt(e){var t=e.createInstance,n=Object(o.useMemo)((function(){return t(!1)}),[]),r=Je.map((function(e){var t=e.percentAtom;return Object(l.d)(t)})),a=Object(l.d)(ze),i=Object(C.a)(a,2),c=i[0],s=i[1],u=Object(l.d)(Ne),f=Object(C.a)(u,1)[0],m=Object(l.d)(Te),p=Object(C.a)(m,1)[0],g=Object(l.d)(We),b=Object(C.a)(g,2),w=b[0],y=b[1],E=Object(l.d)(Re),k=Object(C.a)(E,1)[0],S=Object(o.useState)(),j=Object(C.a)(S,2),O=j[0],P=j[1],x=Object(o.useState)(ie),F=Object(C.a)(x,2),A=F[0],B=F[1],R=function(e){return console.error("tensegrity view",e)},L=function e(t,a,i){try{var c=ue(t,i);if(!c)return!1;y(De.Lines),B(ie);var o=t.featureValues[d.WorldFeature.IntervalCountdown],l=void 0===o?Object(d.default_world_feature)(d.WorldFeature.IntervalCountdown):o;s(t),v.map((function(e){var t=_e(e).percentToValue,a=r[e][0];n.applyFeature(e,a,t(a))})),n.world.set_surface_character(t.surfaceCharacter),P(new xe(new h.Vector3,ne(),n,l,a,t,c))}catch(u){return console.log("Problem running",u),e(je[f],ye.NoOp,R)}return!0};Object(o.useEffect)((function(){Object.keys(localStorage).filter((function(e){return"pretenst-2021-02-27"!==e})).forEach((function(e){return localStorage.removeItem(e)})),L(c||je[f],p,R)}),[]);var M=Object(l.c)();return o.createElement("div",null,o.createElement("div",{style:{position:"absolute",left:0,right:0,height:"100%"}},O?o.createElement("div",{className:"h-100"},o.createElement(_.a,{style:{backgroundColor:"black",borderStyle:"solid",borderColor:w===De.Frozen?"#f0ad4e":"black",cursor:w===De.Selecting?"pointer":"default",borderWidth:"2px"}},o.createElement(M,null,o.createElement(Bt,{tensegrity:O,runTenscript:L,selection:A,setSelection:B}))),k?void 0:o.createElement(o.Fragment,null,o.createElement("div",{id:"top-left"},o.createElement(Gt,{tensegrity:O,runTenscript:L})),o.createElement("div",{id:"top-right"},o.createElement(Ut,{tensegrity:O,selection:A})),o.createElement("div",{id:"bottom-left"},o.createElement(qe,null)),o.createElement("div",{id:"bottom-middle"},o.createElement(at,{tensegrity:O}))),o.createElement("div",{id:"top-middle"},o.createElement(Jt,{tensegrity:O})),o.createElement("div",{id:"bottom-right"},o.createElement(ht,{tensegrity:O}))):o.createElement("div",{className:"h-100"},o.createElement("div",{style:{position:"relative",top:"50%",left:"50%"}},o.createElement("h1",null,o.createElement(V.v,null))))))}function Ht(e){var t=document.getElementById("root");s.render(e,t)}function Yt(e,t,n){return Kt.apply(this,arguments)}function Kt(){return(Kt=Object(c.a)(i.a.mark((function e(t,n,r){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=function(e,a){return new O(t,2e3,e?r:n,a)},Ht(o.createElement(l.a,null,o.createElement(qt,{createInstance:a}))),x();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n.d(t,"startReact",(function(){return Yt}))}}]);
//# sourceMappingURL=5.d80d4744.chunk.js.map