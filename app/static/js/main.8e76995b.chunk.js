(window["webpackJsonpgalapagotchi-client"]=window["webpackJsonpgalapagotchi-client"]||[]).push([[0],{264:function(e,t,n){e.exports=n(636)},599:function(e,t){},601:function(e,t){},634:function(e,t,n){},635:function(e,t,n){},636:function(e,t,n){"use strict";n.r(t);var r=n(7),a=n.n(r),i=n(15),o=n(0),c=n.n(o),s=n(69),u=n(45),l=n(5),h=n(6),f=n(30),d=n(27),p=n(88),m=n(28),v=n(655),g=n(643),y=n(1),b="https://galapagotchi.run/api",x="https://github.com/elastic-interval/galapagotchi/blob/master/client/public/about/index.md";var w,S={x:0,y:0};function E(e,t){return e.x===t.x&&e.y===t.y}function k(e,t){return{x:e.x+t.x,y:e.y+t.y}}function O(e){var t=0,n=0;switch(e.adjacentSpots.forEach((function(e){switch(e.surface){case w.Land:t++;break;case w.Water:n++}})),e.surface){case w.Land:return e.connected&&e.adjacentSpots.length<6||t>=2&&n>=1;case w.Water:return t>0;default:return!1}}function j(e){return e.spots.every(O)}function P(e){e.id=e.spots.map((function(e){return e.surface===w.Land?"1":"0"})).map((function(e,t,n){return t%4===0?n.slice(t,t+4).join(""):void 0})).filter((function(e){return e})).map((function(e){return parseInt(function e(t){return t.length<4?e(t+"0"):t}(e),2).toString(16)})).join("")}function N(e,t){return e.spots.find((function(e){return E(e.coords,t)}))}function C(e){var t=e.spots;t.forEach((function(t){t.adjacentSpots=function(e,t){var n=[],r=t.coords;return D.forEach((function(t){var a=N(e,k(t,r));a&&n.push(a)})),n}(e,t),t.connected=t.adjacentSpots.length<6}));for(var n=!0;n;)n=!1,t.forEach((function(e){e.connected||e.adjacentSpots.find((function(t){return t.surface===e.surface&&t.connected}))&&(e.connected=!0,n=!0)}))}!function(e){e.Unknown="unknown",e.Land="land",e.Water="water"}(w||(w={}));var M=0,V=7;function F(e,t){return e&&e.nonce>=t.nonce?e:t}function T(e,t){return function(e,t){return e.y<t.y?-1:e.y>t.y?1:e.x<t.x?-1:e.x>t.x?1:0}(e.coords,t.coords)}var L,R,A=[{x:0,y:0},{x:2,y:0},{x:1,y:-1},{x:-1,y:-1},{x:-2,y:0},{x:-1,y:1},{x:1,y:1},{x:4,y:0},{x:3,y:-1},{x:2,y:-2},{x:0,y:-2},{x:-2,y:-2},{x:-3,y:-1},{x:-4,y:0},{x:-3,y:1},{x:-2,y:2},{x:0,y:2},{x:2,y:2},{x:3,y:1},{x:6,y:0},{x:5,y:-1},{x:4,y:-2},{x:3,y:-3},{x:1,y:-3},{x:-1,y:-3},{x:-3,y:-3},{x:-4,y:-2},{x:-5,y:-1},{x:-6,y:0},{x:-5,y:1},{x:-4,y:2},{x:-3,y:3},{x:-1,y:3},{x:1,y:3},{x:3,y:3},{x:4,y:2},{x:5,y:1},{x:8,y:0},{x:7,y:-1},{x:6,y:-2},{x:5,y:-3},{x:4,y:-4},{x:2,y:-4},{x:0,y:-4},{x:-2,y:-4},{x:-4,y:-4},{x:-5,y:-3},{x:-6,y:-2},{x:-7,y:-1},{x:-8,y:0},{x:-7,y:1},{x:-6,y:2},{x:-5,y:3},{x:-4,y:4},{x:-2,y:4},{x:-0,y:4},{x:2,y:4},{x:4,y:4},{x:5,y:3},{x:6,y:2},{x:7,y:1},{x:10,y:0},{x:9,y:-1},{x:8,y:-2},{x:7,y:-3},{x:6,y:-4},{x:5,y:-5},{x:3,y:-5},{x:1,y:-5},{x:-1,y:-5},{x:-3,y:-5},{x:-5,y:-5},{x:-6,y:-4},{x:-7,y:-3},{x:-8,y:-2},{x:-9,y:-1},{x:-10,y:0},{x:-9,y:1},{x:-8,y:2},{x:-7,y:3},{x:-6,y:4},{x:-5,y:5},{x:-3,y:5},{x:-1,y:5},{x:1,y:5},{x:3,y:5},{x:5,y:5},{x:6,y:4},{x:7,y:3},{x:8,y:2},{x:9,y:1},{x:12,y:0},{x:11,y:-1},{x:10,y:-2},{x:9,y:-3},{x:8,y:-4},{x:7,y:-5},{x:6,y:-6},{x:4,y:-6},{x:2,y:-6},{x:0,y:-6},{x:-2,y:-6},{x:-4,y:-6},{x:-6,y:-6},{x:-7,y:-5},{x:-8,y:-4},{x:-9,y:-3},{x:-10,y:-2},{x:-11,y:-1},{x:-12,y:0},{x:-11,y:1},{x:-10,y:2},{x:-9,y:3},{x:-8,y:4},{x:-7,y:5},{x:-6,y:6},{x:-4,y:6},{x:-2,y:6},{x:0,y:6},{x:2,y:6},{x:4,y:6},{x:6,y:6},{x:7,y:5},{x:8,y:4},{x:9,y:3},{x:10,y:2},{x:11,y:1}],D=[{x:2,y:0},{x:1,y:-1},{x:-1,y:-1},{x:-2,y:0},{x:-1,y:1},{x:1,y:1}];!function(e){e[e.Busy=0]="Busy",e[e.Growing=1]="Growing",e[e.Shaping=2]="Shaping",e[e.Slack=3]="Slack",e[e.Realizing=4]="Realizing",e[e.Realized=6]="Realized"}(L||(L={})),function(e){e[e.Gravity=0]="Gravity",e[e.Drag=1]="Drag",e[e.PretenstFactor=2]="PretenstFactor",e[e.IterationsPerFrame=3]="IterationsPerFrame",e[e.IntervalCountdown=4]="IntervalCountdown",e[e.PretenstCountdown=5]="PretenstCountdown",e[e.FacePullEndZone=6]="FacePullEndZone",e[e.FacePullOrientationForce=7]="FacePullOrientationForce",e[e.SlackThreshold=8]="SlackThreshold",e[e.ShapingPretenstFactor=9]="ShapingPretenstFactor",e[e.ShapingStiffnessFactor=10]="ShapingStiffnessFactor",e[e.ShapingDrag=11]="ShapingDrag",e[e.MaxStrain=12]="MaxStrain",e[e.VisualStrain=13]="VisualStrain",e[e.NexusPushLength=20]="NexusPushLength",e[e.ColumnPushLength=21]="ColumnPushLength",e[e.TriangleLength=22]="TriangleLength",e[e.RingLength=23]="RingLength",e[e.NexusCrossLength=24]="NexusCrossLength",e[e.ColumnCrossLength=25]="ColumnCrossLength",e[e.BowMidLength=26]="BowMidLength",e[e.BowEndLength=27]="BowEndLength",e[e.PushOverPull=30]="PushOverPull",e[e.PushRadiusFactor=31]="PushRadiusFactor",e[e.PullRadiusFactor=32]="PullRadiusFactor",e[e.MaxStiffness=33]="MaxStiffness"}(R||(R={}));var H,I=60,z=Object.keys(R).filter((function(e){return isNaN(parseInt(e,10))})).map((function(e){return R[e]}));function G(e){switch(e){case H.NexusPush:return"Nex Push";case H.ColumnPush:return"Col Push";case H.Triangle:return"Tri";case H.Ring:return"Ring";case H.NexusCross:return"Nex Cross";case H.ColumnCross:return"Col Cross";case H.BowMid:return"Bow Mid";case H.BowEnd:return"Bow End";case H.FacePull:return"Face Pull"}}!function(e){e[e.NexusPush=0]="NexusPush",e[e.ColumnPush=1]="ColumnPush",e[e.Triangle=2]="Triangle",e[e.Ring=3]="Ring",e[e.NexusCross=4]="NexusCross",e[e.ColumnCross=5]="ColumnCross",e[e.BowMid=6]="BowMid",e[e.BowEnd=7]="BowEnd",e[e.FacePull=8]="FacePull"}(H||(H={}));var B,_,Y,J=Object.keys(H).filter((function(e){return e.length>1&&H[e]!==H.FacePull})).map((function(e){return H[e]}));function U(e){return e===H.ColumnPush||e===H.NexusPush}function Z(e){var t=R.NexusPushLength;if(!(e<t||e>R.BowEndLength))return H[H[e-t]]}function W(e){return R[R[e+R.NexusPushLength]]}!function(e){e[e.Rest=0]="Rest",e[e.Forward=1]="Forward",e[e.TurnLeft=2]="TurnLeft",e[e.TurnRight=3]="TurnRight",e[e.Reverse=4]="Reverse"}(B||(B={})),function(e){e[e.Middle=0]="Middle",e[e.RightSide=1]="RightSide",e[e.LeftSide=2]="LeftSide"}(_||(_={})),function(e){e[e.Frozen=0]="Frozen",e[e.Sticky=1]="Sticky",e[e.Slippery=2]="Slippery",e[e.Bouncy=3]="Bouncy"}(Y||(Y={}));var X=function(){function e(t,n,r,a){Object(l.a)(this,e),this.index=t,this.buffer=n,this.releaseInstance=r,this.fabricEngine=a,this._fabricFeatures=void 0,this._midpoint=void 0,this._lineColors=void 0,this._lineLocations=void 0,this._faceMidpoints=void 0,this._faceNormals=void 0,this._faceLocations=void 0,this._jointLocations=void 0,this._jointVelocities=void 0,this._unitVectors=void 0,this._strains=void 0,this._strainNuances=void 0,this._stiffnesses=void 0,this._linearDensities=void 0;var i=this.engine,o=i._fabricOffset(),c=this.buffer;this._fabricFeatures=new $(c,o+i._fabricFeatures(),(function(){return I})),this._midpoint=new $(c,o+i._midpoint(),(function(){return 3})),this._lineColors=new $(c,o+i._lineColors(),(function(){return 3*i.getIntervalCount()*2})),this._lineLocations=new $(c,o+i._lineLocations(),(function(){return 3*i.getIntervalCount()*2})),this._faceMidpoints=new $(c,o+i._faceMidpoints(),(function(){return 3*i.getFaceCount()})),this._faceNormals=new $(c,o+i._faceNormals(),(function(){return 3*i.getFaceCount()*3})),this._faceLocations=new $(c,o+i._faceLocations(),(function(){return 3*i.getFaceCount()*3})),this._jointLocations=new $(c,o+i._jointLocations(),(function(){return 3*i.getJointCount()})),this._jointVelocities=new $(c,o+i._jointVelocities(),(function(){return 3*i.getJointCount()})),this._unitVectors=new $(c,o+i._intervalUnits(),(function(){return 3*i.getIntervalCount()})),this._strains=new $(c,o+i._intervalStrains(),(function(){return i.getIntervalCount()})),this._strainNuances=new $(c,o+i._intervalStrainNuances(),(function(){return i.getIntervalCount()})),this._stiffnesses=new $(c,o+i._stiffnesses(),(function(){return i.getIntervalCount()})),this._linearDensities=new $(c,o+i._linearDensities(),(function(){return i.getIntervalCount()}))}return Object(h.a)(e,[{key:"applyFeature",value:function(e){this._fabricFeatures.floats[e.fabricFeature]=e.numeric}},{key:"setFeatureValue",value:function(e,t){this._fabricFeatures.floats[e]=t}},{key:"release",value:function(){this.releaseInstance(this.index)}},{key:"forgetDimensions",value:function(){this._faceMidpoints.clear(),this._faceLocations.clear(),this._faceNormals.clear(),this._jointLocations.clear(),this._lineLocations.clear(),this._lineColors.clear(),this._unitVectors.clear(),this._strains.clear(),this._strainNuances.clear(),this._stiffnesses.clear(),this._linearDensities.clear()}},{key:"location",value:function(e){return ee(this._jointLocations.floats,e)}},{key:"apply",value:function(e){for(var t=this.engine.getJointCount(),n=0;n<t;n++){var r=ee(this._jointLocations.floats,n);te(r.applyMatrix4(e),this._jointLocations.floats,n)}}},{key:"unitVector",value:function(e){return ee(this._unitVectors.floats,e)}},{key:"velocities",value:function(){return this._jointVelocities.floats}},{key:"faceMidpoint",value:function(e){return ne(e,this._faceLocations.floats)}},{key:"faceNormal",value:function(e){return ne(e,this._faceNormals.floats)}},{key:"intervalLocation",value:function(e){return ee(this._lineLocations.floats,e)}},{key:"getIntervalMidpoint",value:function(e){var t=this.intervalLocation(2*e),n=this.intervalLocation(2*e+1);return(new y.Vector3).add(t).add(n).multiplyScalar(.5)}},{key:"getMidpoint",value:function(e){return ee(this._midpoint.floats,0,e)}},{key:"strains",get:function(){return this._strains.floats}},{key:"strainNuances",get:function(){return this._strainNuances.floats}},{key:"stiffnesses",get:function(){return this._stiffnesses.floats}},{key:"linearDensities",get:function(){return this._linearDensities.floats}},{key:"faceLocations",get:function(){return this._faceLocations.floats}},{key:"faceNormals",get:function(){return this._faceNormals.floats}},{key:"lineLocations",get:function(){return this._lineLocations.floats}},{key:"lineColors",get:function(){return this._lineColors.floats}},{key:"engine",get:function(){return this.fabricEngine.setInstance(this.index),this.fabricEngine}}]),e}(),$=function(){function e(t,n,r){Object(l.a)(this,e),this.buffer=t,this.offset=n,this.length=r,this.array=void 0}return Object(h.a)(e,[{key:"clear",value:function(){this.array=void 0}},{key:"floats",get:function(){return this.array?this.array:this.array=new Float32Array(this.buffer,this.offset,this.length())}}]),e}(),Q=128,q=3*Q,K=q*Float32Array.BYTES_PER_ELEMENT,ee=function(e,t,n){var r=3*t;return n?(n.set(e[r],e[r+1],e[r+2]),n):new y.Vector3(e[r],e[r+1],e[r+2])},te=function(e,t,n){var r=3*n;t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z};function ne(e,t){var n=3*e,r=ee(t,n),a=ee(t,n+1),i=ee(t,n+2);return(new y.Vector3).add(r).add(a).add(i).multiplyScalar(1/3)}var re,ae=function(){function e(t){var n=this;Object(l.a)(this,e),this.instanceArray=[],this.instanceUsed=[],this.arrayBuffer=void 0,this.spotCenters=void 0,this.hexalotBits=void 0;var r=t.init();if(this.arrayBuffer=t.memory.buffer,this.spotCenters=new Float32Array(this.arrayBuffer,0,q),this.hexalotBits=new Int8Array(this.arrayBuffer,K,Q),0===this.arrayBuffer.byteLength)throw new Error("Zero byte length! ".concat(r));for(var a=0;a<t.getInstanceCount();a++)this.instanceArray.push(new X(a,this.arrayBuffer,(function(e){return n.instanceUsed[e]=!1}),t)),this.instanceUsed.push(!1)}return Object(h.a)(e,[{key:"setHexalot",value:function(e,t){var n=this;if(e.length!==A.length||t.length!==A.length)throw new Error("Size problem");e.forEach((function(e,t){n.spotCenters[3*t]=e.x,n.spotCenters[3*t+1]=e.y,n.spotCenters[3*t+2]=e.z})),t.forEach((function(e,t){n.hexalotBits[t]=e?1:0}))}},{key:"allocateInstance",value:function(){var e=this.instanceUsed.indexOf(!1);if(!(e<0))return this.instanceUsed[e]=!0,this.instanceArray[e]}}]),e}(),ie=n(255);!function(e){e.FlyingIn="Flying in",e.StartGrowth="Start growth",e.GrowthStep="Growth step",e.GrowthComplete="Growth complete",e.Cycle="Cycle",e.Command="Command",e.AppMode="App mode"}(re||(re={}));var oe,ce=new u.BehaviorSubject({event:re.FlyingIn}),se=n(637);!function(e){e.AvailableSpot="Available spot",e.Evolving="Evolving",e.Friend="Friend",e.FreeSpot="Free spot",e.Home="Home",e.Pioneering="Pioneering",e.Planning="Planning",e.Riding="Riding",e.Terraforming="Terraforming",e.Unknown="Unknown"}(oe||(oe={}));var ue,le,he=[{title:oe.AvailableSpot,body:o.createElement(se.a,null,"This spot is unoccupied and can be claimed.")},{title:oe.Planning,body:o.createElement(se.a,null,"You are planning your journey.  This journey is where you galapagotchi rides when you launch it, and it is the path that the evolution will follow.")},{title:oe.Evolving,body:o.createElement(se.a,null,"Your gotchi is experiencing a kind of multiverse evolution. It has been placed in competition with a number of mutations of itself, and they are now locked in a fight for survival.")},{title:oe.Terraforming,body:o.createElement(se.a,null,"You have reserved a new hexalot, but this has created virgin territory at the edge of the island which you still have to terraform.")},{title:oe.Friend,body:o.createElement(se.a,null,"You have selected somebody else's galapagotchi.  You can take it for a ride to see how well it can run.")},{title:oe.FreeSpot,body:o.createElement(se.a,null,"A free spot is a hexagonal spot which can be terraformed, which means that you can turn it into land or water.")},{title:oe.Home,body:o.createElement(se.a,null,"You have selected your home hexalot, and from here you can plan the gotchi's journey. If you already have a journey planned you can try and ride it, or you can start the evolution process so that your gotchi acquires motor skills by survival of the fittest.")},{title:oe.Pioneering,body:o.createElement(se.a,null,"You are a pioneer, so we can assume that you need no instructions.")},{title:oe.Riding,body:o.createElement(se.a,null,"You are riding on a gotchi, which means that you tag along close behind as the gotchi runs each leg of its journey.")},{title:oe.Unknown,body:o.createElement(se.a,null,"Unknown state?")}];function fe(){return{width:window.innerWidth,height:window.innerHeight,left:window.screenLeft,top:window.screenTop}}!function(e){e.Evolving="Evolving",e.Exploring="Exploring",e.Flying="Flying",e.Planning="Planning",e.Riding="Riding",e.Stopped="Stopped",e.Terraforming="Terraforming"}(ue||(ue={})),function(e){e.Cancel="Cancel",e.ClaimHexalot="Claim hexalot",e.DiscardGenes="Discard genes",e.Evolve="Evolve",e.Home="Home",e.MakeLand="Make into land",e.MakeWater="Make into water",e.Plan="Plan",e.Ride="Ride",e.Start="Start",e.Stop="Stop",e.Terraform="Terraform"}(le||(le={}));var de=n(33),pe=[{index:0,numeral:"1",symbol:"\u2680"},{index:1,numeral:"2",symbol:"\u2681"},{index:2,numeral:"3",symbol:"\u2682"},{index:3,numeral:"4",symbol:"\u2683"},{index:4,numeral:"5",symbol:"\u2684"},{index:5,numeral:"6",symbol:"\u2685"}],me=function(){var e={};return pe.forEach((function(t){e[t.numeral]=t,e[t.symbol]=t})),e}();function ve(e){if(0===e.length)throw new Error("No dice!");var t=Math.pow(6,e.length);return(e.reduce((function(e,t){return 6*e+t.index}),0)+.5)/t}var ge=function(){function e(t,n){Object(l.a)(this,e),this.gene=t,this.roll=n,this.cursor=0}return Object(h.a)(e,[{key:"chooseFrom",value:function(e){var t=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Math.floor(ve(n)*e)};return e<=6?t(this.next()):e<=36?t(this.next(),this.next()):e<=216?t(this.next(),this.next(),this.next()):e<=1296?t(this.next(),this.next(),this.next(),this.next()):t(this.next(),this.next(),this.next(),this.next(),this.next())}},{key:"next",value:function(){for(;this.gene.dice.length<this.cursor+1;)this.gene.dice.push(this.roll());return this.gene.dice[this.cursor++]}},{key:"size",get:function(){return this.gene.dice.length}}]),e}();function ye(){return pe[Math.floor(Math.random()*pe.length)]}function be(){return new Se([],ye)}function xe(e){if(!e.genes)return be();var t=e.genes.map((function(e){return{state:e.state,mutationCount:e.mutationCount,dice:(t=e.geneString,t.split("").map((function(e){return me[e]})).filter((function(e){return!!e})))};var t}));return new Se(t,ye)}function we(e){if(e)return xe(e)}var Se=function(){function e(t,n){Object(l.a)(this,e),this.genes=t,this.roll=n}return Object(h.a)(e,[{key:"createReader",value:function(e){var t=this.genes.find((function(t){return e===t.state}));if(t)return new ge(t,this.roll);var n={state:e,mutationCount:0,dice:[]};return this.genes.push(n),new ge(n,this.roll)}},{key:"withMutatedBehavior",value:function(t,n){var r=this.genes.map((function(e){return{state:e.state,mutationCount:e.mutationCount,dice:e.dice.slice()}})),a=r.find((function(e){return t===e.state}));if(a)for(var i=0;i<n;i++){var o=Math.floor(Math.random()*a.dice.length);a.dice[o]=this.roll(),a.mutationCount++}return new e(r,this.roll)}},{key:"genomeData",get:function(){return{genes:this.genes.map((function(e){return{state:e.state,mutationCount:e.mutationCount,geneString:(t=e.dice,t.map((function(e){return e.symbol})).join(""))};var t}))}}}]),e}(),Ee=17.32,ke=30,Oe=[new y.Vector3(0,0,-20),new y.Vector3(-17.32,0,-10),new y.Vector3(-17.32,0,10),new y.Vector3(0,0,20),new y.Vector3(17.32,0,10),new y.Vector3(17.32,0,-10)],je=new y.Color("silver"),Pe=new y.Color("tan"),Ne=new y.Color("darkturquoise"),Ce=6,Me=new y.Vector3(0,1,0),Ve=.03,Fe=function(){function e(t,n,r){Object(l.a)(this,e),this.gotchi=t,this.mutatingGenome=r,this.votes=[],this.currentLeg=void 0,this.leg=n}return Object(h.a)(e,[{key:"reorient",value:function(){if(this.touchedDestination){var e=this.leg.nextLeg;e?this.leg=e:this.gotchi.nextState=B.Rest}if(this.fabric.nextState!==B.Rest){var t=this.voteState();this.nextState!==t&&(console.log("".concat(this.index," turned ").concat(B[this.nextState]," to ").concat(B[t])),this.gotchi.nextState=t)}}},{key:"startMoving",value:function(){this.leg=this.currentLeg}},{key:"stopMoving",value:function(){this.gotchi.nextState=B.Rest}},{key:"mutateGenome",value:function(e){if(!this.mutatingGenome)throw new Error("Not evolving");this.mutatingGenome=this.mutatingGenome.withMutatedBehavior(this.nextState,e)}},{key:"iterate",value:function(e){return this.gotchi.iterate(e)}},{key:"createGotchi",value:function(e){return this.gotchi.copyWithGenome(e)}},{key:"recycle",value:function(){this.gotchi.recycle()}},{key:"voteState",value:function(){var e=this.votes,t=this.directionToTarget;e.push(t),e.length>30&&e.shift();for(var n=e.reduce((function(e,t){return e[t]++,e}),[0,0,0,0,0]),r=B.Forward;r<=B.Reverse;r++)if(30===n[r]&&this.nextState!==r)return r;return t}},{key:"height",get:function(){return this.gotchi.body.midpoint.y}},{key:"isResting",get:function(){return this.gotchi.isResting}},{key:"leg",get:function(){return this.currentLeg},set:function(e){this.currentLeg=e,this.votes=[],this.gotchi.nextState=this.voteState()}},{key:"pointerGeometry",get:function(){return this.gotchi.body.pointerGeometryFor(this.gotchi.body.currentState)}},{key:"facesGeometry",get:function(){return this.gotchi.body.facesGeometry}},{key:"index",get:function(){return this.gotchi.index}},{key:"age",get:function(){return this.gotchi.age}},{key:"fabric",get:function(){return this.gotchi.body}},{key:"offspringGenome",get:function(){if(!this.mutatingGenome)throw new Error("Not evolving");return this.mutatingGenome.genomeData}},{key:"nextState",get:function(){return this.fabric.nextState}},{key:"evaluated",get:function(){return{jockey:this,distanceFromTarget:this.gotchi.getDistanceFrom(this.target)}}},{key:"genomeData",get:function(){return this.gotchi.genomeData}},{key:"touchedDestination",get:function(){return this.gotchi.getDistanceFrom(this.target)<4}},{key:"directionToTarget",get:function(){var e=this.toTarget,t=e.dot(this.gotchi.body.forward),n=e.dot(this.gotchi.body.right);return t>0?n>0?t>n?B.Forward:B.TurnRight:t>-n?B.Forward:B.TurnLeft:n>0?-t>n?B.Reverse:B.TurnRight:-t>-n?B.Reverse:B.TurnLeft}},{key:"toTarget",get:function(){var e=new y.Vector3;return e.subVectors(this.target,this.gotchi.body.seed),e.y=0,e.normalize(),e}},{key:"target",get:function(){return this.currentLeg.goTo.center}}]),e}(),Te=new y.Vector3(0,10,0),Le=function(){function e(t,n,r){Object(l.a)(this,e),this.journey=t,this.visited=n,this.goTo=r}return Object(h.a)(e,[{key:"nextLeg",get:function(){var t=this.visited+1;if(t!==this.journey.visits.length){var n=this.journey.visits[t];return new e(this.journey,t,n)}}}]),e}();function Re(e,t,n){if(n){var r=[];if(n.hexalots.forEach((function(t){var n=e.findHexalot(t);n&&r.push(n)})),!(r.length<2||r[0].id!==t.id))return new Ae(r)}}var Ae=function(){function e(t){if(Object(l.a)(this,e),this.hexalots=t,0===t.length)throw new Error("Empty journey")}return Object(h.a)(e,[{key:"withTruncatedVisit",value:function(t){var n=this.hexalots.indexOf(t);if(!(n<0))return new e(this.hexalots.slice(0,n+1))}},{key:"withVisit",value:function(e){return function e(t,n){var r=t.length-1;if(!(r<0)){var a=t[r].centerSpot.adjacentHexalots.find((function(e){return e.id===n.id}));return a?new Ae(t.concat(a)):e(t.slice(0,r),n)}}(this.hexalots,e)}},{key:"visits",get:function(){return this.hexalots}},{key:"firstLeg",get:function(){if(!(this.hexalots.length<2))return new Le(this,0,this.hexalots[1])}},{key:"data",get:function(){return{hexalots:this.hexalots.map((function(e){return e.id}))}}}]),e}();function De(e,t){return He.apply(this,arguments)}function He(){return(He=Object(i.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.genome){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.fetchGenome(n);case 4:t.genome=e.sent;case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ie(e,t,n){return ze.apply(this,arguments)}function ze(){return(ze=Object(i.a)(a.a.mark((function e(t,n,r){var i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fetchJourney(n,r);case 2:if(i=e.sent){e.next=5;break}return e.abrupt("return",t.createRandomJourney());case 5:return e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ge=function(){function e(t,n,r,a){var i=this;Object(l.a)(this,e),this.parentHexalot=t,this.coords=n,this.spots=r,this.gotchiFactory=a,this.id=void 0,this.genome=void 0,this.journey=void 0,this.childHexalots=[],this.nonce=0,this.visited=!1,this.spots[0].centerOfHexalot=this;for(var o=1;o<=6;o++)this.spots[o].adjacentHexalots.push(this);this.spots.forEach((function(e){return e.memberOfHexalot.push(i)})),t&&(t.childHexalots.push(this),this.nonce=t.nonce+1)}return Object(h.a)(e,[{key:"fetchGenome",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getGenomeData(this);case 2:return n=e.sent,this.genome=we(n),e.abrupt("return",this.genome);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchJourney",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getJourneyData(this);case 2:return r=e.sent,this.journey=Re(n,this,r),e.abrupt("return",this.journey);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"adjustedJourney",value:function(e){if(!this.journey)return new Ae([this,e]);var t=this.journey.withTruncatedVisit(e);if(t)return t;var n=this.journey.withVisit(e);return n||this.journey}},{key:"createRandomJourney",value:function(){return this.journeyOfLength(2)}},{key:"createNativeGotchi",value:function(){if(this.genome)return this.gotchiFactory.createGotchiSeed(this,this.rotation,this.genome)}},{key:"createGotchi",value:function(e,t){return this.gotchiFactory.createGotchiSeed(this,t,e)}},{key:"journeyOfLength",value:function(e){for(var t=[this];t.length<e+1;){var n=t[t.length-1].centerSpot.adjacentHexalots.filter((function(e){return t.every((function(t){return t.id!==e.id}))}));if(0===n.length)break;var r=n[Math.floor(Math.random()*n.length)];t.push(r)}return new Ae(t)}},{key:"rotation",get:function(){if(!this.journey||this.journey.visits.length<2)return Math.floor(6*Math.random());var e=this.journey.visits[1];return this.centerSpot.adjacentSpots.findIndex((function(t){var n=t.centerOfHexalot;return!!n&&n.id===e.id}))}},{key:"firstLeg",get:function(){if(this.journey){var e=this.journey.firstLeg;if(e)return e}var t=this.createRandomJourney().firstLeg;if(!t)throw new Error("Unable to create first leg");return t}},{key:"centerSpot",get:function(){return this.spots[0]}},{key:"center",get:function(){return this.centerSpot.center}},{key:"seed",get:function(){return new y.Vector3(0,10,0).add(this.center)}}]),e}(),Be=n(16),_e=function(){function e(t){Object(l.a)(this,e),this.coords=t,this.center=void 0,this.adjacentSpots=[],this.memberOfHexalot=[],this.adjacentHexalots=[],this.centerOfHexalot=void 0,this.connected=!1,this.faceNames=[],this.surface=w.Unknown,this.free=!1,this.center=new y.Vector3(t.x*Ee,0,t.y*ke)}return Object(h.a)(e,[{key:"isMemberOfOneHexalot",value:function(e){return 1===this.memberOfHexalot.length&&this.memberOfHexalot[0].id===e}},{key:"addSurfaceGeometry",value:function(e,t,n,r){var a=this,i=O(this)?1:.9;n.push.apply(n,Object(Be.a)(Oe.map((function(e){return new y.Vector3(e.x*i+a.center.x,e.y*i+a.center.y,e.z*i+a.center.z)})))),n.push(this.center);for(var o=this.normalSpread,c=0;c<Ce;c++){var s=t*(Oe.length+1),u=(c+1)%Ce,l=[Me,(new y.Vector3).add(Me).addScaledVector(Oe[c],o).normalize(),(new y.Vector3).add(Me).addScaledVector(Oe[u],o).normalize()];this.faceNames.push("".concat(e,":").concat(r.length)),r.push(new y.Face3(s+Ce,s+c,s+u,l,this.color))}}},{key:"addHangerGeometry",value:function(e){for(var t=0;t<Ce;t++){var n=Oe[t],r=Oe[(t+1)%Ce];e.push((new y.Vector3).addVectors(this.center,Te)),e.push((new y.Vector3).add(this.center).addScaledVector(n,.2)),e.push((new y.Vector3).add(this.center).addScaledVector(n,.2)),e.push((new y.Vector3).add(this.center).addScaledVector(r,.2))}}},{key:"addSeed",value:function(e,t,n,r){for(var a=[],i=new y.Vector3(0,10,0),o=n.length,c=0;c<5;c++){var s=c*Math.PI*2/5,u=new y.Vector3(1*Math.sin(s)+i.x,1*Math.cos(s)+i.y,i.z);a.push(u),n.push(u)}var l=n.length,h=new y.Vector3(i.x,i.y,i.z-1);n.push(h),a.push(h);var f=n.length,d=new y.Vector3(i.x,i.y,i.z+1);n.push(d),a.push(d);var p=(new y.Matrix4).makeRotationY(Math.PI/3*e),m=(new y.Matrix4).makeTranslation(this.center.x,this.center.y,this.center.z).multiply(p);a.forEach((function(e){return e.applyMatrix4(m)}));for(var v=0;v<5;v++){var g=o+(v+1)%5,b=o+v;this.faceNames.push("".concat(t,":").concat(r.length)),r.push(new y.Face3(l,b,g)),this.faceNames.push("".concat(t,":").concat(r.length)),r.push(new y.Face3(f,g,b))}}},{key:"addRaisedHexagon",value:function(e,t){for(var n=this,r=function(r){return e.push(new y.Vector3(0,t,0).add(n.center).add(r))},a=0;a<Ce;a++){var i=(a+1)%Ce;r(Oe[a]),r(Oe[i])}}},{key:"addRaisedHexagonParts",value:function(e,t,n,r){for(var a=this,i=(Math.floor(n/r)+5)%6,o=n%r===0,c=function(n){return e.push(new y.Vector3(0,t,0).add(a.center).add(n))},s=0;s<Ce;s++){var u=(s+1)%Ce;(i===s||i===u||o&&i===(u+1)%Ce)&&(c(Oe[s]),c(Oe[u]))}}},{key:"isCandidateHexalot",value:function(e){if(this.surface!==w.Land)return!1;var t=this.centerOfHexalot;return t?!!e&&t.id===e.id:e?this.adjacentHexalots.some((function(t){return t.id!==e.id})):this.adjacentHexalots.length>0}},{key:"color",get:function(){switch(this.surface){case w.Land:return Pe;case w.Water:return Ne;default:return je}}},{key:"normalSpread",get:function(){switch(this.surface){case w.Land:return Ve;case w.Water:return-.02;default:return 0}}}]),e}(),Ye=function(){function e(t,n,r,a){Object(l.a)(this,e),this.gotchiFactory=n,this.name=void 0,this.spots=[],this.hexalots=[],this.vacantHexalot=void 0,function(e,t){for(var n=t.getOrCreateHexalot(void 0,S),r=e.hexalots.split("").reverse().map((function(e){return Number(e)})),a=[];r.length>0;){var i=r.pop();switch(i){case M:n=a.pop();break;case V:n&&a.push(n);break;case 1:case 2:case 3:case 4:case 5:case 6:n&&(n=t.hexalotAroundSpot(n.spots[i]))}}var o=(e.spots?e.spots.split(""):[]).map((function(e){return parseInt(e,16)})).map((function(e){return[0!==(8&e),0!==(4&e),0!==(2&e),0!==(1&e)]})),c=[].concat.apply([],o).reverse();if(t.spots.sort(T),c.length)t.spots.forEach((function(e){var t=c.pop();e.surface=t?w.Land:w.Water}));else if(1===t.hexalots.length){var s=t.hexalots[0];s.spots.map((function(e){return e.surface=Math.random()>.5?w.Land:w.Water})),s.spots[0].surface=w.Land}t.hexalots.forEach(P)}(t,this),this.name=t.name}return Object(h.a)(e,[{key:"findHexalot",value:function(e){return this.hexalots.find((function(t){return t.id===e}))}},{key:"createHexalot",value:function(e){return this.hexalotAroundSpot(e)}},{key:"hexalotAroundSpot",value:function(e){return this.getOrCreateHexalot(function(e){return e.adjacentHexalots.reduce(F,void 0)}(e),e.coords)}},{key:"getOrCreateHexalot",value:function(e,t){var n=this,r=this.hexalots.find((function(e){return E(e.coords,t)}));if(r)return r;var a=A.map((function(e){return n.getOrCreateSpot(k(e,t))})),i=new Ge(e,t,a,this.gotchiFactory);return P(i),this.hexalots.push(i),i}},{key:"getOrCreateSpot",value:function(e){var t=N(this,e);if(t)return t;var n=new _e(e);return this.spots.push(n),n}},{key:"singleHexalot",get:function(){return 1!==this.hexalots.length?void 0:this.hexalots[0]}},{key:"midpoint",get:function(){return this.spots.reduce((function(e,t){return e.add(t.center)}),new y.Vector3).multiplyScalar(1/this.spots.length)}}]),e}(),Je=15e3,Ue=3,Ze=.001*Math.PI,We=.999*Math.PI/2;function Xe(e){return(1-e)*We+e*Ze}function $e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$e(n,!0).forEach((function(t){Object(de.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$e(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qe(e){return{get target(){return e.fabric.midpoint},tooFar:1.4*Ue,tooClose:1.2*Ue,towardsDistance:.04,tooVertical:Xe(.1),tooHorizontal:Xe(0),towardsPolarAngle:.005,appMode:ue.Riding}}function Ke(e){return{get target(){return e.midpoint},tooFar:35,tooClose:25,towardsDistance:.1,tooVertical:Xe(.1),tooHorizontal:Xe(0),towardsPolarAngle:.005,appMode:ue.Evolving}}var et=450;function tt(e,t){return{get target(){return e.genome?e.seed:e.center},tooFar:1.05*et,tooClose:.95*et,towardsDistance:.08,tooVertical:Xe(1),tooHorizontal:Xe(.9),towardsPolarAngle:.008,appMode:t}}function nt(e,t){return Qe({},e,{get target(){return t.genome?t.seed:t.center}})}function rt(e,t){return{get target(){return e.midpoint},tooFar:105,tooClose:95,towardsDistance:.1,tooVertical:Xe(1),tooHorizontal:Xe(.9),towardsPolarAngle:.01,appMode:t}}function at(e,t){return Qe({},e,{target:t.center})}var it=n(86),ot=15e3,ct=function(){function e(t,n){var r=this;Object(l.a)(this,e),this.home=t,this.prototypeJockey=n,this.currentJockeys=new it.BehaviorSubject([]),this.midpointVector=new y.Vector3,this.rebooting=!1,this.rotation=void 0,this.maxAge=void 0;var a=this.leg;if(n&&n.nextState!==B.Rest)throw new Error("Cannot create evolution from jockey which is not resting");t.centerSpot.adjacentSpots.forEach((function(e,t){var n=e.centerOfHexalot;n&&a.goTo.id===n.id&&(r.rotation=t)})),this.currentJockeys.next(this.createPopulation()),this.maxAge=this.startAge+ot}return Object(h.a)(e,[{key:"iterate",value:function(){var e=this,t=this.currentJockeys.getValue();if(0!==t.length&&!this.rebooting){t.forEach((function(e){return e.reorient()}));var n=t.filter((function(t){return t.age<e.maxAge}));if(0===n.length)return this.adjustAgeLimit(),void this.nextGenerationFromSurvival();n.forEach((function(t){var n=e.maxAge-t.age;t.iterate(n>60?60:n)===re.Cycle&&(console.log("mutate"),t.mutateGenome(1))}))}}},{key:"recycle",value:function(){this.currentJockeys.getValue().forEach((function(e){return e.recycle()})),this.prototypeJockey&&this.prototypeJockey.recycle()}},{key:"adjustAgeLimit",value:function(){this.maxAge+=1e3;var e=this.maxAge-this.startAge;e>25e3&&(this.maxAge=this.startAge+ot),console.log("Age: [".concat(this.startAge," to ").concat(this.maxAge,"] ").concat(e))}},{key:"nextGenerationFromSurvival",value:function(){var e=this;this.rebooting=!0;var t=this.rankedJockeys,n=t.splice(Math.ceil(.66*t.length));this.currentJockeys.next(t.map((function(e){return e.jockey}))),n.forEach((function(e){return e.jockey.recycle()})),setTimeout((function(){var r=[];n.map((function(e){return e.jockey})).forEach((function(){var n=t[Math.floor(t.length*Math.random())].jockey,a=e.createOffspring(n);a&&r.push(a)})),e.currentJockeys.next([]),setTimeout((function(){t.forEach((function(e){return e.jockey.recycle()})),t.map((function(e){return e.jockey})).forEach((function(t){var n=e.createJockey(t.leg,xe(t.genomeData));n&&r.push(n)})),e.currentJockeys.next(r),e.rebooting=!1}),500)}),500)}},{key:"createPopulation",value:function(){var e=this.home.genome;if(!e)throw new Error("No genome!");for(var t=xe(e.genomeData),n=[];;){var r=this.createJockey(this.leg,t);if(!r)break;n.push(r),t=t.withMutatedBehavior(r.nextState,5)}return n}},{key:"createOffspring",value:function(e){var t=xe(e.offspringGenome);return this.createJockey(e.leg,t)}},{key:"createJockey",value:function(e,t){var n=this.prototypeJockey,r=n?n.createGotchi(t):this.home.createGotchi(t,this.rotation);if(r)return new Fe(r,e,xe(r.genomeData))}},{key:"leg",get:function(){return this.prototypeJockey?this.prototypeJockey.leg:this.home.firstLeg}},{key:"startAge",get:function(){return this.prototypeJockey?this.prototypeJockey.age:0}},{key:"midpoint",get:function(){var e=this.currentJockeys.getValue();if(0===e.length)return this.midpointVector;var t=new y.Vector3;return e.map((function(e){return e.fabric.midpoint})).forEach((function(e){return t.add(e)})),this.midpointVector.copy(t.multiplyScalar(1/e.length)),this.midpointVector}},{key:"extractFittest",get:function(){var e=this.strongest;if(e){var t=e.jockey.gotchi.index;return this.currentJockeys.next(this.currentJockeys.getValue().filter((function(e){return e.gotchi.index!==t}))),e.jockey}}},{key:"rankedJockeys",get:function(){var e=this.currentJockeys.getValue(),t=this.prototypeJockey;return t&&(e=e.filter((function(e){return e.index!==t.index}))),e.map((function(e){return e.evaluated})).sort((function(e,t){return e.distanceFromTarget-t.distanceFromTarget}))}},{key:"strongest",get:function(){return this.rankedJockeys[0]}}]),e}();function st(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ut(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?st(n,!0).forEach((function(t){Object(de.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):st(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var lt=function(){function e(t){Object(l.a)(this,e),this.nextState=void 0,this.nextState=ut({},t,{nonce:t.nonce+1})}return Object(h.a)(e,[{key:"withIsland",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.withSelectedSpot();case 2:return e.sent.withJourney().withoutEvolution.nextState=ut({},this.nextState,{island:t,islandData:n}),e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"withFlightState",value:function(e){return this.nextState=ut({},this.nextState,{flightState:e}),this}},{key:"reachedFlightStateTarget",value:function(e){return this.nextState=ut({},this.nextState,{appMode:e.appMode}),this}},{key:"withJourney",value:function(e){return this.nextState=ut({},this.nextState,{journey:e}),this}},{key:"withSelectedHexalot",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n,r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.nextState=ut({},this.nextState,{selectedHexalot:t}),n=this.nextState.island,!t){e.next=17;break}return r=nt(this.nextState.flightState,t),this.nextState=ut({},this.nextState,{flightState:r}),e.next=7,De(t,this.nextState.storage);case 7:if(!t.journey){e.next=11;break}return e.abrupt("return",this.withJourney(t.journey));case 11:if(!n){e.next=17;break}return e.next=14,Ie(t,this.nextState.storage,n);case 14:return i=e.sent,t.journey=i,e.abrupt("return",this.withJourney(i));case 17:return e.abrupt("return",this);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"withSelectedSpot",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.nextState=ut({},this.nextState,{selectedSpot:t}),!t){e.next=5;break}return n=at(this.nextState.flightState,t),this.nextState=ut({},this.nextState,{flightState:n}),e.abrupt("return",this.withSelectedHexalot(t.centerOfHexalot));case 5:return e.abrupt("return",this.withSelectedHexalot());case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"withHomeHexalot",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.nextState.island,!this.nextState.homeHexalot&&n){e.next=3;break}throw new Error("Not allowed");case 3:if(this.nextState=ut({},this.nextState,{homeHexalot:t}),t){e.next=6;break}return e.abrupt("return",this.withJourney().withSelectedSpot());case 6:return e.abrupt("return",this.withSelectedSpot(t.centerSpot));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"withJockey",value:function(e){return this.withoutJockey.nextState=ut({},this.nextState,{jockey:e,journey:e.leg.journey,flightState:qe(e),appMode:ue.Flying}),this}},{key:"withEvolution",value:function(e){var t=new ct(e,this.appState.jockey);return this.withoutEvolution.nextState=ut({},this.nextState,{evolution:t,jockey:void 0,flightState:Ke(t),appMode:ue.Flying}),this}},{key:"withSurface",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n,r,i,o,c,s,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.nextState,r=n.selectedSpot,(i=n.island)&&r){e.next=5;break}return e.abrupt("return",this);case 5:if(r.surface=t,r.memberOfHexalot.forEach(P),!(o=r.adjacentSpots.find((function(e){return e.free&&e.surface===w.Unknown})))){e.next=10;break}return e.abrupt("return",this.withSelectedSpot(o));case 10:if(!(c=i.spots.find((function(e){return e.free&&e.surface===w.Unknown})))){e.next=13;break}return e.abrupt("return",this.withSelectedSpot(c));case 13:if(!(s=i.spots.find((function(e){return!O(e)})))){e.next=16;break}return e.abrupt("return",this.withSelectedSpot(s));case 16:if(!(u=i.vacantHexalot)){e.next=19;break}return e.abrupt("return",this.withSelectedSpot(u.centerSpot));case 19:return e.abrupt("return",this);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"appState",get:function(){return this.nextState}},{key:"terraforming",get:function(){return this.nextState=ut({},this.nextState,{appMode:ue.Terraforming}),this}},{key:"planning",get:function(){var e=this.nextState.homeHexalot;if(e){var t=tt(e,ue.Planning);this.nextState=ut({},this.nextState,{appMode:ue.Flying,flightState:t})}return this}},{key:"exploring",get:function(){return this.nextState=ut({},this.nextState,{appMode:ue.Exploring}),this}},{key:"withJockeyStopped",get:function(){var e=ue.Stopped;return this.nextState=ut({},this.nextState,{appMode:e}),this}},{key:"withJockeyRiding",get:function(){var e=ue.Riding;return this.nextState=ut({},this.nextState,{appMode:e}),this}},{key:"withoutJockey",get:function(){var e=this.nextState.jockey;return e&&(e.gotchi.recycle(),this.nextState=ut({},this.nextState,{jockey:void 0,appMode:ue.Flying})),this}},{key:"withoutEvolution",get:function(){var e=this.nextState.evolution;return e&&(e.recycle(),this.nextState=ut({},this.nextState,{evolution:void 0,appMode:ue.Flying})),this}},{key:"withRestructure",get:function(){var e=this.nextState.island;if(!e)return this;C(e);var t=e.hexalots,n=e.spots,r=e.vacantHexalot;1===t.length?n.forEach((function(e){return e.free=!0})):r?n.forEach((function(e){return e.free=e.memberOfHexalot.every((function(e){return e.id===r.id}))})):n.forEach((function(e){return e.free=!1})),t.forEach(P);var a=j(e);this.nextState=ut({},this.nextState,{islandIsLegal:a});var i=e.singleHexalot;if(!a&&i){var o=tt(i,ue.Terraforming);this.nextState=ut({},this.nextState,{flightState:o})}return this}}]),e}();function ht(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ft(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ht(n,!0).forEach((function(t){Object(de.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ht(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var dt=function(){function e(t){Object(l.a)(this,e),this.trans=void 0,this.trans=new lt(t)}return Object(h.a)(e,[{key:"afterCommand",value:function(){var t=Object(i.a)(a.a.mark((function t(n,r){var i,o,c,s,u,l,h,f,d,p,m,v,g,y,b,x,S,E,k,P,N,C,M,V;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.trans,o=i.appState,c=o.island,s=o.islandData,c){t.next=6;break}return t.abrupt("return",this.trans.appState);case 6:u=o.homeHexalot,l=o.selectedHexalot,h=o.jockey,f=o.selectedSpot,d=c.vacantHexalot,p=1===c.hexalots.length?c.hexalots[0]:void 0,t.t0=n,t.next=t.t0===le.DiscardGenes?15:t.t0===le.Home?17:t.t0===le.Ride?33:t.t0===le.Evolve?47:t.t0===le.Start?52:t.t0===le.Stop?56:t.t0===le.MakeLand?60:t.t0===le.MakeWater?65:t.t0===le.Terraform?70:t.t0===le.Cancel?81:t.t0===le.ClaimHexalot?89:t.t0===le.Plan?96:97;break;case 15:return u&&(u.genome=be()),t.abrupt("return",o);case 17:if(!o.jockey){t.next=22;break}return t.next=20,i.withSelectedSpot(o.jockey.gotchi.home.centerSpot);case 20:return m=t.sent,t.abrupt("return",m.withoutJockey.exploring.appState);case 22:if(!u){t.next=27;break}return t.next=25,i.withSelectedSpot(u.centerSpot);case 25:return v=t.sent,t.abrupt("return",v.withoutEvolution.exploring.appState);case 27:if(!l){t.next=32;break}return t.next=30,i.withSelectedSpot();case 30:return g=t.sent,t.abrupt("return",g.withJourney().exploring.appState);case 32:return t.abrupt("return",o);case 33:if(!l){t.next=46;break}if(!(y=o.evolution)||!u){t.next=42;break}if(!(b=y.extractFittest)){t.next=42;break}return x=b.genomeData,u.genome=xe(x),o.storage.setGenomeData(u,x).then((function(){console.log("genome saved")})),t.abrupt("return",i.withoutEvolution.withJockey(b).appState);case 42:if(!(S=l.createNativeGotchi())){t.next=46;break}return E=new Fe(S,l.firstLeg),t.abrupt("return",i.withJockey(E).appState);case 46:return t.abrupt("return",o);case 47:if(!u){t.next=51;break}if(!h||h.isResting){t.next=50;break}throw new Error("Cannot evolve");case 50:return t.abrupt("return",i.withEvolution(u).appState);case 51:return t.abrupt("return",o);case 52:if(!h){t.next=55;break}return h.startMoving(),t.abrupt("return",i.withJockeyRiding.appState);case 55:return t.abrupt("return",o);case 56:if(!h){t.next=59;break}return h.stopMoving(),t.abrupt("return",i.withJockeyStopped.appState);case 59:return t.abrupt("return",o);case 60:if(!f||!f.free){t.next=64;break}return t.next=63,i.withSurface(w.Land);case 63:return t.abrupt("return",t.sent.withRestructure.appState);case 64:return t.abrupt("return",o);case 65:if(!f||!f.free){t.next=69;break}return t.next=68,i.withSurface(w.Water);case 68:return t.abrupt("return",t.sent.withRestructure.appState);case 69:return t.abrupt("return",o);case 70:if(!(k=c.spots.find((function(e){return e.surface===w.Unknown})))){t.next=75;break}return t.next=74,i.withSelectedSpot(k);case 74:return t.abrupt("return",t.sent.appState);case 75:if(!(P=c.spots.find((function(e){return!O(e)})))){t.next=80;break}return t.next=79,i.withSelectedSpot(P);case 79:return t.abrupt("return",t.sent.appState);case 80:return t.abrupt("return",o);case 81:if(N=o.nonce+1,s){t.next=84;break}return t.abrupt("return",o);case 84:return C=new Ye(s,c.gotchiFactory,o.storage,N),t.next=87,i.withIsland(C,s);case 87:return M=t.sent,t.abrupt("return",M.exploring.withRestructure.appState);case 89:if(u||!l||!j(c)||!(p||d&&d.id===l.id)){t.next=95;break}return t.next=92,e.claimHexalot(o,l);case 92:if(!(V=t.sent)){t.next=95;break}return t.abrupt("return",V);case 95:return t.abrupt("return",o);case 96:return t.abrupt("return",i.planning.appState);case 97:throw new Error("Unknown command!");case 98:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}],[{key:"claimHexalot",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){var r,i,o,c,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.island){e.next=4;break}return console.warn("No existing island"),e.abrupt("return",void 0);case 4:return e.next=6,t.storage.claimHexalot(r,n,be().genomeData);case 6:if(i=e.sent){e.next=10;break}return console.warn("No island data arrived"),e.abrupt("return",void 0);case 10:return o=ue.Exploring,!1,c=new Ye(i,r.gotchiFactory,t.storage,t.nonce),s=ft({},t,{nonce:t.nonce+1,island:c,appMode:o,islandIsLegal:!1}),e.next=16,new lt(s).withHomeHexalot(n);case 16:return e.abrupt("return",e.sent.withRestructure.appState);case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),pt=n(638),mt=n(639),vt=n(640),gt=n(641),yt=n(642);function bt(e){var t=wt.find((function(t){return t.title===e}));if(!t)throw new Error("Command not documented: ".concat(e));return t}var xt,wt=[{title:le.Cancel,body:o.createElement(se.a,null,"While you are terraforming the island by terraforming (creating land or water), you can decide to abandon the choice you made and start again.")},{title:le.ClaimHexalot,body:o.createElement(se.a,null,"When you have reserved a hexalot, and terraformed the island to make sure it follows the rules, you can claim the hexalot you reserved. It then belongs to you, since it is completely unique and nobody else can claim the same one.")},{title:le.DiscardGenes,body:o.createElement(se.a,null,"If you don't like what you're seeing during the evolution and you've given up hope for this particular gotchi, you can discard the current set of genes and start from scratch.")},{title:le.Evolve,body:o.createElement(se.a,null,"Evolving creates a group of competing galapagotchis which exist in the same space at the same time, but have slightly mutated genes. They go through cycles, like generations. Every time the slowest are forgotten and the new generation is made by mutating the genes of the current survivors.")},{title:le.Home,body:o.createElement(se.a,null,"Wherever you are, you can go back to your home position up in the tower.")},{title:le.MakeLand,body:o.createElement(se.a,null,"While terraforming, you can choose to make the current hexagonal spot into land.")},{title:le.MakeWater,body:o.createElement(se.a,null,"While terraforming, you can choose to make the current hexagonal spot into water.")},{title:le.Plan,body:o.createElement(se.a,null,"When you plan your journey, you zoom out and see the world from above. Clicking on a new neighbor hexalot adds a leg to your journey, and clicking on one that is already in the journey makes it end there.")},{title:le.Ride,body:o.createElement(se.a,null,"You can ride a gotchi, which means that it will be born from the center tower of its home hexalot and try to follow the arrows of its journey, visiting hexalots along the way.")},{title:le.Start,body:o.createElement(se.a,null,"If you have stopped a gotchi during a ride, you can tell it to start up again.")},{title:le.Stop,body:o.createElement(se.a,null,"If you are tagging along behind a running gotchi, you can tell it to stop.")},{title:le.Terraform,body:o.createElement(se.a,null,"After choosing an unoccupied hexalot, new spots appear at the edge of the island. you can terraform these spots to choose whether they'll be land or water. The terraform button takes you to any problems that still remain on the island.")}],St=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(f.a)(this,Object(d.a)(t).call(this,e))).state={},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this,t=he.find((function(t){return t.title===e.props.toolbarState})),n=this.props.toolbarCommands.map(bt);return o.createElement(pt.a,null,o.createElement(mt.a,null,!!t&&o.createElement("div",null,o.createElement(vt.a,null,t.title),t.body),o.createElement("br",null),n.map((function(e){return o.createElement("div",{key:e.title},o.createElement(ie.a,{color:"success",className:"command-button"},e.title),e.body)}))),o.createElement(gt.a,null,this.footer()))}},{key:"footer",value:function(){var e=this;return o.createElement(yt.a,null,o.createElement("a",{className:"btn btn-info command-button",href:x,target:"_blank"},"Background information"),o.createElement(ie.a,{className:"float-right",color:"info",onClick:function(){return e.props.cancelHelp()}},"Ok, got it"))}}]),t}(o.Component),Et={height:"auto",width:"auto",maxWidth:"70%",display:"inline-flex",textAlign:"left",background:"black",padding:"4px",margin:"5px",borderColor:"inherit",borderWidth:"2px",borderStyle:"solid",borderRadius:"10px"},kt=function(e){function t(e){var n;Object(l.a)(this,t),n=Object(f.a)(this,Object(d.a)(t).call(this,e));var r=oe.Unknown;return n.state={toolbarState:r,toolbarCommands:[],helpVisible:!1},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this,t=this.props.appState.island;return o.createElement("div",{style:Et},this.props.appState.appMode!==ue.Flying&&t?o.createElement("div",null,this.commandButtons(t),!!this.state.helpVisible&&o.createElement(St,{appState:this.props.appState,toolbarState:this.state.toolbarState,toolbarCommands:this.state.toolbarCommands,cancelHelp:function(){return e.setState({helpVisible:!1})}})):o.createElement(ie.a,{color:"info",className:"command-button"},"Hold on!"))}},{key:"commandButtons",value:function(e){var t=this.props.appState,n=e.vacantHexalot,r=t.selectedSpot,a=t.selectedHexalot,i=t.homeHexalot,c=e.singleHexalot;switch(t.appMode){case ue.Terraforming:if(r){if(c&&r.coords===c.centerSpot.coords)return this.buttonToolbar(oe.Pioneering,le.ClaimHexalot);if(r.isCandidateHexalot(n)&&!c)return t.islandIsLegal?this.buttonToolbar(oe.AvailableSpot,le.ClaimHexalot):this.buttonToolbar(oe.Terraforming,le.Terraform,le.Cancel);if(r.free)return this.buttonToolbar(oe.FreeSpot,le.MakeLand,le.MakeWater)}return o.createElement((function(e){return o.createElement("p",null,e.children)}),null,"The island is not yet correct according to the rules. Land must be either at the edge or have two land neighbors. Water must have at least one land neighbor. Click on the marked spots and you can choose to switch them to fix the island.");case ue.Exploring:return function(e){return!!e.homeHexalot&&!!e.selectedHexalot&&e.homeHexalot.id===e.selectedHexalot.id}(t)?this.buttonToolbar(oe.Home,le.Plan,le.Ride,le.Evolve,le.DiscardGenes):a?!i&&a.centerSpot.isCandidateHexalot(n)?this.buttonToolbar(oe.AvailableSpot,le.ClaimHexalot):this.buttonToolbar(oe.Friend,le.Ride,le.Home):this.props.user?o.createElement("p",null,"You are logged in but you have not yet claimed a hexalot. The spots highlighted in green are places that you can claim. You can also click on one of the existing hexalots and go for a ride on the galapagotchi there."):o.createElement("p",null,"You can click on one of the hexalots and go for a ride on the galapagotchi who lives there.");case ue.Planning:return this.buttonToolbar(oe.Planning,le.Home);case ue.Evolving:return this.buttonToolbar(oe.Evolving,le.Ride,le.Home);case ue.Riding:return this.buttonToolbar(oe.Riding,le.Home,le.Stop);case ue.Stopped:return this.buttonToolbar(oe.Riding,le.Home,le.Start,le.Evolve);default:return o.createElement("p",null,"Strange state ",t.appMode)}}},{key:"buttonToolbar",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return setTimeout((function(){t.setState({toolbarState:e,toolbarCommands:r})})),o.createElement("div",null,o.createElement(ie.a,{color:"info",className:"command-button",onClick:function(){return t.setState({helpVisible:!t.state.helpVisible})}},e,": "),!this.state.helpVisible&&r.map((function(e){return t.commandButton(e)})))}},{key:"commandButton",value:function(e){var t=this;return o.createElement(ie.a,{key:e,color:"success",className:"command-button",onClick:Object(i.a)(a.a.mark((function n(){return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t.execute(e));case 1:case"end":return n.stop()}}),n)})))},e)}},{key:"execute",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,e.next=3,new dt(n.appState).afterCommand(t,n.location);case 3:r=e.sent,ce.next({event:re.Command,command:t}),n.appState.updateState(r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),t}(o.Component),Ot=n(22),jt=function(){function e(t,n){Object(l.a)(this,e),this.user=n,this.trans=void 0,this.trans=new lt(t)}return Object(h.a)(e,[{key:"stateAfterClick",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n,r,i,o,c,s,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.trans,r=t.centerOfHexalot,i=n.appState,o=i.homeHexalot,c=i.island){e.next=7;break}return e.abrupt("return",i);case 7:s=c.vacantHexalot,e.t0=i.appMode,e.next=e.t0===ue.Terraforming?11:e.t0===ue.Exploring?14:e.t0===ue.Planning?24:e.t0===ue.Flying?32:e.t0===ue.Evolving?32:e.t0===ue.Riding?32:33;break;case 11:return e.next=13,n.withSelectedSpot(t);case 13:return e.abrupt("return",e.sent.appState);case 14:if(!this.user||o||!i.islandIsLegal||!t.isCandidateHexalot(s)){e.next=19;break}return c.vacantHexalot=c.createHexalot(t),e.next=18,n.withSelectedSpot(t);case 18:return e.abrupt("return",e.sent.terraforming.withRestructure.appState);case 19:if(!r){e.next=23;break}return e.next=22,n.withSelectedSpot(r.centerSpot);case 22:return e.abrupt("return",e.sent.appState);case 23:return e.abrupt("return",i);case 24:if(o){e.next=26;break}throw new Error("No home hexalot");case 26:if(!r){e.next=31;break}return u=o.adjustedJourney(r),o.journey=u,i.storage.setJourneyData(o,u.data).then((function(){console.log("saved journey")})),e.abrupt("return",n.withJourney(u).appState);case 31:case 32:case 33:return e.abrupt("return",i);case 34:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Pt=new y.MeshPhongMaterial({lights:!0,color:new y.Color("silver")}),Nt=new y.MeshPhongMaterial({vertexColors:y.FaceColors,lights:!0}),Ct=new y.LineBasicMaterial({color:new y.Color("black")}),Mt=new y.LineBasicMaterial({color:new y.Color("green")}),Vt=new y.LineBasicMaterial({color:new y.Color("white")}),Ft=new y.LineBasicMaterial({color:new y.Color("green")}),Tt=new y.LineBasicMaterial({color:new y.Color("crimson")}),Lt=new y.LineBasicMaterial({color:new y.Color("magenta")}),Rt=new y.LineBasicMaterial({color:new y.Color("yellow")}),At=new y.MeshPhongMaterial({lights:!0,color:new y.Color("silver"),transparent:!0,opacity:.6}),Dt=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(f.a)(this,Object(d.a)(t).call(this,e))).subscription=void 0,n.state={evolvers:e.evolution.currentJockeys.getValue()},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.subscription=this.props.evolution.currentJockeys.subscribe((function(t){e.setState({evolvers:t})}))}},{key:"componentWillUnmount",value:function(){this.subscription.unsubscribe()}},{key:"render",value:function(){return o.createElement(Ot.a,{key:"EvolutionMesh"},this.state.evolvers.map((function(e,t){var n=e.fabric;return o.createElement("group",{key:"Evolver".concat(t)},o.createElement("lineSegments",{key:"Vectors",geometry:n.pointerGeometryFor(e.nextState),material:Lt}),o.createElement("mesh",{geometry:n.facesGeometry,material:At}))})))}}]),t}(o.Component);!function(e){e.SPOTS_KEY="Spots",e.SEEDS_KEY="Seeds",e.TRIANGLES_KEY="Triangles"}(xt||(xt={}));var Ht,It,zt,Gt,Bt=function(){function e(t,n,r){Object(l.a)(this,e),this.camera=t,this.meshes=new Map,this.rayCaster=new y.Raycaster,this.mouse=new y.Vector2,this.size=new y.Vector2,this.setSize(n,r)}return Object(h.a)(e,[{key:"setMesh",value:function(e,t){t?this.meshes[e]=t:delete this.meshes[e]}},{key:"setSize",value:function(e,t){this.size.x=e,this.size.y=t}},{key:"select",value:function(e,t,n){this.mouse.x=e.clientX/this.size.x*2-1,this.mouse.y=-e.clientY/this.size.y*2+1,this.rayCaster.setFromCamera(this.mouse,this.camera);var r=this.meshes[t];return n(this.rayCaster.intersectObjects([r],!0).filter((function(e){return void 0!==e.faceIndex})))}}]),e}(),_t=new y.Vector3(0,600,0),Yt=new y.Vector3(0,120,0),Jt=new y.Color("white"),Ut=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(f.a)(this,Object(d.a)(t).call(this,e))).appStateNonce=-1,n.spots=void 0,n.seeds=void 0,n.occupiedHangers=void 0,n.vacantHangers=void 0,n.homeHexalot=void 0,n.selectedSpot=void 0,n.availableSpots=void 0,n.vacantHexalots=void 0,n.spots=n.spotsGeometry,n.seeds=n.seedsGeometry,n.occupiedHangers=n.occupiedHangersGeometry,n.vacantHangers=n.vacantHangersGeometry,n.selectedSpot=n.selectedSpotGeometry,n.homeHexalot=n.homeHexalotGeometry,n.availableSpots=n.availableSpotsGeometry,n.vacantHexalots=n.vacantHexalotsGeometry,n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentWillUnmount",value:function(){this.disposeGeometry()}},{key:"render",value:function(){var e=this,t=this.props.appState,n=t.island;return!!n&&(t.nonce>this.appStateNonce&&(this.disposeGeometry(),n.spots.forEach((function(e){return e.faceNames=[]})),this.spots=this.spotsGeometry,this.seeds=this.seedsGeometry,this.occupiedHangers=this.occupiedHangersGeometry,this.vacantHangers=this.vacantHangersGeometry,this.selectedSpot=this.selectedSpotGeometry,this.homeHexalot=this.homeHexalotGeometry,this.availableSpots=this.availableSpotsGeometry,this.vacantHexalots=this.vacantHexalotsGeometry,this.appStateNonce=t.nonce),o.createElement(Ot.a,{key:n.name},o.createElement("mesh",{name:"Spots",geometry:this.spots,material:Nt,ref:function(t){return e.props.setMesh(xt.SPOTS_KEY,t)}}),o.createElement("mesh",{name:"Seeds",geometry:this.seeds,material:Pt}),o.createElement("lineSegments",{key:"HangersOccupied",geometry:this.occupiedHangers,material:Ct}),o.createElement("lineSegments",{key:"HangersFree",geometry:this.vacantHangers,material:Mt}),this.homeHexalot?o.createElement("lineSegments",{key:"HomeHexalot",geometry:this.homeHexalot,material:Vt}):void 0,this.selectedSpot?o.createElement("lineSegments",{key:"Pointer",geometry:this.selectedSpot,material:Rt}):void 0,this.availableSpots?o.createElement("lineSegments",{key:"Available",geometry:this.availableSpots,material:Ft}):void 0,this.vacantHexalots?o.createElement("lineSegments",{key:"Free",geometry:this.vacantHexalots,material:Ft}):void 0,o.createElement("pointLight",{distance:1e3,decay:.01,position:_t}),o.createElement("hemisphereLight",{name:"Hemi",color:Jt})))}},{key:"disposeGeometry",value:function(){this.spots.dispose(),this.seeds.dispose(),this.occupiedHangers.dispose(),this.vacantHangers.dispose(),this.homeHexalot&&this.homeHexalot.dispose(),this.selectedSpot&&this.selectedSpot.dispose(),this.availableSpots&&this.availableSpots.dispose(),this.vacantHexalots&&this.vacantHexalots.dispose()}},{key:"spotsGeometry",get:function(){var e=new y.Geometry,t=this.props.appState.island;return t&&t.spots.forEach((function(t,n){t.addSurfaceGeometry(xt.SPOTS_KEY,n,e.vertices,e.faces)})),e.computeBoundingSphere(),e}},{key:"occupiedHangersGeometry",get:function(){var e=new y.Geometry,t=this.props.appState.island;if(t){var n=t.vacantHexalot;t.hexalots.forEach((function(t){n&&n.id===t.id||t.centerSpot.addHangerGeometry(e.vertices)}))}return e}},{key:"vacantHangersGeometry",get:function(){var e=new y.Geometry,t=this.props.appState.island,n=t?t.vacantHexalot:void 0;return n&&n.centerSpot.addHangerGeometry(e.vertices),e}},{key:"seedsGeometry",get:function(){var e=new y.Geometry,t=this.props.appState.island;if(t){var n=t.hexalots,r=this.activeHexalotId;n.forEach((function(t){r&&t.id===r||t.centerSpot.addSeed(t.rotation,xt.SEEDS_KEY,e.vertices,e.faces)}))}return e.computeFaceNormals(),e.computeBoundingSphere(),e}},{key:"selectedSpotGeometry",get:function(){var e=this.props.appState.selectedSpot;if(e){var t=e.center,n=e.centerOfHexalot?new y.Vector3(0,10,0).add(t):t,r=new y.Geometry;return r.vertices=[n,(new y.Vector3).addVectors(n,Yt)],r}}},{key:"homeHexalotGeometry",get:function(){var e=this.props.appState.homeHexalot;if(e){var t=new y.Geometry;return e.spots.forEach((function(e,n){var r=n-91;r<0||e.addRaisedHexagonParts(t.vertices,.3,r,6)})),e.centerSpot.addRaisedHexagon(t.vertices,.3),e.centerSpot.addHangerGeometry(t.vertices),t.computeBoundingSphere(),t}}},{key:"availableSpotsGeometry",get:function(){var e=this.props.appState;if(this.props.user&&!e.homeHexalot&&e.islandIsLegal){var t=new y.Geometry,n=e.island;if(n){var r=n.vacantHexalot;n.spots.filter((function(e){return e.isCandidateHexalot(r)})).forEach((function(e){e.addRaisedHexagon(t.vertices,.3)}))}return t}}},{key:"vacantHexalotsGeometry",get:function(){var e=this.props.appState.island;if(e){var t=e.vacantHexalot;if(t){var n=new y.Geometry;return t.centerSpot.addRaisedHexagon(n.vertices,.3),t.spots.forEach((function(e,t){var r=t-91;r<0||e.addRaisedHexagonParts(n.vertices,.3,r,6)})),n}}}},{key:"activeHexalotId",get:function(){var e=this.props.appState;return e.jockey?e.jockey.gotchi.home.id:e.evolution?e.evolution.home.id:void 0}}]),t}(o.Component),Zt=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(f.a)(this,Object(d.a)(t).call(this,e))).geometry=void 0,n.state={},n.geometry=t.createGeometry(e),n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.journey!==this.props.journey&&(this.geometry.dispose(),this.geometry=t.createGeometry(e))}},{key:"componentWillUnmount",value:function(){this.geometry.dispose()}},{key:"render",value:function(){return o.createElement(Ot.a,null,o.createElement("lineSegments",{key:"Journey",geometry:this.geometry,material:Tt}))}}],[{key:"createGeometry",value:function(e){var t=new y.BufferGeometry,n=e.journey,r=n.visits.length-1;if(r<1)return t;for(var a=new Float32Array(24*r),i=new y.Vector3,o=new y.Vector3(0,1,0),c=new y.Vector3,s=0;s<r;s++){var u=(new y.Vector3).add(n.visits[s].center),l=(new y.Vector3).add(n.visits[s+1].center);i.subVectors(l,u),c.crossVectors(o,i),l.addScaledVector(i,-.1),c.normalize(),i.normalize().multiplyScalar(4);var h=24*s;a[h++]=u.x,a[h++]=10,a[h++]=u.z,a[h++]=l.x-i.x,a[h++]=10,a[h++]=l.z-i.z,a[h++]=l.x-c.x-i.x,a[h++]=10,a[h++]=l.z-c.z-i.z,a[h++]=l.x,a[h++]=10,a[h++]=l.z,a[h++]=l.x+c.x-i.x,a[h++]=10,a[h++]=l.z+c.z-i.z,a[h++]=l.x,a[h++]=10,a[h++]=l.z,a[h++]=l.x+c.x-i.x,a[h++]=10,a[h++]=l.z+c.z-i.z,a[h++]=l.x-c.x-i.x,a[h++]=10,a[h++]=l.z-c.z-i.z}return t.addAttribute("position",new y.Float32BufferAttribute(a,3)),t}}]),t}(o.Component),Wt=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(f.a)(this,Object(d.a)(t).call(this,e))).appStateNonce=-1,n.selector=void 0,n.state={iterating:!1},n.selector=new Bt(n.props.perspectiveCamera,n.props.appState.width,n.props.appState.height),n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentDidUpdate",value:function(e,t,n){e.appState.width===this.props.appState.width&&e.appState.height===this.props.appState.height||(this.props.perspectiveCamera.aspect=this.props.appState.width/this.props.appState.height,this.props.perspectiveCamera.updateProjectionMatrix(),this.selector.setSize(this.props.appState.width,this.props.appState.height))}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this.props.appState,n=t.island;if(n){var r=t.evolution,a=t.jockey,i=t.journey;if(t.nonce>this.appStateNonce){this.appStateNonce=t.nonce;var c=!!a||!!r;this.state.iterating!==c&&setTimeout((function(){e.setState({iterating:c})}))}return o.createElement("div",{id:"gotchi-view",onMouseDownCapture:function(t){var r=e.selector.select(t,xt.SPOTS_KEY,(function(e){return e.map((function(e){var t="".concat(xt.SPOTS_KEY,":").concat(e.faceIndex);return n.spots.find((function(e){return e.faceNames.indexOf(t)>=0}))})).pop()}));r&&e.click(r)}},o.createElement(Ot.a,null,o.createElement("group",null,o.createElement(Ut,{user:this.props.user,appState:t,setMesh:function(t,n){return e.selector.setMesh(t,n)}}),r?o.createElement(Dt,{evolution:r}):void 0,a?o.createElement("group",{key:"Gotchi"},o.createElement("lineSegments",{key:"Vectors",geometry:a.pointerGeometry,material:Lt}),o.createElement("mesh",{geometry:a.facesGeometry,material:Pt})):void 0,i?o.createElement(Zt,{journey:i}):void 0)))}}},{key:"click",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n,r,i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,r=n.appState,i=new jt(r,n.user),e.next=5,i.stateAfterClick(t);case 5:o=e.sent,n.appState.updateState(o);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),t}(o.Component),Xt=function(e){function t(e){var n;Object(l.a)(this,t),(n=Object(f.a)(this,Object(d.a)(t).call(this,e))).perspectiveCamera=void 0,n.fabricKernel=void 0,n.appStateNonce=-1,n.fabricKernel=new ae(e.engine);var r=window.innerWidth,a=window.innerHeight;n.perspectiveCamera=new y.PerspectiveCamera(50,r/a,1,1.05*Je);var i=window.screenLeft,o=window.screenTop,c=Object(p.a)(n);return n.state={width:r,height:a,left:i,top:o,ownedLots:[],flightState:{target:new y.Vector3,tooFar:Je+1,tooClose:Je-1,towardsDistance:.5,tooVertical:Xe(0),tooHorizontal:Xe(.1),towardsPolarAngle:.01,appMode:ue.Flying},nonce:0,appMode:ue.Flying,islandIsLegal:!1,storage:e.storage,transitionState:function(e){c.setState(e)},updateState:function(e){if(c.appStateNonce===e.nonce)throw new Error("Same nonce! ".concat(e.nonce));c.appStateNonce=e.nonce;var t=e.selectedHexalot;if(t){var n=t.spots.map((function(e){return e.center})),r=t.spots.map((function(e){return e.surface===w.Land}));c.fabricKernel.setHexalot(n,r)}c.setState(e)}},n}return Object(m.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;if(window.addEventListener("resize",(function(){return e.setState(fe)})),this.props.user){var t=this.props.user.ownedLots.map((function(e){return e.id}));t&&t.length>0?(this.setState({ownedLots:t}),this.fetchIsland("rotterdam",t[0])):(this.setState({ownedLots:[]}),this.fetchIsland("rotterdam"))}else this.fetchIsland("rotterdam")}},{key:"componentWillUnmount",value:function(){var e=this;window.removeEventListener("resize",(function(){return e.setState(fe)}))}},{key:"render",value:function(){return this.state.island?o.createElement("div",null,o.createElement("div",null,o.createElement("div",{style:{textAlign:"center",width:"100%",top:0,height:"auto",position:"absolute",color:"#00d1d1",marginTop:0}},o.createElement("div",{style:{float:"left",height:"100%",width:"auto",display:"inline-flex",background:"black",margin:"5px",padding:"4px",borderColor:"inherit",borderWidth:"2px",borderStyle:"solid",borderRadius:"10px"}},this.props.user?o.createElement("div",{style:{fontSize:"larger",padding:"0 6px 6px 6px"}},o.createElement("a",{href:"".concat(b,"/auth/logout")},o.createElement(g.a,{color:"info"},"@",this.props.user.profile.username))):o.createElement("div",{style:{padding:"6px"}},o.createElement("a",{href:"".concat(b,"/auth/twitter")},o.createElement("img",{src:"sign-in-with-twitter-gray.png",alt:"Sign in with Twitter"})))),o.createElement(kt,{appState:this.state,location:this.perspectiveCamera.position,user:this.props.user}),o.createElement("div",{style:{float:"right",height:"100%",width:"auto",display:"inline-flex",background:"black",margin:"5px",padding:"4px",borderColor:"inherit",borderWidth:"2px",borderStyle:"solid",borderRadius:"10px"}},o.createElement("a",{className:"command-button btn btn-info",href:x,target:"_blank"},"About")))),o.createElement(Wt,{perspectiveCamera:this.perspectiveCamera,user:this.props.user,appState:this.state})):o.createElement("div",{className:"welcome"},o.createElement(v.a,{color:"secondary"},'Visiting Galapagotchi island "',"rotterdam",'"...'))}},{key:"fetchIsland",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){var r,i,o,c,s,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.storage.getIslandData(t);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return");case 5:return i=new Ye(r,{createGotchiSeed:function(e,t,n){},copyLiveGotchi:function(e,t){}},this.props.storage,0),o=n?i.findHexalot(n):void 0,c=o?tt(o,ue.Exploring):rt(i,ue.Exploring),e.next=11,new lt(this.state).withIsland(i,r);case 11:if(e.t0=c,s=e.sent.withFlightState(e.t0).withRestructure.appState,n){e.next=17;break}this.state.updateState(s),e.next=21;break;case 17:return e.next=19,new lt(s).withHomeHexalot(o);case 19:u=e.sent,this.state.updateState(u.withRestructure.appState);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),t}(o.Component),$t=1.61803398875,Qt=Math.sqrt(2);function qt(e){var t=new y.Vector3;switch(e){case Ht.XP:return t.setX(1);case Ht.XN:return t.setX(-1);case Ht.YP:return t.setY(1);case Ht.YN:return t.setY(-1);case Ht.ZP:return t.setZ(1);case Ht.ZN:return t.setZ(-1);default:return t}}function Kt(e,t){return qt(e).multiplyScalar(Qt/2).addScaledVector(qt(t),Qt/2/$t)}!function(e){e[e.XP=0]="XP",e[e.XN=1]="XN",e[e.YP=2]="YP",e[e.YN=3]="YN",e[e.ZP=4]="ZP",e[e.ZN=5]="ZN"}(Ht||(Ht={})),function(e){e[e.XPA=0]="XPA",e[e.XPO=1]="XPO",e[e.XNA=2]="XNA",e[e.XNO=3]="XNO",e[e.YPA=4]="YPA",e[e.YPO=5]="YPO",e[e.YNA=6]="YNA",e[e.YNO=7]="YNO",e[e.ZPA=8]="ZPA",e[e.ZPO=9]="ZPO",e[e.ZNA=10]="ZNA",e[e.ZNO=11]="ZNO"}(It||(It={})),function(e){e[e.NNN=0]="NNN",e[e.PNN=1]="PNN",e[e.NPN=2]="NPN",e[e.NNP=3]="NNP",e[e.NPP=4]="NPP",e[e.PNP=5]="PNP",e[e.PPN=6]="PPN",e[e.PPP=7]="PPP"}(zt||(zt={})),function(e){e[e.NN=0]="NN",e[e.PN=1]="PN",e[e.NP=2]="NP",e[e.PP=3]="PP"}(Gt||(Gt={}));var en=[{alpha:Kt(Ht.ZN,Ht.XP),omega:Kt(Ht.ZP,Ht.XP)},{alpha:Kt(Ht.ZN,Ht.XN),omega:Kt(Ht.ZP,Ht.XN)},{alpha:Kt(Ht.XN,Ht.YP),omega:Kt(Ht.XP,Ht.YP)},{alpha:Kt(Ht.XN,Ht.YN),omega:Kt(Ht.XP,Ht.YN)},{alpha:Kt(Ht.YN,Ht.ZP),omega:Kt(Ht.YP,Ht.ZP)},{alpha:Kt(Ht.YN,Ht.ZN),omega:Kt(Ht.YP,Ht.ZN)}],tn=[{name:zt.NNN,opposite:zt.PPP,negative:!0,ring:Gt.NN,pushEnds:[It.YNA,It.XNA,It.ZNA],ringMember:[Gt.NP,Gt.PN,Gt.PP]},{name:zt.PNN,opposite:zt.NPP,negative:!1,ring:Gt.PP,pushEnds:[It.XNA,It.YPA,It.ZNO],ringMember:[Gt.PN,Gt.NN,Gt.NP]},{name:zt.NPN,opposite:zt.PNP,negative:!1,ring:Gt.PN,pushEnds:[It.XNO,It.YNA,It.ZPA],ringMember:[Gt.PP,Gt.NP,Gt.NN]},{name:zt.NNP,opposite:zt.PPN,negative:!1,ring:Gt.NP,pushEnds:[It.XPA,It.YNO,It.ZNA],ringMember:[Gt.NN,Gt.PN,Gt.PP]},{name:zt.NPP,opposite:zt.PNN,negative:!0,ring:Gt.PP,pushEnds:[It.YNO,It.XPO,It.ZPA],ringMember:[Gt.PN,Gt.NP,Gt.NN]},{name:zt.PNP,opposite:zt.NPN,negative:!0,ring:Gt.PN,pushEnds:[It.YPO,It.XPA,It.ZNO],ringMember:[Gt.PP,Gt.NN,Gt.NP]},{name:zt.PPN,opposite:zt.NNP,negative:!0,ring:Gt.NP,pushEnds:[It.YPA,It.XNO,It.ZPO],ringMember:[Gt.NN,Gt.PP,Gt.PN]},{name:zt.PPP,opposite:zt.NNN,negative:!1,ring:Gt.NN,pushEnds:[It.XPO,It.YPO,It.ZPO],ringMember:[Gt.NP,Gt.PP,Gt.PN]}];function nn(e){return tn[e].opposite}function rn(e){return e||{_:100}}function an(e){return e._/100}function on(e){return{_:100*e}}function cn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function sn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cn(n,!0).forEach((function(t){Object(de.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var un="ABCDabcd";function ln(e){return un.indexOf(e)>=0}var hn="0123456789";function fn(e){return hn.indexOf(e)>=0}function dn(e,t,n){switch(t){case"A":e.A=n;break;case"B":e.B=n;break;case"C":e.C=n;break;case"D":e.D=n;break;case"b":e.b=n;break;case"c":e.c=n;break;case"d":e.d=n;break;case"a":e.a=n;break;default:throw new Error("Unexpected direction directionChar: "+t)}}function pn(e,t,n){switch(t){case"A":e.MA=n;break;case"B":e.MB=n;break;case"C":e.MC=n;break;case"D":e.MD=n;break;case"a":e.Ma=n;break;case"b":e.Mb=n;break;case"c":e.Mc=n;break;case"d":e.Md=n;break;default:throw new Error("Unexpected direction directionChar: "+t)}}function mn(e,t,n){function r(e){if(!e.match(/^\d+$/))throw new Error("Not a number: ".concat(e));return parseInt(e,10)}try{if(!n||0===n.length)return void e("No code to parse");var a=function e(t){function n(e,t){var n=e.indexOf(","),r=n>=0;if("("!==e.charAt(0))return r?{content:e.substring(0,n),skip:n}:{content:e,skip:e.length};var a=function(e){if("("!==e.charAt(0))throw new Error('Code must start with "(": '.concat(e," ").concat(e.charAt(0)));for(var t=0,n=0;n<e.length;n++){var r=e.charAt(n);if("("===r)t++;else if(")"===r&&0===--t)return n}throw new Error("No matching end bracket: |".concat(e,"|"))}(e);return{content:t?e.substring(1,a):e.substring(0,a+1),skip:a+1}}var a=n(t,!0).content,i={};function o(t){var r=n(a.substring(t),!1),i=r.content,o=r.skip;return{codeTree:e(i),skip:o}}for(var c=0;c<a.length;c++){var s=a.charAt(c);if(ln(s)){var u=o(c+1);if(!u.codeTree)throw new Error("No subtree: ".concat(a.substring(c)));dn(i,s,u.codeTree),c+=u.skip}else if(fn(s)){var l=n(a,!1);i._=r(l.content),c+=l.skip}else switch(s){case"S":var h=n(a.substring(c+1),!0);i.S={_:r(h.content)},c+=h.skip;break;case"M":var f=a.charAt(c+1),d=n(a.substring(c+2),!0);pn(i,f,{_:r(d.content)}),c+=d.skip+1;break;case",":case" ":break;default:throw new Error("Unexpected character: ".concat(s))}}return 0===Object.keys(i).length?void 0:i}(function(e){return e.replace(/[\n\r\t ]/g,"")}(n));if(!a)return;return function(e,t,n){return{name:e,tree:t,code:JSON.stringify(t).replace(/[_.:"]/g,"").replace(/[{]/g,"(").replace(/[}]/g,")").replace(/([ABCDabcdSM])\((\d*)\)/g,(function(e){return"".concat(arguments.length<=1?void 0:arguments[1]).concat(arguments.length<=2?void 0:arguments[2])})),fromUrl:n}}(function(e){var t=e.split(":");if(2===t.length)return t[1];return e.split("").filter((function(e){return ln(e)||fn(e)})).join("")}(n),a,t)}catch(i){return void e(i.message)}}function vn(e){throw new Error("Unable to parse: ".concat(e))}function gn(e,t){var n=e.split(":");return 2===n.length?"".concat(n[0],":").concat(t.trim()):"".concat(e,":").concat(t)}var yn,bn=["(0):Zen","(1):One","(6):Six","(16,S90):Axoneme","(b1,a1):Knee","(b3,a3):Leg","(a1,b1,c1,d1):Nexus","(A2,B(3,b(2,S90),S80),C(3,c(2,S90),S80),D(3,d(2,S90),S80)):Tripod with Knees","(A(8, S85, MA1), a(8, S85, MA1)):Bulge Ring","(a1,b(3,S85,MA1),c(3,S85,MA1),d(3,S85,MA1)):Convergence Three","(a1,b(12,S85,MA1),c(12,S85,MA1),d(12,S85,MA1)):Convergence Twelve","(B(7,S80,MA1),C(2,S120,MA0),D(7,S80,MA1)):Halo by Crane","(B(5,S75),C(5,S75),D(5,S75)):Pretenst Lander","(a(1,MA0),c(3,b(3,d(3,c(3,b(3,d(1,MA0))))))):Zig Zag Loop","(B2, C2, D2, A(2, b2, c2, d2)):Crystal Interstitial","(a(2,b(2,c(2,d(1,MA11)),d(2,c(1,MA10))),c(2,d(2,b(1,MA13)),b(2,d(1,MA12))),d(2,b(2,c(1,MA15)),c(2,b(1,MA14)))),b(2,d(2,Mc13),c(2,Md14)),c(2,b(2,Md15),d(2,Mb10)),d(2,c(2,Mb11),b(2,Mc12))): Diamond","(a(3,b(3,c(3,d(2,MA11)),d(3,c(2,MA10))),c(3,d(3,b(2,MA13)),b(3,d(2,MA12))),d(3,b(3,c(2,MA15)),c(3,b(2,MA14)))),b(3,d(3,Mc13),c(3,Md14)),c(3,b(3,Md15),d(3,Mb10)),d(3,c(3,Mb11),b(3,Mc12))):Diamond2"].map((function(e){return mn(vn,!1,e)}));function xn(e,t){var n=[];return e.forEach((function(e){var r=e.brick,a=e.tree,i=e.fabric;function o(e,n,r,a){var o=e.base===zt.PPP?nn(r):r,c=i.builder.createConnectedBrick(e,o,a);return 0===n._&&function(e,n){function r(n,r){if(r){var a=e.base===zt.NNN?e.faces[n]:e.faces[nn(n)];if(a.removed)throw new Error("!! trying to use a face that was removed");t(r._,a)}}r(zt.PPP,n.MA),r(zt.NPP,n.Mb),r(zt.PNP,n.Mc),r(zt.PPN,n.Md),r(zt.PNN,n.MB),r(zt.NPN,n.MC),r(zt.NNP,n.MD),r(zt.NNN,n.Ma)}(c,n),{tree:n,brick:c,fabric:i}}var c=a._;if(c){var s=c-1;n.push(o(r,sn({},a,{_:s}),zt.PPP,rn(a.S)))}else u(r,zt.PPP,a.A),u(r,zt.NPP,a.b),u(r,zt.PNP,a.c),u(r,zt.PPN,a.d),u(r,zt.PNN,a.B),u(r,zt.NPN,a.C),u(r,zt.NNP,a.D),u(r,zt.NNN,a.a);function u(e,t,r){if(r){var a=rn(r.S),i=sn({},r,{_:r._?r._-1:void 0});n.push(o(e,i,t,a))}}})),n}function wn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Sn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wn(n,!0).forEach((function(t){Object(de.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.Grow="Grow",e.Shape="Shape",e.Realize="Realize",e.View="View",e.Strain="Strain"}(yn||(yn={}));var En="2019-12-14";function kn(e){return Object.keys(e.recentCode).map((function(t){var n=e.recentCode[t],r=mn((function(e){return console.error(e)}),!1,n);if(!r)throw new Error("Unable to read recent tenscript code: ".concat(n));return r}))}function On(e,t){return Sn({},e,{nonce:e.nonce+1},t)}var jn="State";function Pn(e){var t=localStorage.getItem(jn);if(t){var n=JSON.parse(t);if(n.version===En)return n}return function(e){var t=z.map(e).reduce((function(e,t){return e[t.feature]={percent:100,numeric:t.defaultValue},e}),{});return{version:En,nonce:0,surfaceCharacter:Y.Frozen,featureValues:t,recentCode:{},controlTab:yn.Grow,fullScreen:!0,ellipsoids:!1,rotating:!1,showPushes:!0,showPulls:!0}}(e)}function Nn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Cn=[50,75,90,100,125,150,200],Mn=(1+Math.sqrt(5))/2,Vn=Math.sqrt(2),Fn=Math.sqrt(3),Tn=Math.sqrt(2-2*Math.sqrt(2/3)),Ln=(Mn/3-1/6)*Fn,Rn=Mn/3*Fn-1+Vn/Fn,An=Math.sqrt(.25+Ln*Ln+Rn*Rn);function Dn(e){switch(e){case R.Gravity:return{feature:e,name:"Gravity",defaultValue:1e-7,percents:[0,10,50,100,200,500]};case R.Drag:return{feature:e,name:"Drag",defaultValue:1e-4,percents:[0,10,50,100,150,200]};case R.PretenstFactor:return{feature:e,name:"Pretenst factor",defaultValue:.03,percents:[0,50,90,100,125,150,200]};case R.IterationsPerFrame:return{feature:e,name:"Iterations per frame",defaultValue:100,percents:[10,25,50,100,200,300,500]};case R.IntervalCountdown:return{feature:e,name:"Interval Countdown",defaultValue:1e3,percents:[10,20,30,100,150,400,1e3]};case R.PretenstCountdown:return{feature:e,name:"Slack to Pretenst countdown",defaultValue:3e4,percents:Cn};case R.FacePullEndZone:return{feature:e,name:"Face Pull End Zone",defaultValue:4,percents:Cn};case R.FacePullOrientationForce:return{feature:e,name:"Face Pull Orientation Force",defaultValue:1e-4,percents:Cn};case R.SlackThreshold:return{feature:e,name:"Slack threshold",defaultValue:1e-4,percents:[.01,.1,1,10,100,1e3]};case R.ShapingPretenstFactor:return{feature:e,name:"Pretenst factor",defaultValue:.1,percents:[0,1,2,3,5,10,20,50,100]};case R.ShapingStiffnessFactor:return{feature:e,name:"Stiffness factor",defaultValue:10,percents:[100,150,200,250,300,400,500]};case R.ShapingDrag:return{feature:e,name:"Drag",defaultValue:.1,percents:[0,10,50,100,200,500]};case R.MaxStrain:return{feature:e,name:"Maximum Strain",defaultValue:.1,percents:[1,2,3,5,8,13,21,34,55,100]};case R.VisualStrain:return{feature:e,name:"Visual Strain",defaultValue:1,percents:[0,10,50,100,200,300,500,1e3,1e4,1e5]};case R.PushOverPull:return{feature:e,name:"Compression/Tension",defaultValue:1,percents:[10,20,30,50,100,200,300,500,1e3]};case R.NexusPushLength:return{feature:e,name:"Nexus Push",defaultValue:Mn,percents:Cn};case R.ColumnPushLength:return{feature:e,name:"Column Push",defaultValue:Vn,percents:Cn};case R.TriangleLength:return{feature:e,name:"Triangle",defaultValue:1,percents:Cn};case R.RingLength:return{feature:e,name:"Ring",defaultValue:Tn,percents:[10,80,90,100,110,120,130]};case R.NexusCrossLength:return{feature:e,name:"Nexus Cross",defaultValue:An,percents:Cn};case R.ColumnCrossLength:return{feature:e,name:"Column Cross",defaultValue:1,percents:Cn};case R.BowMidLength:return{feature:e,name:"Bow Mid",defaultValue:.4,percents:Cn};case R.BowEndLength:return{feature:e,name:"Bow End",defaultValue:.6,percents:Cn};case R.PushRadiusFactor:return{feature:e,name:"Push Radius",defaultValue:4,percents:[5,25,50,100,150,200,300]};case R.PullRadiusFactor:return{feature:e,name:"Pull Radius",defaultValue:2,percents:[5,25,50,100,150,200,300]};case R.MaxStiffness:return{feature:e,name:"Maximum Stiffness",defaultValue:5e-4,percents:[5,25,50,100,150,200,500]}}}var Hn=function(){function e(t,n){Object(l.a)(this,e),this.config=t,this.value$=void 0;var r=n.getValue().featureValues[t.feature],a=void 0!==r?r:{numeric:t.defaultValue,percent:100};this.value$=new u.BehaviorSubject(a),this.value$.subscribe((function(e){var r=n.getValue(),a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nn(n,!0).forEach((function(t){Object(de.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r.featureValues);a[t.feature]=e,n.next(On(r,{featureValues:a}))}))}return Object(h.a)(e,[{key:"value",get:function(){return this.value$.getValue()}},{key:"title",get:function(){return this.config.name}},{key:"percentChoices",get:function(){return this.config.percents}},{key:"numeric",get:function(){return this.value$.getValue().numeric}},{key:"formatted",get:function(){var e=this.numeric,t=e.toExponential(5),n=t.indexOf("e+0");return n>0?t.substring(0,n):Math.max(t.indexOf("e-1"),t.indexOf("e-2"))>0?e.toFixed(5):Math.max(t.indexOf("e+1"),t.indexOf("e+2"))>0?e.toFixed(1):t}},{key:"percent",get:function(){return this.value$.getValue().percent},set:function(e){this.value$.next({numeric:this.config.defaultValue*e/100,percent:e})}},{key:"observable",get:function(){return this.value$}},{key:"fabricFeature",get:function(){return this.config.feature}}]),e}();function In(e){var t={};return z.map(Dn).forEach((function(n){return t[n.feature]=new Hn(n,e)})),t}var zn=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Gn(){if("serviceWorker"in navigator){if(new URL("/app",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/app","/service-worker.js");zn?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Bn(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):Bn(e)}))}}function Bn(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var _n,Yn=n(258),Jn=n.n(Yn),Un=function(){function e(t){Object(l.a)(this,e),this.client=void 0,this.client=Jn.a.create({baseURL:t,withCredentials:!0}),this.client.get("/").catch((function(e){console.log("ERROR: Cannot reach remote storage at ".concat(t,". Are you running the server? \n").concat(e))}))}return Object(h.a)(e,[{key:"getIslandData",value:function(){var e=Object(i.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchResource("/island/".concat(t)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"claimHexalot",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n,r){var i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.genome=we(r),e.next=3,this.client.post("/island/".concat(t.name,"/claim-lot"),{id:n.id,x:n.coords.x,y:n.coords.y,genomeData:JSON.stringify(r)});case 3:return i=e.sent,e.abrupt("return",i.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getUser",value:function(){var e=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchResource("/me");case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),console.log("Could not get user:",e.t0),e.abrupt("return",void 0);case 10:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"getGenomeData",value:function(){var e=Object(i.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchResource("/hexalot/".concat(t.id,"/genome-data")));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setGenomeData",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post("/hexalot/".concat(t.id,"/genome-data"),{genomeData:n});case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getJourneyData",value:function(){var e=Object(i.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchResource("/hexalot/".concat(t.id,"/journey")));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setJourneyData",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post("/hexalot/".concat(t.id,"/journey"),{journeyData:n});case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getLotOwner",value:function(){var e=Object(i.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchResource("/hexalot/".concat(t.id,"/owner")));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchResource",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.client.get(t);case 3:return n=e.sent,e.abrupt("return",n.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("network problem",e.t0),e.abrupt("return",void 0);case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Zn=n(9),Wn=n(654),Xn=n(644);!function(e){e[e.Main=0]="Main",e[e.Tensegrity=1]="Tensegrity"}(_n||(_n={}));var $n=Object.keys(_n).filter((function(e){return e.length>2})).map((function(e){return _n[e]}));function Qn(e){var t=e.children;return c.a.createElement("div",{className:"m-3 p-2",style:{borderRadius:"1em",borderStyle:"solid",borderWidth:"0.1em",borderColor:"#45782e"}},t)}function qn(e){var t=e.name,n=e.caption;return c.a.createElement("div",{style:{borderRadius:"1em",borderColor:"#acacac",borderWidth:3,borderStyle:"solid"}},c.a.createElement("video",{style:{borderTopLeftRadius:"1em",borderTopRightRadius:"1em"},height:"300",controls:!1,loop:!0,autoPlay:!0},c.a.createElement("source",{src:"/pretenst/movies/".concat(t,".mp4"),type:"video/mp4"}),"Your browser does not support the video tag."),c.a.createElement("h5",{className:"w-100 text-center"},n))}function Kn(e){var t=e.page;return c.a.createElement("a",{href:"#".concat(_n[t])},_n[t])}function er(e){var t=e.name,n=e.caption;return c.a.createElement("div",{style:{borderRadius:"1em",borderColor:"#acacac",borderWidth:3,borderStyle:"solid"}},c.a.createElement("img",{style:{borderTopLeftRadius:"1em",borderTopRightRadius:"1em"},id:t,src:"/pretenst/images/".concat(t,".png"),alt:t}),c.a.createElement("h5",{className:"w-100 text-center"},n))}function tr(e){var t=e.name,n=e.x,r=e.y,a=e.children,i=Object(o.useState)({x:0,y:0}),s=Object(Zn.a)(i,2),u=s[0],l=s[1];return Object(o.useEffect)((function(){var e=document.getElementById(t).getBoundingClientRect();l({x:e.left+n,y:e.top+r})}),[]),c.a.createElement("div",null,c.a.createElement("strong",null,'line to image called "',t,'" at (',u.x,", ",u.y,")"),c.a.createElement("div",null,a))}function nr(e){var t=e.term,n=e.children;return c.a.createElement("div",null,c.a.createElement("strong",null,t,":"),c.a.createElement("div",null,n))}function rr(e){var t=e.cancel,n=Object(o.useState)(_n.Main),r=Object(Zn.a)(n,2),a=r[0],i=r[1];return o.createElement("div",{className:"w-100 h-100 p-3",style:{backgroundColor:"#494949",color:"#d4d4d4"}},o.createElement("div",{className:"text-center my-3"},o.createElement("h2",null,"About Pretenst")),o.createElement("div",{style:{borderColor:"#c8c8c8",borderWidth:"3px",height:"calc(100% - 8em)",borderStyle:"solid",borderRadius:"2em"},className:"mx-4 p-4"},o.createElement(ar,{page:a})),o.createElement("div",{className:"w-100 fixed-bottom my-3 text-center"},o.createElement(Xn.a,null,$n.map((function(e){return o.createElement(ie.a,{key:_n[e],color:e===a?"success":"secondary",onClick:function(){return i(e)}},_n[e])}))),o.createElement(Xn.a,{className:"mx-2"},o.createElement(ie.a,{color:"warning",onClick:t},o.createElement(Wn.y,null)," Ok go!"))))}function ar(e){switch(e.page){case _n.Main:return o.createElement("div",{style:{display:"flex"}},o.createElement(qn,{name:"zero-pretenst",caption:"The Zero Shape"}),o.createElement(Qn,null,"Documentation coming soon...."));case _n.Tensegrity:return o.createElement("div",null,o.createElement("h3",null,"Tensegrity Page"),o.createElement(Qn,null,o.createElement(nr,{term:"Pretenst"},'A misspelling of the word "pretensed".')),o.createElement(er,{name:"optimize",caption:"Something to optimize"}),o.createElement(Qn,null,o.createElement(tr,{name:"optimize",x:10,y:10},"Picture pointer")),o.createElement(Qn,null,o.createElement(Kn,{page:_n.Main})))}}var ir=function(){function e(t,n,r){Object(l.a)(this,e),this.numericFeature=t,this.fabric=n,this._stage=void 0,this._stage=r}return Object(h.a)(e,[{key:"withStage",value:function(t,n){return this.transition(t,n),this._stage=t,new e(this.numericFeature,this.fabric,t)}},{key:"transition",value:function(e,t){switch(this._stage){case L.Growing:switch(e){case L.Shaping:return void this.save()}break;case L.Shaping:switch(e){case L.Slack:return void(t&&t.adoptLengths&&(this.fabric.instance.engine.adoptLengths(),this.save()));case L.Realizing:return}break;case L.Slack:switch(e){case L.Shaping:case L.Realizing:return}break;case L.Realizing:switch(e){case L.Realized:return}break;case L.Realized:switch(e){case L.Slack:if(t&&t.strainToStiffness){var n=this.numericFeature(R.PushOverPull),r=function(e,t){var n=e.instance.strains,r=e.instance.stiffnesses,a=function(e){return e.reduce((function(e,t){return e+n[t.index]}),0)/e.length},i=e.intervals,o=i.filter((function(e){return e.isPush})),c=a(o),s=i.filter((function(e){return!e.isPush})),u=a(s),l=(-t*c+u)/2,h=i.map((function(e){return 1+(n[e.index]*(e.isPush?-t:1)-l)/l})),f=r.map((function(e,t){return e*h[t]})),d=f.map(or);return{newStiffnesses:f,newLinearDensities:d}}(this.fabric,n),a=r.newStiffnesses,i=r.newLinearDensities;this.restore();var o=this.fabric.instance;return a.forEach((function(e,t){return o.stiffnesses[t]=e})),void i.forEach((function(e,t){return o.linearDensities[t]=e}))}return t&&t.adoptLengths?(this.fabric.instance.engine.adoptLengths(),void this.save()):void this.restore()}}throw new Error("No transition ".concat(L[this._stage]," to ").concat(L[e]))}},{key:"save",value:function(){this.fabric.instance.engine.cloneInstance(this.fabric.instance.index,this.fabric.slackInstance.index)}},{key:"restore",value:function(){var e=this;this.fabric.instance.engine.cloneInstance(this.fabric.slackInstance.index,this.fabric.instance.index),z.forEach((function(t){e.fabric.instance.setFeatureValue(t,e.numericFeature(t))}))}},{key:"stage",get:function(){return this._stage}}]),e}();function or(e){return Math.sqrt(e)}var cr=n(259);function sr(e){return.6*e}var ur=function(){function e(t,n){Object(l.a)(this,e),this.fabric=t,this.numericFeature=n,this.faceMarks={}}return Object(h.a)(e,[{key:"createBrickAt",value:function(e,t){var n=this.createBrickPointsAt(zt.PPP,t,e);return this.createBrick(n,zt.NNN,t)}},{key:"createConnectedBrick",value:function(e,t,n){var r=e.faces[t],a=an(e.scale),i=a*an(n),o=this.createBrickOnFace(r,on(i)),c=o.faces[o.base],s=this.numericFeature(R.IntervalCountdown);return this.connectFaces(r,c,on((a+i)/2),s)||console.error("Cannot connect!"),o}},{key:"turnUpright",value:function(){var e=this.faceMarkLists.find((function(e){return 1===e.length}));e&&this.uprightAtOrigin(e[0])}},{key:"checkFacePulls",value:function(e,t){var n=this;if(0===e.length)return e;var r=this.fabric.instance;return e.filter((function(e){var a=e.alpha,i=e.omega,o=e.scaleFactor;return!(r.faceMidpoint(a.index).distanceTo(r.faceMidpoint(i.index))<=10*sr(o))||(function(e){var t=e.alpha,r=e.omega,a=e.scaleFactor,i=n.numericFeature(R.IntervalCountdown);n.connectFaces(t,r,on(a),i)||console.error("Unable to connect")}(e),t(e),!1)}))}},{key:"optimize",value:function(){var e=this,t=this.fabric,n=t.instance,r=[],a=function(e){var n=t.intervals.filter((function(e){return e.isPush})).find((function(t){return t.alpha.index===e||t.omega.index===e}));if(!n)throw new Error("Cannot find ".concat(e));return{interval:n,joint:n.alpha.index===e?n.alpha:n.omega}},i=t.intervals.filter((function(e){return e.intervalRole===H.ColumnCross||e.intervalRole===H.NexusCross}));i.forEach((function(e,t){var o=e.alpha.index,c=e.omega.index,s=a(o),u=a(c),l=n.location(o),h=n.location(c),f=l.distanceTo(h),d=(new y.Vector3).addVectors(l,h).multiplyScalar(.5);i.forEach((function(i,p){var m=i.alpha.index,v=i.omega.index;if(!(t>=p||o===m||o===v||c===m||c===v)){var g,b,x,w,S,E=a(m),k=a(v),O=function(e,t){return e.interval.index===t.interval.index};if(O(s,E))g=s.interval,b=e.alpha,x=e.omega,w=i.alpha,S=i.omega;else if(O(s,k))g=s.interval,b=e.alpha,x=e.omega,w=i.omega,S=i.alpha;else if(O(u,E))g=u.interval,b=e.omega,x=e.alpha,w=i.alpha,S=i.omega;else{if(!O(u,k))return;g=u.interval,b=e.omega,x=e.alpha,w=i.omega,S=i.alpha}var j=n.location(m),P=n.location(v),N=j.distanceTo(P),C=(new y.Vector3).addVectors(j,P).multiplyScalar(.5),M=l.distanceTo(C)/N,V=h.distanceTo(C)/N,F=j.distanceTo(d)/f,T=P.distanceTo(d)/f,L=0,R=function(e){e<.5&&L++};if(R(M),R(V),R(F),R(T),!(L<2)){var A=g.scale;r.push({scale:A,a:b,x:x,b:w,y:S})}}}))}));var o=this.numericFeature(R.IntervalCountdown);r.forEach((function(n){var r=n.scale,a=n.a,i=n.x,c=n.b,s=n.y;t.createInterval(i,s,H.BowMid,r,o);var u=t.findInterval(a,i),l=t.findInterval(a,s),h=t.findInterval(c,i),f=t.findInterval(c,s);if(!(u&&h&&l&&f))throw new Error("Cannot find intervals during optimize");t.removeInterval(u),t.removeInterval(f),e.fabric.changeIntervalRole(l,H.BowEnd,r,o),e.fabric.changeIntervalRole(h,H.BowEnd,r,o)})),n.forgetDimensions()}},{key:"uprightAtOrigin",value:function(e){var t=this.faceToOrigin(e);this.fabric.instance.apply(t)}},{key:"createFacePulls",value:function(e){var t=this,n=this.fabric.instance,r=function(){var r,a=t.createBrickAt((r=e.map((function(e){return n.faceMidpoint(e.index)}))).reduce((function(e,t){return e.add(t)}),new y.Vector3).multiplyScalar(1/r.length),on(function(e){return e.reduce((function(e,t){return e+an(t.brick.scale)}),0)/e.length}(e)));n.engine.renderNumbers();return e.map((function(e){return t.fabric.createFacePull(function(e){var t=n.faceMidpoint(e.index);return a.faces.filter((function(t){return t.negative!==e.negative})).reduce((function(e,r){return n.faceMidpoint(e.index).distanceTo(t)<n.faceMidpoint(r.index).distanceTo(t)?e:r}))}(e),e)}))};switch(e.length){case 2:return e[0].negative===e[1].negative?r():[this.fabric.createFacePull(e[0],e[1])];case 3:return r();default:return[]}}},{key:"createBrickOnFace",value:function(e,t){var n=this,r=tn[e.triangle].negative,a=e.brick,i=e.triangle,o=a.faces[i].joints.map((function(e){return n.fabric.instance.location(e.index)})),c=o.reduce((function(e,t){return e.add(t)}),new y.Vector3).multiplyScalar(1/3),s=(new y.Vector3).addVectors(o[0],o[1]).multiplyScalar(.5),u=(new y.Vector3).subVectors(s,c).normalize(),l=(new y.Vector3).subVectors(o[1],c).normalize(),h=(new y.Vector3).add(u).multiplyScalar(u.dot(l)),f=l.sub(h).normalize(),d=(new y.Vector3).crossVectors(f,u).normalize(),p=(new y.Matrix4).makeBasis(u,d,f).setPosition(c),m=r?zt.NNN:zt.PPP,v=this.createBrickPointsAt(m,t,new y.Vector3(0,0,0)).map((function(e){return e.applyMatrix4(p)})),g=r?zt.PPP:zt.NNN;return this.createBrick(v,g,t)}},{key:"createBrick",value:function(e,t,n){var r,a=this,i=this.numericFeature(R.IntervalCountdown),o=function(e,t,n){return{index:e,base:t,scale:n,joints:[],pushes:[],pulls:[],crosses:[],rings:[[],[],[],[]],faces:[],negativeAdjacent:0,postiveeAdjacent:0}}(this.fabric.bricks.length,t,n);this.fabric.bricks.push(o);var c=e.map((function(e,t){return a.fabric.createJointIndex(t,e)}));en.forEach((function(e,t){Object(cr.a)(e);var r=c[2*t],s=c[2*t+1],u={index:r,oppositeIndex:s},l={index:s,oppositeIndex:r};o.pushes.push(a.fabric.createInterval(u,l,H.NexusPush,n,i))})),o.pushes.forEach((function(e){return o.joints.push(e.alpha,e.omega)}));var s=o.pushes.reduce((function(e,t){return e.push(t.alpha,t.omega),e}),[]);return(r=this.fabric.joints).push.apply(r,Object(Be.a)(s)),tn.forEach((function(e){for(var t=e.pushEnds.map((function(e){return s[e]})),r=0;r<3;r++){var c=t[r],u=t[(r+1)%3],l=a.fabric.createInterval(c,u,H.Triangle,n,i);o.pulls.push(l),o.rings[e.ringMember[r]].push(l)}})),tn.forEach((function(e){var t=a.fabric.createFace(o,e.name);o.faces.push(t)})),this.fabric.instance.forgetDimensions(),o}},{key:"createBrickPointsAt",value:function(e,t,n){var r=en.reduce((function(e,t){return e.push((new y.Vector3).add(t.alpha)),e.push((new y.Vector3).add(t.omega)),e}),[]),a=nn(e),i=tn[a].pushEnds.map((function(e){return r[e]})).reverse(),o=i.reduce((function(e,t){return e.add(t)}),new y.Vector3).multiplyScalar(1/3),c=(new y.Vector3).subVectors(i[0],o).normalize(),s=(new y.Vector3).sub(o).normalize(),u=(new y.Vector3).crossVectors(s,c).normalize(),l=(new y.Matrix4).makeBasis(c,s,u),h=an(t),f=(new y.Matrix4).getInverse(l).setPosition(n).scale(new y.Vector3(h,h,h));return r.map((function(e){return e.applyMatrix4(f)}))}},{key:"faceToOrigin",value:function(e){var t=this;this.fabric.instance.engine.renderNumbers();var n=e.joints.map((function(e){return t.fabric.instance.location(e.index)})),r=n.reduce((function(e,t){return e.add(t)}),new y.Vector3).multiplyScalar(1/3),a=(new y.Vector3).subVectors(n[1],r).normalize(),i=(new y.Vector3).subVectors(n[0],r).normalize(),o=(new y.Vector3).crossVectors(i,a).normalize();i.crossVectors(a,o).normalize();var c=(new y.Matrix4).makeBasis(a,o,i).setPosition(r);return(new y.Matrix4).getInverse(c)}},{key:"nineJointPairsByProximity",value:function(e,t){var n=[],r=this.fabric.instance;return e.joints.forEach((function(e){t.joints.forEach((function(t){var a=r.location(e.index),i=r.location(t.index),o=a.distanceTo(i);n.push({jointA:e,jointB:t,distance:o})}))})),n.sort((function(e,t){return e.distance-t.distance}))}},{key:"facesToRing",value:function(e,t){if(e.negative===t.negative)throw new Error("Polarity not opposite");var n=this.nineJointPairsByProximity(e,t).slice(0,6),r=n.shift();if(!r)throw new Error("No closest found");var a=function(e){var t=n.findIndex(e);return t>=0?n.splice(t,1)[0]:void 0},i=function(e){var t=a((function(t){return t.jointB.index===e.index}));return t?t.jointA:void 0},o=function(e){var t=a((function(t){return t.jointA.index===e.index}));return t?t.jointB:void 0},c=r.jointA,s=r.jointB,u=o(c);if(u){var l=i(u);if(l){var h=o(l);if(h){var f=i(h);if(f){var d=o(f);if(d&&d.index===s.index){var p=(e.joints.findIndex((function(e){return e.index===c.index}))+1)%3===e.joints.findIndex((function(e){return e.index===l.index}));return{faceA:e,faceB:t,jointsA:p!==e.negative?[c,f,l]:[c,l,f],jointsB:p!==e.negative?[u,s,h]:[s,u,h]}}console.error("Cannot complete ring!")}}}}}},{key:"connectFaces",value:function(e,t,n,r){var a=this;if(e.negative===t.negative)throw new Error("Same polarity!");var i=this.facesToRing(e,t);if(!i)return!1;for(var o=function(e){return e.negativeAdjacent>1||e.postiveeAdjacent>1},c=function(e,t,i){return a.fabric.createInterval(e,t,i,n,r)},s=function(e,t){return c(e,t,H.Ring)},u=function(e,t,n){var r=a.fabric.joints[t.oppositeIndex],i=o(n.brick)?H.NexusCross:H.ColumnCross;return c(e,r,i)},l=0;l<3;l++){var h=i.jointsA[l],f=i.jointsB[l],d=i.jointsB[(l+1)%3];s(h,f),s(h,d),u(h,d,t),u(f,h,e)}var p=function(e){var t=e.brick.scale,n=e.triangle,i=e.brick;e.negative?i.negativeAdjacent++:i.postiveeAdjacent++,tn.filter((function(e){return e.opposite!==n&&e.negative!==tn[n].negative})).forEach((function(e){return i.faces[e.name].canGrow=!1})),a.fabric.removeFace(e,!0);var c=tn[n].ring;o(i)?(i.pulls.filter((function(e){return!e.removed})).forEach((function(e){return a.fabric.changeIntervalRole(e,H.Triangle,t,r)})),i.crosses.forEach((function(e){return a.fabric.changeIntervalRole(e,H.NexusCross,t,r)}))):i.rings[c].filter((function(e){return!e.removed})).forEach((function(e){return a.fabric.changeIntervalRole(e,H.Ring,t,r)}));var s=o(i)?H.NexusPush:H.ColumnPush;i.pushes.filter((function(e){return!e.removed})).forEach((function(e){return a.fabric.changeIntervalRole(e,s,t,r)}))};return p(e),p(t),this.fabric.instance.forgetDimensions(),!0}},{key:"markFace",get:function(){var e=this;return function(t,n){var r=e.faceMarks[t];r?r.push(n):e.faceMarks[t]=[n]}}},{key:"initialFacePulls",get:function(){var e=this;return this.faceMarkLists.filter((function(e){return 2===e.length||3===e.length})).reduce((function(t,n){return[].concat(Object(Be.a)(t),Object(Be.a)(e.createFacePulls(n)))}),[])}},{key:"faceMarkLists",get:function(){var e=this;return Object.keys(this.faceMarks).map((function(t){return e.faceMarks[t]}))}}]),e}(),lr=new y.SphereGeometry(1,32,8),hr=65535;function fr(e){return an(e)/1e4}var dr,pr,mr=function(){function e(t,n,r,a,i){Object(l.a)(this,e),this.roleDefaultLength=t,this.numericFeature=n,this.instance=r,this.slackInstance=a,this.tenscript=i,this.life$=void 0,this.joints=[],this.intervals=[],this.facePulls=[],this.faces=[],this.bricks=[],this.activeTenscript=void 0,this.facesToConnect=void 0,this.maxJointSpeed=0,this.builder=void 0,this.faceCount=void 0,this.faceLocations=void 0,this.faceNormals=void 0,this._facesGeometry=new y.BufferGeometry,this.intervalCount=void 0,this.lineLocations=void 0,this.lineColors=void 0,this._linesGeometry=new y.BufferGeometry,this.life$=new u.BehaviorSubject(new ir(n,this,L.Growing)),this.builder=new ur(this,n),this.refreshLineGeometry(),this.refreshFaceGeometry();var o=this.builder.createBrickAt(new y.Vector3,rn());this.bricks=[o],this.activeTenscript=[{tree:this.tenscript.tree,brick:o,fabric:this}]}return Object(h.a)(e,[{key:"toStage",value:function(e,t){e!==this.life.stage&&this.life$.next(this.life.withStage(e,t))}},{key:"connectFaces",value:function(e){this.facesToConnect=e}},{key:"brickMidpoint",value:function(e,t){var n=this,r=e.joints,a=t||new y.Vector3;return r.reduce((function(e,t){return e.add(n.instance.location(t.index))}),a).multiplyScalar(1/r.length)}},{key:"createJointIndex",value:function(e,t){return this.engine.createJoint(e,_.RightSide,t.x,t.y,t.z)}},{key:"createFacePull",value:function(e,t){var n=this.instance,r=n.faceMidpoint(e.index).distanceTo(n.faceMidpoint(t.index)),a=fr(rn()),i=or(a),o=(an(e.brick.scale)+an(t.brick.scale))/2,c=sr(o),s={index:this.engine.createInterval(e.index,t.index,H.FacePull,c,a,i,function(e){var t=4e3*e;return t>hr?hr:t}(r)),alpha:e,omega:t,distance:r,scaleFactor:o,removed:!1};return this.facePulls.push(s),this.instance.forgetDimensions(),s}},{key:"removeFacePull",value:function(e){this.facePulls=this.facePulls.filter((function(t){return t.index!==e.index})),this.engine.removeInterval(e.index),this.facePulls.forEach((function(t){t.index>e.index&&t.index--})),this.intervals.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0,this.instance.forgetDimensions()}},{key:"createInterval",value:function(e,t,n,r,a){var i=an(r)*this.roleDefaultLength(n),o=fr(r),c=or(o),s={index:this.engine.createInterval(e.index,t.index,n,i,o,c,a),intervalRole:n,scale:r,alpha:e,omega:t,removed:!1,isPush:U(n)};return this.intervals.push(s),s}},{key:"changeIntervalScale",value:function(e,t){e.scale=on(an(e.scale)*t),this.instance.engine.multiplyRestLength(e.index,t,100)}},{key:"changeIntervalRole",value:function(e,t,n,r){e.intervalRole=t;var a=this.instance.engine;a.setIntervalRole(e.index,t),a.changeRestLength(e.index,an(n)*this.roleDefaultLength(t),r)}},{key:"removeInterval",value:function(e){this.intervals=this.intervals.filter((function(t){return t.index!==e.index})),this.engine.removeInterval(e.index),this.intervals.forEach((function(t){t.index>e.index&&t.index--})),this.facePulls.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0,this.instance.forgetDimensions()}},{key:"createFace",value:function(e,t){var n=tn[t],r=n.negative,a=n.pushEnds,i=a.map((function(t){return e.joints[t]})),o=a.map((function(t){var n=e.pushes.find((function(n){var r=e.joints[t];return r.index===n.alpha.index||r.index===n.omega.index}));if(void 0===n)throw new Error;return n})),c=[0,1,2].map((function(n){return e.pulls[3*t+n]})),s={index:this.engine.createFace(i[0].index,i[1].index,i[2].index),canGrow:!0,negative:r,removed:!1,brick:e,triangle:t,joints:i,pushes:o,pulls:c};return this.faces.push(s),s}},{key:"removeFace",value:function(e,t){var n=this;this.engine.removeFace(e.index),this.faces=this.faces.filter((function(t){return t.index!==e.index})),this.faces.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0,t&&e.pulls.forEach((function(e){return n.removeInterval(e)}))}},{key:"release",value:function(){this.instance.release()}},{key:"needsUpdate",value:function(){var e=this.instance;this.faceLocations.array=e.faceLocations,this.faceLocations.needsUpdate=!0,this.faceNormals.array=e.faceNormals,this.faceNormals.needsUpdate=!0,this.lineLocations.array=e.lineLocations,this.lineLocations.needsUpdate=!0,this.lineColors.array=e.lineColors,this.lineColors.needsUpdate=!0,this._linesGeometry.computeBoundingSphere(),this._facesGeometry.computeBoundingSphere()}},{key:"startTightening",value:function(e){this.facePulls=e}},{key:"iterate",value:function(){var e=this,t=this.engine,n=t.iterate(this.life$.getValue().stage);if(this.maxJointSpeed=Math.sqrt(t.renderNumbers()),n===L.Busy)return n;var r=this.activeTenscript;if(r){if(r.length>0&&(this.activeTenscript=xn(r,this.builder.markFace),t.centralize()),0===r.length&&(this.activeTenscript=void 0,n===L.Growing)){var a=t.finishGrowing();return this.facePulls=this.builder.initialFacePulls,a}}else{var i=this.facesToConnect;i&&(this.facesToConnect=void 0,this.builder.createFacePulls(i)),this.facePulls=this.builder.checkFacePulls(this.facePulls,(function(t){return e.removeFacePull(t)}))}return n}},{key:"findInterval",value:function(e,t){return this.intervals.find((function(n){return n.alpha.index===e.index&&n.omega.index===t.index||n.alpha.index===t.index&&n.omega.index===e.index}))}},{key:"orientInterval",value:function(e,t,n){var r=new y.Vector3(0,1,0),a=this.instance.unitVector(e.index),i=(new y.Quaternion).setFromUnitVectors(r,a),o=this.instance.location(e.alpha.index),c=this.instance.location(e.omega.index),s=o.distanceTo(c),u=this.instance.strains[e.index],l=s/2;return{scale:new y.Vector3(t,l+l*-u*n,t),rotation:i}}},{key:"refreshLineGeometry",value:function(){this.engine.renderNumbers(),this.intervalCount=this.instance.engine.getIntervalCount(),this.lineLocations=new y.Float32BufferAttribute(this.instance.lineLocations,3),this.lineColors=new y.Float32BufferAttribute(this.instance.lineColors,3),this._linesGeometry.addAttribute("position",this.lineLocations),this._linesGeometry.addAttribute("color",this.lineColors),this._linesGeometry.computeBoundingSphere()}},{key:"refreshFaceGeometry",value:function(){this.engine.renderNumbers(),this.faceCount=this.instance.engine.getFaceCount(),this.faceLocations=new y.Float32BufferAttribute(this.instance.faceLocations,3),this.faceNormals=new y.Float32BufferAttribute(this.instance.faceNormals,3),this._facesGeometry.addAttribute("position",this.faceLocations),this._facesGeometry.addAttribute("normal",this.faceNormals),this._facesGeometry.computeBoundingSphere()}},{key:"life",get:function(){return this.life$.getValue()}},{key:"submergedJoints",get:function(){var e=this;return this.joints.filter((function(t){return e.instance.location(t.index).y<0}))}},{key:"facesGeometry",get:function(){return this.faceCount!==this.instance.engine.getFaceCount()&&this.refreshFaceGeometry(),this._facesGeometry}},{key:"linesGeometry",get:function(){return this.intervalCount!==this.instance.engine.getIntervalCount()&&this.refreshLineGeometry(),this._linesGeometry}},{key:"output",get:function(){var e=this,t=function(e){return e.toFixed(5).replace(/[.]/,",")},n=this.instance.strains,r=this.instance.stiffnesses,a=this.instance.linearDensities;return{name:this.tenscript.name,joints:this.joints.map((function(n){var r=e.instance.location(n.index);return{index:(n.index+1).toString(),x:t(r.x),y:t(r.z),z:t(r.y)}})),intervals:this.intervals.map((function(i){var o=e.instance.location(i.alpha.index),c=e.instance.location(i.omega.index),s=o.distanceTo(c),u="".concat(i.alpha.index+1,",").concat(i.omega.index+1),l=t(n[i.index]),h=i.isPush?"Push":"Pull",f=r[i.index],d=t(f),p=a[i.index],m=t(p),v=H[i.intervalRole];return{joints:u,type:h,strainString:l,stiffness:f,stiffnessString:d,linearDensity:p,linearDensityString:m,isPush:U(i.intervalRole),role:v,length:s}})).sort((function(e,t){return e.isPush&&!t.isPush?-1:!e.isPush&&t.isPush?1:e.stiffness-t.stiffness}))}}},{key:"engine",get:function(){return this.instance.engine}}]),e}(),vr=n(649),gr=n(650),yr=n(651),br=n(652),xr=n(653),wr=["#fc4d4d","#fb712a","#ed9400","#d4b500","#afd200","#80da52","#4edd83","#00ddad","#00c4d7","#00a5ff","#007bff","#2329f7"].reverse().map((function(e){return new y.Color(e)})),Sr=!0,Er=new y.MeshPhongMaterial({color:new y.Color("#1c1608"),side:y.DoubleSide}),kr=new y.LineBasicMaterial({vertexColors:y.VertexColors}),Or=new y.LineBasicMaterial({color:new y.Color("#cace02")}),jr=new y.MeshPhongMaterial({lights:Sr,color:new y.Color("white"),side:y.DoubleSide,transparent:!0,opacity:.2}),Pr=new y.MeshPhongMaterial({color:new y.Color("#91934f"),lights:!0}),Nr=wr.map((function(e){return new y.MeshLambertMaterial({color:e,lights:Sr})}));function Cr(e){switch(e){case H.NexusPush:return"#6541b4";case H.ColumnPush:return"#2f3aca";case H.Triangle:return"#f9c9bf";case H.Ring:return"#cc3200";case H.NexusCross:return"#59ebcb";case H.ColumnCross:return"#73c84a";case H.BowMid:return"#f101e9";case H.BowEnd:return"#cb01c3";case H.FacePull:return"#bf0105";default:return}}function Mr(e){var t=function(e){return new y.Color(Cr(e))}(e);return new y.MeshLambertMaterial({color:t,lights:Sr})}function Vr(e){var t=e.feature,n=e.disabled,r=Object(o.useState)((function(){return t.percent})),a=Object(Zn.a)(r,2),i=a[0],c=a[1];Object(o.useEffect)((function(){var e=t.observable.subscribe((function(e){var t=e.percent;return c(t)}));return function(){return e.unsubscribe()}}),[]);var s=Cr(Z(t.fabricFeature)),u=s||"#919191";return o.createElement("div",{className:"my-2"},o.createElement("div",{className:"float-right",style:{color:n?"gray":"white"}},t.formatted),o.createElement("div",null,t.config.name),o.createElement(Xn.a,{className:"w-100"},t.percentChoices.map((function(e){var r=i===e?"#000000":u;return o.createElement(ie.a,{disabled:n,size:"sm",style:{color:"white",backgroundColor:r},key:"".concat(t.config.name,":").concat(e),onClick:function(){return t.percent=e}},function(e){return e<=100?"".concat(e,"%"):"".concat(e/100,"x")}(e))}))))}function Fr(e){var t=e.fabric,n=e.stageTransition,r=e.disabled,a=Object(o.useState)(t.life),i=Object(Zn.a)(a,2),c=i[0],s=i[1];function u(e){return!(!r&&c.stage!==L.Busy&&c.stage!==L.Realizing)||c.stage!==e}switch(Object(o.useEffect)((function(){var e=t.life$.subscribe(s);return function(){return e.unsubscribe()}}),[t]),n){case dr.CaptureLengthsToSlack:return o.createElement(ie.a,{className:"my-1 w-100",disabled:u(L.Shaping),onClick:function(){return t.toStage(L.Slack,{adoptLengths:!0})}},"Capture Lengths ",o.createElement(Wn.j,null)," (",o.createElement(Tr,{stage:L.Shaping})," ) ",o.createElement(Wn.d,null)," ( ",o.createElement(Wn.f,null),o.createElement(Tr,{stage:L.Slack})," ) New Slack");case dr.CurrentLengthsToSlack:return o.createElement(ie.a,{className:"my-1 w-100",disabled:u(L.Shaping),onClick:function(){return t.toStage(L.Slack)}},"Current Lengths ",o.createElement(Tr,{stage:L.Shaping})," ",o.createElement(Wn.d,null),o.createElement(Tr,{stage:L.Slack})," Slack");case dr.SlackToRealizing:return o.createElement(ie.a,{className:"my-1 w-100",disabled:u(L.Slack),onClick:function(){return t.toStage(L.Realizing)}},"Slack ",o.createElement(Tr,{stage:L.Slack})," ",o.createElement(Wn.d,null)," ",o.createElement(Tr,{stage:L.Realized})," Realized");case dr.SlackToShaping:return o.createElement(Xn.a,{vertical:!0,className:"w-100 my-1"},o.createElement(ie.a,{className:"my-1 w-100",disabled:u(L.Slack),onClick:function(){return t.toStage(L.Shaping)}},"Slack ",o.createElement(Tr,{stage:L.Slack})," ",o.createElement(Wn.d,null)," ",o.createElement(Tr,{stage:L.Shaping})," Shaping"));case dr.CaptureRealizedToSlack:return o.createElement(ie.a,{className:"my-1 w-100",disabled:u(L.Realized),onClick:function(){return t.toStage(L.Slack,{adoptLengths:!0})}},"Capture realized ",o.createElement(Wn.j,null)," ( ",o.createElement(Tr,{stage:L.Realized})," ) ",o.createElement(Wn.d,null)," ( ",o.createElement(Wn.f,null),o.createElement(Tr,{stage:L.Slack})," ) New Slack");case dr.CaptureStrainForStiffness:return o.createElement(ie.a,{className:"my-1 w-100",disabled:u(L.Realized),onClick:function(){return t.toStage(L.Slack,{strainToStiffness:!0})}},"Capture Strain ",o.createElement(Wn.j,null)," ( ",o.createElement(Tr,{stage:L.Realized})," ",o.createElement(Wn.G,null)," ) ",o.createElement(Wn.d,null),"( ",o.createElement(Tr,{stage:L.Slack})," ",o.createElement(Wn.k,null)," ) Slack Stiffness")}}function Tr(e){switch(e.stage){case L.Busy:return o.createElement(Wn.n,null);case L.Growing:return o.createElement(Wn.N,null);case L.Shaping:return o.createElement(Wn.S,null);case L.Slack:return o.createElement(Wn.U,null);case L.Realizing:return o.createElement(Wn.n,null);case L.Realized:return o.createElement(Wn.B,null)}}function Lr(e){var t=e.floatFeatures,n=e.fabric,r=e.selectedIntervals,a=e.setFabric,i=e.shapeSelection,c=e.setShapeSelection,s=e.selectedFaces,u=e.clearSelectedFaces,l=e.storedState$,h=Object(o.useState)(!1),f=Object(Zn.a)(h,2),d=f[0],p=f[1];Object(o.useEffect)((function(){n.instance.engine.setPushAndPull(d)}),[d]);var m=Object(o.useState)(l.getValue().ellipsoids),v=Object(Zn.a)(m,2),g=v[0],y=v[1];Object(o.useEffect)((function(){var e=[l.subscribe((function(e){return y(e.ellipsoids)}))];return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[]);var b=Object(o.useState)(n.life),x=Object(Zn.a)(b,2),w=x[0],S=x[1];Object(o.useEffect)((function(){var e=n.life$.subscribe(S);return function(){return e.unsubscribe()}}),[n]);var E=Object(o.useState)(t[R.NexusPushLength]),k=Object(Zn.a)(E,2),O=k[0],j=k[1],P=function(e,t,a){return function(){r&&r.forEach((function(r){r.isPush&&!t||!r.isPush&&!a||n.changeIntervalScale(r,e?1.03:1/1.03)}))}};function N(){return g||w.stage!==L.Shaping}function C(e,t){return!(!N()&&i===t)||(s.length<e||g)}function M(){return g||i!==pr.None}return o.createElement("div",null,o.createElement(na,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Wn.a,null)," Phase"),o.createElement(Fr,{fabric:n,stageTransition:dr.CaptureLengthsToSlack,disabled:M()}),o.createElement(Fr,{fabric:n,stageTransition:dr.CurrentLengthsToSlack,disabled:M()}),o.createElement(Fr,{fabric:n,stageTransition:dr.SlackToShaping,disabled:M()})),o.createElement(na,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Wn.z,null)," Manual"),o.createElement(Xn.a,{size:"sm",className:"w-100 my-2"},o.createElement(ie.a,{color:i===pr.Intervals?"warning":"secondary",disabled:g&&i===pr.None||0===s.length,onClick:function(){var e=i===pr.Intervals?pr.None:pr.Intervals;c(e)}},o.createElement("span",null,o.createElement(Wn.b,null)," Adjust ",o.createElement(Wn.e,null))),o.createElement(ie.a,{disabled:C(1,pr.Intervals),onClick:P(!0,!0,!0)},"TC ",o.createElement(Wn.e,null)),o.createElement(ie.a,{disabled:C(1,pr.Intervals),onClick:P(!1,!0,!0)},"TC ",o.createElement(Wn.b,null)),o.createElement(ie.a,{disabled:C(1,pr.Intervals),onClick:P(!0,!1,!0)},"T",o.createElement(Wn.e,null)),o.createElement(ie.a,{disabled:C(1,pr.Intervals),onClick:P(!1,!1,!0)},"T ",o.createElement(Wn.b,null)),o.createElement(ie.a,{disabled:C(1,pr.Intervals),onClick:P(!0,!0,!1)},"C ",o.createElement(Wn.e,null)),o.createElement(ie.a,{disabled:C(1,pr.Intervals),onClick:P(!1,!0,!1)},"C ",o.createElement(Wn.b,null))),o.createElement(Xn.a,{size:"sm",className:"w-100 my-2"},o.createElement(ie.a,{disabled:0===s.length||N()&&i!==pr.None,onClick:function(){return u()}},o.createElement(Wn.Q,null)," Clear selection"),o.createElement(ie.a,{disabled:C(1,pr.Faces),onClick:function(){n.builder.uprightAtOrigin(s[0]),u()}},o.createElement(Wn.o,null),o.createElement("span",null," Upright")),o.createElement(ie.a,{disabled:C(2,pr.Faces),onClick:function(){n.connectFaces(s),u(),c(pr.None),a(n)}},o.createElement(Wn.F,null),o.createElement("span",null," Connect")),o.createElement(ie.a,{disabled:N(),onClick:function(){return n.builder.optimize()}},o.createElement(Wn.H,null),o.createElement("span",null," Bows")))),o.createElement(na,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Wn.S,null)," Adjustments"),o.createElement(Vr,{feature:t[R.ShapingPretenstFactor],disabled:N()}),o.createElement(Vr,{feature:t[R.ShapingDrag],disabled:N()}),o.createElement(Vr,{feature:t[R.ShapingStiffnessFactor],disabled:N()}),o.createElement(Xn.a,{size:"sm",className:"w-100 my-2"},o.createElement(ie.a,{disabled:N(),color:d?"secondary":"success",onClick:function(){return p(!1)}},o.createElement(Wn.l,null),": T or C"),o.createElement(ie.a,{disabled:N(),color:d?"success":"secondary",onClick:function(){return p(!0)}},o.createElement(Wn.r,null),": T=C"))),o.createElement(na,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Wn.G,null)," Default Lengths"),o.createElement(Vr,{key:O.title,feature:O,disabled:N()}),o.createElement(Xn.a,{className:"my-2"},J.map((function(e){return{intervalRole:e,feature:t[W(e)]}})).map((function(e){var t=e.intervalRole,n=e.feature;return o.createElement(ie.a,{size:"sm",key:H[t],onClick:function(){return j(n)},color:O.fabricFeature===n.fabricFeature?"success":"secondary"},G(t))})))))}function Rr(e){var t=e.floatFeatures,n=e.fabric,r=e.shapeSelection,a=e.storedState$,i=Object(o.useState)(a.getValue()),c=Object(Zn.a)(i,2),s=c[0],u=c[1],l=Object(o.useState)(a.getValue().ellipsoids),h=Object(Zn.a)(l,2),f=h[0],d=h[1];Object(o.useEffect)((function(){var e=[a.subscribe((function(e){d(s.ellipsoids),u(e)}))];return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[]);var p,m=Object(o.useState)(n.life),v=Object(Zn.a)(m,2),g=v[0],y=v[1];function b(){return f||r!==pr.None||g.stage<L.Slack}function x(){return f||r!==pr.None}return Object(o.useEffect)((function(){var e=n.life$.subscribe(y);return function(){return e.unsubscribe()}}),[n]),o.createElement("div",null,o.createElement(na,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Wn.a,null)," Phase"),o.createElement(Fr,{fabric:n,stageTransition:dr.SlackToRealizing,disabled:x()}),o.createElement(Fr,{fabric:n,stageTransition:dr.CaptureRealizedToSlack,disabled:x()})),o.createElement(na,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Wn.x,null)," Environment"),o.createElement(Vr,{feature:t[R.PretenstFactor],disabled:b()}),o.createElement("div",{className:"float-right",style:{color:b()?"gray":"white"}},Y[s.surfaceCharacter]),o.createElement("div",null,"Surface"),o.createElement(Xn.a,{size:"sm",className:"w-100"},(p=Y,Object.keys(p).filter((function(e){return e.length>1})).map((function(e){return p[e]}))).map((function(e){return o.createElement(ie.a,{key:Y[e],disabled:b(),active:s.surfaceCharacter===e,onClick:function(){return t={surfaceCharacter:e},void a.next(On(a.getValue(),t));var t}},Y[e])}))),o.createElement(Vr,{feature:t[R.Gravity],disabled:b()}),o.createElement(Vr,{feature:t[R.Drag],disabled:b()})),o.createElement(na,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Wn.g,null)," Compression vs Tension"),o.createElement(Fr,{fabric:n,stageTransition:dr.CaptureStrainForStiffness,disabled:x()}),o.createElement(Vr,{feature:t[R.PushOverPull],disabled:b()})))}!function(e){e[e.CaptureLengthsToSlack=0]="CaptureLengthsToSlack",e[e.CurrentLengthsToSlack=1]="CurrentLengthsToSlack",e[e.SlackToRealizing=2]="SlackToRealizing",e[e.SlackToShaping=3]="SlackToShaping",e[e.CaptureRealizedToSlack=4]="CaptureRealizedToSlack",e[e.CaptureStrainForStiffness=5]="CaptureStrainForStiffness"}(dr||(dr={})),function(e){e[e.None=0]="None",e[e.Faces=1]="Faces",e[e.Intervals=2]="Intervals"}(pr||(pr={}));var Ar=.7,Dr=1.4,Hr=3.5,Ir=[R.MaxStrain,R.MaxStiffness,R.VisualStrain,R.SlackThreshold];function zr(e){var t=new y.Geometry,n=function(e,t){return new y.Vector3(e,t,0)};return t.vertices=[n(0,-Hr),n(0,Hr),n(-Ar,Hr),n(Ar,Hr),n(-Ar,-Hr),n(Ar,-Hr)],e&&t.vertices.push(n(-Ar,0),n(Ar,0)),t}function Gr(e,t,n,r,a){var i=new Float32Array(2*n.length*3),o=0;e.forEach((function(e){var t=(n[e.index]-r)/(a-r),c=t<-1?-1:t>1?1:t;i[o++]=-Ar*Dr,i[o++]=c*Hr,i[o++]=0,i[o++]=Ar*Dr,i[o++]=c*Hr,i[o++]=0}));var c=new y.BufferGeometry;return c.addAttribute("position",new y.Float32BufferAttribute(i,3)),c.addAttribute("color",new y.Float32BufferAttribute(t,3)),c}function Br(e){var t=e.floatFeatures,n=e.fabric,r=e.storedState$,a=Object(o.useRef)();return o.createElement(o.Fragment,null,o.createElement(na,{height:"50%"},o.createElement("div",{style:{position:"absolute",left:"6em"}},"Strain"),o.createElement("div",{style:{position:"absolute",right:"5em"}},"Stiffness"),o.createElement((function(){var e=Object(o.useState)(0),t=Object(Zn.a)(e,2),i=t[0],c=t[1],s=Object(o.useState)(r.getValue().featureValues[R.MaxStrain].numeric),u=Object(Zn.a)(s,2),l=u[0],h=u[1],f=Object(o.useState)(r.getValue().featureValues[R.MaxStiffness].numeric),d=Object(Zn.a)(f,2),p=d[0],m=d[1];Object(o.useEffect)((function(){var e=r.subscribe((function(e){h(e.featureValues[R.MaxStrain].numeric),m(e.featureValues[R.MaxStiffness].numeric)}));return function(){return e.unsubscribe()}}),[n]),Object(o.useEffect)((function(){var e=setInterval((function(){var e=n.instance.engine.getAge();i<e&&c(e)}),1e3);return function(){return clearTimeout(e)}}),[]);var v=n.instance;function g(e){var t=e.position,n=e.intervals,r=e.floats,a=e.mid,i=e.max,c=e.middleTick;return o.createElement("group",{position:new y.Vector3(t,-.15,0)},o.createElement("lineSegments",{geometry:Gr(n,v.lineColors,r,a,i),material:kr}),o.createElement("lineSegments",{geometry:zr(c),material:Or}))}return o.createElement(Ot.a,null,o.createElement("orthographicCamera",{position:new y.Vector3(0,0,-1),ref:a}),o.createElement("scene",null,o.createElement(g,{position:-1.5,intervals:n.intervals,floats:v.strains,mid:0,max:l,middleTick:!0}),o.createElement(g,{position:1.5,intervals:n.intervals,floats:v.stiffnesses,mid:0,max:p,middleTick:!1})))}),null)),o.createElement(na,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Wn.O,null)," Adjustments"),Ir.map((function(e){return o.createElement(Vr,{key:R[e],feature:t[e],disabled:!1})}))))}var _r=n(656),Yr=n(645),Jr=n(646),Ur=n(647),Zr=n(648);function Wr(e){var t=e.rootTenscript,n=e.setRootTenscript,r=e.fabric,a=e.runTenscript,i=e.storedState$,c=Object(o.useState)(r&&!r.tenscript.fromUrl?r.tenscript:t),s=Object(Zn.a)(c,2),u=s[0],l=s[1],h=Object(o.useState)(""),f=Object(Zn.a)(h,2),d=f[0],p=f[1],m=Object(o.useState)(!1),v=Object(Zn.a)(m,2),g=v[0],y=v[1],b=Object(o.useState)(kn(i.getValue())),x=Object(Zn.a)(b,2),w=x[0],S=x[1],E=Object(o.useState)(!1),k=Object(Zn.a)(E,2),O=k[0],j=k[1];function P(e){var t=function(e,t){var n=t.code,r=t.name,a=Sn({},e.recentCode);return a[r]=gn(n,r),On(e,{recentCode:a})}(i.getValue(),e);S(kn(t)),i.next(t)}return o.createElement("div",{id:"tenscript-panel",style:{flexDirection:"column",position:"relative",backgroundColor:"rgba(0,0,0,1)",height:"100%"}},o.createElement(na,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Wn.N,null)," Tenscript"),o.createElement("div",{id:"code-and-run",style:{flexDirection:"column",height:"available"}},o.createElement(Xr,{tenscript:u,setTenscript:l,error:d,setError:p}),o.createElement(Xn.a,{className:"w-100 my-2"},o.createElement(ie.a,{color:d.length>0?"warning":"success",disabled:d.length>0,onClick:function(){return a(u)}},0===d.length?o.createElement("span",null,"Execute ",o.createElement(Wn.J,null)," tenscript"):o.createElement("span",null,o.createElement(Wn.i,null)," ",d))))),o.createElement(na,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Wn.h,null)," Storage"),0===w.length?void 0:o.createElement(_r.a,{className:"w-100 my-2",isOpen:g,toggle:function(){return y(!g)}},o.createElement(Yr.a,{style:{borderRadius:"1.078em"}},g?o.createElement(Wn.L,null):o.createElement(Wn.K,null)," Recent"),o.createElement(Jr.a,null,w.map((function(e,t){return o.createElement(Ur.a,{key:"Recent".concat(t),onClick:function(){return a(e)}},e.name)})))),o.createElement(Xn.a,{className:"w-100 my-2"},o.createElement(ie.a,{disabled:u.code===t.code,onClick:function(){n(u),P(u)}},"Save ",o.createElement(Wn.C,null)," for later")),o.createElement(_r.a,{className:"w-100 my-2",isOpen:O,toggle:function(){return j(!O)}},o.createElement(Yr.a,{color:"info",style:{borderRadius:"1.078em"}},"Explore ",o.createElement(Wn.D,null)," existing designs"),o.createElement(Jr.a,null,bn.map((function(e,t){return o.createElement(Ur.a,{key:"Boot".concat(t),onClick:function(){return a(e)}},e.name)}))))))}function Xr(e){var t=e.tenscript,n=e.setTenscript,r=e.error,a=e.setError,i=Object(o.useState)(""),c=Object(Zn.a)(i,2),s=c[0],u=c[1];function l(e){u(e),function(e){var t=mn(a,!1,e);t&&(a(""),n(t))}(e)}return Object(o.useEffect)((function(){return u(function(e){return e.replace(/[,]/g,", ")}(t.code))}),[]),o.createElement("div",{className:"my-2 p-2 w-100",style:{backgroundColor:"#757575",color:"#ffffff",borderStyle:"solid",borderRadius:"1em",borderColor:0===r.length?"black":"#f0ad4e",borderWidth:"2px"}},o.createElement("h6",{className:"w-100 text-center"},o.createElement("i",null,'"',t.name,'"')),o.createElement(Zr.a,{style:{borderRadius:"1em",height:"20em"},type:"textarea",id:"tenscript",value:s,onChange:function(e){return l(e.target.value)}}))}var $r=n(120),Qr=n(262),qr=n.n(Qr);n(263);function Kr(e){var t=e.floatFeatures,n=e.fabric,r=e.visibleRoles,a=e.setVisibleRoles,i=e.storedState$,c=Object(o.useState)(i.getValue().ellipsoids),s=Object(Zn.a)(c,2),u=s[0],l=s[1],h=Object(o.useState)(i.getValue().showPushes),f=Object(Zn.a)(h,2),d=f[0],p=f[1],m=Object(o.useState)(i.getValue().showPulls),v=Object(Zn.a)(m,2),g=v[0],y=v[1];Object(o.useEffect)((function(){var e=i.subscribe((function(e){l(e.ellipsoids),p(e.showPushes),y(e.showPulls)}));return function(){return e.unsubscribe()}}),[]);var b=Object(o.useState)(n.life),x=Object(Zn.a)(b,2),w=x[0],S=x[1];function E(e){var t=e.pushes,n=e.pulls,r=e.children;return o.createElement(ie.a,{style:{color:"white"},color:t===d&&n===g?"success":"secondary",onClick:function(){i.next(On(i.getValue(),{showPulls:n,showPushes:t}))}},r)}return Object(o.useEffect)((function(){var e=n.life$.subscribe(S);return function(){return e.unsubscribe()}}),[n]),o.createElement("div",null,o.createElement(na,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Wn.t,null)," Coloring"),o.createElement(Xn.a,{className:"w-100 my-2"},o.createElement(E,{pushes:!0,pulls:!0},o.createElement("span",null,o.createElement(Wn.w,null)," All")),o.createElement(E,{pushes:!1,pulls:!0},o.createElement("span",null,o.createElement(Wn.T,null)," Pulls")),o.createElement(E,{pushes:!0,pulls:!1},o.createElement("span",null,o.createElement(Wn.s,null)," Pushes")),o.createElement(E,{pushes:!1,pulls:!1},o.createElement("span",null,o.createElement(Wn.m,null)," Roles")))),o.createElement(na,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Wn.j,null)," Snapshot"),o.createElement(Xn.a,{size:"sm"},J.map((function(e){return o.createElement(ie.a,{color:r.indexOf(e)<0?"secondary":"success",key:"viz".concat(e),onClick:function(){r.indexOf(e)<0?a([].concat(Object(Be.a)(r),[e])):a(r.filter((function(t){return t!==e})))},disabled:!u},G(e))}))),o.createElement(Vr,{key:"pushrad",feature:t[R.PushRadiusFactor],disabled:!u}),o.createElement(Vr,{key:"pullrad",feature:t[R.PullRadiusFactor],disabled:!u})),o.createElement(na,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Wn.n,null)," Time"),o.createElement(Vr,{key:"it",feature:t[R.IterationsPerFrame],disabled:u}),o.createElement(Vr,{key:"ic",feature:t[R.IntervalCountdown],disabled:u}),o.createElement(Vr,{key:"pc",feature:t[R.PretenstCountdown],disabled:u})),o.createElement(na,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Wn.v,null)," Perturb"),o.createElement(Xn.a,{className:"w-100"},o.createElement(ie.a,{disabled:w.stage!==L.Realized,onClick:function(){return n.instance.engine.setAltitude(1)}},o.createElement(Wn.A,null)," Nudge"),o.createElement(ie.a,{disabled:w.stage!==L.Realized,onClick:function(){return n.instance.engine.setAltitude(10)}},o.createElement(Wn.I,null)," Drop"),o.createElement(ie.a,{disabled:u,onClick:function(){return n.instance.engine.centralize()}},o.createElement(Wn.p,null)," Centralize"))),o.createElement(na,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Wn.M,null)," Take"),o.createElement(Xn.a,{vertical:!0,className:"w-100"},o.createElement(ie.a,{onClick:function(){return function(e){var t=e.output,n=new qr.a;n.file("joints.csv",function(e){var t=[];return t.push(["index","x","y","z"]),e.joints.forEach((function(e){return t.push([e.index,e.x,e.y,e.z])})),t.map((function(e){return e.join(";")})).join("\n")}(t)),n.file("intervals.csv",function(e){var t=[];return t.push(["joints","type","strain","elasticity","linear density","role","length"]),e.intervals.forEach((function(e){t.push(['"=""'.concat(e.joints,'"""'),e.type,e.strainString,e.stiffnessString,e.linearDensityString,e.role,e.length.toFixed(8)])})),t.map((function(e){return e.join(";")})).join("\n")}(t)),n.file("submerged.csv",function(e){var t=[];return t.push(["joints"]),t.push(['"=""'.concat(e.submergedJoints.map((function(e){return e.index+1})),'"""')]),t.map((function(e){return e.join(";")})).join("\n")}(e)),n.generateAsync({type:"blob",mimeType:"application/zip"}).then((function(e){var t=(new Date).toISOString().replace(/[.].*/,"").replace(/[:T_]/g,"-");$r.saveAs(e,"pretenst-".concat(t,".zip"))}))}(n)}},o.createElement(Wn.q,null)," Download CSV ",o.createElement(Wn.u,null)))))}var ea="25em";function ta(e){var t=e.floatFeatures,n=e.rootTenscript,r=e.setRootTenscript,a=e.shapeSelection,i=e.setShapeSelection,c=e.selectedFaces,s=e.clearSelectedFaces,u=e.selectedIntervals,l=e.fabric,h=e.setFabric,f=e.runTenscript,d=e.visibleRoles,p=e.setVisibleRoles,m=e.toFullScreen,g=e.storedState$,y=Object(o.useState)(l?l.life:void 0),b=Object(Zn.a)(y,2),x=b[0],w=b[1];Object(o.useEffect)((function(){var e=l?l.life$.subscribe(w):void 0;return function(){e&&e.unsubscribe()}}),[l]);var S=Object(o.useState)(g.getValue().controlTab),E=Object(Zn.a)(S,2),k=E[0],O=E[1];function j(e){var t=e.tab;return o.createElement(vr.a,null,o.createElement(gr.a,{active:k===t,onClick:function(){return g.next(On(g.getValue(),{controlTab:t}))}},t))}function P(e){var m=e.tab,y=o.createElement(v.a,{color:"warning"},"No fabric");return o.createElement(yr.a,{id:"tab-pane",style:{height:"100%"},tabId:m},o.createElement((function(){switch(m){case yn.Grow:return o.createElement(Wr,{rootTenscript:n,setRootTenscript:r,fabric:l,runTenscript:f,storedState$:g});case yn.Shape:return l?o.createElement(Lr,{floatFeatures:t,fabric:l,setFabric:h,selectedIntervals:u,shapeSelection:a,setShapeSelection:i,selectedFaces:c,clearSelectedFaces:s,storedState$:g}):y;case yn.Realize:return l?o.createElement(Rr,{floatFeatures:t,fabric:l,shapeSelection:a,storedState$:g}):y;case yn.View:return l?o.createElement(Kr,{floatFeatures:t,fabric:l,visibleRoles:d,setVisibleRoles:p,storedState$:g}):y;case yn.Strain:return l?o.createElement(Br,{floatFeatures:t,fabric:l,storedState$:g}):y}}),null))}return Object(o.useEffect)((function(){k!==yn.Shape&&s()}),[k,x]),Object(o.useEffect)((function(){var e=g.subscribe((function(e){return O(e.controlTab)}));return function(){return e.unsubscribe()}}),[]),o.createElement("div",{className:"h-100"},o.createElement(br.a,{tabs:!0,style:{backgroundColor:"#b2b2b2"}},Object.keys(yn).map((function(e){return o.createElement(j,{key:"T".concat(e),tab:yn[e]})}))),o.createElement(xr.a,{style:{flex:1,flexFlow:"auto",height:"100%"},id:"tab-content",activeTab:k},Object.keys(yn).map((function(e){return o.createElement(P,{key:e,tab:yn[e]})}))),o.createElement("div",{style:{position:"absolute",top:0,height:"100%",left:ea,zIndex:10,width:"1em"}},o.createElement((function(){return o.createElement(ie.a,{style:{padding:0,margin:0,borderRadius:0,width:"1em"},className:"w-100 h-100",color:"dark",onClick:m},o.createElement(Wn.c,null))}),null)))}function na(e){var t=e.children,n=e.height;return o.createElement("div",{className:"m-3 p-2",style:{height:n,borderRadius:"1em",borderStyle:"solid",borderWidth:"0.1em",borderColor:"#45782e"}},t)}var ra={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},aa={type:"change"},ia={type:"start"},oa={type:"end"},ca=function(e){function t(e,n){var r;return Object(l.a)(this,t),(r=Object(f.a)(this,Object(d.a)(t).call(this))).object=void 0,r.element=void 0,r.window=void 0,r.enabled=void 0,r.target=void 0,r.enableZoom=void 0,r.zoomSpeed=void 0,r.minDistance=void 0,r.maxDistance=void 0,r.enableRotate=void 0,r.rotateSpeed=void 0,r.enablePan=void 0,r.keyPanSpeed=void 0,r.autoRotate=void 0,r.autoRotateSpeed=void 0,r.minZoom=void 0,r.maxZoom=void 0,r.minPolarAngle=void 0,r.maxPolarAngle=void 0,r.minAzimuthAngle=void 0,r.maxAzimuthAngle=void 0,r.keys=void 0,r.mouseButtons=void 0,r.enableDamping=void 0,r.dampingFactor=void 0,r.spherical=void 0,r.sphericalDelta=void 0,r.scale=void 0,r.target0=void 0,r.position0=void 0,r.zoom0=void 0,r.state=void 0,r.panOffset=void 0,r.zoomChanged=void 0,r.rotateStart=void 0,r.rotateEnd=void 0,r.rotateDelta=void 0,r.panStart=void 0,r.panEnd=void 0,r.panDelta=void 0,r.dollyStart=void 0,r.dollyEnd=void 0,r.dollyDelta=void 0,r.updateLastPosition=void 0,r.updateOffset=void 0,r.updateQuat=void 0,r.updateLastQuaternion=void 0,r.updateQuatInverse=void 0,r.panLeftV=void 0,r.panUpV=void 0,r.panInternalOffset=void 0,r.onMouseUp=void 0,r.onMouseDown=void 0,r.onMouseMove=void 0,r.onMouseWheel=void 0,r.onTouchStart=void 0,r.onTouchEnd=void 0,r.onTouchMove=void 0,r.object=e,r.element=n,r.window=window,r.enabled=!0,r.target=new y.Vector3,r.minDistance=0,r.maxDistance=1/0,r.minZoom=0,r.maxZoom=1/0,r.minPolarAngle=0,r.maxPolarAngle=Math.PI,r.minAzimuthAngle=-1/0,r.maxAzimuthAngle=1/0,r.enableDamping=!1,r.dampingFactor=.25,r.enableZoom=!0,r.zoomSpeed=1,r.enableRotate=!0,r.rotateSpeed=1,r.enablePan=!0,r.keyPanSpeed=7,r.autoRotate=!1,r.autoRotateSpeed=2,r.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},r.mouseButtons={ORBIT:y.MOUSE.LEFT,ZOOM:y.MOUSE.MIDDLE,PAN:y.MOUSE.RIGHT},r.target0=r.target.clone(),r.position0=r.object.position.clone(),r.zoom0=r.object.zoom,r.updateOffset=new y.Vector3,r.updateQuat=(new y.Quaternion).setFromUnitVectors(r.object.up,new y.Vector3(0,1,0)),r.updateQuatInverse=r.updateQuat.clone().inverse(),r.updateLastPosition=new y.Vector3,r.updateLastQuaternion=new y.Quaternion,r.state=ra.NONE,r.scale=1,r.spherical=new y.Spherical,r.sphericalDelta=new y.Spherical,r.panOffset=new y.Vector3,r.zoomChanged=!1,r.rotateStart=new y.Vector2,r.rotateEnd=new y.Vector2,r.rotateDelta=new y.Vector2,r.panStart=new y.Vector2,r.panEnd=new y.Vector2,r.panDelta=new y.Vector2,r.dollyStart=new y.Vector2,r.dollyEnd=new y.Vector2,r.dollyDelta=new y.Vector2,r.panLeftV=new y.Vector3,r.panUpV=new y.Vector3,r.panInternalOffset=new y.Vector3,r.onMouseDown=function(e){if(e.preventDefault(),r.enabled){if(e.button===r.mouseButtons.ORBIT){if(!r.enableRotate)return;r.rotateStart.set(e.clientX,e.clientY),r.state=ra.ROTATE}else if(e.button===r.mouseButtons.ZOOM){if(!r.enableZoom)return;r.dollyStart.set(e.clientX,e.clientY),r.state=ra.DOLLY}else if(e.button===r.mouseButtons.PAN){if(!r.enablePan)return;r.panStart.set(e.clientX,e.clientY),r.state=ra.PAN}r.state!==ra.NONE&&(document.addEventListener("mousemove",r.onMouseMove,!1),document.addEventListener("mouseup",r.onMouseUp,!1),r.dispatchEvent(ia))}},r.onMouseMove=function(e){if(e.preventDefault(),r.enabled)if(r.state===ra.ROTATE){if(!r.enableRotate)return;r.rotateEnd.set(e.clientX,e.clientY),r.rotateDelta.subVectors(r.rotateEnd,r.rotateStart),r.rotateLeft(2*Math.PI*r.rotateDelta.x/r.element.clientWidth*r.rotateSpeed),r.rotateUp(2*Math.PI*r.rotateDelta.y/r.element.clientHeight*r.rotateSpeed),r.rotateStart.copy(r.rotateEnd),r.update()}else if(r.state===ra.DOLLY){if(!r.enableZoom)return;r.dollyEnd.set(e.clientX,e.clientY),r.dollyDelta.subVectors(r.dollyEnd,r.dollyStart),r.dollyDelta.y>0?r.dollyIn(r.getZoomScale()):r.dollyDelta.y<0&&r.dollyOut(r.getZoomScale()),r.dollyStart.copy(r.dollyEnd),r.update()}else if(r.state===ra.PAN){if(!r.enablePan)return;r.panEnd.set(e.clientX,e.clientY),r.panDelta.subVectors(r.panEnd,r.panStart),r.pan(r.panDelta.x,r.panDelta.y),r.panStart.copy(r.panEnd),r.update()}},r.onMouseUp=function(e){e.preventDefault(),r.enabled&&(document.removeEventListener("mousemove",r.onMouseMove,!1),document.removeEventListener("mouseup",r.onMouseUp,!1),r.dispatchEvent(oa),r.state=ra.NONE)},r.onMouseWheel=function(e){e.preventDefault(),r.enabled&&r.enableZoom&&(r.state===ra.NONE||r.state===ra.ROTATE)&&(e.stopPropagation(),e.deltaY<0?r.dollyOut(r.getZoomScale()):e.deltaY>0&&r.dollyIn(r.getZoomScale()),r.update(),r.dispatchEvent(ia),r.dispatchEvent(oa))},r.onTouchStart=function(e){if(e.preventDefault(),r.enabled){switch(e.touches.length){case 1:if(!r.enableRotate)return;r.rotateStart.set(e.touches[0].pageX,e.touches[0].pageY),r.state=ra.TOUCH_ROTATE;break;case 2:if(!r.enableZoom)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);r.dollyStart.set(0,a),r.state=ra.TOUCH_DOLLY;break;case 3:if(!r.enablePan)return;r.panStart.set(e.touches[0].pageX,e.touches[0].pageY),r.state=ra.TOUCH_PAN;break;default:r.state=ra.NONE}r.state!==ra.NONE&&r.dispatchEvent(ia)}},r.onTouchMove=function(e){if(e.preventDefault(),r.enabled)switch(e.touches.length){case 1:if(!r.enableRotate)return;if(r.state!==ra.TOUCH_ROTATE)return;r.rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY),r.rotateDelta.subVectors(r.rotateEnd,r.rotateStart),r.rotateLeft(2*Math.PI*r.rotateDelta.x/r.element.clientWidth*r.rotateSpeed),r.rotateUp(2*Math.PI*r.rotateDelta.y/r.element.clientHeight*r.rotateSpeed),r.rotateStart.copy(r.rotateEnd),r.update();break;case 2:if(!r.enableZoom)return;if(r.state!==ra.TOUCH_DOLLY)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);r.dollyEnd.set(0,a),r.dollyDelta.subVectors(r.dollyEnd,r.dollyStart),r.dollyDelta.y>0?r.dollyOut(r.getZoomScale()):r.dollyDelta.y<0&&r.dollyIn(r.getZoomScale()),r.dollyStart.copy(r.dollyEnd),r.update();break;case 3:if(!r.enablePan)return;if(r.state!==ra.TOUCH_PAN)return;r.panEnd.set(e.touches[0].pageX,e.touches[0].pageY),r.panDelta.subVectors(r.panEnd,r.panStart),r.pan(r.panDelta.x,r.panDelta.y),r.panStart.copy(r.panEnd),r.update();break;default:r.state=ra.NONE}},r.onTouchEnd=function(e){e.preventDefault(),r.enabled&&(r.dispatchEvent(oa),r.state=ra.NONE)},r.element.addEventListener("mousedown",r.onMouseDown,{capture:!0}),r.element.addEventListener("wheel",r.onMouseWheel,{capture:!0}),r.element.addEventListener("touchstart",r.onTouchStart,{capture:!0}),r.element.addEventListener("touchend",r.onTouchEnd,{capture:!0}),r.element.addEventListener("touchmove",r.onTouchMove,{capture:!0}),r.update(),r}return Object(m.a)(t,e),Object(h.a)(t,[{key:"update",value:function(){var e=this.object.position;return this.updateOffset.copy(e).sub(this.target),this.updateOffset.applyQuaternion(this.updateQuat),this.spherical.setFromVector3(this.updateOffset),this.autoRotate&&this.state===ra.NONE&&this.rotateLeft(this.getAutoRotationAngle()),this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi,this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),this.target.add(this.panOffset),this.updateOffset.setFromSpherical(this.spherical),this.updateOffset.applyQuaternion(this.updateQuatInverse),e.copy(this.target).add(this.updateOffset),this.object.lookAt(this.target),this.enableDamping?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor):this.sphericalDelta.set(0,0,0),this.scale=1,this.panOffset.set(0,0,0),!!(this.zoomChanged||this.updateLastPosition.distanceToSquared(this.object.position)>1e-6||8*(1-this.updateLastQuaternion.dot(this.object.quaternion))>1e-6)&&(this.dispatchEvent(aa),this.updateLastPosition.copy(this.object.position),this.updateLastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0)}},{key:"panLeft",value:function(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}},{key:"panUp",value:function(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}},{key:"pan",value:function(e,t){var n=this.element,r=this.object.position;this.panInternalOffset.copy(r).sub(this.target);var a=this.panInternalOffset.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*a/n.clientHeight,this.object.matrix),this.panUp(2*t*a/n.clientHeight,this.object.matrix)}},{key:"dollyIn",value:function(e){this.scale/=e}},{key:"dollyOut",value:function(e){this.scale*=e}},{key:"getAutoRotationAngle",value:function(){return 2*Math.PI/60/60*this.autoRotateSpeed}},{key:"getZoomScale",value:function(){return Math.pow(.95,this.zoomSpeed)}},{key:"rotateLeft",value:function(e){this.sphericalDelta.theta-=e}},{key:"rotateUp",value:function(e){this.sphericalDelta.phi-=e}},{key:"getPolarAngle",value:function(){return this.spherical.phi}},{key:"getAzimuthalAngle",value:function(){return this.spherical.theta}},{key:"dispose",value:function(){this.element.removeEventListener("mousedown",this.onMouseDown,!1),this.element.removeEventListener("wheel",this.onMouseWheel,!1),this.element.removeEventListener("touchstart",this.onTouchStart,!1),this.element.removeEventListener("touchend",this.onTouchEnd,!1),this.element.removeEventListener("touchmove",this.onTouchMove,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1)}},{key:"reset",value:function(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(aa),this.update(),this.state=ra.NONE}}]),t}(y.EventDispatcher);function sa(){var e=Object(o.useMemo)((function(){return function(){var e=new y.Geometry;return function(e,t,n,r){n.push.apply(n,Object(Be.a)(Oe.map((function(e){return new y.Vector3(e.x,e.y,e.z)})))),n.push(new y.Vector3);for(var a=0;a<Ce;a++){var i=t*(Oe.length+1),o=(a+1)%Ce,c=[Me,(new y.Vector3).add(Me).addScaledVector(Oe[a],Ve).normalize(),(new y.Vector3).add(Me).addScaledVector(Oe[o],Ve).normalize()];r.push(new y.Face3(i+Ce,i+a,i+o,c,Pe))}}(xt.SPOTS_KEY,0,e.vertices,e.faces),e.vertices.forEach((function(e){return e.sub(new y.Vector3(0,.01,0))})),e.computeBoundingSphere(),e}()}),[]);return o.createElement("mesh",{name:"Spots",geometry:e,material:Er})}Object(Ot.b)({Orbit:ca});var ua=new y.Color("#ffffff"),la=100,ha=1,fa=new y.SphereGeometry(la,25,25).scale(ha,ha,ha),da=.01,pa=4;function ma(e){var t=e.fabric,n=e.fabricError,r=e.selectedIntervals,a=e.selectedFaces,i=e.setSelectedFaces,c=e.storedState$,s=e.shapeSelection,u=e.ellipsoids,l=e.visibleRoles,h=document.getElementById("view-container"),f=Object(o.useState)(0),d=Object(Zn.a)(f,2),p=d[0],m=d[1],v=Object(Ot.d)().camera,g=Object(o.useMemo)((function(){var e=(new y.TextureLoader).load("space.jpg");return new y.MeshPhongMaterial({map:e,side:y.BackSide})}),[]),b=Object(o.useState)(t.life),x=Object(Zn.a)(b,2),w=x[0],S=x[1];Object(o.useEffect)((function(){var e=t.life$.subscribe(S);return function(){return e.unsubscribe()}}),[t]);var E=Object(o.useState)(c.getValue()),k=Object(Zn.a)(E,2),O=k[0],j=k[1];Object(o.useEffect)((function(){var e=c.subscribe((function(e){return j(e)}));return function(){return e.unsubscribe()}}),[]),Object(o.useEffect)((function(){P.current.autoRotate=O.rotating}),[O]);var P=Object(Ot.e)((function(e){var t=new y.Vector3(0,pa,0);v.position.set(t.x,pa,t.z+4*pa),v.lookAt(P.current.target),v.fov=60,v.far=2*la,v.near=.001,e.object=v,e.minPolarAngle=-.98*Math.PI/2,e.maxPolarAngle=.8*Math.PI,e.maxDistance=la*ha*.9,e.zoomSpeed=.5,e.enableZoom=!0,e.target.set(t.x,t.y,t.z),e.update()}),[]);return Object(Ot.c)((function(){try{var e=t.instance,r=e.getMidpoint(),a=(new y.Vector3).subVectors(r,P.current.target).multiplyScalar(da);if(P.current.target.add(a),P.current.update(),!u&&s!==pr.Faces){var i=t.iterate();w.stage===L.Realizing&&i===L.Realized?setTimeout((function(){return t.toStage(L.Realized,{})})):i!==w.stage&&w.stage!==L.Realizing&&i!==L.Busy&&setTimeout((function(){return t.toStage(i,{})}))}e.engine.renderNumbers(),t.needsUpdate(),m(e.engine.getAge())}catch(o){n(o)}}),!0,[t,t,p,w,s,u]),o.createElement("group",null,o.createElement("orbit",{ref:P,args:[v,h]}),o.createElement("scene",null,u?o.createElement(ya,{key:"ellipsoid",fabric:t,selectedIntervals:r,storedState:O,visibleRoles:l}):o.createElement(ba,{key:"lines",fabric:t,selectedIntervals:r,storedState:O}),s!==pr.Faces?void 0:o.createElement(xa,{key:"faces",fabric:t,stage:w.stage,selectFace:function(e){a.some((function(t){return t.index===e.index}))?i(a.filter((function(t){return t.index!==e.index}))):i([].concat(Object(Be.a)(a),[e]))}}),a.map((function(e){return o.createElement(va,{key:"Face".concat(e.index),fabric:t,face:e})})),w.stage<=L.Slack?void 0:o.createElement(sa,null),o.createElement("mesh",{key:"space",geometry:fa,material:g}),o.createElement("ambientLight",{color:ua,intensity:.8}),o.createElement("directionalLight",{color:new y.Color("#FFFFFF"),intensity:2})))}function va(e){var t=e.fabric,n=e.face,r=an(n.brick.scale)/8;return o.createElement("mesh",{geometry:lr,position:t.instance.faceMidpoint(n.index),material:Pr,scale:new y.Vector3(r,r,r)})}function ga(e){var t=e.fabric,n=e.interval,r=e.storedState,a=Mr(n.intervalRole);if((r.showPushes||r.showPulls)&&(a=function(e){var t=Math.floor(e*Nr.length);return Nr[t>=Nr.length?Nr.length-1:t]}(t.instance.strainNuances[n.index]),(!r.showPushes||!r.showPulls)&&(r.showPushes&&!n.isPush||r.showPulls&&n.isPush)))return o.createElement("group",null);var i=t.instance.linearDensities[n.index],c=r.featureValues[n.isPush?R.PushRadiusFactor:R.PullRadiusFactor],s=r.featureValues[R.VisualStrain],u=t.orientInterval(n,c.numeric*i,s.numeric),l=u.scale,h=u.rotation;return o.createElement("mesh",{geometry:lr,position:t.instance.getIntervalMidpoint(n.index),rotation:(new y.Euler).setFromQuaternion(h),scale:l,material:a,matrixWorldNeedsUpdate:!0})}function ya(e){var t=e.fabric,n=e.visibleRoles,r=e.selectedIntervals,a=e.storedState;return o.createElement("group",null,r.length>0?r.map((function(e){return o.createElement(ga,{key:"SI".concat(e.index),fabric:t,interval:e,storedState:a})})):t.intervals.map((function(e){return n.indexOf(e.intervalRole)<0?void 0:o.createElement(ga,{key:"I".concat(e.index),fabric:t,interval:e,storedState:a})})),"}")}function ba(e){var t=e.fabric,n=e.selectedIntervals,r=e.storedState;return o.createElement("group",null,o.createElement("lineSegments",{key:"lines",geometry:t.linesGeometry,material:kr}),n.map((function(e){return o.createElement(ga,{key:"SI".concat(e.index),fabric:t,interval:e,storedState:r})})))}function xa(e){var t=e.fabric,n=e.stage,r=e.selectFace,a=Object(Ot.d)().raycaster,i=Object(o.useRef)(),c=Object(o.useState)(),s=Object(Zn.a)(c,2),u=s[0],l=s[1];return o.createElement("mesh",{key:"faces",ref:i,onPointerDown:function(e){return l(e)},onPointerUp:function(e){var o=i.current;if(!function(e){return e===L.Growing||e===L.Slack}(n)&&u&&o){var c=u.clientX-e.clientX,s=u.clientY-e.clientY;if(!(c*c+s*s>100)){var h=a.intersectObjects([o],!0).map((function(e){return e.faceIndex})).map((function(e){if(void 0!==e)return t.faces[e]})).reverse().pop();l(void 0),h&&r(h)}}},geometry:t.facesGeometry,material:jr})}var wa="25em",Sa="26em";function Ea(e){var t=function(){var e=location.hash.substring(1);try{return mn((function(e){return console.error(e)}),!0,decodeURIComponent(e))}catch(t){console.error("Code error",t)}}();if(t)return t;var n=kn(e);return n.length>0?n[0]:bn[0]}function ka(e){var t=e.fabricKernel,n=e.floatFeatures,r=e.storedState$,a=Object(o.useMemo)((function(){return t.allocateInstance()}),[]),i=Object(o.useMemo)((function(){return t.allocateInstance()}),[]),c=Object(o.useState)(!1),s=Object(Zn.a)(c,2),u=s[0],l=s[1],h=Object(o.useState)(),f=Object(Zn.a)(h,2),d=f[0],p=f[1],m=Object(o.useState)([]),v=Object(Zn.a)(m,2),g=v[0],y=v[1],b=Object(o.useState)([]),x=Object(Zn.a)(b,2),w=x[0],S=x[1];Object(o.useEffect)((function(){return y(w.reduce((function(e,t){var n=function(t){return!e.some((function(e){return t.index===e.index}))},r=t.pulls.filter(n),a=t.pushes.filter(n);return[].concat(Object(Be.a)(e),Object(Be.a)(a),Object(Be.a)(r))}),[]))}),[w]);var E=Object(o.useState)((function(){return Ea(r.getValue())})),k=Object(Zn.a)(E,2),O=k[0],j=k[1];Object(o.useEffect)((function(){0===location.hash.length&&(location.hash=gn(O.code,O.name))}),[O]);var P=Object(o.useState)(J),N=Object(Zn.a)(P,2),C=N[0],M=N[1],V=Object(o.useState)(r.getValue().rotating),F=Object(Zn.a)(V,2),T=F[0],L=F[1],A=Object(o.useState)(pr.None),D=Object(Zn.a)(A,2),I=D[0],z=D[1],G=Object(o.useState)(r.getValue().fullScreen),B=Object(Zn.a)(G,2),_=B[0],Y=B[1],U=Object(o.useState)(r.getValue().ellipsoids),W=Object(Zn.a)(U,2),X=W[0],$=W[1];function Q(e){if(a&&i){location.hash=gn(e.code,e.name),a.engine.initInstance(),a.forgetDimensions(),n[R.ShapingPretenstFactor].percent=100,n[R.ShapingDrag].percent=100,n[R.ShapingStiffnessFactor].percent=100,r.next(On(r.getValue(),{ellipsoids:!1})),Object.keys(n).map((function(e){return n[e]})).forEach((function(e){return a.applyFeature(e)}));p(new mr((function(e){return function(e,t){if(t===H.FacePull)throw new Error;return e[R[R[t+R.NexusPushLength]]].numeric}(n,e)}),(function(e){return r.getValue().featureValues[e].numeric}),a,i,e))}}function q(e){r.next(On(r.getValue(),{fullScreen:e}))}return Object(o.useEffect)((function(){return M(J)}),[X]),Object(o.useEffect)((function(){var e=r.subscribe((function(e){if(Y(e.fullScreen),$(e.ellipsoids),L(e.rotating),d){var t=d.instance.engine;t.setColoring(e.showPushes,e.showPulls),t.setSurfaceCharacter(e.surfaceCharacter)}}));return function(){return e.unsubscribe()}}),[d]),Object(o.useEffect)((function(){var e=Object.keys(n).map((function(e){return n[e]})).map((function(e){return e.observable.subscribe((function(t){if(d){d.instance.applyFeature(e);var n=Z(e.config.feature);if(void 0!==n){var r=d.instance.engine;d.intervals.filter((function(e){return e.intervalRole===n})).forEach((function(t){var n=e.numeric*an(t.scale);r.changeRestLength(t.index,n,500)}))}}}))}));return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[d]),Object(o.useEffect)((function(){var e=setTimeout((function(){d||Q(O)}),200);return function(){return clearTimeout(e)}}),[O]),u?o.createElement(rr,{cancel:function(){return l(!1)}}):o.createElement(o.Fragment,null,_?o.createElement(ie.a,{id:"to-full-screen",color:"dark",onClick:function(){return q(!1)}},o.createElement(Wn.d,null),o.createElement("br",null),o.createElement(Wn.R,null),o.createElement("br",null),o.createElement(Wn.d,null)):o.createElement("div",{id:"left-side",style:{visibility:_?"collapse":"visible",width:wa}},o.createElement(ta,{floatFeatures:n,rootTenscript:O,setRootTenscript:j,fabric:d,setFabric:p,selectedIntervals:g,shapeSelection:I,setShapeSelection:z,selectedFaces:w,clearSelectedFaces:function(){return S([])},runTenscript:Q,toFullScreen:function(){return q(!0)},visibleRoles:C,setVisibleRoles:M,storedState$:r})),o.createElement("div",{style:{position:"absolute",left:_?0:Sa,right:0,height:"100%"}},d?o.createElement("div",{className:"h-100"},o.createElement(Oa,{fabric:d}),o.createElement("div",{id:"top-right"},o.createElement(ie.a,{color:"info",onClick:function(){return l(!0)}},o.createElement(Wn.E,null)," About")),o.createElement("div",{id:"bottom-middle"},o.createElement(Xn.a,null,o.createElement(ie.a,{color:X?"warning":"secondary",onClick:function(){return r.next(On(r.getValue(),{ellipsoids:!X}))}},o.createElement(Wn.j,null)),o.createElement(ie.a,{color:I===pr.Faces?"warning":"secondary",disabled:X&&I===pr.None,onClick:function(){return z(I!==pr.Faces?pr.Faces:pr.None)}},o.createElement("span",null,o.createElement(Wn.z,null))),o.createElement(ie.a,{color:T?"warning":"secondary",onClick:function(){return r.next(On(r.getValue(),{rotating:!T}))}},o.createElement(Wn.P,null)))),o.createElement("div",{id:"view-container",className:"h-100"},o.createElement(Ot.a,{style:{backgroundColor:"black",borderStyle:"solid",borderColor:I===pr.Faces||X?"#f0ad4e":"black",cursor:I===pr.Faces?"pointer":"all-scroll",borderWidth:"2px"}},o.createElement(ma,{fabric:d,fabricError:function(e){console.error(e);var t=d.tenscript;p(void 0),setTimeout((function(){return Q(t)}),1e3)},selectedIntervals:g,selectedFaces:w,setSelectedFaces:S,shapeSelection:I,ellipsoids:X,visibleRoles:C,storedState$:r})))):o.createElement("div",{id:"tensegrity-view",className:"h-100"},o.createElement("div",{style:{position:"relative",top:"50%",left:"50%"}},o.createElement(ie.a,{onClick:function(){return Q(O)}},o.createElement("h6",null,O.name),o.createElement("h1",null,o.createElement(Wn.J,null)))))))}function Oa(e){var t=e.fabric,n=Object(o.useState)(t.life),r=Object(Zn.a)(n,2),a=r[0],i=r[1];return Object(o.useEffect)((function(){var e=t.life$.subscribe(i);return function(){return e.unsubscribe()}}),[t]),o.createElement("div",{id:"top-middle"},o.createElement("span",null,L[a.stage])," ",o.createElement("i",null,'"',t.tenscript.name,'"'))}n(634),n(635);var ja=!0;function Pa(){return(Pa=Object(i.a)(a.a.mark((function e(){var t,n,r,i,c,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,getFabricEngine();case 2:if(t=e.sent,n=new ae(t),r=document.getElementById("root"),(i=new u.BehaviorSubject(Pn(Dn))).subscribe((function(e){return t=e,void localStorage.setItem(jn,JSON.stringify(t));var t})),!ja){e.next=12;break}console.log("Starting Pretenst.."),s.render(o.createElement(ka,{fabricKernel:n,floatFeatures:In(i),storedState$:i}),r),e.next=19;break;case 12:return console.log("Starting Galapagotchi.."),console.log("Using API at ".concat(b)),c=new Un(b),e.next=17,c.getUser();case 17:l=e.sent,s.render(o.createElement(Xt,{engine:t,floatFeatures:[],storage:c,user:l}),r);case 19:Gn();case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){Pa.apply(this,arguments)}()}},[[264,1,2]]]);
//# sourceMappingURL=main.8e76995b.chunk.js.map