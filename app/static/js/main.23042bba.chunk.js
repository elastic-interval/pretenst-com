(window["webpackJsonpgalapagotchi-client"]=window["webpackJsonpgalapagotchi-client"]||[]).push([[0],{264:function(e,t,n){e.exports=n(636)},599:function(e,t){},601:function(e,t){},634:function(e,t,n){},635:function(e,t,n){},636:function(e,t,n){"use strict";n.r(t);var r=n(7),a=n.n(r),i=n(15),o=n(0),c=n(69),s=n(45),u=n(5),l=n(6),h=n(30),f=n(27),d=n(88),p=n(28),m=n(655),g=n(643),v=n(1),b="https://galapagotchi.run/api",y="https://github.com/elastic-interval/galapagotchi/blob/master/client/public/about/index.md";var x,w={x:0,y:0};function S(e,t){return e.x===t.x&&e.y===t.y}function E(e,t){return{x:e.x+t.x,y:e.y+t.y}}function k(e){var t=0,n=0;switch(e.adjacentSpots.forEach((function(e){switch(e.surface){case x.Land:t++;break;case x.Water:n++}})),e.surface){case x.Land:return e.connected&&e.adjacentSpots.length<6||t>=2&&n>=1;case x.Water:return t>0;default:return!1}}function O(e){return e.spots.every(k)}function j(e){e.id=e.spots.map((function(e){return e.surface===x.Land?"1":"0"})).map((function(e,t,n){return t%4===0?n.slice(t,t+4).join(""):void 0})).filter((function(e){return e})).map((function(e){return parseInt(function e(t){return t.length<4?e(t+"0"):t}(e),2).toString(16)})).join("")}function P(e,t){return e.spots.find((function(e){return S(e.coords,t)}))}function N(e){var t=e.spots;t.forEach((function(t){t.adjacentSpots=function(e,t){var n=[],r=t.coords;return A.forEach((function(t){var a=P(e,E(t,r));a&&n.push(a)})),n}(e,t),t.connected=t.adjacentSpots.length<6}));for(var n=!0;n;)n=!1,t.forEach((function(e){e.connected||e.adjacentSpots.find((function(t){return t.surface===e.surface&&t.connected}))&&(e.connected=!0,n=!0)}))}!function(e){e.Unknown="unknown",e.Land="land",e.Water="water"}(x||(x={}));var C=0,M=7;function V(e,t){return e&&e.nonce>=t.nonce?e:t}function F(e,t){return function(e,t){return e.y<t.y?-1:e.y>t.y?1:e.x<t.x?-1:e.x>t.x?1:0}(e.coords,t.coords)}var T,L,R=[{x:0,y:0},{x:2,y:0},{x:1,y:-1},{x:-1,y:-1},{x:-2,y:0},{x:-1,y:1},{x:1,y:1},{x:4,y:0},{x:3,y:-1},{x:2,y:-2},{x:0,y:-2},{x:-2,y:-2},{x:-3,y:-1},{x:-4,y:0},{x:-3,y:1},{x:-2,y:2},{x:0,y:2},{x:2,y:2},{x:3,y:1},{x:6,y:0},{x:5,y:-1},{x:4,y:-2},{x:3,y:-3},{x:1,y:-3},{x:-1,y:-3},{x:-3,y:-3},{x:-4,y:-2},{x:-5,y:-1},{x:-6,y:0},{x:-5,y:1},{x:-4,y:2},{x:-3,y:3},{x:-1,y:3},{x:1,y:3},{x:3,y:3},{x:4,y:2},{x:5,y:1},{x:8,y:0},{x:7,y:-1},{x:6,y:-2},{x:5,y:-3},{x:4,y:-4},{x:2,y:-4},{x:0,y:-4},{x:-2,y:-4},{x:-4,y:-4},{x:-5,y:-3},{x:-6,y:-2},{x:-7,y:-1},{x:-8,y:0},{x:-7,y:1},{x:-6,y:2},{x:-5,y:3},{x:-4,y:4},{x:-2,y:4},{x:-0,y:4},{x:2,y:4},{x:4,y:4},{x:5,y:3},{x:6,y:2},{x:7,y:1},{x:10,y:0},{x:9,y:-1},{x:8,y:-2},{x:7,y:-3},{x:6,y:-4},{x:5,y:-5},{x:3,y:-5},{x:1,y:-5},{x:-1,y:-5},{x:-3,y:-5},{x:-5,y:-5},{x:-6,y:-4},{x:-7,y:-3},{x:-8,y:-2},{x:-9,y:-1},{x:-10,y:0},{x:-9,y:1},{x:-8,y:2},{x:-7,y:3},{x:-6,y:4},{x:-5,y:5},{x:-3,y:5},{x:-1,y:5},{x:1,y:5},{x:3,y:5},{x:5,y:5},{x:6,y:4},{x:7,y:3},{x:8,y:2},{x:9,y:1},{x:12,y:0},{x:11,y:-1},{x:10,y:-2},{x:9,y:-3},{x:8,y:-4},{x:7,y:-5},{x:6,y:-6},{x:4,y:-6},{x:2,y:-6},{x:0,y:-6},{x:-2,y:-6},{x:-4,y:-6},{x:-6,y:-6},{x:-7,y:-5},{x:-8,y:-4},{x:-9,y:-3},{x:-10,y:-2},{x:-11,y:-1},{x:-12,y:0},{x:-11,y:1},{x:-10,y:2},{x:-9,y:3},{x:-8,y:4},{x:-7,y:5},{x:-6,y:6},{x:-4,y:6},{x:-2,y:6},{x:0,y:6},{x:2,y:6},{x:4,y:6},{x:6,y:6},{x:7,y:5},{x:8,y:4},{x:9,y:3},{x:10,y:2},{x:11,y:1}],A=[{x:2,y:0},{x:1,y:-1},{x:-1,y:-1},{x:-2,y:0},{x:-1,y:1},{x:1,y:1}];!function(e){e[e.Busy=0]="Busy",e[e.Growing=1]="Growing",e[e.Shaping=2]="Shaping",e[e.Slack=3]="Slack",e[e.Realizing=4]="Realizing",e[e.Realized=6]="Realized"}(T||(T={})),function(e){e[e.Gravity=0]="Gravity",e[e.Drag=1]="Drag",e[e.PretenstFactor=2]="PretenstFactor",e[e.IterationsPerFrame=3]="IterationsPerFrame",e[e.IntervalCountdown=4]="IntervalCountdown",e[e.PretenstCountdown=5]="PretenstCountdown",e[e.FacePullEndZone=6]="FacePullEndZone",e[e.FacePullOrientationForce=7]="FacePullOrientationForce",e[e.SlackThreshold=8]="SlackThreshold",e[e.ShapingPretenstFactor=9]="ShapingPretenstFactor",e[e.ShapingStiffnessFactor=10]="ShapingStiffnessFactor",e[e.ShapingDrag=11]="ShapingDrag",e[e.MaxStrain=12]="MaxStrain",e[e.VisualStrain=13]="VisualStrain",e[e.NexusPushLength=20]="NexusPushLength",e[e.ColumnPushLength=21]="ColumnPushLength",e[e.TriangleLength=22]="TriangleLength",e[e.RingLength=23]="RingLength",e[e.NexusCrossLength=24]="NexusCrossLength",e[e.ColumnCrossLength=25]="ColumnCrossLength",e[e.BowMidLength=26]="BowMidLength",e[e.BowEndLength=27]="BowEndLength",e[e.PushOverPull=30]="PushOverPull",e[e.PushRadiusFactor=31]="PushRadiusFactor",e[e.PullRadiusFactor=32]="PullRadiusFactor",e[e.MaxStiffness=33]="MaxStiffness"}(L||(L={}));var D,H=60,I=Object.keys(L).filter((function(e){return isNaN(parseInt(e,10))})).map((function(e){return L[e]}));function z(e){switch(e){case D.NexusPush:return"Nex Push";case D.ColumnPush:return"Col Push";case D.Triangle:return"Tri";case D.Ring:return"Ring";case D.NexusCross:return"Nex Cross";case D.ColumnCross:return"Col Cross";case D.BowMid:return"Bow Mid";case D.BowEnd:return"Bow End";case D.FacePull:return"Face Pull"}}!function(e){e[e.NexusPush=0]="NexusPush",e[e.ColumnPush=1]="ColumnPush",e[e.Triangle=2]="Triangle",e[e.Ring=3]="Ring",e[e.NexusCross=4]="NexusCross",e[e.ColumnCross=5]="ColumnCross",e[e.BowMid=6]="BowMid",e[e.BowEnd=7]="BowEnd",e[e.FacePull=8]="FacePull"}(D||(D={}));var G,B,_,Y=Object.keys(D).filter((function(e){return e.length>1&&D[e]!==D.FacePull})).map((function(e){return D[e]}));function J(e){return e===D.ColumnPush||e===D.NexusPush}function U(e){var t=L.NexusPushLength;if(!(e<t||e>L.BowEndLength))return D[D[e-t]]}function Z(e){return L[L[e+L.NexusPushLength]]}!function(e){e[e.Rest=0]="Rest",e[e.Forward=1]="Forward",e[e.TurnLeft=2]="TurnLeft",e[e.TurnRight=3]="TurnRight",e[e.Reverse=4]="Reverse"}(G||(G={})),function(e){e[e.Middle=0]="Middle",e[e.RightSide=1]="RightSide",e[e.LeftSide=2]="LeftSide"}(B||(B={})),function(e){e[e.Frozen=0]="Frozen",e[e.Sticky=1]="Sticky",e[e.Slippery=2]="Slippery",e[e.Bouncy=3]="Bouncy"}(_||(_={}));var W=function(){function e(t,n,r,a){Object(u.a)(this,e),this.index=t,this.buffer=n,this.releaseInstance=r,this.fabricEngine=a,this._fabricFeatures=void 0,this._midpoint=void 0,this._lineColors=void 0,this._lineLocations=void 0,this._faceMidpoints=void 0,this._faceNormals=void 0,this._faceLocations=void 0,this._jointLocations=void 0,this._jointVelocities=void 0,this._unitVectors=void 0,this._strains=void 0,this._strainNuances=void 0,this._stiffnesses=void 0,this._linearDensities=void 0;var i=this.engine,o=i._fabricOffset(),c=this.buffer;this._fabricFeatures=new X(c,o+i._fabricFeatures(),(function(){return H})),this._midpoint=new X(c,o+i._midpoint(),(function(){return 3})),this._lineColors=new X(c,o+i._lineColors(),(function(){return 3*i.getIntervalCount()*2})),this._lineLocations=new X(c,o+i._lineLocations(),(function(){return 3*i.getIntervalCount()*2})),this._faceMidpoints=new X(c,o+i._faceMidpoints(),(function(){return 3*i.getFaceCount()})),this._faceNormals=new X(c,o+i._faceNormals(),(function(){return 3*i.getFaceCount()*3})),this._faceLocations=new X(c,o+i._faceLocations(),(function(){return 3*i.getFaceCount()*3})),this._jointLocations=new X(c,o+i._jointLocations(),(function(){return 3*i.getJointCount()})),this._jointVelocities=new X(c,o+i._jointVelocities(),(function(){return 3*i.getJointCount()})),this._unitVectors=new X(c,o+i._intervalUnits(),(function(){return 3*i.getIntervalCount()})),this._strains=new X(c,o+i._intervalStrains(),(function(){return i.getIntervalCount()})),this._strainNuances=new X(c,o+i._intervalStrainNuances(),(function(){return i.getIntervalCount()})),this._stiffnesses=new X(c,o+i._stiffnesses(),(function(){return i.getIntervalCount()})),this._linearDensities=new X(c,o+i._linearDensities(),(function(){return i.getIntervalCount()}))}return Object(l.a)(e,[{key:"applyFeature",value:function(e){this._fabricFeatures.floats[e.fabricFeature]=e.numeric}},{key:"setFeatureValue",value:function(e,t){this._fabricFeatures.floats[e]=t}},{key:"release",value:function(){this.releaseInstance(this.index)}},{key:"forgetDimensions",value:function(){this._faceMidpoints.clear(),this._faceLocations.clear(),this._faceNormals.clear(),this._jointLocations.clear(),this._lineLocations.clear(),this._lineColors.clear(),this._unitVectors.clear(),this._strains.clear(),this._strainNuances.clear(),this._stiffnesses.clear(),this._linearDensities.clear()}},{key:"location",value:function(e){return K(this._jointLocations.floats,e)}},{key:"apply",value:function(e){for(var t=this.engine.getJointCount(),n=0;n<t;n++){var r=K(this._jointLocations.floats,n);ee(r.applyMatrix4(e),this._jointLocations.floats,n)}}},{key:"unitVector",value:function(e){return K(this._unitVectors.floats,e)}},{key:"velocities",value:function(){return this._jointVelocities.floats}},{key:"faceMidpoint",value:function(e){return te(e,this._faceLocations.floats)}},{key:"faceNormal",value:function(e){return te(e,this._faceNormals.floats)}},{key:"intervalLocation",value:function(e){return K(this._lineLocations.floats,e)}},{key:"getIntervalMidpoint",value:function(e){var t=this.intervalLocation(2*e),n=this.intervalLocation(2*e+1);return(new v.Vector3).add(t).add(n).multiplyScalar(.5)}},{key:"getMidpoint",value:function(e){return K(this._midpoint.floats,0,e)}},{key:"strains",get:function(){return this._strains.floats}},{key:"strainNuances",get:function(){return this._strainNuances.floats}},{key:"stiffnesses",get:function(){return this._stiffnesses.floats}},{key:"linearDensities",get:function(){return this._linearDensities.floats}},{key:"faceLocations",get:function(){return this._faceLocations.floats}},{key:"faceNormals",get:function(){return this._faceNormals.floats}},{key:"lineLocations",get:function(){return this._lineLocations.floats}},{key:"lineColors",get:function(){return this._lineColors.floats}},{key:"engine",get:function(){return this.fabricEngine.setInstance(this.index),this.fabricEngine}}]),e}(),X=function(){function e(t,n,r){Object(u.a)(this,e),this.buffer=t,this.offset=n,this.length=r,this.array=void 0}return Object(l.a)(e,[{key:"clear",value:function(){this.array=void 0}},{key:"floats",get:function(){return this.array?this.array:this.array=new Float32Array(this.buffer,this.offset,this.length())}}]),e}(),$=128,Q=3*$,q=Q*Float32Array.BYTES_PER_ELEMENT,K=function(e,t,n){var r=3*t;return n?(n.set(e[r],e[r+1],e[r+2]),n):new v.Vector3(e[r],e[r+1],e[r+2])},ee=function(e,t,n){var r=3*n;t[r]=e.x,t[r+1]=e.y,t[r+2]=e.z};function te(e,t){var n=3*e,r=K(t,n),a=K(t,n+1),i=K(t,n+2);return(new v.Vector3).add(r).add(a).add(i).multiplyScalar(1/3)}var ne,re=function(){function e(t){var n=this;Object(u.a)(this,e),this.instanceArray=[],this.instanceUsed=[],this.arrayBuffer=void 0,this.spotCenters=void 0,this.hexalotBits=void 0;var r=t.init();if(this.arrayBuffer=t.memory.buffer,this.spotCenters=new Float32Array(this.arrayBuffer,0,Q),this.hexalotBits=new Int8Array(this.arrayBuffer,q,$),0===this.arrayBuffer.byteLength)throw new Error("Zero byte length! ".concat(r));for(var a=0;a<t.getInstanceCount();a++)this.instanceArray.push(new W(a,this.arrayBuffer,(function(e){return n.instanceUsed[e]=!1}),t)),this.instanceUsed.push(!1)}return Object(l.a)(e,[{key:"setHexalot",value:function(e,t){var n=this;if(e.length!==R.length||t.length!==R.length)throw new Error("Size problem");e.forEach((function(e,t){n.spotCenters[3*t]=e.x,n.spotCenters[3*t+1]=e.y,n.spotCenters[3*t+2]=e.z})),t.forEach((function(e,t){n.hexalotBits[t]=e?1:0}))}},{key:"allocateInstance",value:function(){var e=this.instanceUsed.indexOf(!1);if(!(e<0))return this.instanceUsed[e]=!0,this.instanceArray[e]}}]),e}(),ae=n(255);!function(e){e.FlyingIn="Flying in",e.StartGrowth="Start growth",e.GrowthStep="Growth step",e.GrowthComplete="Growth complete",e.Cycle="Cycle",e.Command="Command",e.AppMode="App mode"}(ne||(ne={}));var ie,oe=new s.BehaviorSubject({event:ne.FlyingIn}),ce=n(637);!function(e){e.AvailableSpot="Available spot",e.Evolving="Evolving",e.Friend="Friend",e.FreeSpot="Free spot",e.Home="Home",e.Pioneering="Pioneering",e.Planning="Planning",e.Riding="Riding",e.Terraforming="Terraforming",e.Unknown="Unknown"}(ie||(ie={}));var se,ue,le=[{title:ie.AvailableSpot,body:o.createElement(ce.a,null,"This spot is unoccupied and can be claimed.")},{title:ie.Planning,body:o.createElement(ce.a,null,"You are planning your journey.  This journey is where you galapagotchi rides when you launch it, and it is the path that the evolution will follow.")},{title:ie.Evolving,body:o.createElement(ce.a,null,"Your gotchi is experiencing a kind of multiverse evolution. It has been placed in competition with a number of mutations of itself, and they are now locked in a fight for survival.")},{title:ie.Terraforming,body:o.createElement(ce.a,null,"You have reserved a new hexalot, but this has created virgin territory at the edge of the island which you still have to terraform.")},{title:ie.Friend,body:o.createElement(ce.a,null,"You have selected somebody else's galapagotchi.  You can take it for a ride to see how well it can run.")},{title:ie.FreeSpot,body:o.createElement(ce.a,null,"A free spot is a hexagonal spot which can be terraformed, which means that you can turn it into land or water.")},{title:ie.Home,body:o.createElement(ce.a,null,"You have selected your home hexalot, and from here you can plan the gotchi's journey. If you already have a journey planned you can try and ride it, or you can start the evolution process so that your gotchi acquires motor skills by survival of the fittest.")},{title:ie.Pioneering,body:o.createElement(ce.a,null,"You are a pioneer, so we can assume that you need no instructions.")},{title:ie.Riding,body:o.createElement(ce.a,null,"You are riding on a gotchi, which means that you tag along close behind as the gotchi runs each leg of its journey.")},{title:ie.Unknown,body:o.createElement(ce.a,null,"Unknown state?")}];function he(){return{width:window.innerWidth,height:window.innerHeight,left:window.screenLeft,top:window.screenTop}}!function(e){e.Evolving="Evolving",e.Exploring="Exploring",e.Flying="Flying",e.Planning="Planning",e.Riding="Riding",e.Stopped="Stopped",e.Terraforming="Terraforming"}(se||(se={})),function(e){e.Cancel="Cancel",e.ClaimHexalot="Claim hexalot",e.DiscardGenes="Discard genes",e.Evolve="Evolve",e.Home="Home",e.MakeLand="Make into land",e.MakeWater="Make into water",e.Plan="Plan",e.Ride="Ride",e.Start="Start",e.Stop="Stop",e.Terraform="Terraform"}(ue||(ue={}));var fe=n(33),de=[{index:0,numeral:"1",symbol:"\u2680"},{index:1,numeral:"2",symbol:"\u2681"},{index:2,numeral:"3",symbol:"\u2682"},{index:3,numeral:"4",symbol:"\u2683"},{index:4,numeral:"5",symbol:"\u2684"},{index:5,numeral:"6",symbol:"\u2685"}],pe=function(){var e={};return de.forEach((function(t){e[t.numeral]=t,e[t.symbol]=t})),e}();function me(e){if(0===e.length)throw new Error("No dice!");var t=Math.pow(6,e.length);return(e.reduce((function(e,t){return 6*e+t.index}),0)+.5)/t}var ge=function(){function e(t,n){Object(u.a)(this,e),this.gene=t,this.roll=n,this.cursor=0}return Object(l.a)(e,[{key:"chooseFrom",value:function(e){var t=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Math.floor(me(n)*e)};return e<=6?t(this.next()):e<=36?t(this.next(),this.next()):e<=216?t(this.next(),this.next(),this.next()):e<=1296?t(this.next(),this.next(),this.next(),this.next()):t(this.next(),this.next(),this.next(),this.next(),this.next())}},{key:"next",value:function(){for(;this.gene.dice.length<this.cursor+1;)this.gene.dice.push(this.roll());return this.gene.dice[this.cursor++]}},{key:"size",get:function(){return this.gene.dice.length}}]),e}();function ve(){return de[Math.floor(Math.random()*de.length)]}function be(){return new we([],ve)}function ye(e){if(!e.genes)return be();var t=e.genes.map((function(e){return{state:e.state,mutationCount:e.mutationCount,dice:(t=e.geneString,t.split("").map((function(e){return pe[e]})).filter((function(e){return!!e})))};var t}));return new we(t,ve)}function xe(e){if(e)return ye(e)}var we=function(){function e(t,n){Object(u.a)(this,e),this.genes=t,this.roll=n}return Object(l.a)(e,[{key:"createReader",value:function(e){var t=this.genes.find((function(t){return e===t.state}));if(t)return new ge(t,this.roll);var n={state:e,mutationCount:0,dice:[]};return this.genes.push(n),new ge(n,this.roll)}},{key:"withMutatedBehavior",value:function(t,n){var r=this.genes.map((function(e){return{state:e.state,mutationCount:e.mutationCount,dice:e.dice.slice()}})),a=r.find((function(e){return t===e.state}));if(a)for(var i=0;i<n;i++){var o=Math.floor(Math.random()*a.dice.length);a.dice[o]=this.roll(),a.mutationCount++}return new e(r,this.roll)}},{key:"genomeData",get:function(){return{genes:this.genes.map((function(e){return{state:e.state,mutationCount:e.mutationCount,geneString:(t=e.dice,t.map((function(e){return e.symbol})).join(""))};var t}))}}}]),e}(),Se=17.32,Ee=30,ke=[new v.Vector3(0,0,-20),new v.Vector3(-17.32,0,-10),new v.Vector3(-17.32,0,10),new v.Vector3(0,0,20),new v.Vector3(17.32,0,10),new v.Vector3(17.32,0,-10)],Oe=new v.Color("silver"),je=new v.Color("tan"),Pe=new v.Color("darkturquoise"),Ne=6,Ce=new v.Vector3(0,1,0),Me=.03,Ve=function(){function e(t,n,r){Object(u.a)(this,e),this.gotchi=t,this.mutatingGenome=r,this.votes=[],this.currentLeg=void 0,this.leg=n}return Object(l.a)(e,[{key:"reorient",value:function(){if(this.touchedDestination){var e=this.leg.nextLeg;e?this.leg=e:this.gotchi.nextState=G.Rest}if(this.fabric.nextState!==G.Rest){var t=this.voteState();this.nextState!==t&&(console.log("".concat(this.index," turned ").concat(G[this.nextState]," to ").concat(G[t])),this.gotchi.nextState=t)}}},{key:"startMoving",value:function(){this.leg=this.currentLeg}},{key:"stopMoving",value:function(){this.gotchi.nextState=G.Rest}},{key:"mutateGenome",value:function(e){if(!this.mutatingGenome)throw new Error("Not evolving");this.mutatingGenome=this.mutatingGenome.withMutatedBehavior(this.nextState,e)}},{key:"iterate",value:function(e){return this.gotchi.iterate(e)}},{key:"createGotchi",value:function(e){return this.gotchi.copyWithGenome(e)}},{key:"recycle",value:function(){this.gotchi.recycle()}},{key:"voteState",value:function(){var e=this.votes,t=this.directionToTarget;e.push(t),e.length>30&&e.shift();for(var n=e.reduce((function(e,t){return e[t]++,e}),[0,0,0,0,0]),r=G.Forward;r<=G.Reverse;r++)if(30===n[r]&&this.nextState!==r)return r;return t}},{key:"height",get:function(){return this.gotchi.body.midpoint.y}},{key:"isResting",get:function(){return this.gotchi.isResting}},{key:"leg",get:function(){return this.currentLeg},set:function(e){this.currentLeg=e,this.votes=[],this.gotchi.nextState=this.voteState()}},{key:"pointerGeometry",get:function(){return this.gotchi.body.pointerGeometryFor(this.gotchi.body.currentState)}},{key:"facesGeometry",get:function(){return this.gotchi.body.facesGeometry}},{key:"index",get:function(){return this.gotchi.index}},{key:"age",get:function(){return this.gotchi.age}},{key:"fabric",get:function(){return this.gotchi.body}},{key:"offspringGenome",get:function(){if(!this.mutatingGenome)throw new Error("Not evolving");return this.mutatingGenome.genomeData}},{key:"nextState",get:function(){return this.fabric.nextState}},{key:"evaluated",get:function(){return{jockey:this,distanceFromTarget:this.gotchi.getDistanceFrom(this.target)}}},{key:"genomeData",get:function(){return this.gotchi.genomeData}},{key:"touchedDestination",get:function(){return this.gotchi.getDistanceFrom(this.target)<4}},{key:"directionToTarget",get:function(){var e=this.toTarget,t=e.dot(this.gotchi.body.forward),n=e.dot(this.gotchi.body.right);return t>0?n>0?t>n?G.Forward:G.TurnRight:t>-n?G.Forward:G.TurnLeft:n>0?-t>n?G.Reverse:G.TurnRight:-t>-n?G.Reverse:G.TurnLeft}},{key:"toTarget",get:function(){var e=new v.Vector3;return e.subVectors(this.target,this.gotchi.body.seed),e.y=0,e.normalize(),e}},{key:"target",get:function(){return this.currentLeg.goTo.center}}]),e}(),Fe=new v.Vector3(0,10,0),Te=function(){function e(t,n,r){Object(u.a)(this,e),this.journey=t,this.visited=n,this.goTo=r}return Object(l.a)(e,[{key:"nextLeg",get:function(){var t=this.visited+1;if(t!==this.journey.visits.length){var n=this.journey.visits[t];return new e(this.journey,t,n)}}}]),e}();function Le(e,t,n){if(n){var r=[];if(n.hexalots.forEach((function(t){var n=e.findHexalot(t);n&&r.push(n)})),!(r.length<2||r[0].id!==t.id))return new Re(r)}}var Re=function(){function e(t){if(Object(u.a)(this,e),this.hexalots=t,0===t.length)throw new Error("Empty journey")}return Object(l.a)(e,[{key:"withTruncatedVisit",value:function(t){var n=this.hexalots.indexOf(t);if(!(n<0))return new e(this.hexalots.slice(0,n+1))}},{key:"withVisit",value:function(e){return function e(t,n){var r=t.length-1;if(!(r<0)){var a=t[r].centerSpot.adjacentHexalots.find((function(e){return e.id===n.id}));return a?new Re(t.concat(a)):e(t.slice(0,r),n)}}(this.hexalots,e)}},{key:"visits",get:function(){return this.hexalots}},{key:"firstLeg",get:function(){if(!(this.hexalots.length<2))return new Te(this,0,this.hexalots[1])}},{key:"data",get:function(){return{hexalots:this.hexalots.map((function(e){return e.id}))}}}]),e}();function Ae(e,t){return De.apply(this,arguments)}function De(){return(De=Object(i.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.genome){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,t.fetchGenome(n);case 4:t.genome=e.sent;case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function He(e,t,n){return Ie.apply(this,arguments)}function Ie(){return(Ie=Object(i.a)(a.a.mark((function e(t,n,r){var i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.fetchJourney(n,r);case 2:if(i=e.sent){e.next=5;break}return e.abrupt("return",t.createRandomJourney());case 5:return e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ze=function(){function e(t,n,r,a){var i=this;Object(u.a)(this,e),this.parentHexalot=t,this.coords=n,this.spots=r,this.gotchiFactory=a,this.id=void 0,this.genome=void 0,this.journey=void 0,this.childHexalots=[],this.nonce=0,this.visited=!1,this.spots[0].centerOfHexalot=this;for(var o=1;o<=6;o++)this.spots[o].adjacentHexalots.push(this);this.spots.forEach((function(e){return e.memberOfHexalot.push(i)})),t&&(t.childHexalots.push(this),this.nonce=t.nonce+1)}return Object(l.a)(e,[{key:"fetchGenome",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getGenomeData(this);case 2:return n=e.sent,this.genome=xe(n),e.abrupt("return",this.genome);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchJourney",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getJourneyData(this);case 2:return r=e.sent,this.journey=Le(n,this,r),e.abrupt("return",this.journey);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"adjustedJourney",value:function(e){if(!this.journey)return new Re([this,e]);var t=this.journey.withTruncatedVisit(e);if(t)return t;var n=this.journey.withVisit(e);return n||this.journey}},{key:"createRandomJourney",value:function(){return this.journeyOfLength(2)}},{key:"createNativeGotchi",value:function(){if(this.genome)return this.gotchiFactory.createGotchiSeed(this,this.rotation,this.genome)}},{key:"createGotchi",value:function(e,t){return this.gotchiFactory.createGotchiSeed(this,t,e)}},{key:"journeyOfLength",value:function(e){for(var t=[this];t.length<e+1;){var n=t[t.length-1].centerSpot.adjacentHexalots.filter((function(e){return t.every((function(t){return t.id!==e.id}))}));if(0===n.length)break;var r=n[Math.floor(Math.random()*n.length)];t.push(r)}return new Re(t)}},{key:"rotation",get:function(){if(!this.journey||this.journey.visits.length<2)return Math.floor(6*Math.random());var e=this.journey.visits[1];return this.centerSpot.adjacentSpots.findIndex((function(t){var n=t.centerOfHexalot;return!!n&&n.id===e.id}))}},{key:"firstLeg",get:function(){if(this.journey){var e=this.journey.firstLeg;if(e)return e}var t=this.createRandomJourney().firstLeg;if(!t)throw new Error("Unable to create first leg");return t}},{key:"centerSpot",get:function(){return this.spots[0]}},{key:"center",get:function(){return this.centerSpot.center}},{key:"seed",get:function(){return new v.Vector3(0,10,0).add(this.center)}}]),e}(),Ge=n(16),Be=function(){function e(t){Object(u.a)(this,e),this.coords=t,this.center=void 0,this.adjacentSpots=[],this.memberOfHexalot=[],this.adjacentHexalots=[],this.centerOfHexalot=void 0,this.connected=!1,this.faceNames=[],this.surface=x.Unknown,this.free=!1,this.center=new v.Vector3(t.x*Se,0,t.y*Ee)}return Object(l.a)(e,[{key:"isMemberOfOneHexalot",value:function(e){return 1===this.memberOfHexalot.length&&this.memberOfHexalot[0].id===e}},{key:"addSurfaceGeometry",value:function(e,t,n,r){var a=this,i=k(this)?1:.9;n.push.apply(n,Object(Ge.a)(ke.map((function(e){return new v.Vector3(e.x*i+a.center.x,e.y*i+a.center.y,e.z*i+a.center.z)})))),n.push(this.center);for(var o=this.normalSpread,c=0;c<Ne;c++){var s=t*(ke.length+1),u=(c+1)%Ne,l=[Ce,(new v.Vector3).add(Ce).addScaledVector(ke[c],o).normalize(),(new v.Vector3).add(Ce).addScaledVector(ke[u],o).normalize()];this.faceNames.push("".concat(e,":").concat(r.length)),r.push(new v.Face3(s+Ne,s+c,s+u,l,this.color))}}},{key:"addHangerGeometry",value:function(e){for(var t=0;t<Ne;t++){var n=ke[t],r=ke[(t+1)%Ne];e.push((new v.Vector3).addVectors(this.center,Fe)),e.push((new v.Vector3).add(this.center).addScaledVector(n,.2)),e.push((new v.Vector3).add(this.center).addScaledVector(n,.2)),e.push((new v.Vector3).add(this.center).addScaledVector(r,.2))}}},{key:"addSeed",value:function(e,t,n,r){for(var a=[],i=new v.Vector3(0,10,0),o=n.length,c=0;c<5;c++){var s=c*Math.PI*2/5,u=new v.Vector3(1*Math.sin(s)+i.x,1*Math.cos(s)+i.y,i.z);a.push(u),n.push(u)}var l=n.length,h=new v.Vector3(i.x,i.y,i.z-1);n.push(h),a.push(h);var f=n.length,d=new v.Vector3(i.x,i.y,i.z+1);n.push(d),a.push(d);var p=(new v.Matrix4).makeRotationY(Math.PI/3*e),m=(new v.Matrix4).makeTranslation(this.center.x,this.center.y,this.center.z).multiply(p);a.forEach((function(e){return e.applyMatrix4(m)}));for(var g=0;g<5;g++){var b=o+(g+1)%5,y=o+g;this.faceNames.push("".concat(t,":").concat(r.length)),r.push(new v.Face3(l,y,b)),this.faceNames.push("".concat(t,":").concat(r.length)),r.push(new v.Face3(f,b,y))}}},{key:"addRaisedHexagon",value:function(e,t){for(var n=this,r=function(r){return e.push(new v.Vector3(0,t,0).add(n.center).add(r))},a=0;a<Ne;a++){var i=(a+1)%Ne;r(ke[a]),r(ke[i])}}},{key:"addRaisedHexagonParts",value:function(e,t,n,r){for(var a=this,i=(Math.floor(n/r)+5)%6,o=n%r===0,c=function(n){return e.push(new v.Vector3(0,t,0).add(a.center).add(n))},s=0;s<Ne;s++){var u=(s+1)%Ne;(i===s||i===u||o&&i===(u+1)%Ne)&&(c(ke[s]),c(ke[u]))}}},{key:"isCandidateHexalot",value:function(e){if(this.surface!==x.Land)return!1;var t=this.centerOfHexalot;return t?!!e&&t.id===e.id:e?this.adjacentHexalots.some((function(t){return t.id!==e.id})):this.adjacentHexalots.length>0}},{key:"color",get:function(){switch(this.surface){case x.Land:return je;case x.Water:return Pe;default:return Oe}}},{key:"normalSpread",get:function(){switch(this.surface){case x.Land:return Me;case x.Water:return-.02;default:return 0}}}]),e}(),_e=function(){function e(t,n,r,a){Object(u.a)(this,e),this.gotchiFactory=n,this.name=void 0,this.spots=[],this.hexalots=[],this.vacantHexalot=void 0,function(e,t){for(var n=t.getOrCreateHexalot(void 0,w),r=e.hexalots.split("").reverse().map((function(e){return Number(e)})),a=[];r.length>0;){var i=r.pop();switch(i){case C:n=a.pop();break;case M:n&&a.push(n);break;case 1:case 2:case 3:case 4:case 5:case 6:n&&(n=t.hexalotAroundSpot(n.spots[i]))}}var o=(e.spots?e.spots.split(""):[]).map((function(e){return parseInt(e,16)})).map((function(e){return[0!==(8&e),0!==(4&e),0!==(2&e),0!==(1&e)]})),c=[].concat.apply([],o).reverse();if(t.spots.sort(F),c.length)t.spots.forEach((function(e){var t=c.pop();e.surface=t?x.Land:x.Water}));else if(1===t.hexalots.length){var s=t.hexalots[0];s.spots.map((function(e){return e.surface=Math.random()>.5?x.Land:x.Water})),s.spots[0].surface=x.Land}t.hexalots.forEach(j)}(t,this),this.name=t.name}return Object(l.a)(e,[{key:"findHexalot",value:function(e){return this.hexalots.find((function(t){return t.id===e}))}},{key:"createHexalot",value:function(e){return this.hexalotAroundSpot(e)}},{key:"hexalotAroundSpot",value:function(e){return this.getOrCreateHexalot(function(e){return e.adjacentHexalots.reduce(V,void 0)}(e),e.coords)}},{key:"getOrCreateHexalot",value:function(e,t){var n=this,r=this.hexalots.find((function(e){return S(e.coords,t)}));if(r)return r;var a=R.map((function(e){return n.getOrCreateSpot(E(e,t))})),i=new ze(e,t,a,this.gotchiFactory);return j(i),this.hexalots.push(i),i}},{key:"getOrCreateSpot",value:function(e){var t=P(this,e);if(t)return t;var n=new Be(e);return this.spots.push(n),n}},{key:"singleHexalot",get:function(){return 1!==this.hexalots.length?void 0:this.hexalots[0]}},{key:"midpoint",get:function(){return this.spots.reduce((function(e,t){return e.add(t.center)}),new v.Vector3).multiplyScalar(1/this.spots.length)}}]),e}(),Ye=15e3,Je=3,Ue=.001*Math.PI,Ze=.999*Math.PI/2;function We(e){return(1-e)*Ze+e*Ue}function Xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xe(n,!0).forEach((function(t){Object(fe.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qe(e){return{get target(){return e.fabric.midpoint},tooFar:1.4*Je,tooClose:1.2*Je,towardsDistance:.04,tooVertical:We(.1),tooHorizontal:We(0),towardsPolarAngle:.005,appMode:se.Riding}}function qe(e){return{get target(){return e.midpoint},tooFar:35,tooClose:25,towardsDistance:.1,tooVertical:We(.1),tooHorizontal:We(0),towardsPolarAngle:.005,appMode:se.Evolving}}var Ke=450;function et(e,t){return{get target(){return e.genome?e.seed:e.center},tooFar:1.05*Ke,tooClose:.95*Ke,towardsDistance:.08,tooVertical:We(1),tooHorizontal:We(.9),towardsPolarAngle:.008,appMode:t}}function tt(e,t){return $e({},e,{get target(){return t.genome?t.seed:t.center}})}function nt(e,t){return{get target(){return e.midpoint},tooFar:105,tooClose:95,towardsDistance:.1,tooVertical:We(1),tooHorizontal:We(.9),towardsPolarAngle:.01,appMode:t}}function rt(e,t){return $e({},e,{target:t.center})}var at=n(86),it=15e3,ot=function(){function e(t,n){var r=this;Object(u.a)(this,e),this.home=t,this.prototypeJockey=n,this.currentJockeys=new at.BehaviorSubject([]),this.midpointVector=new v.Vector3,this.rebooting=!1,this.rotation=void 0,this.maxAge=void 0;var a=this.leg;if(n&&n.nextState!==G.Rest)throw new Error("Cannot create evolution from jockey which is not resting");t.centerSpot.adjacentSpots.forEach((function(e,t){var n=e.centerOfHexalot;n&&a.goTo.id===n.id&&(r.rotation=t)})),this.currentJockeys.next(this.createPopulation()),this.maxAge=this.startAge+it}return Object(l.a)(e,[{key:"iterate",value:function(){var e=this,t=this.currentJockeys.getValue();if(0!==t.length&&!this.rebooting){t.forEach((function(e){return e.reorient()}));var n=t.filter((function(t){return t.age<e.maxAge}));if(0===n.length)return this.adjustAgeLimit(),void this.nextGenerationFromSurvival();n.forEach((function(t){var n=e.maxAge-t.age;t.iterate(n>60?60:n)===ne.Cycle&&(console.log("mutate"),t.mutateGenome(1))}))}}},{key:"recycle",value:function(){this.currentJockeys.getValue().forEach((function(e){return e.recycle()})),this.prototypeJockey&&this.prototypeJockey.recycle()}},{key:"adjustAgeLimit",value:function(){this.maxAge+=1e3;var e=this.maxAge-this.startAge;e>25e3&&(this.maxAge=this.startAge+it),console.log("Age: [".concat(this.startAge," to ").concat(this.maxAge,"] ").concat(e))}},{key:"nextGenerationFromSurvival",value:function(){var e=this;this.rebooting=!0;var t=this.rankedJockeys,n=t.splice(Math.ceil(.66*t.length));this.currentJockeys.next(t.map((function(e){return e.jockey}))),n.forEach((function(e){return e.jockey.recycle()})),setTimeout((function(){var r=[];n.map((function(e){return e.jockey})).forEach((function(){var n=t[Math.floor(t.length*Math.random())].jockey,a=e.createOffspring(n);a&&r.push(a)})),e.currentJockeys.next([]),setTimeout((function(){t.forEach((function(e){return e.jockey.recycle()})),t.map((function(e){return e.jockey})).forEach((function(t){var n=e.createJockey(t.leg,ye(t.genomeData));n&&r.push(n)})),e.currentJockeys.next(r),e.rebooting=!1}),500)}),500)}},{key:"createPopulation",value:function(){var e=this.home.genome;if(!e)throw new Error("No genome!");for(var t=ye(e.genomeData),n=[];;){var r=this.createJockey(this.leg,t);if(!r)break;n.push(r),t=t.withMutatedBehavior(r.nextState,5)}return n}},{key:"createOffspring",value:function(e){var t=ye(e.offspringGenome);return this.createJockey(e.leg,t)}},{key:"createJockey",value:function(e,t){var n=this.prototypeJockey,r=n?n.createGotchi(t):this.home.createGotchi(t,this.rotation);if(r)return new Ve(r,e,ye(r.genomeData))}},{key:"leg",get:function(){return this.prototypeJockey?this.prototypeJockey.leg:this.home.firstLeg}},{key:"startAge",get:function(){return this.prototypeJockey?this.prototypeJockey.age:0}},{key:"midpoint",get:function(){var e=this.currentJockeys.getValue();if(0===e.length)return this.midpointVector;var t=new v.Vector3;return e.map((function(e){return e.fabric.midpoint})).forEach((function(e){return t.add(e)})),this.midpointVector.copy(t.multiplyScalar(1/e.length)),this.midpointVector}},{key:"extractFittest",get:function(){var e=this.strongest;if(e){var t=e.jockey.gotchi.index;return this.currentJockeys.next(this.currentJockeys.getValue().filter((function(e){return e.gotchi.index!==t}))),e.jockey}}},{key:"rankedJockeys",get:function(){var e=this.currentJockeys.getValue(),t=this.prototypeJockey;return t&&(e=e.filter((function(e){return e.index!==t.index}))),e.map((function(e){return e.evaluated})).sort((function(e,t){return e.distanceFromTarget-t.distanceFromTarget}))}},{key:"strongest",get:function(){return this.rankedJockeys[0]}}]),e}();function ct(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function st(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ct(n,!0).forEach((function(t){Object(fe.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ct(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ut=function(){function e(t){Object(u.a)(this,e),this.nextState=void 0,this.nextState=st({},t,{nonce:t.nonce+1})}return Object(l.a)(e,[{key:"withIsland",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.withSelectedSpot();case 2:return e.sent.withJourney().withoutEvolution.nextState=st({},this.nextState,{island:t,islandData:n}),e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"withFlightState",value:function(e){return this.nextState=st({},this.nextState,{flightState:e}),this}},{key:"reachedFlightStateTarget",value:function(e){return this.nextState=st({},this.nextState,{appMode:e.appMode}),this}},{key:"withJourney",value:function(e){return this.nextState=st({},this.nextState,{journey:e}),this}},{key:"withSelectedHexalot",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n,r,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.nextState=st({},this.nextState,{selectedHexalot:t}),n=this.nextState.island,!t){e.next=17;break}return r=tt(this.nextState.flightState,t),this.nextState=st({},this.nextState,{flightState:r}),e.next=7,Ae(t,this.nextState.storage);case 7:if(!t.journey){e.next=11;break}return e.abrupt("return",this.withJourney(t.journey));case 11:if(!n){e.next=17;break}return e.next=14,He(t,this.nextState.storage,n);case 14:return i=e.sent,t.journey=i,e.abrupt("return",this.withJourney(i));case 17:return e.abrupt("return",this);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"withSelectedSpot",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.nextState=st({},this.nextState,{selectedSpot:t}),!t){e.next=5;break}return n=rt(this.nextState.flightState,t),this.nextState=st({},this.nextState,{flightState:n}),e.abrupt("return",this.withSelectedHexalot(t.centerOfHexalot));case 5:return e.abrupt("return",this.withSelectedHexalot());case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"withHomeHexalot",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.nextState.island,!this.nextState.homeHexalot&&n){e.next=3;break}throw new Error("Not allowed");case 3:if(this.nextState=st({},this.nextState,{homeHexalot:t}),t){e.next=6;break}return e.abrupt("return",this.withJourney().withSelectedSpot());case 6:return e.abrupt("return",this.withSelectedSpot(t.centerSpot));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"withJockey",value:function(e){return this.withoutJockey.nextState=st({},this.nextState,{jockey:e,journey:e.leg.journey,flightState:Qe(e),appMode:se.Flying}),this}},{key:"withEvolution",value:function(e){var t=new ot(e,this.appState.jockey);return this.withoutEvolution.nextState=st({},this.nextState,{evolution:t,jockey:void 0,flightState:qe(t),appMode:se.Flying}),this}},{key:"withSurface",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n,r,i,o,c,s,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.nextState,r=n.selectedSpot,(i=n.island)&&r){e.next=5;break}return e.abrupt("return",this);case 5:if(r.surface=t,r.memberOfHexalot.forEach(j),!(o=r.adjacentSpots.find((function(e){return e.free&&e.surface===x.Unknown})))){e.next=10;break}return e.abrupt("return",this.withSelectedSpot(o));case 10:if(!(c=i.spots.find((function(e){return e.free&&e.surface===x.Unknown})))){e.next=13;break}return e.abrupt("return",this.withSelectedSpot(c));case 13:if(!(s=i.spots.find((function(e){return!k(e)})))){e.next=16;break}return e.abrupt("return",this.withSelectedSpot(s));case 16:if(!(u=i.vacantHexalot)){e.next=19;break}return e.abrupt("return",this.withSelectedSpot(u.centerSpot));case 19:return e.abrupt("return",this);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"appState",get:function(){return this.nextState}},{key:"terraforming",get:function(){return this.nextState=st({},this.nextState,{appMode:se.Terraforming}),this}},{key:"planning",get:function(){var e=this.nextState.homeHexalot;if(e){var t=et(e,se.Planning);this.nextState=st({},this.nextState,{appMode:se.Flying,flightState:t})}return this}},{key:"exploring",get:function(){return this.nextState=st({},this.nextState,{appMode:se.Exploring}),this}},{key:"withJockeyStopped",get:function(){var e=se.Stopped;return this.nextState=st({},this.nextState,{appMode:e}),this}},{key:"withJockeyRiding",get:function(){var e=se.Riding;return this.nextState=st({},this.nextState,{appMode:e}),this}},{key:"withoutJockey",get:function(){var e=this.nextState.jockey;return e&&(e.gotchi.recycle(),this.nextState=st({},this.nextState,{jockey:void 0,appMode:se.Flying})),this}},{key:"withoutEvolution",get:function(){var e=this.nextState.evolution;return e&&(e.recycle(),this.nextState=st({},this.nextState,{evolution:void 0,appMode:se.Flying})),this}},{key:"withRestructure",get:function(){var e=this.nextState.island;if(!e)return this;N(e);var t=e.hexalots,n=e.spots,r=e.vacantHexalot;1===t.length?n.forEach((function(e){return e.free=!0})):r?n.forEach((function(e){return e.free=e.memberOfHexalot.every((function(e){return e.id===r.id}))})):n.forEach((function(e){return e.free=!1})),t.forEach(j);var a=O(e);this.nextState=st({},this.nextState,{islandIsLegal:a});var i=e.singleHexalot;if(!a&&i){var o=et(i,se.Terraforming);this.nextState=st({},this.nextState,{flightState:o})}return this}}]),e}();function lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ht(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lt(n,!0).forEach((function(t){Object(fe.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ft=function(){function e(t){Object(u.a)(this,e),this.trans=void 0,this.trans=new ut(t)}return Object(l.a)(e,[{key:"afterCommand",value:function(){var t=Object(i.a)(a.a.mark((function t(n,r){var i,o,c,s,u,l,h,f,d,p,m,g,v,b,y,w,S,E,j,P,N,C,M,V;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=this.trans,o=i.appState,c=o.island,s=o.islandData,c){t.next=6;break}return t.abrupt("return",this.trans.appState);case 6:u=o.homeHexalot,l=o.selectedHexalot,h=o.jockey,f=o.selectedSpot,d=c.vacantHexalot,p=1===c.hexalots.length?c.hexalots[0]:void 0,t.t0=n,t.next=t.t0===ue.DiscardGenes?15:t.t0===ue.Home?17:t.t0===ue.Ride?33:t.t0===ue.Evolve?47:t.t0===ue.Start?52:t.t0===ue.Stop?56:t.t0===ue.MakeLand?60:t.t0===ue.MakeWater?65:t.t0===ue.Terraform?70:t.t0===ue.Cancel?81:t.t0===ue.ClaimHexalot?89:t.t0===ue.Plan?96:97;break;case 15:return u&&(u.genome=be()),t.abrupt("return",o);case 17:if(!o.jockey){t.next=22;break}return t.next=20,i.withSelectedSpot(o.jockey.gotchi.home.centerSpot);case 20:return m=t.sent,t.abrupt("return",m.withoutJockey.exploring.appState);case 22:if(!u){t.next=27;break}return t.next=25,i.withSelectedSpot(u.centerSpot);case 25:return g=t.sent,t.abrupt("return",g.withoutEvolution.exploring.appState);case 27:if(!l){t.next=32;break}return t.next=30,i.withSelectedSpot();case 30:return v=t.sent,t.abrupt("return",v.withJourney().exploring.appState);case 32:return t.abrupt("return",o);case 33:if(!l){t.next=46;break}if(!(b=o.evolution)||!u){t.next=42;break}if(!(y=b.extractFittest)){t.next=42;break}return w=y.genomeData,u.genome=ye(w),o.storage.setGenomeData(u,w).then((function(){console.log("genome saved")})),t.abrupt("return",i.withoutEvolution.withJockey(y).appState);case 42:if(!(S=l.createNativeGotchi())){t.next=46;break}return E=new Ve(S,l.firstLeg),t.abrupt("return",i.withJockey(E).appState);case 46:return t.abrupt("return",o);case 47:if(!u){t.next=51;break}if(!h||h.isResting){t.next=50;break}throw new Error("Cannot evolve");case 50:return t.abrupt("return",i.withEvolution(u).appState);case 51:return t.abrupt("return",o);case 52:if(!h){t.next=55;break}return h.startMoving(),t.abrupt("return",i.withJockeyRiding.appState);case 55:return t.abrupt("return",o);case 56:if(!h){t.next=59;break}return h.stopMoving(),t.abrupt("return",i.withJockeyStopped.appState);case 59:return t.abrupt("return",o);case 60:if(!f||!f.free){t.next=64;break}return t.next=63,i.withSurface(x.Land);case 63:return t.abrupt("return",t.sent.withRestructure.appState);case 64:return t.abrupt("return",o);case 65:if(!f||!f.free){t.next=69;break}return t.next=68,i.withSurface(x.Water);case 68:return t.abrupt("return",t.sent.withRestructure.appState);case 69:return t.abrupt("return",o);case 70:if(!(j=c.spots.find((function(e){return e.surface===x.Unknown})))){t.next=75;break}return t.next=74,i.withSelectedSpot(j);case 74:return t.abrupt("return",t.sent.appState);case 75:if(!(P=c.spots.find((function(e){return!k(e)})))){t.next=80;break}return t.next=79,i.withSelectedSpot(P);case 79:return t.abrupt("return",t.sent.appState);case 80:return t.abrupt("return",o);case 81:if(N=o.nonce+1,s){t.next=84;break}return t.abrupt("return",o);case 84:return C=new _e(s,c.gotchiFactory,o.storage,N),t.next=87,i.withIsland(C,s);case 87:return M=t.sent,t.abrupt("return",M.exploring.withRestructure.appState);case 89:if(u||!l||!O(c)||!(p||d&&d.id===l.id)){t.next=95;break}return t.next=92,e.claimHexalot(o,l);case 92:if(!(V=t.sent)){t.next=95;break}return t.abrupt("return",V);case 95:return t.abrupt("return",o);case 96:return t.abrupt("return",i.planning.appState);case 97:throw new Error("Unknown command!");case 98:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}],[{key:"claimHexalot",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){var r,i,o,c,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.island){e.next=4;break}return console.warn("No existing island"),e.abrupt("return",void 0);case 4:return e.next=6,t.storage.claimHexalot(r,n,be().genomeData);case 6:if(i=e.sent){e.next=10;break}return console.warn("No island data arrived"),e.abrupt("return",void 0);case 10:return o=se.Exploring,!1,c=new _e(i,r.gotchiFactory,t.storage,t.nonce),s=ht({},t,{nonce:t.nonce+1,island:c,appMode:o,islandIsLegal:!1}),e.next=16,new ut(s).withHomeHexalot(n);case 16:return e.abrupt("return",e.sent.withRestructure.appState);case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),dt=n(638),pt=n(639),mt=n(640),gt=n(641),vt=n(642);function bt(e){var t=xt.find((function(t){return t.title===e}));if(!t)throw new Error("Command not documented: ".concat(e));return t}var yt,xt=[{title:ue.Cancel,body:o.createElement(ce.a,null,"While you are terraforming the island by terraforming (creating land or water), you can decide to abandon the choice you made and start again.")},{title:ue.ClaimHexalot,body:o.createElement(ce.a,null,"When you have reserved a hexalot, and terraformed the island to make sure it follows the rules, you can claim the hexalot you reserved. It then belongs to you, since it is completely unique and nobody else can claim the same one.")},{title:ue.DiscardGenes,body:o.createElement(ce.a,null,"If you don't like what you're seeing during the evolution and you've given up hope for this particular gotchi, you can discard the current set of genes and start from scratch.")},{title:ue.Evolve,body:o.createElement(ce.a,null,"Evolving creates a group of competing galapagotchis which exist in the same space at the same time, but have slightly mutated genes. They go through cycles, like generations. Every time the slowest are forgotten and the new generation is made by mutating the genes of the current survivors.")},{title:ue.Home,body:o.createElement(ce.a,null,"Wherever you are, you can go back to your home position up in the tower.")},{title:ue.MakeLand,body:o.createElement(ce.a,null,"While terraforming, you can choose to make the current hexagonal spot into land.")},{title:ue.MakeWater,body:o.createElement(ce.a,null,"While terraforming, you can choose to make the current hexagonal spot into water.")},{title:ue.Plan,body:o.createElement(ce.a,null,"When you plan your journey, you zoom out and see the world from above. Clicking on a new neighbor hexalot adds a leg to your journey, and clicking on one that is already in the journey makes it end there.")},{title:ue.Ride,body:o.createElement(ce.a,null,"You can ride a gotchi, which means that it will be born from the center tower of its home hexalot and try to follow the arrows of its journey, visiting hexalots along the way.")},{title:ue.Start,body:o.createElement(ce.a,null,"If you have stopped a gotchi during a ride, you can tell it to start up again.")},{title:ue.Stop,body:o.createElement(ce.a,null,"If you are tagging along behind a running gotchi, you can tell it to stop.")},{title:ue.Terraform,body:o.createElement(ce.a,null,"After choosing an unoccupied hexalot, new spots appear at the edge of the island. you can terraform these spots to choose whether they'll be land or water. The terraform button takes you to any problems that still remain on the island.")}],wt=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(f.a)(t).call(this,e))).state={},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=le.find((function(t){return t.title===e.props.toolbarState})),n=this.props.toolbarCommands.map(bt);return o.createElement(dt.a,null,o.createElement(pt.a,null,!!t&&o.createElement("div",null,o.createElement(mt.a,null,t.title),t.body),o.createElement("br",null),n.map((function(e){return o.createElement("div",{key:e.title},o.createElement(ae.a,{color:"success",className:"command-button"},e.title),e.body)}))),o.createElement(gt.a,null,this.footer()))}},{key:"footer",value:function(){var e=this;return o.createElement(vt.a,null,o.createElement("a",{className:"btn btn-info command-button",href:y,target:"_blank"},"Background information"),o.createElement(ae.a,{className:"float-right",color:"info",onClick:function(){return e.props.cancelHelp()}},"Ok, got it"))}}]),t}(o.Component),St={height:"auto",width:"auto",maxWidth:"70%",display:"inline-flex",textAlign:"left",background:"black",padding:"4px",margin:"5px",borderColor:"inherit",borderWidth:"2px",borderStyle:"solid",borderRadius:"10px"},Et=function(e){function t(e){var n;Object(u.a)(this,t),n=Object(h.a)(this,Object(f.a)(t).call(this,e));var r=ie.Unknown;return n.state={toolbarState:r,toolbarCommands:[],helpVisible:!1},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.appState.island;return o.createElement("div",{style:St},this.props.appState.appMode!==se.Flying&&t?o.createElement("div",null,this.commandButtons(t),!!this.state.helpVisible&&o.createElement(wt,{appState:this.props.appState,toolbarState:this.state.toolbarState,toolbarCommands:this.state.toolbarCommands,cancelHelp:function(){return e.setState({helpVisible:!1})}})):o.createElement(ae.a,{color:"info",className:"command-button"},"Hold on!"))}},{key:"commandButtons",value:function(e){var t=this.props.appState,n=e.vacantHexalot,r=t.selectedSpot,a=t.selectedHexalot,i=t.homeHexalot,c=e.singleHexalot;switch(t.appMode){case se.Terraforming:if(r){if(c&&r.coords===c.centerSpot.coords)return this.buttonToolbar(ie.Pioneering,ue.ClaimHexalot);if(r.isCandidateHexalot(n)&&!c)return t.islandIsLegal?this.buttonToolbar(ie.AvailableSpot,ue.ClaimHexalot):this.buttonToolbar(ie.Terraforming,ue.Terraform,ue.Cancel);if(r.free)return this.buttonToolbar(ie.FreeSpot,ue.MakeLand,ue.MakeWater)}return o.createElement((function(e){return o.createElement("p",null,e.children)}),null,"The island is not yet correct according to the rules. Land must be either at the edge or have two land neighbors. Water must have at least one land neighbor. Click on the marked spots and you can choose to switch them to fix the island.");case se.Exploring:return function(e){return!!e.homeHexalot&&!!e.selectedHexalot&&e.homeHexalot.id===e.selectedHexalot.id}(t)?this.buttonToolbar(ie.Home,ue.Plan,ue.Ride,ue.Evolve,ue.DiscardGenes):a?!i&&a.centerSpot.isCandidateHexalot(n)?this.buttonToolbar(ie.AvailableSpot,ue.ClaimHexalot):this.buttonToolbar(ie.Friend,ue.Ride,ue.Home):this.props.user?o.createElement("p",null,"You are logged in but you have not yet claimed a hexalot. The spots highlighted in green are places that you can claim. You can also click on one of the existing hexalots and go for a ride on the galapagotchi there."):o.createElement("p",null,"You can click on one of the hexalots and go for a ride on the galapagotchi who lives there.");case se.Planning:return this.buttonToolbar(ie.Planning,ue.Home);case se.Evolving:return this.buttonToolbar(ie.Evolving,ue.Ride,ue.Home);case se.Riding:return this.buttonToolbar(ie.Riding,ue.Home,ue.Stop);case se.Stopped:return this.buttonToolbar(ie.Riding,ue.Home,ue.Start,ue.Evolve);default:return o.createElement("p",null,"Strange state ",t.appMode)}}},{key:"buttonToolbar",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return setTimeout((function(){t.setState({toolbarState:e,toolbarCommands:r})})),o.createElement("div",null,o.createElement(ae.a,{color:"info",className:"command-button",onClick:function(){return t.setState({helpVisible:!t.state.helpVisible})}},e,": "),!this.state.helpVisible&&r.map((function(e){return t.commandButton(e)})))}},{key:"commandButton",value:function(e){var t=this;return o.createElement(ae.a,{key:e,color:"success",className:"command-button",onClick:Object(i.a)(a.a.mark((function n(){return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t.execute(e));case 1:case"end":return n.stop()}}),n)})))},e)}},{key:"execute",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,e.next=3,new ft(n.appState).afterCommand(t,n.location);case 3:r=e.sent,oe.next({event:ne.Command,command:t}),n.appState.updateState(r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),t}(o.Component),kt=n(22),Ot=function(){function e(t,n){Object(u.a)(this,e),this.user=n,this.trans=void 0,this.trans=new ut(t)}return Object(l.a)(e,[{key:"stateAfterClick",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n,r,i,o,c,s,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.trans,r=t.centerOfHexalot,i=n.appState,o=i.homeHexalot,c=i.island){e.next=7;break}return e.abrupt("return",i);case 7:s=c.vacantHexalot,e.t0=i.appMode,e.next=e.t0===se.Terraforming?11:e.t0===se.Exploring?14:e.t0===se.Planning?24:e.t0===se.Flying?32:e.t0===se.Evolving?32:e.t0===se.Riding?32:33;break;case 11:return e.next=13,n.withSelectedSpot(t);case 13:return e.abrupt("return",e.sent.appState);case 14:if(!this.user||o||!i.islandIsLegal||!t.isCandidateHexalot(s)){e.next=19;break}return c.vacantHexalot=c.createHexalot(t),e.next=18,n.withSelectedSpot(t);case 18:return e.abrupt("return",e.sent.terraforming.withRestructure.appState);case 19:if(!r){e.next=23;break}return e.next=22,n.withSelectedSpot(r.centerSpot);case 22:return e.abrupt("return",e.sent.appState);case 23:return e.abrupt("return",i);case 24:if(o){e.next=26;break}throw new Error("No home hexalot");case 26:if(!r){e.next=31;break}return u=o.adjustedJourney(r),o.journey=u,i.storage.setJourneyData(o,u.data).then((function(){console.log("saved journey")})),e.abrupt("return",n.withJourney(u).appState);case 31:case 32:case 33:return e.abrupt("return",i);case 34:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),jt=new v.MeshPhongMaterial({lights:!0,color:new v.Color("silver")}),Pt=new v.MeshPhongMaterial({vertexColors:v.FaceColors,lights:!0}),Nt=new v.LineBasicMaterial({color:new v.Color("black")}),Ct=new v.LineBasicMaterial({color:new v.Color("green")}),Mt=new v.LineBasicMaterial({color:new v.Color("white")}),Vt=new v.LineBasicMaterial({color:new v.Color("green")}),Ft=new v.LineBasicMaterial({color:new v.Color("crimson")}),Tt=new v.LineBasicMaterial({color:new v.Color("magenta")}),Lt=new v.LineBasicMaterial({color:new v.Color("yellow")}),Rt=new v.MeshPhongMaterial({lights:!0,color:new v.Color("silver"),transparent:!0,opacity:.6}),At=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(f.a)(t).call(this,e))).subscription=void 0,n.state={evolvers:e.evolution.currentJockeys.getValue()},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.subscription=this.props.evolution.currentJockeys.subscribe((function(t){e.setState({evolvers:t})}))}},{key:"componentWillUnmount",value:function(){this.subscription.unsubscribe()}},{key:"render",value:function(){return o.createElement(kt.a,{key:"EvolutionMesh"},this.state.evolvers.map((function(e,t){var n=e.fabric;return o.createElement("group",{key:"Evolver".concat(t)},o.createElement("lineSegments",{key:"Vectors",geometry:n.pointerGeometryFor(e.nextState),material:Tt}),o.createElement("mesh",{geometry:n.facesGeometry,material:Rt}))})))}}]),t}(o.Component);!function(e){e.SPOTS_KEY="Spots",e.SEEDS_KEY="Seeds",e.TRIANGLES_KEY="Triangles"}(yt||(yt={}));var Dt,Ht,It,zt,Gt=function(){function e(t,n,r){Object(u.a)(this,e),this.camera=t,this.meshes=new Map,this.rayCaster=new v.Raycaster,this.mouse=new v.Vector2,this.size=new v.Vector2,this.setSize(n,r)}return Object(l.a)(e,[{key:"setMesh",value:function(e,t){t?this.meshes[e]=t:delete this.meshes[e]}},{key:"setSize",value:function(e,t){this.size.x=e,this.size.y=t}},{key:"select",value:function(e,t,n){this.mouse.x=e.clientX/this.size.x*2-1,this.mouse.y=-e.clientY/this.size.y*2+1,this.rayCaster.setFromCamera(this.mouse,this.camera);var r=this.meshes[t];return n(this.rayCaster.intersectObjects([r],!0).filter((function(e){return void 0!==e.faceIndex})))}}]),e}(),Bt=new v.Vector3(0,600,0),_t=new v.Vector3(0,120,0),Yt=new v.Color("white"),Jt=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(f.a)(t).call(this,e))).appStateNonce=-1,n.spots=void 0,n.seeds=void 0,n.occupiedHangers=void 0,n.vacantHangers=void 0,n.homeHexalot=void 0,n.selectedSpot=void 0,n.availableSpots=void 0,n.vacantHexalots=void 0,n.spots=n.spotsGeometry,n.seeds=n.seedsGeometry,n.occupiedHangers=n.occupiedHangersGeometry,n.vacantHangers=n.vacantHangersGeometry,n.selectedSpot=n.selectedSpotGeometry,n.homeHexalot=n.homeHexalotGeometry,n.availableSpots=n.availableSpotsGeometry,n.vacantHexalots=n.vacantHexalotsGeometry,n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentWillUnmount",value:function(){this.disposeGeometry()}},{key:"render",value:function(){var e=this,t=this.props.appState,n=t.island;return!!n&&(t.nonce>this.appStateNonce&&(this.disposeGeometry(),n.spots.forEach((function(e){return e.faceNames=[]})),this.spots=this.spotsGeometry,this.seeds=this.seedsGeometry,this.occupiedHangers=this.occupiedHangersGeometry,this.vacantHangers=this.vacantHangersGeometry,this.selectedSpot=this.selectedSpotGeometry,this.homeHexalot=this.homeHexalotGeometry,this.availableSpots=this.availableSpotsGeometry,this.vacantHexalots=this.vacantHexalotsGeometry,this.appStateNonce=t.nonce),o.createElement(kt.a,{key:n.name},o.createElement("mesh",{name:"Spots",geometry:this.spots,material:Pt,ref:function(t){return e.props.setMesh(yt.SPOTS_KEY,t)}}),o.createElement("mesh",{name:"Seeds",geometry:this.seeds,material:jt}),o.createElement("lineSegments",{key:"HangersOccupied",geometry:this.occupiedHangers,material:Nt}),o.createElement("lineSegments",{key:"HangersFree",geometry:this.vacantHangers,material:Ct}),this.homeHexalot?o.createElement("lineSegments",{key:"HomeHexalot",geometry:this.homeHexalot,material:Mt}):void 0,this.selectedSpot?o.createElement("lineSegments",{key:"Pointer",geometry:this.selectedSpot,material:Lt}):void 0,this.availableSpots?o.createElement("lineSegments",{key:"Available",geometry:this.availableSpots,material:Vt}):void 0,this.vacantHexalots?o.createElement("lineSegments",{key:"Free",geometry:this.vacantHexalots,material:Vt}):void 0,o.createElement("pointLight",{distance:1e3,decay:.01,position:Bt}),o.createElement("hemisphereLight",{name:"Hemi",color:Yt})))}},{key:"disposeGeometry",value:function(){this.spots.dispose(),this.seeds.dispose(),this.occupiedHangers.dispose(),this.vacantHangers.dispose(),this.homeHexalot&&this.homeHexalot.dispose(),this.selectedSpot&&this.selectedSpot.dispose(),this.availableSpots&&this.availableSpots.dispose(),this.vacantHexalots&&this.vacantHexalots.dispose()}},{key:"spotsGeometry",get:function(){var e=new v.Geometry,t=this.props.appState.island;return t&&t.spots.forEach((function(t,n){t.addSurfaceGeometry(yt.SPOTS_KEY,n,e.vertices,e.faces)})),e.computeBoundingSphere(),e}},{key:"occupiedHangersGeometry",get:function(){var e=new v.Geometry,t=this.props.appState.island;if(t){var n=t.vacantHexalot;t.hexalots.forEach((function(t){n&&n.id===t.id||t.centerSpot.addHangerGeometry(e.vertices)}))}return e}},{key:"vacantHangersGeometry",get:function(){var e=new v.Geometry,t=this.props.appState.island,n=t?t.vacantHexalot:void 0;return n&&n.centerSpot.addHangerGeometry(e.vertices),e}},{key:"seedsGeometry",get:function(){var e=new v.Geometry,t=this.props.appState.island;if(t){var n=t.hexalots,r=this.activeHexalotId;n.forEach((function(t){r&&t.id===r||t.centerSpot.addSeed(t.rotation,yt.SEEDS_KEY,e.vertices,e.faces)}))}return e.computeFaceNormals(),e.computeBoundingSphere(),e}},{key:"selectedSpotGeometry",get:function(){var e=this.props.appState.selectedSpot;if(e){var t=e.center,n=e.centerOfHexalot?new v.Vector3(0,10,0).add(t):t,r=new v.Geometry;return r.vertices=[n,(new v.Vector3).addVectors(n,_t)],r}}},{key:"homeHexalotGeometry",get:function(){var e=this.props.appState.homeHexalot;if(e){var t=new v.Geometry;return e.spots.forEach((function(e,n){var r=n-91;r<0||e.addRaisedHexagonParts(t.vertices,.3,r,6)})),e.centerSpot.addRaisedHexagon(t.vertices,.3),e.centerSpot.addHangerGeometry(t.vertices),t.computeBoundingSphere(),t}}},{key:"availableSpotsGeometry",get:function(){var e=this.props.appState;if(this.props.user&&!e.homeHexalot&&e.islandIsLegal){var t=new v.Geometry,n=e.island;if(n){var r=n.vacantHexalot;n.spots.filter((function(e){return e.isCandidateHexalot(r)})).forEach((function(e){e.addRaisedHexagon(t.vertices,.3)}))}return t}}},{key:"vacantHexalotsGeometry",get:function(){var e=this.props.appState.island;if(e){var t=e.vacantHexalot;if(t){var n=new v.Geometry;return t.centerSpot.addRaisedHexagon(n.vertices,.3),t.spots.forEach((function(e,t){var r=t-91;r<0||e.addRaisedHexagonParts(n.vertices,.3,r,6)})),n}}}},{key:"activeHexalotId",get:function(){var e=this.props.appState;return e.jockey?e.jockey.gotchi.home.id:e.evolution?e.evolution.home.id:void 0}}]),t}(o.Component),Ut=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(f.a)(t).call(this,e))).geometry=void 0,n.state={},n.geometry=t.createGeometry(e),n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.journey!==this.props.journey&&(this.geometry.dispose(),this.geometry=t.createGeometry(e))}},{key:"componentWillUnmount",value:function(){this.geometry.dispose()}},{key:"render",value:function(){return o.createElement(kt.a,null,o.createElement("lineSegments",{key:"Journey",geometry:this.geometry,material:Ft}))}}],[{key:"createGeometry",value:function(e){var t=new v.BufferGeometry,n=e.journey,r=n.visits.length-1;if(r<1)return t;for(var a=new Float32Array(24*r),i=new v.Vector3,o=new v.Vector3(0,1,0),c=new v.Vector3,s=0;s<r;s++){var u=(new v.Vector3).add(n.visits[s].center),l=(new v.Vector3).add(n.visits[s+1].center);i.subVectors(l,u),c.crossVectors(o,i),l.addScaledVector(i,-.1),c.normalize(),i.normalize().multiplyScalar(4);var h=24*s;a[h++]=u.x,a[h++]=10,a[h++]=u.z,a[h++]=l.x-i.x,a[h++]=10,a[h++]=l.z-i.z,a[h++]=l.x-c.x-i.x,a[h++]=10,a[h++]=l.z-c.z-i.z,a[h++]=l.x,a[h++]=10,a[h++]=l.z,a[h++]=l.x+c.x-i.x,a[h++]=10,a[h++]=l.z+c.z-i.z,a[h++]=l.x,a[h++]=10,a[h++]=l.z,a[h++]=l.x+c.x-i.x,a[h++]=10,a[h++]=l.z+c.z-i.z,a[h++]=l.x-c.x-i.x,a[h++]=10,a[h++]=l.z-c.z-i.z}return t.addAttribute("position",new v.Float32BufferAttribute(a,3)),t}}]),t}(o.Component),Zt=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(h.a)(this,Object(f.a)(t).call(this,e))).appStateNonce=-1,n.selector=void 0,n.state={iterating:!1},n.selector=new Gt(n.props.perspectiveCamera,n.props.appState.width,n.props.appState.height),n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidUpdate",value:function(e,t,n){e.appState.width===this.props.appState.width&&e.appState.height===this.props.appState.height||(this.props.perspectiveCamera.aspect=this.props.appState.width/this.props.appState.height,this.props.perspectiveCamera.updateProjectionMatrix(),this.selector.setSize(this.props.appState.width,this.props.appState.height))}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=this.props.appState,n=t.island;if(n){var r=t.evolution,a=t.jockey,i=t.journey;if(t.nonce>this.appStateNonce){this.appStateNonce=t.nonce;var c=!!a||!!r;this.state.iterating!==c&&setTimeout((function(){e.setState({iterating:c})}))}return o.createElement("div",{id:"gotchi-view",onMouseDownCapture:function(t){var r=e.selector.select(t,yt.SPOTS_KEY,(function(e){return e.map((function(e){var t="".concat(yt.SPOTS_KEY,":").concat(e.faceIndex);return n.spots.find((function(e){return e.faceNames.indexOf(t)>=0}))})).pop()}));r&&e.click(r)}},o.createElement(kt.a,null,o.createElement("group",null,o.createElement(Jt,{user:this.props.user,appState:t,setMesh:function(t,n){return e.selector.setMesh(t,n)}}),r?o.createElement(At,{evolution:r}):void 0,a?o.createElement("group",{key:"Gotchi"},o.createElement("lineSegments",{key:"Vectors",geometry:a.pointerGeometry,material:Tt}),o.createElement("mesh",{geometry:a.facesGeometry,material:jt})):void 0,i?o.createElement(Ut,{journey:i}):void 0)))}}},{key:"click",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n,r,i,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props,r=n.appState,i=new Ot(r,n.user),e.next=5,i.stateAfterClick(t);case 5:o=e.sent,n.appState.updateState(o);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),t}(o.Component),Wt=function(e){function t(e){var n;Object(u.a)(this,t),(n=Object(h.a)(this,Object(f.a)(t).call(this,e))).perspectiveCamera=void 0,n.fabricKernel=void 0,n.appStateNonce=-1,n.fabricKernel=new re(e.engine);var r=window.innerWidth,a=window.innerHeight;n.perspectiveCamera=new v.PerspectiveCamera(50,r/a,1,1.05*Ye);var i=window.screenLeft,o=window.screenTop,c=Object(d.a)(n);return n.state={width:r,height:a,left:i,top:o,ownedLots:[],flightState:{target:new v.Vector3,tooFar:Ye+1,tooClose:Ye-1,towardsDistance:.5,tooVertical:We(0),tooHorizontal:We(.1),towardsPolarAngle:.01,appMode:se.Flying},nonce:0,appMode:se.Flying,islandIsLegal:!1,storage:e.storage,transitionState:function(e){c.setState(e)},updateState:function(e){if(c.appStateNonce===e.nonce)throw new Error("Same nonce! ".concat(e.nonce));c.appStateNonce=e.nonce;var t=e.selectedHexalot;if(t){var n=t.spots.map((function(e){return e.center})),r=t.spots.map((function(e){return e.surface===x.Land}));c.fabricKernel.setHexalot(n,r)}c.setState(e)}},n}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;if(window.addEventListener("resize",(function(){return e.setState(he)})),this.props.user){var t=this.props.user.ownedLots.map((function(e){return e.id}));t&&t.length>0?(this.setState({ownedLots:t}),this.fetchIsland("rotterdam",t[0])):(this.setState({ownedLots:[]}),this.fetchIsland("rotterdam"))}else this.fetchIsland("rotterdam")}},{key:"componentWillUnmount",value:function(){var e=this;window.removeEventListener("resize",(function(){return e.setState(he)}))}},{key:"render",value:function(){return this.state.island?o.createElement("div",null,o.createElement("div",null,o.createElement("div",{style:{textAlign:"center",width:"100%",top:0,height:"auto",position:"absolute",color:"#00d1d1",marginTop:0}},o.createElement("div",{style:{float:"left",height:"100%",width:"auto",display:"inline-flex",background:"black",margin:"5px",padding:"4px",borderColor:"inherit",borderWidth:"2px",borderStyle:"solid",borderRadius:"10px"}},this.props.user?o.createElement("div",{style:{fontSize:"larger",padding:"0 6px 6px 6px"}},o.createElement("a",{href:"".concat(b,"/auth/logout")},o.createElement(g.a,{color:"info"},"@",this.props.user.profile.username))):o.createElement("div",{style:{padding:"6px"}},o.createElement("a",{href:"".concat(b,"/auth/twitter")},o.createElement("img",{src:"sign-in-with-twitter-gray.png",alt:"Sign in with Twitter"})))),o.createElement(Et,{appState:this.state,location:this.perspectiveCamera.position,user:this.props.user}),o.createElement("div",{style:{float:"right",height:"100%",width:"auto",display:"inline-flex",background:"black",margin:"5px",padding:"4px",borderColor:"inherit",borderWidth:"2px",borderStyle:"solid",borderRadius:"10px"}},o.createElement("a",{className:"command-button btn btn-info",href:y,target:"_blank"},"About")))),o.createElement(Zt,{perspectiveCamera:this.perspectiveCamera,user:this.props.user,appState:this.state})):o.createElement("div",{className:"welcome"},o.createElement(m.a,{color:"secondary"},'Visiting Galapagotchi island "',"rotterdam",'"...'))}},{key:"fetchIsland",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){var r,i,o,c,s,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.storage.getIslandData(t);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return");case 5:return i=new _e(r,{createGotchiSeed:function(e,t,n){},copyLiveGotchi:function(e,t){}},this.props.storage,0),o=n?i.findHexalot(n):void 0,c=o?et(o,se.Exploring):nt(i,se.Exploring),e.next=11,new ut(this.state).withIsland(i,r);case 11:if(e.t0=c,s=e.sent.withFlightState(e.t0).withRestructure.appState,n){e.next=17;break}this.state.updateState(s),e.next=21;break;case 17:return e.next=19,new ut(s).withHomeHexalot(o);case 19:u=e.sent,this.state.updateState(u.withRestructure.appState);case 21:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),t}(o.Component),Xt=1.61803398875,$t=Math.sqrt(2);function Qt(e){var t=new v.Vector3;switch(e){case Dt.XP:return t.setX(1);case Dt.XN:return t.setX(-1);case Dt.YP:return t.setY(1);case Dt.YN:return t.setY(-1);case Dt.ZP:return t.setZ(1);case Dt.ZN:return t.setZ(-1);default:return t}}function qt(e,t){return Qt(e).multiplyScalar($t/2).addScaledVector(Qt(t),$t/2/Xt)}!function(e){e[e.XP=0]="XP",e[e.XN=1]="XN",e[e.YP=2]="YP",e[e.YN=3]="YN",e[e.ZP=4]="ZP",e[e.ZN=5]="ZN"}(Dt||(Dt={})),function(e){e[e.XPA=0]="XPA",e[e.XPO=1]="XPO",e[e.XNA=2]="XNA",e[e.XNO=3]="XNO",e[e.YPA=4]="YPA",e[e.YPO=5]="YPO",e[e.YNA=6]="YNA",e[e.YNO=7]="YNO",e[e.ZPA=8]="ZPA",e[e.ZPO=9]="ZPO",e[e.ZNA=10]="ZNA",e[e.ZNO=11]="ZNO"}(Ht||(Ht={})),function(e){e[e.NNN=0]="NNN",e[e.PNN=1]="PNN",e[e.NPN=2]="NPN",e[e.NNP=3]="NNP",e[e.NPP=4]="NPP",e[e.PNP=5]="PNP",e[e.PPN=6]="PPN",e[e.PPP=7]="PPP"}(It||(It={})),function(e){e[e.NN=0]="NN",e[e.PN=1]="PN",e[e.NP=2]="NP",e[e.PP=3]="PP"}(zt||(zt={}));var Kt=[{alpha:qt(Dt.ZN,Dt.XP),omega:qt(Dt.ZP,Dt.XP)},{alpha:qt(Dt.ZN,Dt.XN),omega:qt(Dt.ZP,Dt.XN)},{alpha:qt(Dt.XN,Dt.YP),omega:qt(Dt.XP,Dt.YP)},{alpha:qt(Dt.XN,Dt.YN),omega:qt(Dt.XP,Dt.YN)},{alpha:qt(Dt.YN,Dt.ZP),omega:qt(Dt.YP,Dt.ZP)},{alpha:qt(Dt.YN,Dt.ZN),omega:qt(Dt.YP,Dt.ZN)}],en=[{name:It.NNN,opposite:It.PPP,negative:!0,ring:zt.NN,pushEnds:[Ht.YNA,Ht.XNA,Ht.ZNA],ringMember:[zt.NP,zt.PN,zt.PP]},{name:It.PNN,opposite:It.NPP,negative:!1,ring:zt.PP,pushEnds:[Ht.XNA,Ht.YPA,Ht.ZNO],ringMember:[zt.PN,zt.NN,zt.NP]},{name:It.NPN,opposite:It.PNP,negative:!1,ring:zt.PN,pushEnds:[Ht.XNO,Ht.YNA,Ht.ZPA],ringMember:[zt.PP,zt.NP,zt.NN]},{name:It.NNP,opposite:It.PPN,negative:!1,ring:zt.NP,pushEnds:[Ht.XPA,Ht.YNO,Ht.ZNA],ringMember:[zt.NN,zt.PN,zt.PP]},{name:It.NPP,opposite:It.PNN,negative:!0,ring:zt.PP,pushEnds:[Ht.YNO,Ht.XPO,Ht.ZPA],ringMember:[zt.PN,zt.NP,zt.NN]},{name:It.PNP,opposite:It.NPN,negative:!0,ring:zt.PN,pushEnds:[Ht.YPO,Ht.XPA,Ht.ZNO],ringMember:[zt.PP,zt.NN,zt.NP]},{name:It.PPN,opposite:It.NNP,negative:!0,ring:zt.NP,pushEnds:[Ht.YPA,Ht.XNO,Ht.ZPO],ringMember:[zt.NN,zt.PP,zt.PN]},{name:It.PPP,opposite:It.NNN,negative:!1,ring:zt.NN,pushEnds:[Ht.XPO,Ht.YPO,Ht.ZPO],ringMember:[zt.NP,zt.PP,zt.PN]}];function tn(e){return en[e].opposite}function nn(e){return e||{_:100}}function rn(e){return e._/100}function an(e){return{_:100*e}}function on(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function cn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?on(n,!0).forEach((function(t){Object(fe.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):on(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var sn="ABCDabcd";function un(e){return sn.indexOf(e)>=0}var ln="0123456789";function hn(e){return ln.indexOf(e)>=0}function fn(e,t,n){switch(t){case"A":e.A=n;break;case"B":e.B=n;break;case"C":e.C=n;break;case"D":e.D=n;break;case"b":e.b=n;break;case"c":e.c=n;break;case"d":e.d=n;break;case"a":e.a=n;break;default:throw new Error("Unexpected direction directionChar: "+t)}}function dn(e,t,n){switch(t){case"A":e.MA=n;break;case"B":e.MB=n;break;case"C":e.MC=n;break;case"D":e.MD=n;break;case"a":e.Ma=n;break;case"b":e.Mb=n;break;case"c":e.Mc=n;break;case"d":e.Md=n;break;default:throw new Error("Unexpected direction directionChar: "+t)}}function pn(e,t,n){function r(e){if(!e.match(/^\d+$/))throw new Error("Not a number: ".concat(e));return parseInt(e,10)}try{if(!n||0===n.length)return void e("No code to parse");var a=function e(t){function n(e,t){var n=e.indexOf(","),r=n>=0;if("("!==e.charAt(0))return r?{content:e.substring(0,n),skip:n}:{content:e,skip:e.length};var a=function(e){if("("!==e.charAt(0))throw new Error('Code must start with "(": '.concat(e," ").concat(e.charAt(0)));for(var t=0,n=0;n<e.length;n++){var r=e.charAt(n);if("("===r)t++;else if(")"===r&&0===--t)return n}throw new Error("No matching end bracket: |".concat(e,"|"))}(e);return{content:t?e.substring(1,a):e.substring(0,a+1),skip:a+1}}var a=n(t,!0).content,i={};function o(t){var r=n(a.substring(t),!1),i=r.content,o=r.skip;return{codeTree:e(i),skip:o}}for(var c=0;c<a.length;c++){var s=a.charAt(c);if(un(s)){var u=o(c+1);if(!u.codeTree)throw new Error("No subtree: ".concat(a.substring(c)));fn(i,s,u.codeTree),c+=u.skip}else if(hn(s)){var l=n(a,!1);i._=r(l.content),c+=l.skip}else switch(s){case"S":var h=n(a.substring(c+1),!0);i.S={_:r(h.content)},c+=h.skip;break;case"M":var f=a.charAt(c+1),d=n(a.substring(c+2),!0);dn(i,f,{_:r(d.content)}),c+=d.skip+1;break;case",":case" ":break;default:throw new Error("Unexpected character: ".concat(s))}}return 0===Object.keys(i).length?void 0:i}(function(e){return e.replace(/[\n\r\t ]/g,"")}(n));if(!a)return;return function(e,t,n){return{name:e,tree:t,code:JSON.stringify(t).replace(/[_.:"]/g,"").replace(/[{]/g,"(").replace(/[}]/g,")").replace(/([ABCDabcdSM])\((\d*)\)/g,(function(e){return"".concat(arguments.length<=1?void 0:arguments[1]).concat(arguments.length<=2?void 0:arguments[2])})),fromUrl:n}}(function(e){var t=e.split(":");if(2===t.length)return t[1];return e.split("").filter((function(e){return un(e)||hn(e)})).join("")}(n),a,t)}catch(i){return void e(i.message)}}function mn(e){throw new Error("Unable to parse: ".concat(e))}function gn(e,t){var n=e.split(":");return 2===n.length?"".concat(n[0],":").concat(t.trim()):"".concat(e,":").concat(t)}var vn,bn=["(0):Zen","(1):One","(6):Six","(16,S90):Axoneme","(b1,a1):Knee","(b3,a3):Leg","(a1,b1,c1,d1):Nexus","(A2,B(3,b(2,S90),S80),C(3,c(2,S90),S80),D(3,d(2,S90),S80)):Tripod with Knees","(A(8, S85, MA1), a(8, S85, MA1)):Bulge Ring","(a1,b(3,S85,MA1),c(3,S85,MA1),d(3,S85,MA1)):Convergence Three","(a1,b(12,S85,MA1),c(12,S85,MA1),d(12,S85,MA1)):Convergence Twelve","(B(7,S80,MA1),C(2,S120,MA0),D(7,S80,MA1)):Halo by Crane","(B(5,S75),C(5,S75),D(5,S75)):Pretenst Lander","(a(1,MA0),c(3,b(3,d(3,c(3,b(3,d(1,MA0))))))):Zig Zag Loop","(B2, C2, D2, A(2, b2, c2, d2)):Crystal Interstitial","(a(2,b(2,c(2,d(1,MA11)),d(2,c(1,MA10))),c(2,d(2,b(1,MA13)),b(2,d(1,MA12))),d(2,b(2,c(1,MA15)),c(2,b(1,MA14)))),b(2,d(2,Mc13),c(2,Md14)),c(2,b(2,Md15),d(2,Mb10)),d(2,c(2,Mb11),b(2,Mc12))): Diamond","(a(3,b(3,c(3,d(2,MA11)),d(3,c(2,MA10))),c(3,d(3,b(2,MA13)),b(3,d(2,MA12))),d(3,b(3,c(2,MA15)),c(3,b(2,MA14)))),b(3,d(3,Mc13),c(3,Md14)),c(3,b(3,Md15),d(3,Mb10)),d(3,c(3,Mb11),b(3,Mc12))):Diamond2"].map((function(e){return pn(mn,!1,e)}));function yn(e,t){var n=[];return e.forEach((function(e){var r=e.brick,a=e.tree,i=e.fabric;function o(e,n,r,a){var o=e.base===It.PPP?tn(r):r,c=i.builder.createConnectedBrick(e,o,a);return 0===n._&&function(e,n){function r(n,r){if(r){var a=e.base===It.NNN?e.faces[n]:e.faces[tn(n)];if(a.removed)throw new Error("!! trying to use a face that was removed");t(r._,a)}}r(It.PPP,n.MA),r(It.NPP,n.Mb),r(It.PNP,n.Mc),r(It.PPN,n.Md),r(It.PNN,n.MB),r(It.NPN,n.MC),r(It.NNP,n.MD),r(It.NNN,n.Ma)}(c,n),{tree:n,brick:c,fabric:i}}var c=a._;if(c){var s=c-1;n.push(o(r,cn({},a,{_:s}),It.PPP,nn(a.S)))}else u(r,It.PPP,a.A),u(r,It.NPP,a.b),u(r,It.PNP,a.c),u(r,It.PPN,a.d),u(r,It.PNN,a.B),u(r,It.NPN,a.C),u(r,It.NNP,a.D),u(r,It.NNN,a.a);function u(e,t,r){if(r){var a=nn(r.S),i=cn({},r,{_:r._?r._-1:void 0});n.push(o(e,i,t,a))}}})),n}function xn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xn(n,!0).forEach((function(t){Object(fe.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.Grow="Grow",e.Shape="Shape",e.Realize="Realize",e.View="View",e.Strain="Strain"}(vn||(vn={}));var Sn="2019-12-14";function En(e){return Object.keys(e.recentCode).map((function(t){var n=e.recentCode[t],r=pn((function(e){return console.error(e)}),!1,n);if(!r)throw new Error("Unable to read recent tenscript code: ".concat(n));return r}))}function kn(e,t){return wn({},e,{nonce:e.nonce+1},t)}var On="State";function jn(e){var t=localStorage.getItem(On);if(t){var n=JSON.parse(t);if(n.version===Sn)return n}return function(e){var t=I.map(e).reduce((function(e,t){return e[t.feature]={percent:100,numeric:t.defaultValue},e}),{});return{version:Sn,nonce:0,surfaceCharacter:_.Frozen,featureValues:t,recentCode:{},controlTab:vn.Grow,fullScreen:!0,ellipsoids:!1,rotating:!1,showPushes:!0,showPulls:!0}}(e)}function Pn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Nn=[50,75,90,100,125,150,200],Cn=(1+Math.sqrt(5))/2,Mn=Math.sqrt(2),Vn=Math.sqrt(3),Fn=Math.sqrt(2-2*Math.sqrt(2/3)),Tn=(Cn/3-1/6)*Vn,Ln=Cn/3*Vn-1+Mn/Vn,Rn=Math.sqrt(.25+Tn*Tn+Ln*Ln);function An(e){switch(e){case L.Gravity:return{feature:e,name:"Gravity",defaultValue:1e-7,percents:[0,10,50,100,200,500]};case L.Drag:return{feature:e,name:"Drag",defaultValue:1e-4,percents:[0,10,50,100,150,200]};case L.PretenstFactor:return{feature:e,name:"Pretenst factor",defaultValue:.03,percents:[0,50,90,100,125,150,200]};case L.IterationsPerFrame:return{feature:e,name:"Iterations per frame",defaultValue:100,percents:[10,25,50,100,200,300,500]};case L.IntervalCountdown:return{feature:e,name:"Interval Countdown",defaultValue:1e3,percents:[10,20,30,100,150,400,1e3]};case L.PretenstCountdown:return{feature:e,name:"Slack to Pretenst countdown",defaultValue:3e4,percents:Nn};case L.FacePullEndZone:return{feature:e,name:"Face Pull End Zone",defaultValue:4,percents:Nn};case L.FacePullOrientationForce:return{feature:e,name:"Face Pull Orientation Force",defaultValue:1e-4,percents:Nn};case L.SlackThreshold:return{feature:e,name:"Slack threshold",defaultValue:1e-4,percents:[.01,.1,1,10,100,1e3]};case L.ShapingPretenstFactor:return{feature:e,name:"Pretenst factor",defaultValue:.1,percents:[0,1,2,3,5,10,20,50,100]};case L.ShapingStiffnessFactor:return{feature:e,name:"Stiffness factor",defaultValue:10,percents:[100,150,200,250,300,400,500]};case L.ShapingDrag:return{feature:e,name:"Drag",defaultValue:.1,percents:[0,10,50,100,200,500]};case L.MaxStrain:return{feature:e,name:"Maximum Strain",defaultValue:.1,percents:[1,2,3,5,8,13,21,34,55,100]};case L.VisualStrain:return{feature:e,name:"Visual Strain",defaultValue:1,percents:[0,10,50,100,200,300,500,1e3,1e4,1e5]};case L.PushOverPull:return{feature:e,name:"Compression/Tension",defaultValue:1,percents:[10,20,30,50,100,200,300,500,1e3]};case L.NexusPushLength:return{feature:e,name:"Nexus Push",defaultValue:Cn,percents:Nn};case L.ColumnPushLength:return{feature:e,name:"Column Push",defaultValue:Mn,percents:Nn};case L.TriangleLength:return{feature:e,name:"Triangle",defaultValue:1,percents:Nn};case L.RingLength:return{feature:e,name:"Ring",defaultValue:Fn,percents:[10,80,90,100,110,120,130]};case L.NexusCrossLength:return{feature:e,name:"Nexus Cross",defaultValue:Rn,percents:Nn};case L.ColumnCrossLength:return{feature:e,name:"Column Cross",defaultValue:1,percents:Nn};case L.BowMidLength:return{feature:e,name:"Bow Mid",defaultValue:.4,percents:Nn};case L.BowEndLength:return{feature:e,name:"Bow End",defaultValue:.6,percents:Nn};case L.PushRadiusFactor:return{feature:e,name:"Push Radius",defaultValue:4,percents:[5,25,50,100,150,200,300]};case L.PullRadiusFactor:return{feature:e,name:"Pull Radius",defaultValue:2,percents:[5,25,50,100,150,200,300]};case L.MaxStiffness:return{feature:e,name:"Maximum Stiffness",defaultValue:5e-4,percents:[5,25,50,100,150,200,500]}}}var Dn=function(){function e(t,n){Object(u.a)(this,e),this.config=t,this.value$=void 0;var r=n.getValue().featureValues[t.feature],a=void 0!==r?r:{numeric:t.defaultValue,percent:100};this.value$=new s.BehaviorSubject(a),this.value$.subscribe((function(e){var r=n.getValue(),a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pn(n,!0).forEach((function(t){Object(fe.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r.featureValues);a[t.feature]=e,n.next(kn(r,{featureValues:a}))}))}return Object(l.a)(e,[{key:"value",get:function(){return this.value$.getValue()}},{key:"title",get:function(){return this.config.name}},{key:"percentChoices",get:function(){return this.config.percents}},{key:"numeric",get:function(){return this.value$.getValue().numeric}},{key:"formatted",get:function(){var e=this.numeric,t=e.toExponential(5),n=t.indexOf("e+0");return n>0?t.substring(0,n):Math.max(t.indexOf("e-1"),t.indexOf("e-2"))>0?e.toFixed(5):Math.max(t.indexOf("e+1"),t.indexOf("e+2"))>0?e.toFixed(1):t}},{key:"percent",get:function(){return this.value$.getValue().percent},set:function(e){this.value$.next({numeric:this.config.defaultValue*e/100,percent:e})}},{key:"observable",get:function(){return this.value$}},{key:"fabricFeature",get:function(){return this.config.feature}}]),e}();function Hn(e){var t={};return I.map(An).forEach((function(n){return t[n.feature]=new Dn(n,e)})),t}var In=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function zn(){if("serviceWorker"in navigator){if(new URL("",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("","/service-worker.js");In?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Gn(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):Gn(e)}))}}function Gn(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var Bn,_n=n(258),Yn=n.n(_n),Jn=function(){function e(t){Object(u.a)(this,e),this.client=void 0,this.client=Yn.a.create({baseURL:t,withCredentials:!0}),this.client.get("/").catch((function(e){console.log("ERROR: Cannot reach remote storage at ".concat(t,". Are you running the server? \n").concat(e))}))}return Object(l.a)(e,[{key:"getIslandData",value:function(){var e=Object(i.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchResource("/island/".concat(t)));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"claimHexalot",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n,r){var i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.genome=xe(r),e.next=3,this.client.post("/island/".concat(t.name,"/claim-lot"),{id:n.id,x:n.coords.x,y:n.coords.y,genomeData:JSON.stringify(r)});case 3:return i=e.sent,e.abrupt("return",i.data);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getUser",value:function(){var e=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchResource("/me");case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),console.log("Could not get user:",e.t0),e.abrupt("return",void 0);case 10:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"getGenomeData",value:function(){var e=Object(i.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchResource("/hexalot/".concat(t.id,"/genome-data")));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setGenomeData",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post("/hexalot/".concat(t.id,"/genome-data"),{genomeData:n});case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getJourneyData",value:function(){var e=Object(i.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchResource("/hexalot/".concat(t.id,"/journey")));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setJourneyData",value:function(){var e=Object(i.a)(a.a.mark((function e(t,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.post("/hexalot/".concat(t.id,"/journey"),{journeyData:n});case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getLotOwner",value:function(){var e=Object(i.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetchResource("/hexalot/".concat(t.id,"/owner")));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchResource",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.client.get(t);case 3:return n=e.sent,e.abrupt("return",n.data);case 7:return e.prev=7,e.t0=e.catch(0),console.error("network problem",e.t0),e.abrupt("return",void 0);case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Un=n(9),Zn=n(654),Wn=n(644);!function(e){e[e.Main=0]="Main",e[e.Tensegrity=1]="Tensegrity"}(Bn||(Bn={}));var Xn=Object.keys(Bn).filter((function(e){return e.length>2})).map((function(e){return Bn[e]}));function $n(e){var t=e.children;return o.createElement("div",null,t)}function Qn(e){var t=e.children;return o.createElement("h3",null,t)}function qn(e){var t=e.children;return o.createElement("i",null,t)}function Kn(e){var t=e.children;return o.createElement("p",null,t)}function er(e){var t=e.children;return o.createElement("div",{className:"m-3 p-2",style:{borderRadius:"1em",borderStyle:"solid",borderWidth:"0.1em",borderColor:"#45782e"}},t)}function tr(e){var t=e.name,n=e.caption,r=e.width;return o.createElement("div",{style:{borderRadius:"1em",borderColor:"#acacac",borderWidth:3,borderStyle:"solid"}},o.createElement("video",{style:{borderTopLeftRadius:"1em",borderTopRightRadius:"1em"},width:r,controls:!1,loop:!0,autoPlay:!0},o.createElement("source",{src:"/pretenst/movies/".concat(t,".mp4"),type:"video/mp4"}),"Your browser does not support the video tag."),o.createElement("h5",{className:"w-100 text-center"},n))}function nr(e){var t=e.page;return o.createElement("a",{href:"#".concat(Bn[t])},Bn[t])}function rr(e){var t=e.name,n=e.caption;return o.createElement("div",{style:{borderRadius:"1em",borderColor:"#acacac",borderWidth:3,borderStyle:"solid"}},o.createElement("img",{style:{borderTopLeftRadius:"1em",borderTopRightRadius:"1em"},id:t,src:"/pretenst/images/".concat(t,".png"),alt:t}),o.createElement("h5",{className:"w-100 text-center"},n))}function ar(e){var t=e.name,n=e.x,r=e.y,a=e.children,i=Object(o.useState)({x:0,y:0}),c=Object(Un.a)(i,2),s=c[0],u=c[1];return Object(o.useEffect)((function(){var e=document.getElementById(t).getBoundingClientRect();u({x:e.left+n,y:e.top+r})}),[]),o.createElement("div",null,o.createElement("strong",null,'line to image called "',t,'" at (',s.x,", ",s.y,")"),o.createElement("div",null,a))}function ir(e){var t=e.term,n=e.children;return o.createElement("div",null,o.createElement("strong",null,t,":"),o.createElement("div",null,n))}function or(e){var t=e.cancel,n=Object(o.useState)(Bn.Main),r=Object(Un.a)(n,2),a=r[0],i=r[1];return o.createElement("div",{className:"w-100 h-100 p-3",style:{backgroundColor:"#494949",color:"#d4d4d4"}},o.createElement("div",{className:"text-center my-3"},o.createElement("h2",null,"pretenst.com")),o.createElement("div",{style:{borderColor:"#c8c8c8",borderWidth:"3px",height:"calc(100% - 8em)",borderStyle:"solid",borderRadius:"2em"},className:"mx-4 p-4"},o.createElement(cr,{page:a})),o.createElement("div",{className:"w-100 fixed-bottom my-3 text-center"},o.createElement(Wn.a,null,Xn.map((function(e){return o.createElement(ae.a,{key:Bn[e],color:e===a?"success":"secondary",onClick:function(){return i(e)}},Bn[e])}))),o.createElement(Wn.a,{className:"mx-2"},o.createElement(ae.a,{color:"warning",onClick:t},o.createElement(Zn.y,null)," Ok go!"))))}function cr(e){switch(e.page){case Bn.Main:return o.createElement($n,null,o.createElement(Qn,null,"Pretenst Design"),o.createElement(qn,null,"Pretenst software is a 4D design tool for physical structures which can be built from elements of pure compression (bars) and tension (cables) and exploring how these structures behave over time and under stress."),o.createElement(Kn,null,"Most houses that we think of are made of stacking solid bricks on top of one another, maybe with something in between to stick them together. A bridge or a really tall building must go a bit further, so to understand we need to think about where all the forces come from and where they go."),o.createElement(Kn,null,"Civil engineers don't just use concrete, because they know that concrete on its own will just crumble and fall apart. As we've all seen when we peek through the fence at a building site, the first thing they do is lay down a lattice of steel rods, and only later do they pour the concrete. It's only the combination of the concrete and the pre-tensed steel rods that actually makes it last. Pre-tension is everywhere! It's just mostly hidden."),o.createElement(Kn,null,"Pretenst design makes the pushing and pulling forces visual and explicit, and it invites us to see what can be built when we distill spatial structure down to its fundamentals."),o.createElement(tr,{name:"zero-pretenst",caption:"The Zero Shape",width:250}));case Bn.Tensegrity:return o.createElement("div",null,o.createElement("h3",null,"Tensegrity Page"),o.createElement(er,null,"Documentation coming soon...."),o.createElement(er,null,o.createElement(ir,{term:"Pretenst"},'A misspelling of the word "pretensed".')),o.createElement(rr,{name:"optimize",caption:"Something to optimize"}),o.createElement(er,null,o.createElement(ar,{name:"optimize",x:10,y:10},"Picture pointer")),o.createElement(er,null,o.createElement(nr,{page:Bn.Main})))}}var sr=function(){function e(t,n,r){Object(u.a)(this,e),this.numericFeature=t,this.fabric=n,this._stage=void 0,this._stage=r}return Object(l.a)(e,[{key:"withStage",value:function(t,n){return this.transition(t,n),this._stage=t,new e(this.numericFeature,this.fabric,t)}},{key:"transition",value:function(e,t){switch(this._stage){case T.Growing:switch(e){case T.Shaping:return void this.save()}break;case T.Shaping:switch(e){case T.Slack:return void(t&&t.adoptLengths&&(this.fabric.instance.engine.adoptLengths(),this.save()));case T.Realizing:return}break;case T.Slack:switch(e){case T.Shaping:case T.Realizing:return}break;case T.Realizing:switch(e){case T.Realized:return}break;case T.Realized:switch(e){case T.Slack:if(t&&t.strainToStiffness){var n=this.numericFeature(L.PushOverPull),r=function(e,t){var n=e.instance.strains,r=e.instance.stiffnesses,a=function(e){return e.reduce((function(e,t){return e+n[t.index]}),0)/e.length},i=e.intervals,o=i.filter((function(e){return e.isPush})),c=a(o),s=i.filter((function(e){return!e.isPush})),u=a(s),l=(-t*c+u)/2,h=i.map((function(e){return 1+(n[e.index]*(e.isPush?-t:1)-l)/l})),f=r.map((function(e,t){return e*h[t]})),d=f.map(ur);return{newStiffnesses:f,newLinearDensities:d}}(this.fabric,n),a=r.newStiffnesses,i=r.newLinearDensities;this.restore();var o=this.fabric.instance;return a.forEach((function(e,t){return o.stiffnesses[t]=e})),void i.forEach((function(e,t){return o.linearDensities[t]=e}))}return t&&t.adoptLengths?(this.fabric.instance.engine.adoptLengths(),void this.save()):void this.restore()}}throw new Error("No transition ".concat(T[this._stage]," to ").concat(T[e]))}},{key:"save",value:function(){this.fabric.instance.engine.cloneInstance(this.fabric.instance.index,this.fabric.slackInstance.index)}},{key:"restore",value:function(){var e=this;this.fabric.instance.engine.cloneInstance(this.fabric.slackInstance.index,this.fabric.instance.index),I.forEach((function(t){e.fabric.instance.setFeatureValue(t,e.numericFeature(t))}))}},{key:"stage",get:function(){return this._stage}}]),e}();function ur(e){return Math.sqrt(e)}var lr=n(259);function hr(e){return.6*e}var fr=function(){function e(t,n){Object(u.a)(this,e),this.fabric=t,this.numericFeature=n,this.faceMarks={}}return Object(l.a)(e,[{key:"createBrickAt",value:function(e,t){var n=this.createBrickPointsAt(It.PPP,t,e);return this.createBrick(n,It.NNN,t)}},{key:"createConnectedBrick",value:function(e,t,n){var r=e.faces[t],a=rn(e.scale),i=a*rn(n),o=this.createBrickOnFace(r,an(i)),c=o.faces[o.base],s=this.numericFeature(L.IntervalCountdown);return this.connectFaces(r,c,an((a+i)/2),s)||console.error("Cannot connect!"),o}},{key:"turnUpright",value:function(){var e=this.faceMarkLists.find((function(e){return 1===e.length}));e&&this.uprightAtOrigin(e[0])}},{key:"checkFacePulls",value:function(e,t){var n=this;if(0===e.length)return e;var r=this.fabric.instance;return e.filter((function(e){var a=e.alpha,i=e.omega,o=e.scaleFactor;return!(r.faceMidpoint(a.index).distanceTo(r.faceMidpoint(i.index))<=10*hr(o))||(function(e){var t=e.alpha,r=e.omega,a=e.scaleFactor,i=n.numericFeature(L.IntervalCountdown);n.connectFaces(t,r,an(a),i)||console.error("Unable to connect")}(e),t(e),!1)}))}},{key:"optimize",value:function(){var e=this,t=this.fabric,n=t.instance,r=[],a=function(e){var n=t.intervals.filter((function(e){return e.isPush})).find((function(t){return t.alpha.index===e||t.omega.index===e}));if(!n)throw new Error("Cannot find ".concat(e));return{interval:n,joint:n.alpha.index===e?n.alpha:n.omega}},i=t.intervals.filter((function(e){return e.intervalRole===D.ColumnCross||e.intervalRole===D.NexusCross}));i.forEach((function(e,t){var o=e.alpha.index,c=e.omega.index,s=a(o),u=a(c),l=n.location(o),h=n.location(c),f=l.distanceTo(h),d=(new v.Vector3).addVectors(l,h).multiplyScalar(.5);i.forEach((function(i,p){var m=i.alpha.index,g=i.omega.index;if(!(t>=p||o===m||o===g||c===m||c===g)){var b,y,x,w,S,E=a(m),k=a(g),O=function(e,t){return e.interval.index===t.interval.index};if(O(s,E))b=s.interval,y=e.alpha,x=e.omega,w=i.alpha,S=i.omega;else if(O(s,k))b=s.interval,y=e.alpha,x=e.omega,w=i.omega,S=i.alpha;else if(O(u,E))b=u.interval,y=e.omega,x=e.alpha,w=i.alpha,S=i.omega;else{if(!O(u,k))return;b=u.interval,y=e.omega,x=e.alpha,w=i.omega,S=i.alpha}var j=n.location(m),P=n.location(g),N=j.distanceTo(P),C=(new v.Vector3).addVectors(j,P).multiplyScalar(.5),M=l.distanceTo(C)/N,V=h.distanceTo(C)/N,F=j.distanceTo(d)/f,T=P.distanceTo(d)/f,L=0,R=function(e){e<.5&&L++};if(R(M),R(V),R(F),R(T),!(L<2)){var A=b.scale;r.push({scale:A,a:y,x:x,b:w,y:S})}}}))}));var o=this.numericFeature(L.IntervalCountdown);r.forEach((function(n){var r=n.scale,a=n.a,i=n.x,c=n.b,s=n.y;t.createInterval(i,s,D.BowMid,r,o);var u=t.findInterval(a,i),l=t.findInterval(a,s),h=t.findInterval(c,i),f=t.findInterval(c,s);if(!(u&&h&&l&&f))throw new Error("Cannot find intervals during optimize");t.removeInterval(u),t.removeInterval(f),e.fabric.changeIntervalRole(l,D.BowEnd,r,o),e.fabric.changeIntervalRole(h,D.BowEnd,r,o)})),n.forgetDimensions()}},{key:"uprightAtOrigin",value:function(e){var t=this.faceToOrigin(e);this.fabric.instance.apply(t)}},{key:"createFacePulls",value:function(e){var t=this,n=this.fabric.instance,r=function(){var r,a=t.createBrickAt((r=e.map((function(e){return n.faceMidpoint(e.index)}))).reduce((function(e,t){return e.add(t)}),new v.Vector3).multiplyScalar(1/r.length),an(function(e){return e.reduce((function(e,t){return e+rn(t.brick.scale)}),0)/e.length}(e)));n.engine.renderNumbers();return e.map((function(e){return t.fabric.createFacePull(function(e){var t=n.faceMidpoint(e.index);return a.faces.filter((function(t){return t.negative!==e.negative})).reduce((function(e,r){return n.faceMidpoint(e.index).distanceTo(t)<n.faceMidpoint(r.index).distanceTo(t)?e:r}))}(e),e)}))};switch(e.length){case 2:return e[0].negative===e[1].negative?r():[this.fabric.createFacePull(e[0],e[1])];case 3:return r();default:return[]}}},{key:"createBrickOnFace",value:function(e,t){var n=this,r=en[e.triangle].negative,a=e.brick,i=e.triangle,o=a.faces[i].joints.map((function(e){return n.fabric.instance.location(e.index)})),c=o.reduce((function(e,t){return e.add(t)}),new v.Vector3).multiplyScalar(1/3),s=(new v.Vector3).addVectors(o[0],o[1]).multiplyScalar(.5),u=(new v.Vector3).subVectors(s,c).normalize(),l=(new v.Vector3).subVectors(o[1],c).normalize(),h=(new v.Vector3).add(u).multiplyScalar(u.dot(l)),f=l.sub(h).normalize(),d=(new v.Vector3).crossVectors(f,u).normalize(),p=(new v.Matrix4).makeBasis(u,d,f).setPosition(c),m=r?It.NNN:It.PPP,g=this.createBrickPointsAt(m,t,new v.Vector3(0,0,0)).map((function(e){return e.applyMatrix4(p)})),b=r?It.PPP:It.NNN;return this.createBrick(g,b,t)}},{key:"createBrick",value:function(e,t,n){var r,a=this,i=this.numericFeature(L.IntervalCountdown),o=function(e,t,n){return{index:e,base:t,scale:n,joints:[],pushes:[],pulls:[],crosses:[],rings:[[],[],[],[]],faces:[],negativeAdjacent:0,postiveeAdjacent:0}}(this.fabric.bricks.length,t,n);this.fabric.bricks.push(o);var c=e.map((function(e,t){return a.fabric.createJointIndex(t,e)}));Kt.forEach((function(e,t){Object(lr.a)(e);var r=c[2*t],s=c[2*t+1],u={index:r,oppositeIndex:s},l={index:s,oppositeIndex:r};o.pushes.push(a.fabric.createInterval(u,l,D.NexusPush,n,i))})),o.pushes.forEach((function(e){return o.joints.push(e.alpha,e.omega)}));var s=o.pushes.reduce((function(e,t){return e.push(t.alpha,t.omega),e}),[]);return(r=this.fabric.joints).push.apply(r,Object(Ge.a)(s)),en.forEach((function(e){for(var t=e.pushEnds.map((function(e){return s[e]})),r=0;r<3;r++){var c=t[r],u=t[(r+1)%3],l=a.fabric.createInterval(c,u,D.Triangle,n,i);o.pulls.push(l),o.rings[e.ringMember[r]].push(l)}})),en.forEach((function(e){var t=a.fabric.createFace(o,e.name);o.faces.push(t)})),this.fabric.instance.forgetDimensions(),o}},{key:"createBrickPointsAt",value:function(e,t,n){var r=Kt.reduce((function(e,t){return e.push((new v.Vector3).add(t.alpha)),e.push((new v.Vector3).add(t.omega)),e}),[]),a=tn(e),i=en[a].pushEnds.map((function(e){return r[e]})).reverse(),o=i.reduce((function(e,t){return e.add(t)}),new v.Vector3).multiplyScalar(1/3),c=(new v.Vector3).subVectors(i[0],o).normalize(),s=(new v.Vector3).sub(o).normalize(),u=(new v.Vector3).crossVectors(s,c).normalize(),l=(new v.Matrix4).makeBasis(c,s,u),h=rn(t),f=(new v.Matrix4).getInverse(l).setPosition(n).scale(new v.Vector3(h,h,h));return r.map((function(e){return e.applyMatrix4(f)}))}},{key:"faceToOrigin",value:function(e){var t=this;this.fabric.instance.engine.renderNumbers();var n=e.joints.map((function(e){return t.fabric.instance.location(e.index)})),r=n.reduce((function(e,t){return e.add(t)}),new v.Vector3).multiplyScalar(1/3),a=(new v.Vector3).subVectors(n[1],r).normalize(),i=(new v.Vector3).subVectors(n[0],r).normalize(),o=(new v.Vector3).crossVectors(i,a).normalize();i.crossVectors(a,o).normalize();var c=(new v.Matrix4).makeBasis(a,o,i).setPosition(r);return(new v.Matrix4).getInverse(c)}},{key:"nineJointPairsByProximity",value:function(e,t){var n=[],r=this.fabric.instance;return e.joints.forEach((function(e){t.joints.forEach((function(t){var a=r.location(e.index),i=r.location(t.index),o=a.distanceTo(i);n.push({jointA:e,jointB:t,distance:o})}))})),n.sort((function(e,t){return e.distance-t.distance}))}},{key:"facesToRing",value:function(e,t){if(e.negative===t.negative)throw new Error("Polarity not opposite");var n=this.nineJointPairsByProximity(e,t).slice(0,6),r=n.shift();if(!r)throw new Error("No closest found");var a=function(e){var t=n.findIndex(e);return t>=0?n.splice(t,1)[0]:void 0},i=function(e){var t=a((function(t){return t.jointB.index===e.index}));return t?t.jointA:void 0},o=function(e){var t=a((function(t){return t.jointA.index===e.index}));return t?t.jointB:void 0},c=r.jointA,s=r.jointB,u=o(c);if(u){var l=i(u);if(l){var h=o(l);if(h){var f=i(h);if(f){var d=o(f);if(d&&d.index===s.index){var p=(e.joints.findIndex((function(e){return e.index===c.index}))+1)%3===e.joints.findIndex((function(e){return e.index===l.index}));return{faceA:e,faceB:t,jointsA:p!==e.negative?[c,f,l]:[c,l,f],jointsB:p!==e.negative?[u,s,h]:[s,u,h]}}console.error("Cannot complete ring!")}}}}}},{key:"connectFaces",value:function(e,t,n,r){var a=this;if(e.negative===t.negative)throw new Error("Same polarity!");var i=this.facesToRing(e,t);if(!i)return!1;for(var o=function(e){return e.negativeAdjacent>1||e.postiveeAdjacent>1},c=function(e,t,i){return a.fabric.createInterval(e,t,i,n,r)},s=function(e,t){return c(e,t,D.Ring)},u=function(e,t,n){var r=a.fabric.joints[t.oppositeIndex],i=o(n.brick)?D.NexusCross:D.ColumnCross;return c(e,r,i)},l=0;l<3;l++){var h=i.jointsA[l],f=i.jointsB[l],d=i.jointsB[(l+1)%3];s(h,f),s(h,d),u(h,d,t),u(f,h,e)}var p=function(e){var t=e.brick.scale,n=e.triangle,i=e.brick;e.negative?i.negativeAdjacent++:i.postiveeAdjacent++,en.filter((function(e){return e.opposite!==n&&e.negative!==en[n].negative})).forEach((function(e){return i.faces[e.name].canGrow=!1})),a.fabric.removeFace(e,!0);var c=en[n].ring;o(i)?(i.pulls.filter((function(e){return!e.removed})).forEach((function(e){return a.fabric.changeIntervalRole(e,D.Triangle,t,r)})),i.crosses.forEach((function(e){return a.fabric.changeIntervalRole(e,D.NexusCross,t,r)}))):i.rings[c].filter((function(e){return!e.removed})).forEach((function(e){return a.fabric.changeIntervalRole(e,D.Ring,t,r)}));var s=o(i)?D.NexusPush:D.ColumnPush;i.pushes.filter((function(e){return!e.removed})).forEach((function(e){return a.fabric.changeIntervalRole(e,s,t,r)}))};return p(e),p(t),this.fabric.instance.forgetDimensions(),!0}},{key:"markFace",get:function(){var e=this;return function(t,n){var r=e.faceMarks[t];r?r.push(n):e.faceMarks[t]=[n]}}},{key:"initialFacePulls",get:function(){var e=this;return this.faceMarkLists.filter((function(e){return 2===e.length||3===e.length})).reduce((function(t,n){return[].concat(Object(Ge.a)(t),Object(Ge.a)(e.createFacePulls(n)))}),[])}},{key:"faceMarkLists",get:function(){var e=this;return Object.keys(this.faceMarks).map((function(t){return e.faceMarks[t]}))}}]),e}(),dr=new v.SphereGeometry(1,32,8),pr=65535;function mr(e){return rn(e)/1e4}var gr,vr,br=function(){function e(t,n,r,a,i){Object(u.a)(this,e),this.roleDefaultLength=t,this.numericFeature=n,this.instance=r,this.slackInstance=a,this.tenscript=i,this.life$=void 0,this.joints=[],this.intervals=[],this.facePulls=[],this.faces=[],this.bricks=[],this.activeTenscript=void 0,this.facesToConnect=void 0,this.maxJointSpeed=0,this.builder=void 0,this.faceCount=void 0,this.faceLocations=void 0,this.faceNormals=void 0,this._facesGeometry=new v.BufferGeometry,this.intervalCount=void 0,this.lineLocations=void 0,this.lineColors=void 0,this._linesGeometry=new v.BufferGeometry,this.life$=new s.BehaviorSubject(new sr(n,this,T.Growing)),this.builder=new fr(this,n),this.refreshLineGeometry(),this.refreshFaceGeometry();var o=this.builder.createBrickAt(new v.Vector3,nn());this.bricks=[o],this.activeTenscript=[{tree:this.tenscript.tree,brick:o,fabric:this}]}return Object(l.a)(e,[{key:"toStage",value:function(e,t){e!==this.life.stage&&this.life$.next(this.life.withStage(e,t))}},{key:"connectFaces",value:function(e){this.facesToConnect=e}},{key:"brickMidpoint",value:function(e,t){var n=this,r=e.joints,a=t||new v.Vector3;return r.reduce((function(e,t){return e.add(n.instance.location(t.index))}),a).multiplyScalar(1/r.length)}},{key:"createJointIndex",value:function(e,t){return this.engine.createJoint(e,B.RightSide,t.x,t.y,t.z)}},{key:"createFacePull",value:function(e,t){var n=this.instance,r=n.faceMidpoint(e.index).distanceTo(n.faceMidpoint(t.index)),a=mr(nn()),i=ur(a),o=(rn(e.brick.scale)+rn(t.brick.scale))/2,c=hr(o),s={index:this.engine.createInterval(e.index,t.index,D.FacePull,c,a,i,function(e){var t=4e3*e;return t>pr?pr:t}(r)),alpha:e,omega:t,distance:r,scaleFactor:o,removed:!1};return this.facePulls.push(s),this.instance.forgetDimensions(),s}},{key:"removeFacePull",value:function(e){this.facePulls=this.facePulls.filter((function(t){return t.index!==e.index})),this.engine.removeInterval(e.index),this.facePulls.forEach((function(t){t.index>e.index&&t.index--})),this.intervals.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0,this.instance.forgetDimensions()}},{key:"createInterval",value:function(e,t,n,r,a){var i=rn(r)*this.roleDefaultLength(n),o=mr(r),c=ur(o),s={index:this.engine.createInterval(e.index,t.index,n,i,o,c,a),intervalRole:n,scale:r,alpha:e,omega:t,removed:!1,isPush:J(n)};return this.intervals.push(s),s}},{key:"changeIntervalScale",value:function(e,t){e.scale=an(rn(e.scale)*t),this.instance.engine.multiplyRestLength(e.index,t,100)}},{key:"changeIntervalRole",value:function(e,t,n,r){e.intervalRole=t;var a=this.instance.engine;a.setIntervalRole(e.index,t),a.changeRestLength(e.index,rn(n)*this.roleDefaultLength(t),r)}},{key:"removeInterval",value:function(e){this.intervals=this.intervals.filter((function(t){return t.index!==e.index})),this.engine.removeInterval(e.index),this.intervals.forEach((function(t){t.index>e.index&&t.index--})),this.facePulls.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0,this.instance.forgetDimensions()}},{key:"createFace",value:function(e,t){var n=en[t],r=n.negative,a=n.pushEnds,i=a.map((function(t){return e.joints[t]})),o=a.map((function(t){var n=e.pushes.find((function(n){var r=e.joints[t];return r.index===n.alpha.index||r.index===n.omega.index}));if(void 0===n)throw new Error;return n})),c=[0,1,2].map((function(n){return e.pulls[3*t+n]})),s={index:this.engine.createFace(i[0].index,i[1].index,i[2].index),canGrow:!0,negative:r,removed:!1,brick:e,triangle:t,joints:i,pushes:o,pulls:c};return this.faces.push(s),s}},{key:"removeFace",value:function(e,t){var n=this;this.engine.removeFace(e.index),this.faces=this.faces.filter((function(t){return t.index!==e.index})),this.faces.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0,t&&e.pulls.forEach((function(e){return n.removeInterval(e)}))}},{key:"release",value:function(){this.instance.release()}},{key:"needsUpdate",value:function(){var e=this.instance;this.faceLocations.array=e.faceLocations,this.faceLocations.needsUpdate=!0,this.faceNormals.array=e.faceNormals,this.faceNormals.needsUpdate=!0,this.lineLocations.array=e.lineLocations,this.lineLocations.needsUpdate=!0,this.lineColors.array=e.lineColors,this.lineColors.needsUpdate=!0,this._linesGeometry.computeBoundingSphere(),this._facesGeometry.computeBoundingSphere()}},{key:"startTightening",value:function(e){this.facePulls=e}},{key:"iterate",value:function(){var e=this,t=this.engine,n=t.iterate(this.life$.getValue().stage);if(this.maxJointSpeed=Math.sqrt(t.renderNumbers()),n===T.Busy)return n;var r=this.activeTenscript;if(r){if(r.length>0&&(this.activeTenscript=yn(r,this.builder.markFace),t.centralize()),0===r.length&&(this.activeTenscript=void 0,n===T.Growing)){var a=t.finishGrowing();return this.facePulls=this.builder.initialFacePulls,a}}else{var i=this.facesToConnect;i&&(this.facesToConnect=void 0,this.builder.createFacePulls(i)),this.facePulls=this.builder.checkFacePulls(this.facePulls,(function(t){return e.removeFacePull(t)}))}return n}},{key:"findInterval",value:function(e,t){return this.intervals.find((function(n){return n.alpha.index===e.index&&n.omega.index===t.index||n.alpha.index===t.index&&n.omega.index===e.index}))}},{key:"orientInterval",value:function(e,t,n){var r=new v.Vector3(0,1,0),a=this.instance.unitVector(e.index),i=(new v.Quaternion).setFromUnitVectors(r,a),o=this.instance.location(e.alpha.index),c=this.instance.location(e.omega.index),s=o.distanceTo(c),u=this.instance.strains[e.index],l=s/2;return{scale:new v.Vector3(t,l+l*-u*n,t),rotation:i}}},{key:"refreshLineGeometry",value:function(){this.engine.renderNumbers(),this.intervalCount=this.instance.engine.getIntervalCount(),this.lineLocations=new v.Float32BufferAttribute(this.instance.lineLocations,3),this.lineColors=new v.Float32BufferAttribute(this.instance.lineColors,3),this._linesGeometry.addAttribute("position",this.lineLocations),this._linesGeometry.addAttribute("color",this.lineColors),this._linesGeometry.computeBoundingSphere()}},{key:"refreshFaceGeometry",value:function(){this.engine.renderNumbers(),this.faceCount=this.instance.engine.getFaceCount(),this.faceLocations=new v.Float32BufferAttribute(this.instance.faceLocations,3),this.faceNormals=new v.Float32BufferAttribute(this.instance.faceNormals,3),this._facesGeometry.addAttribute("position",this.faceLocations),this._facesGeometry.addAttribute("normal",this.faceNormals),this._facesGeometry.computeBoundingSphere()}},{key:"life",get:function(){return this.life$.getValue()}},{key:"submergedJoints",get:function(){var e=this;return this.joints.filter((function(t){return e.instance.location(t.index).y<0}))}},{key:"facesGeometry",get:function(){return this.faceCount!==this.instance.engine.getFaceCount()&&this.refreshFaceGeometry(),this._facesGeometry}},{key:"linesGeometry",get:function(){return this.intervalCount!==this.instance.engine.getIntervalCount()&&this.refreshLineGeometry(),this._linesGeometry}},{key:"output",get:function(){var e=this,t=function(e){return e.toFixed(5).replace(/[.]/,",")},n=this.instance.strains,r=this.instance.stiffnesses,a=this.instance.linearDensities;return{name:this.tenscript.name,joints:this.joints.map((function(n){var r=e.instance.location(n.index);return{index:(n.index+1).toString(),x:t(r.x),y:t(r.z),z:t(r.y)}})),intervals:this.intervals.map((function(i){var o=e.instance.location(i.alpha.index),c=e.instance.location(i.omega.index),s=o.distanceTo(c),u="".concat(i.alpha.index+1,",").concat(i.omega.index+1),l=t(n[i.index]),h=i.isPush?"Push":"Pull",f=r[i.index],d=t(f),p=a[i.index],m=t(p),g=D[i.intervalRole];return{joints:u,type:h,strainString:l,stiffness:f,stiffnessString:d,linearDensity:p,linearDensityString:m,isPush:J(i.intervalRole),role:g,length:s}})).sort((function(e,t){return e.isPush&&!t.isPush?-1:!e.isPush&&t.isPush?1:e.stiffness-t.stiffness}))}}},{key:"engine",get:function(){return this.instance.engine}}]),e}(),yr=n(649),xr=n(650),wr=n(651),Sr=n(652),Er=n(653),kr=["#fc4d4d","#fb712a","#ed9400","#d4b500","#afd200","#80da52","#4edd83","#00ddad","#00c4d7","#00a5ff","#007bff","#2329f7"].reverse().map((function(e){return new v.Color(e)})),Or=!0,jr=new v.MeshPhongMaterial({color:new v.Color("#1c1608"),side:v.DoubleSide}),Pr=new v.LineBasicMaterial({vertexColors:v.VertexColors}),Nr=new v.LineBasicMaterial({color:new v.Color("#cace02")}),Cr=new v.MeshPhongMaterial({lights:Or,color:new v.Color("white"),side:v.DoubleSide,transparent:!0,opacity:.2}),Mr=new v.MeshPhongMaterial({color:new v.Color("#91934f"),lights:!0}),Vr=kr.map((function(e){return new v.MeshLambertMaterial({color:e,lights:Or})}));function Fr(e){switch(e){case D.NexusPush:return"#6541b4";case D.ColumnPush:return"#2f3aca";case D.Triangle:return"#f9c9bf";case D.Ring:return"#cc3200";case D.NexusCross:return"#59ebcb";case D.ColumnCross:return"#73c84a";case D.BowMid:return"#f101e9";case D.BowEnd:return"#cb01c3";case D.FacePull:return"#bf0105";default:return}}function Tr(e){var t=function(e){return new v.Color(Fr(e))}(e);return new v.MeshLambertMaterial({color:t,lights:Or})}function Lr(e){var t=e.feature,n=e.disabled,r=Object(o.useState)((function(){return t.percent})),a=Object(Un.a)(r,2),i=a[0],c=a[1];Object(o.useEffect)((function(){var e=t.observable.subscribe((function(e){var t=e.percent;return c(t)}));return function(){return e.unsubscribe()}}),[]);var s=Fr(U(t.fabricFeature)),u=s||"#919191";return o.createElement("div",{className:"my-2"},o.createElement("div",{className:"float-right",style:{color:n?"gray":"white"}},t.formatted),o.createElement("div",null,t.config.name),o.createElement(Wn.a,{className:"w-100"},t.percentChoices.map((function(e){var r=i===e?"#000000":u;return o.createElement(ae.a,{disabled:n,size:"sm",style:{color:"white",backgroundColor:r},key:"".concat(t.config.name,":").concat(e),onClick:function(){return t.percent=e}},function(e){return e<=100?"".concat(e,"%"):"".concat(e/100,"x")}(e))}))))}function Rr(e){var t=e.fabric,n=e.stageTransition,r=e.disabled,a=Object(o.useState)(t.life),i=Object(Un.a)(a,2),c=i[0],s=i[1];function u(e){return!(!r&&c.stage!==T.Busy&&c.stage!==T.Realizing)||c.stage!==e}switch(Object(o.useEffect)((function(){var e=t.life$.subscribe(s);return function(){return e.unsubscribe()}}),[t]),n){case gr.CaptureLengthsToSlack:return o.createElement(ae.a,{className:"my-1 w-100",disabled:u(T.Shaping),onClick:function(){return t.toStage(T.Slack,{adoptLengths:!0})}},"Capture Lengths ",o.createElement(Zn.j,null)," (",o.createElement(Ar,{stage:T.Shaping})," ) ",o.createElement(Zn.d,null)," ( ",o.createElement(Zn.f,null),o.createElement(Ar,{stage:T.Slack})," ) New Slack");case gr.CurrentLengthsToSlack:return o.createElement(ae.a,{className:"my-1 w-100",disabled:u(T.Shaping),onClick:function(){return t.toStage(T.Slack)}},"Current Lengths ",o.createElement(Ar,{stage:T.Shaping})," ",o.createElement(Zn.d,null),o.createElement(Ar,{stage:T.Slack})," Slack");case gr.SlackToRealizing:return o.createElement(ae.a,{className:"my-1 w-100",disabled:u(T.Slack),onClick:function(){return t.toStage(T.Realizing)}},"Slack ",o.createElement(Ar,{stage:T.Slack})," ",o.createElement(Zn.d,null)," ",o.createElement(Ar,{stage:T.Realized})," Realized");case gr.SlackToShaping:return o.createElement(Wn.a,{vertical:!0,className:"w-100 my-1"},o.createElement(ae.a,{className:"my-1 w-100",disabled:u(T.Slack),onClick:function(){return t.toStage(T.Shaping)}},"Slack ",o.createElement(Ar,{stage:T.Slack})," ",o.createElement(Zn.d,null)," ",o.createElement(Ar,{stage:T.Shaping})," Shaping"));case gr.CaptureRealizedToSlack:return o.createElement(ae.a,{className:"my-1 w-100",disabled:u(T.Realized),onClick:function(){return t.toStage(T.Slack,{adoptLengths:!0})}},"Capture realized ",o.createElement(Zn.j,null)," ( ",o.createElement(Ar,{stage:T.Realized})," ) ",o.createElement(Zn.d,null)," ( ",o.createElement(Zn.f,null),o.createElement(Ar,{stage:T.Slack})," ) New Slack");case gr.CaptureStrainForStiffness:return o.createElement(ae.a,{className:"my-1 w-100",disabled:u(T.Realized),onClick:function(){return t.toStage(T.Slack,{strainToStiffness:!0})}},"Capture Strain ",o.createElement(Zn.j,null)," ( ",o.createElement(Ar,{stage:T.Realized})," ",o.createElement(Zn.G,null)," ) ",o.createElement(Zn.d,null),"( ",o.createElement(Ar,{stage:T.Slack})," ",o.createElement(Zn.k,null)," ) Slack Stiffness")}}function Ar(e){switch(e.stage){case T.Busy:return o.createElement(Zn.n,null);case T.Growing:return o.createElement(Zn.N,null);case T.Shaping:return o.createElement(Zn.S,null);case T.Slack:return o.createElement(Zn.U,null);case T.Realizing:return o.createElement(Zn.n,null);case T.Realized:return o.createElement(Zn.B,null)}}function Dr(e){var t=e.floatFeatures,n=e.fabric,r=e.selectedIntervals,a=e.setFabric,i=e.shapeSelection,c=e.setShapeSelection,s=e.selectedFaces,u=e.clearSelectedFaces,l=e.storedState$,h=Object(o.useState)(!1),f=Object(Un.a)(h,2),d=f[0],p=f[1];Object(o.useEffect)((function(){n.instance.engine.setPushAndPull(d)}),[d]);var m=Object(o.useState)(l.getValue().ellipsoids),g=Object(Un.a)(m,2),v=g[0],b=g[1];Object(o.useEffect)((function(){var e=[l.subscribe((function(e){return b(e.ellipsoids)}))];return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[]);var y=Object(o.useState)(n.life),x=Object(Un.a)(y,2),w=x[0],S=x[1];Object(o.useEffect)((function(){var e=n.life$.subscribe(S);return function(){return e.unsubscribe()}}),[n]);var E=Object(o.useState)(t[L.NexusPushLength]),k=Object(Un.a)(E,2),O=k[0],j=k[1],P=function(e,t,a){return function(){r&&r.forEach((function(r){r.isPush&&!t||!r.isPush&&!a||n.changeIntervalScale(r,e?1.03:1/1.03)}))}};function N(){return v||w.stage!==T.Shaping}function C(e,t){return!(!N()&&i===t)||(s.length<e||v)}function M(){return v||i!==vr.None}return o.createElement("div",null,o.createElement(ia,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Zn.a,null)," Phase"),o.createElement(Rr,{fabric:n,stageTransition:gr.CaptureLengthsToSlack,disabled:M()}),o.createElement(Rr,{fabric:n,stageTransition:gr.CurrentLengthsToSlack,disabled:M()}),o.createElement(Rr,{fabric:n,stageTransition:gr.SlackToShaping,disabled:M()})),o.createElement(ia,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Zn.z,null)," Manual"),o.createElement(Wn.a,{size:"sm",className:"w-100 my-2"},o.createElement(ae.a,{color:i===vr.Intervals?"warning":"secondary",disabled:v&&i===vr.None||0===s.length,onClick:function(){var e=i===vr.Intervals?vr.None:vr.Intervals;c(e)}},o.createElement("span",null,o.createElement(Zn.b,null)," Adjust ",o.createElement(Zn.e,null))),o.createElement(ae.a,{disabled:C(1,vr.Intervals),onClick:P(!0,!0,!0)},"TC ",o.createElement(Zn.e,null)),o.createElement(ae.a,{disabled:C(1,vr.Intervals),onClick:P(!1,!0,!0)},"TC ",o.createElement(Zn.b,null)),o.createElement(ae.a,{disabled:C(1,vr.Intervals),onClick:P(!0,!1,!0)},"T",o.createElement(Zn.e,null)),o.createElement(ae.a,{disabled:C(1,vr.Intervals),onClick:P(!1,!1,!0)},"T ",o.createElement(Zn.b,null)),o.createElement(ae.a,{disabled:C(1,vr.Intervals),onClick:P(!0,!0,!1)},"C ",o.createElement(Zn.e,null)),o.createElement(ae.a,{disabled:C(1,vr.Intervals),onClick:P(!1,!0,!1)},"C ",o.createElement(Zn.b,null))),o.createElement(Wn.a,{size:"sm",className:"w-100 my-2"},o.createElement(ae.a,{disabled:0===s.length||N()&&i!==vr.None,onClick:function(){return u()}},o.createElement(Zn.Q,null)," Clear selection"),o.createElement(ae.a,{disabled:C(1,vr.Faces),onClick:function(){n.builder.uprightAtOrigin(s[0]),u()}},o.createElement(Zn.o,null),o.createElement("span",null," Upright")),o.createElement(ae.a,{disabled:C(2,vr.Faces),onClick:function(){n.connectFaces(s),u(),c(vr.None),a(n)}},o.createElement(Zn.F,null),o.createElement("span",null," Connect")),o.createElement(ae.a,{disabled:N(),onClick:function(){return n.builder.optimize()}},o.createElement(Zn.H,null),o.createElement("span",null," Bows")))),o.createElement(ia,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Zn.S,null)," Adjustments"),o.createElement(Lr,{feature:t[L.ShapingPretenstFactor],disabled:N()}),o.createElement(Lr,{feature:t[L.ShapingDrag],disabled:N()}),o.createElement(Lr,{feature:t[L.ShapingStiffnessFactor],disabled:N()}),o.createElement(Wn.a,{size:"sm",className:"w-100 my-2"},o.createElement(ae.a,{disabled:N(),color:d?"secondary":"success",onClick:function(){return p(!1)}},o.createElement(Zn.l,null),": T or C"),o.createElement(ae.a,{disabled:N(),color:d?"success":"secondary",onClick:function(){return p(!0)}},o.createElement(Zn.r,null),": T=C"))),o.createElement(ia,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Zn.G,null)," Default Lengths"),o.createElement(Lr,{key:O.title,feature:O,disabled:N()}),o.createElement(Wn.a,{className:"my-2"},Y.map((function(e){return{intervalRole:e,feature:t[Z(e)]}})).map((function(e){var t=e.intervalRole,n=e.feature;return o.createElement(ae.a,{size:"sm",key:D[t],onClick:function(){return j(n)},color:O.fabricFeature===n.fabricFeature?"success":"secondary"},z(t))})))))}function Hr(e){var t=e.floatFeatures,n=e.fabric,r=e.shapeSelection,a=e.storedState$,i=Object(o.useState)(a.getValue()),c=Object(Un.a)(i,2),s=c[0],u=c[1],l=Object(o.useState)(a.getValue().ellipsoids),h=Object(Un.a)(l,2),f=h[0],d=h[1];Object(o.useEffect)((function(){var e=[a.subscribe((function(e){d(s.ellipsoids),u(e)}))];return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[]);var p,m=Object(o.useState)(n.life),g=Object(Un.a)(m,2),v=g[0],b=g[1];function y(){return f||r!==vr.None||v.stage<T.Slack}function x(){return f||r!==vr.None}return Object(o.useEffect)((function(){var e=n.life$.subscribe(b);return function(){return e.unsubscribe()}}),[n]),o.createElement("div",null,o.createElement(ia,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Zn.a,null)," Phase"),o.createElement(Rr,{fabric:n,stageTransition:gr.SlackToRealizing,disabled:x()}),o.createElement(Rr,{fabric:n,stageTransition:gr.CaptureRealizedToSlack,disabled:x()})),o.createElement(ia,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Zn.x,null)," Environment"),o.createElement(Lr,{feature:t[L.PretenstFactor],disabled:y()}),o.createElement("div",{className:"float-right",style:{color:y()?"gray":"white"}},_[s.surfaceCharacter]),o.createElement("div",null,"Surface"),o.createElement(Wn.a,{size:"sm",className:"w-100"},(p=_,Object.keys(p).filter((function(e){return e.length>1})).map((function(e){return p[e]}))).map((function(e){return o.createElement(ae.a,{key:_[e],disabled:y(),active:s.surfaceCharacter===e,onClick:function(){return t={surfaceCharacter:e},void a.next(kn(a.getValue(),t));var t}},_[e])}))),o.createElement(Lr,{feature:t[L.Gravity],disabled:y()}),o.createElement(Lr,{feature:t[L.Drag],disabled:y()})),o.createElement(ia,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Zn.g,null)," Compression vs Tension"),o.createElement(Rr,{fabric:n,stageTransition:gr.CaptureStrainForStiffness,disabled:x()}),o.createElement(Lr,{feature:t[L.PushOverPull],disabled:y()})))}!function(e){e[e.CaptureLengthsToSlack=0]="CaptureLengthsToSlack",e[e.CurrentLengthsToSlack=1]="CurrentLengthsToSlack",e[e.SlackToRealizing=2]="SlackToRealizing",e[e.SlackToShaping=3]="SlackToShaping",e[e.CaptureRealizedToSlack=4]="CaptureRealizedToSlack",e[e.CaptureStrainForStiffness=5]="CaptureStrainForStiffness"}(gr||(gr={})),function(e){e[e.None=0]="None",e[e.Faces=1]="Faces",e[e.Intervals=2]="Intervals"}(vr||(vr={}));var Ir=.7,zr=1.4,Gr=3.5,Br=[L.MaxStrain,L.MaxStiffness,L.VisualStrain,L.SlackThreshold];function _r(e){var t=new v.Geometry,n=function(e,t){return new v.Vector3(e,t,0)};return t.vertices=[n(0,-Gr),n(0,Gr),n(-Ir,Gr),n(Ir,Gr),n(-Ir,-Gr),n(Ir,-Gr)],e&&t.vertices.push(n(-Ir,0),n(Ir,0)),t}function Yr(e,t,n,r,a){var i=new Float32Array(2*n.length*3),o=0;e.forEach((function(e){var t=(n[e.index]-r)/(a-r),c=t<-1?-1:t>1?1:t;i[o++]=-Ir*zr,i[o++]=c*Gr,i[o++]=0,i[o++]=Ir*zr,i[o++]=c*Gr,i[o++]=0}));var c=new v.BufferGeometry;return c.addAttribute("position",new v.Float32BufferAttribute(i,3)),c.addAttribute("color",new v.Float32BufferAttribute(t,3)),c}function Jr(e){var t=e.floatFeatures,n=e.fabric,r=e.storedState$,a=Object(o.useRef)();return o.createElement(o.Fragment,null,o.createElement(ia,{height:"50%"},o.createElement("div",{style:{position:"absolute",left:"6em"}},"Strain"),o.createElement("div",{style:{position:"absolute",right:"5em"}},"Stiffness"),o.createElement((function(){var e=Object(o.useState)(0),t=Object(Un.a)(e,2),i=t[0],c=t[1],s=Object(o.useState)(r.getValue().featureValues[L.MaxStrain].numeric),u=Object(Un.a)(s,2),l=u[0],h=u[1],f=Object(o.useState)(r.getValue().featureValues[L.MaxStiffness].numeric),d=Object(Un.a)(f,2),p=d[0],m=d[1];Object(o.useEffect)((function(){var e=r.subscribe((function(e){h(e.featureValues[L.MaxStrain].numeric),m(e.featureValues[L.MaxStiffness].numeric)}));return function(){return e.unsubscribe()}}),[n]),Object(o.useEffect)((function(){var e=setInterval((function(){var e=n.instance.engine.getAge();i<e&&c(e)}),1e3);return function(){return clearTimeout(e)}}),[]);var g=n.instance;function b(e){var t=e.position,n=e.intervals,r=e.floats,a=e.mid,i=e.max,c=e.middleTick;return o.createElement("group",{position:new v.Vector3(t,-.15,0)},o.createElement("lineSegments",{geometry:Yr(n,g.lineColors,r,a,i),material:Pr}),o.createElement("lineSegments",{geometry:_r(c),material:Nr}))}return o.createElement(kt.a,null,o.createElement("orthographicCamera",{position:new v.Vector3(0,0,-1),ref:a}),o.createElement("scene",null,o.createElement(b,{position:-1.5,intervals:n.intervals,floats:g.strains,mid:0,max:l,middleTick:!0}),o.createElement(b,{position:1.5,intervals:n.intervals,floats:g.stiffnesses,mid:0,max:p,middleTick:!1})))}),null)),o.createElement(ia,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Zn.O,null)," Adjustments"),Br.map((function(e){return o.createElement(Lr,{key:L[e],feature:t[e],disabled:!1})}))))}var Ur=n(656),Zr=n(645),Wr=n(646),Xr=n(647),$r=n(648);function Qr(e){var t=e.rootTenscript,n=e.setRootTenscript,r=e.fabric,a=e.runTenscript,i=e.storedState$,c=Object(o.useState)(r&&!r.tenscript.fromUrl?r.tenscript:t),s=Object(Un.a)(c,2),u=s[0],l=s[1],h=Object(o.useState)(""),f=Object(Un.a)(h,2),d=f[0],p=f[1],m=Object(o.useState)(!1),g=Object(Un.a)(m,2),v=g[0],b=g[1],y=Object(o.useState)(En(i.getValue())),x=Object(Un.a)(y,2),w=x[0],S=x[1],E=Object(o.useState)(!1),k=Object(Un.a)(E,2),O=k[0],j=k[1];function P(e){var t=function(e,t){var n=t.code,r=t.name,a=wn({},e.recentCode);return a[r]=gn(n,r),kn(e,{recentCode:a})}(i.getValue(),e);S(En(t)),i.next(t)}return o.createElement("div",{id:"tenscript-panel",style:{flexDirection:"column",position:"relative",backgroundColor:"rgba(0,0,0,1)",height:"100%"}},o.createElement(ia,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Zn.N,null)," Tenscript"),o.createElement("div",{id:"code-and-run",style:{flexDirection:"column",height:"available"}},o.createElement(qr,{tenscript:u,setTenscript:l,error:d,setError:p}),o.createElement(Wn.a,{className:"w-100 my-2"},o.createElement(ae.a,{color:d.length>0?"warning":"success",disabled:d.length>0,onClick:function(){return a(u)}},0===d.length?o.createElement("span",null,"Execute ",o.createElement(Zn.J,null)," tenscript"):o.createElement("span",null,o.createElement(Zn.i,null)," ",d))))),o.createElement(ia,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Zn.h,null)," Storage"),0===w.length?void 0:o.createElement(Ur.a,{className:"w-100 my-2",isOpen:v,toggle:function(){return b(!v)}},o.createElement(Zr.a,{style:{borderRadius:"1.078em"}},v?o.createElement(Zn.L,null):o.createElement(Zn.K,null)," Recent"),o.createElement(Wr.a,null,w.map((function(e,t){return o.createElement(Xr.a,{key:"Recent".concat(t),onClick:function(){return a(e)}},e.name)})))),o.createElement(Wn.a,{className:"w-100 my-2"},o.createElement(ae.a,{disabled:u.code===t.code,onClick:function(){n(u),P(u)}},"Save ",o.createElement(Zn.C,null)," for later")),o.createElement(Ur.a,{className:"w-100 my-2",isOpen:O,toggle:function(){return j(!O)}},o.createElement(Zr.a,{color:"info",style:{borderRadius:"1.078em"}},"Explore ",o.createElement(Zn.D,null)," existing designs"),o.createElement(Wr.a,null,bn.map((function(e,t){return o.createElement(Xr.a,{key:"Boot".concat(t),onClick:function(){return a(e)}},e.name)}))))))}function qr(e){var t=e.tenscript,n=e.setTenscript,r=e.error,a=e.setError,i=Object(o.useState)(""),c=Object(Un.a)(i,2),s=c[0],u=c[1];function l(e){u(e),function(e){var t=pn(a,!1,e);t&&(a(""),n(t))}(e)}return Object(o.useEffect)((function(){return u(t.code)}),[]),o.createElement("div",{className:"my-2 p-2 w-100",style:{backgroundColor:"#757575",color:"#ffffff",borderStyle:"solid",borderRadius:"1em",borderColor:0===r.length?"black":"#f0ad4e",borderWidth:"2px"}},o.createElement("h6",{className:"w-100 text-center"},o.createElement("i",null,'"',t.name,'"')),o.createElement($r.a,{style:{borderRadius:"1em",height:"20em"},type:"textarea",id:"tenscript",value:s,onChange:function(e){return l(e.target.value)}}))}var Kr=n(120),ea=n(262),ta=n.n(ea);n(263);function na(e){var t=e.floatFeatures,n=e.fabric,r=e.visibleRoles,a=e.setVisibleRoles,i=e.storedState$,c=Object(o.useState)(i.getValue().ellipsoids),s=Object(Un.a)(c,2),u=s[0],l=s[1],h=Object(o.useState)(i.getValue().showPushes),f=Object(Un.a)(h,2),d=f[0],p=f[1],m=Object(o.useState)(i.getValue().showPulls),g=Object(Un.a)(m,2),v=g[0],b=g[1];Object(o.useEffect)((function(){var e=i.subscribe((function(e){l(e.ellipsoids),p(e.showPushes),b(e.showPulls)}));return function(){return e.unsubscribe()}}),[]);var y=Object(o.useState)(n.life),x=Object(Un.a)(y,2),w=x[0],S=x[1];function E(e){var t=e.pushes,n=e.pulls,r=e.children;return o.createElement(ae.a,{style:{color:"white"},color:t===d&&n===v?"success":"secondary",onClick:function(){i.next(kn(i.getValue(),{showPulls:n,showPushes:t}))}},r)}return Object(o.useEffect)((function(){var e=n.life$.subscribe(S);return function(){return e.unsubscribe()}}),[n]),o.createElement("div",null,o.createElement(ia,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Zn.t,null)," Coloring"),o.createElement(Wn.a,{className:"w-100 my-2"},o.createElement(E,{pushes:!0,pulls:!0},o.createElement("span",null,o.createElement(Zn.w,null)," All")),o.createElement(E,{pushes:!1,pulls:!0},o.createElement("span",null,o.createElement(Zn.T,null)," Pulls")),o.createElement(E,{pushes:!0,pulls:!1},o.createElement("span",null,o.createElement(Zn.s,null)," Pushes")),o.createElement(E,{pushes:!1,pulls:!1},o.createElement("span",null,o.createElement(Zn.m,null)," Roles")))),o.createElement(ia,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Zn.j,null)," Snapshot"),o.createElement(Wn.a,{size:"sm"},Y.map((function(e){return o.createElement(ae.a,{color:r.indexOf(e)<0?"secondary":"success",key:"viz".concat(e),onClick:function(){r.indexOf(e)<0?a([].concat(Object(Ge.a)(r),[e])):a(r.filter((function(t){return t!==e})))},disabled:!u},z(e))}))),o.createElement(Lr,{key:"pushrad",feature:t[L.PushRadiusFactor],disabled:!u}),o.createElement(Lr,{key:"pullrad",feature:t[L.PullRadiusFactor],disabled:!u})),o.createElement(ia,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Zn.n,null)," Time"),o.createElement(Lr,{key:"it",feature:t[L.IterationsPerFrame],disabled:u}),o.createElement(Lr,{key:"ic",feature:t[L.IntervalCountdown],disabled:u}),o.createElement(Lr,{key:"pc",feature:t[L.PretenstCountdown],disabled:u})),o.createElement(ia,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Zn.v,null)," Perturb"),o.createElement(Wn.a,{className:"w-100"},o.createElement(ae.a,{disabled:w.stage!==T.Realized,onClick:function(){return n.instance.engine.setAltitude(1)}},o.createElement(Zn.A,null)," Nudge"),o.createElement(ae.a,{disabled:w.stage!==T.Realized,onClick:function(){return n.instance.engine.setAltitude(10)}},o.createElement(Zn.I,null)," Drop"),o.createElement(ae.a,{disabled:u,onClick:function(){return n.instance.engine.centralize()}},o.createElement(Zn.p,null)," Centralize"))),o.createElement(ia,null,o.createElement("h6",{className:"w-100 text-center"},o.createElement(Zn.M,null)," Take"),o.createElement(Wn.a,{vertical:!0,className:"w-100"},o.createElement(ae.a,{onClick:function(){return function(e){var t=e.output,n=new ta.a;n.file("joints.csv",function(e){var t=[];return t.push(["index","x","y","z"]),e.joints.forEach((function(e){return t.push([e.index,e.x,e.y,e.z])})),t.map((function(e){return e.join(";")})).join("\n")}(t)),n.file("intervals.csv",function(e){var t=[];return t.push(["joints","type","strain","elasticity","linear density","role","length"]),e.intervals.forEach((function(e){t.push(['"=""'.concat(e.joints,'"""'),e.type,e.strainString,e.stiffnessString,e.linearDensityString,e.role,e.length.toFixed(8)])})),t.map((function(e){return e.join(";")})).join("\n")}(t)),n.file("submerged.csv",function(e){var t=[];return t.push(["joints"]),t.push(['"=""'.concat(e.submergedJoints.map((function(e){return e.index+1})),'"""')]),t.map((function(e){return e.join(";")})).join("\n")}(e)),n.generateAsync({type:"blob",mimeType:"application/zip"}).then((function(e){var t=(new Date).toISOString().replace(/[.].*/,"").replace(/[:T_]/g,"-");Kr.saveAs(e,"pretenst-".concat(t,".zip"))}))}(n)}},o.createElement(Zn.q,null)," Download CSV ",o.createElement(Zn.u,null)))))}var ra="25em";function aa(e){var t=e.floatFeatures,n=e.rootTenscript,r=e.setRootTenscript,a=e.shapeSelection,i=e.setShapeSelection,c=e.selectedFaces,s=e.clearSelectedFaces,u=e.selectedIntervals,l=e.fabric,h=e.setFabric,f=e.runTenscript,d=e.visibleRoles,p=e.setVisibleRoles,g=e.toFullScreen,v=e.storedState$,b=Object(o.useState)(l?l.life:void 0),y=Object(Un.a)(b,2),x=y[0],w=y[1];Object(o.useEffect)((function(){var e=l?l.life$.subscribe(w):void 0;return function(){e&&e.unsubscribe()}}),[l]);var S=Object(o.useState)(v.getValue().controlTab),E=Object(Un.a)(S,2),k=E[0],O=E[1];function j(e){var t=e.tab;return o.createElement(yr.a,null,o.createElement(xr.a,{active:k===t,onClick:function(){return v.next(kn(v.getValue(),{controlTab:t}))}},t))}function P(e){var g=e.tab,b=o.createElement(m.a,{color:"warning"},"No fabric");return o.createElement(wr.a,{id:"tab-pane",style:{height:"100%"},tabId:g},o.createElement((function(){switch(g){case vn.Grow:return o.createElement(Qr,{rootTenscript:n,setRootTenscript:r,fabric:l,runTenscript:f,storedState$:v});case vn.Shape:return l?o.createElement(Dr,{floatFeatures:t,fabric:l,setFabric:h,selectedIntervals:u,shapeSelection:a,setShapeSelection:i,selectedFaces:c,clearSelectedFaces:s,storedState$:v}):b;case vn.Realize:return l?o.createElement(Hr,{floatFeatures:t,fabric:l,shapeSelection:a,storedState$:v}):b;case vn.View:return l?o.createElement(na,{floatFeatures:t,fabric:l,visibleRoles:d,setVisibleRoles:p,storedState$:v}):b;case vn.Strain:return l?o.createElement(Jr,{floatFeatures:t,fabric:l,storedState$:v}):b}}),null))}return Object(o.useEffect)((function(){k!==vn.Shape&&s()}),[k,x]),Object(o.useEffect)((function(){var e=v.subscribe((function(e){return O(e.controlTab)}));return function(){return e.unsubscribe()}}),[]),o.createElement("div",{className:"h-100"},o.createElement(Sr.a,{tabs:!0,style:{backgroundColor:"#b2b2b2"}},Object.keys(vn).map((function(e){return o.createElement(j,{key:"T".concat(e),tab:vn[e]})}))),o.createElement(Er.a,{style:{flex:1,flexFlow:"auto",height:"100%"},id:"tab-content",activeTab:k},Object.keys(vn).map((function(e){return o.createElement(P,{key:e,tab:vn[e]})}))),o.createElement("div",{style:{position:"absolute",top:0,height:"100%",left:ra,zIndex:10,width:"1em"}},o.createElement((function(){return o.createElement(ae.a,{style:{padding:0,margin:0,borderRadius:0,width:"1em"},className:"w-100 h-100",color:"dark",onClick:g},o.createElement(Zn.c,null))}),null)))}function ia(e){var t=e.children,n=e.height;return o.createElement("div",{className:"m-3 p-2",style:{height:n,borderRadius:"1em",borderStyle:"solid",borderWidth:"0.1em",borderColor:"#45782e"}},t)}var oa={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},ca={type:"change"},sa={type:"start"},ua={type:"end"},la=function(e){function t(e,n){var r;return Object(u.a)(this,t),(r=Object(h.a)(this,Object(f.a)(t).call(this))).object=void 0,r.element=void 0,r.window=void 0,r.enabled=void 0,r.target=void 0,r.enableZoom=void 0,r.zoomSpeed=void 0,r.minDistance=void 0,r.maxDistance=void 0,r.enableRotate=void 0,r.rotateSpeed=void 0,r.enablePan=void 0,r.keyPanSpeed=void 0,r.autoRotate=void 0,r.autoRotateSpeed=void 0,r.minZoom=void 0,r.maxZoom=void 0,r.minPolarAngle=void 0,r.maxPolarAngle=void 0,r.minAzimuthAngle=void 0,r.maxAzimuthAngle=void 0,r.keys=void 0,r.mouseButtons=void 0,r.enableDamping=void 0,r.dampingFactor=void 0,r.spherical=void 0,r.sphericalDelta=void 0,r.scale=void 0,r.target0=void 0,r.position0=void 0,r.zoom0=void 0,r.state=void 0,r.panOffset=void 0,r.zoomChanged=void 0,r.rotateStart=void 0,r.rotateEnd=void 0,r.rotateDelta=void 0,r.panStart=void 0,r.panEnd=void 0,r.panDelta=void 0,r.dollyStart=void 0,r.dollyEnd=void 0,r.dollyDelta=void 0,r.updateLastPosition=void 0,r.updateOffset=void 0,r.updateQuat=void 0,r.updateLastQuaternion=void 0,r.updateQuatInverse=void 0,r.panLeftV=void 0,r.panUpV=void 0,r.panInternalOffset=void 0,r.onMouseUp=void 0,r.onMouseDown=void 0,r.onMouseMove=void 0,r.onMouseWheel=void 0,r.onTouchStart=void 0,r.onTouchEnd=void 0,r.onTouchMove=void 0,r.object=e,r.element=n,r.window=window,r.enabled=!0,r.target=new v.Vector3,r.minDistance=0,r.maxDistance=1/0,r.minZoom=0,r.maxZoom=1/0,r.minPolarAngle=0,r.maxPolarAngle=Math.PI,r.minAzimuthAngle=-1/0,r.maxAzimuthAngle=1/0,r.enableDamping=!1,r.dampingFactor=.25,r.enableZoom=!0,r.zoomSpeed=1,r.enableRotate=!0,r.rotateSpeed=1,r.enablePan=!0,r.keyPanSpeed=7,r.autoRotate=!1,r.autoRotateSpeed=2,r.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},r.mouseButtons={ORBIT:v.MOUSE.LEFT,ZOOM:v.MOUSE.MIDDLE,PAN:v.MOUSE.RIGHT},r.target0=r.target.clone(),r.position0=r.object.position.clone(),r.zoom0=r.object.zoom,r.updateOffset=new v.Vector3,r.updateQuat=(new v.Quaternion).setFromUnitVectors(r.object.up,new v.Vector3(0,1,0)),r.updateQuatInverse=r.updateQuat.clone().inverse(),r.updateLastPosition=new v.Vector3,r.updateLastQuaternion=new v.Quaternion,r.state=oa.NONE,r.scale=1,r.spherical=new v.Spherical,r.sphericalDelta=new v.Spherical,r.panOffset=new v.Vector3,r.zoomChanged=!1,r.rotateStart=new v.Vector2,r.rotateEnd=new v.Vector2,r.rotateDelta=new v.Vector2,r.panStart=new v.Vector2,r.panEnd=new v.Vector2,r.panDelta=new v.Vector2,r.dollyStart=new v.Vector2,r.dollyEnd=new v.Vector2,r.dollyDelta=new v.Vector2,r.panLeftV=new v.Vector3,r.panUpV=new v.Vector3,r.panInternalOffset=new v.Vector3,r.onMouseDown=function(e){if(e.preventDefault(),r.enabled){if(e.button===r.mouseButtons.ORBIT){if(!r.enableRotate)return;r.rotateStart.set(e.clientX,e.clientY),r.state=oa.ROTATE}else if(e.button===r.mouseButtons.ZOOM){if(!r.enableZoom)return;r.dollyStart.set(e.clientX,e.clientY),r.state=oa.DOLLY}else if(e.button===r.mouseButtons.PAN){if(!r.enablePan)return;r.panStart.set(e.clientX,e.clientY),r.state=oa.PAN}r.state!==oa.NONE&&(document.addEventListener("mousemove",r.onMouseMove,!1),document.addEventListener("mouseup",r.onMouseUp,!1),r.dispatchEvent(sa))}},r.onMouseMove=function(e){if(e.preventDefault(),r.enabled)if(r.state===oa.ROTATE){if(!r.enableRotate)return;r.rotateEnd.set(e.clientX,e.clientY),r.rotateDelta.subVectors(r.rotateEnd,r.rotateStart),r.rotateLeft(2*Math.PI*r.rotateDelta.x/r.element.clientWidth*r.rotateSpeed),r.rotateUp(2*Math.PI*r.rotateDelta.y/r.element.clientHeight*r.rotateSpeed),r.rotateStart.copy(r.rotateEnd),r.update()}else if(r.state===oa.DOLLY){if(!r.enableZoom)return;r.dollyEnd.set(e.clientX,e.clientY),r.dollyDelta.subVectors(r.dollyEnd,r.dollyStart),r.dollyDelta.y>0?r.dollyIn(r.getZoomScale()):r.dollyDelta.y<0&&r.dollyOut(r.getZoomScale()),r.dollyStart.copy(r.dollyEnd),r.update()}else if(r.state===oa.PAN){if(!r.enablePan)return;r.panEnd.set(e.clientX,e.clientY),r.panDelta.subVectors(r.panEnd,r.panStart),r.pan(r.panDelta.x,r.panDelta.y),r.panStart.copy(r.panEnd),r.update()}},r.onMouseUp=function(e){e.preventDefault(),r.enabled&&(document.removeEventListener("mousemove",r.onMouseMove,!1),document.removeEventListener("mouseup",r.onMouseUp,!1),r.dispatchEvent(ua),r.state=oa.NONE)},r.onMouseWheel=function(e){e.preventDefault(),r.enabled&&r.enableZoom&&(r.state===oa.NONE||r.state===oa.ROTATE)&&(e.stopPropagation(),e.deltaY<0?r.dollyOut(r.getZoomScale()):e.deltaY>0&&r.dollyIn(r.getZoomScale()),r.update(),r.dispatchEvent(sa),r.dispatchEvent(ua))},r.onTouchStart=function(e){if(e.preventDefault(),r.enabled){switch(e.touches.length){case 1:if(!r.enableRotate)return;r.rotateStart.set(e.touches[0].pageX,e.touches[0].pageY),r.state=oa.TOUCH_ROTATE;break;case 2:if(!r.enableZoom)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);r.dollyStart.set(0,a),r.state=oa.TOUCH_DOLLY;break;case 3:if(!r.enablePan)return;r.panStart.set(e.touches[0].pageX,e.touches[0].pageY),r.state=oa.TOUCH_PAN;break;default:r.state=oa.NONE}r.state!==oa.NONE&&r.dispatchEvent(sa)}},r.onTouchMove=function(e){if(e.preventDefault(),r.enabled)switch(e.touches.length){case 1:if(!r.enableRotate)return;if(r.state!==oa.TOUCH_ROTATE)return;r.rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY),r.rotateDelta.subVectors(r.rotateEnd,r.rotateStart),r.rotateLeft(2*Math.PI*r.rotateDelta.x/r.element.clientWidth*r.rotateSpeed),r.rotateUp(2*Math.PI*r.rotateDelta.y/r.element.clientHeight*r.rotateSpeed),r.rotateStart.copy(r.rotateEnd),r.update();break;case 2:if(!r.enableZoom)return;if(r.state!==oa.TOUCH_DOLLY)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);r.dollyEnd.set(0,a),r.dollyDelta.subVectors(r.dollyEnd,r.dollyStart),r.dollyDelta.y>0?r.dollyOut(r.getZoomScale()):r.dollyDelta.y<0&&r.dollyIn(r.getZoomScale()),r.dollyStart.copy(r.dollyEnd),r.update();break;case 3:if(!r.enablePan)return;if(r.state!==oa.TOUCH_PAN)return;r.panEnd.set(e.touches[0].pageX,e.touches[0].pageY),r.panDelta.subVectors(r.panEnd,r.panStart),r.pan(r.panDelta.x,r.panDelta.y),r.panStart.copy(r.panEnd),r.update();break;default:r.state=oa.NONE}},r.onTouchEnd=function(e){e.preventDefault(),r.enabled&&(r.dispatchEvent(ua),r.state=oa.NONE)},r.element.addEventListener("mousedown",r.onMouseDown,{capture:!0}),r.element.addEventListener("wheel",r.onMouseWheel,{capture:!0}),r.element.addEventListener("touchstart",r.onTouchStart,{capture:!0}),r.element.addEventListener("touchend",r.onTouchEnd,{capture:!0}),r.element.addEventListener("touchmove",r.onTouchMove,{capture:!0}),r.update(),r}return Object(p.a)(t,e),Object(l.a)(t,[{key:"update",value:function(){var e=this.object.position;return this.updateOffset.copy(e).sub(this.target),this.updateOffset.applyQuaternion(this.updateQuat),this.spherical.setFromVector3(this.updateOffset),this.autoRotate&&this.state===oa.NONE&&this.rotateLeft(this.getAutoRotationAngle()),this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi,this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),this.target.add(this.panOffset),this.updateOffset.setFromSpherical(this.spherical),this.updateOffset.applyQuaternion(this.updateQuatInverse),e.copy(this.target).add(this.updateOffset),this.object.lookAt(this.target),this.enableDamping?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor):this.sphericalDelta.set(0,0,0),this.scale=1,this.panOffset.set(0,0,0),!!(this.zoomChanged||this.updateLastPosition.distanceToSquared(this.object.position)>1e-6||8*(1-this.updateLastQuaternion.dot(this.object.quaternion))>1e-6)&&(this.dispatchEvent(ca),this.updateLastPosition.copy(this.object.position),this.updateLastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0)}},{key:"panLeft",value:function(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}},{key:"panUp",value:function(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}},{key:"pan",value:function(e,t){var n=this.element,r=this.object.position;this.panInternalOffset.copy(r).sub(this.target);var a=this.panInternalOffset.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*a/n.clientHeight,this.object.matrix),this.panUp(2*t*a/n.clientHeight,this.object.matrix)}},{key:"dollyIn",value:function(e){this.scale/=e}},{key:"dollyOut",value:function(e){this.scale*=e}},{key:"getAutoRotationAngle",value:function(){return 2*Math.PI/60/60*this.autoRotateSpeed}},{key:"getZoomScale",value:function(){return Math.pow(.95,this.zoomSpeed)}},{key:"rotateLeft",value:function(e){this.sphericalDelta.theta-=e}},{key:"rotateUp",value:function(e){this.sphericalDelta.phi-=e}},{key:"getPolarAngle",value:function(){return this.spherical.phi}},{key:"getAzimuthalAngle",value:function(){return this.spherical.theta}},{key:"dispose",value:function(){this.element.removeEventListener("mousedown",this.onMouseDown,!1),this.element.removeEventListener("wheel",this.onMouseWheel,!1),this.element.removeEventListener("touchstart",this.onTouchStart,!1),this.element.removeEventListener("touchend",this.onTouchEnd,!1),this.element.removeEventListener("touchmove",this.onTouchMove,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1)}},{key:"reset",value:function(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(ca),this.update(),this.state=oa.NONE}}]),t}(v.EventDispatcher);function ha(){var e=Object(o.useMemo)((function(){return function(){var e=new v.Geometry;return function(e,t,n,r){n.push.apply(n,Object(Ge.a)(ke.map((function(e){return new v.Vector3(e.x,e.y,e.z)})))),n.push(new v.Vector3);for(var a=0;a<Ne;a++){var i=t*(ke.length+1),o=(a+1)%Ne,c=[Ce,(new v.Vector3).add(Ce).addScaledVector(ke[a],Me).normalize(),(new v.Vector3).add(Ce).addScaledVector(ke[o],Me).normalize()];r.push(new v.Face3(i+Ne,i+a,i+o,c,je))}}(yt.SPOTS_KEY,0,e.vertices,e.faces),e.vertices.forEach((function(e){return e.sub(new v.Vector3(0,.01,0))})),e.computeBoundingSphere(),e}()}),[]);return o.createElement("mesh",{name:"Spots",geometry:e,material:jr})}Object(kt.b)({Orbit:la});var fa=new v.Color("#ffffff"),da=100,pa=1,ma=new v.SphereGeometry(da,25,25).scale(pa,pa,pa),ga=.01,va=4;function ba(e){var t=e.fabric,n=e.fabricError,r=e.selectedIntervals,a=e.selectedFaces,i=e.setSelectedFaces,c=e.storedState$,s=e.shapeSelection,u=e.ellipsoids,l=e.visibleRoles,h=document.getElementById("view-container"),f=Object(o.useState)(0),d=Object(Un.a)(f,2),p=d[0],m=d[1],g=Object(kt.d)().camera,b=Object(o.useMemo)((function(){var e=(new v.TextureLoader).load("space.jpg");return new v.MeshPhongMaterial({map:e,side:v.BackSide})}),[]),y=Object(o.useState)(t.life),x=Object(Un.a)(y,2),w=x[0],S=x[1];Object(o.useEffect)((function(){var e=t.life$.subscribe(S);return function(){return e.unsubscribe()}}),[t]);var E=Object(o.useState)(c.getValue()),k=Object(Un.a)(E,2),O=k[0],j=k[1];Object(o.useEffect)((function(){var e=c.subscribe((function(e){return j(e)}));return function(){return e.unsubscribe()}}),[]),Object(o.useEffect)((function(){P.current.autoRotate=O.rotating}),[O]);var P=Object(kt.e)((function(e){var t=new v.Vector3(0,va,0);g.position.set(t.x,va,t.z+4*va),g.lookAt(P.current.target),g.fov=60,g.far=2*da,g.near=.001,e.object=g,e.minPolarAngle=-.98*Math.PI/2,e.maxPolarAngle=.8*Math.PI,e.maxDistance=da*pa*.9,e.zoomSpeed=.5,e.enableZoom=!0,e.target.set(t.x,t.y,t.z),e.update()}),[]);return Object(kt.c)((function(){try{var e=t.instance,r=e.getMidpoint(),a=(new v.Vector3).subVectors(r,P.current.target).multiplyScalar(ga);if(P.current.target.add(a),P.current.update(),!u&&s!==vr.Faces){var i=t.iterate();w.stage===T.Realizing&&i===T.Realized?setTimeout((function(){return t.toStage(T.Realized,{})})):i!==w.stage&&w.stage!==T.Realizing&&i!==T.Busy&&setTimeout((function(){return t.toStage(i,{})}))}e.engine.renderNumbers(),t.needsUpdate(),m(e.engine.getAge())}catch(o){n(o)}}),!0,[t,t,p,w,s,u]),o.createElement("group",null,o.createElement("orbit",{ref:P,args:[g,h]}),o.createElement("scene",null,u?o.createElement(wa,{key:"ellipsoid",fabric:t,selectedIntervals:r,storedState:O,visibleRoles:l}):o.createElement(Sa,{key:"lines",fabric:t,selectedIntervals:r,storedState:O}),s!==vr.Faces?void 0:o.createElement(Ea,{key:"faces",fabric:t,stage:w.stage,selectFace:function(e){a.some((function(t){return t.index===e.index}))?i(a.filter((function(t){return t.index!==e.index}))):i([].concat(Object(Ge.a)(a),[e]))}}),a.map((function(e){return o.createElement(ya,{key:"Face".concat(e.index),fabric:t,face:e})})),w.stage<=T.Slack?void 0:o.createElement(ha,null),o.createElement("mesh",{key:"space",geometry:ma,material:b}),o.createElement("ambientLight",{color:fa,intensity:.8}),o.createElement("directionalLight",{color:new v.Color("#FFFFFF"),intensity:2})))}function ya(e){var t=e.fabric,n=e.face,r=rn(n.brick.scale)/8;return o.createElement("mesh",{geometry:dr,position:t.instance.faceMidpoint(n.index),material:Mr,scale:new v.Vector3(r,r,r)})}function xa(e){var t=e.fabric,n=e.interval,r=e.storedState,a=Tr(n.intervalRole);if((r.showPushes||r.showPulls)&&(a=function(e){var t=Math.floor(e*Vr.length);return Vr[t>=Vr.length?Vr.length-1:t]}(t.instance.strainNuances[n.index]),(!r.showPushes||!r.showPulls)&&(r.showPushes&&!n.isPush||r.showPulls&&n.isPush)))return o.createElement("group",null);var i=t.instance.linearDensities[n.index],c=r.featureValues[n.isPush?L.PushRadiusFactor:L.PullRadiusFactor],s=r.featureValues[L.VisualStrain],u=t.orientInterval(n,c.numeric*i,s.numeric),l=u.scale,h=u.rotation;return o.createElement("mesh",{geometry:dr,position:t.instance.getIntervalMidpoint(n.index),rotation:(new v.Euler).setFromQuaternion(h),scale:l,material:a,matrixWorldNeedsUpdate:!0})}function wa(e){var t=e.fabric,n=e.visibleRoles,r=e.selectedIntervals,a=e.storedState;return o.createElement("group",null,r.length>0?r.map((function(e){return o.createElement(xa,{key:"SI".concat(e.index),fabric:t,interval:e,storedState:a})})):t.intervals.map((function(e){return n.indexOf(e.intervalRole)<0?void 0:o.createElement(xa,{key:"I".concat(e.index),fabric:t,interval:e,storedState:a})})),"}")}function Sa(e){var t=e.fabric,n=e.selectedIntervals,r=e.storedState;return o.createElement("group",null,o.createElement("lineSegments",{key:"lines",geometry:t.linesGeometry,material:Pr}),n.map((function(e){return o.createElement(xa,{key:"SI".concat(e.index),fabric:t,interval:e,storedState:r})})))}function Ea(e){var t=e.fabric,n=e.stage,r=e.selectFace,a=Object(kt.d)().raycaster,i=Object(o.useRef)(),c=Object(o.useState)(),s=Object(Un.a)(c,2),u=s[0],l=s[1];return o.createElement("mesh",{key:"faces",ref:i,onPointerDown:function(e){return l(e)},onPointerUp:function(e){var o=i.current;if(!function(e){return e===T.Growing||e===T.Slack}(n)&&u&&o){var c=u.clientX-e.clientX,s=u.clientY-e.clientY;if(!(c*c+s*s>100)){var h=a.intersectObjects([o],!0).map((function(e){return e.faceIndex})).map((function(e){if(void 0!==e)return t.faces[e]})).reverse().pop();l(void 0),h&&r(h)}}},geometry:t.facesGeometry,material:Cr})}var ka="25em",Oa="26em";function ja(e){var t=function(){var e=location.hash.substring(1);try{return pn((function(e){return console.error(e)}),!0,decodeURIComponent(e))}catch(t){console.error("Code error",t)}}();if(t)return t;var n=En(e);return n.length>0?n[0]:bn[0]}function Pa(e){var t=e.fabricKernel,n=e.floatFeatures,r=e.storedState$,a=Object(o.useMemo)((function(){return t.allocateInstance()}),[]),i=Object(o.useMemo)((function(){return t.allocateInstance()}),[]),c=Object(o.useState)(!0),s=Object(Un.a)(c,2),u=s[0],l=s[1],h=Object(o.useState)(),f=Object(Un.a)(h,2),d=f[0],p=f[1],m=Object(o.useState)([]),g=Object(Un.a)(m,2),v=g[0],b=g[1],y=Object(o.useState)([]),x=Object(Un.a)(y,2),w=x[0],S=x[1];Object(o.useEffect)((function(){return b(w.reduce((function(e,t){var n=function(t){return!e.some((function(e){return t.index===e.index}))},r=t.pulls.filter(n),a=t.pushes.filter(n);return[].concat(Object(Ge.a)(e),Object(Ge.a)(a),Object(Ge.a)(r))}),[]))}),[w]);var E=Object(o.useState)((function(){return ja(r.getValue())})),k=Object(Un.a)(E,2),O=k[0],j=k[1];Object(o.useEffect)((function(){0===location.hash.length&&(location.hash=gn(O.code,O.name))}),[O]);var P=Object(o.useState)(Y),N=Object(Un.a)(P,2),C=N[0],M=N[1],V=Object(o.useState)(r.getValue().rotating),F=Object(Un.a)(V,2),T=F[0],R=F[1],A=Object(o.useState)(vr.None),H=Object(Un.a)(A,2),I=H[0],z=H[1],G=Object(o.useState)(r.getValue().fullScreen),B=Object(Un.a)(G,2),_=B[0],J=B[1],Z=Object(o.useState)(r.getValue().ellipsoids),W=Object(Un.a)(Z,2),X=W[0],$=W[1];function Q(e){if(a&&i){location.hash=gn(e.code,e.name),a.engine.initInstance(),a.forgetDimensions(),n[L.ShapingPretenstFactor].percent=100,n[L.ShapingDrag].percent=100,n[L.ShapingStiffnessFactor].percent=100,r.next(kn(r.getValue(),{ellipsoids:!1})),Object.keys(n).map((function(e){return n[e]})).forEach((function(e){return a.applyFeature(e)}));p(new br((function(e){return function(e,t){if(t===D.FacePull)throw new Error;return e[L[L[t+L.NexusPushLength]]].numeric}(n,e)}),(function(e){return r.getValue().featureValues[e].numeric}),a,i,e))}}function q(e){r.next(kn(r.getValue(),{fullScreen:e}))}return Object(o.useEffect)((function(){return M(Y)}),[X]),Object(o.useEffect)((function(){var e=r.subscribe((function(e){if(J(e.fullScreen),$(e.ellipsoids),R(e.rotating),d){var t=d.instance.engine;t.setColoring(e.showPushes,e.showPulls),t.setSurfaceCharacter(e.surfaceCharacter)}}));return function(){return e.unsubscribe()}}),[d]),Object(o.useEffect)((function(){var e=Object.keys(n).map((function(e){return n[e]})).map((function(e){return e.observable.subscribe((function(t){if(d){d.instance.applyFeature(e);var n=U(e.config.feature);if(void 0!==n){var r=d.instance.engine;d.intervals.filter((function(e){return e.intervalRole===n})).forEach((function(t){var n=e.numeric*rn(t.scale);r.changeRestLength(t.index,n,500)}))}}}))}));return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[d]),Object(o.useEffect)((function(){var e=setTimeout((function(){d||Q(O)}),200);return function(){return clearTimeout(e)}}),[O]),u?o.createElement(or,{cancel:function(){return l(!1)}}):o.createElement(o.Fragment,null,_?o.createElement(ae.a,{id:"to-full-screen",color:"dark",onClick:function(){return q(!1)}},o.createElement(Zn.d,null),o.createElement("br",null),o.createElement(Zn.R,null),o.createElement("br",null),o.createElement(Zn.d,null)):o.createElement("div",{id:"left-side",style:{visibility:_?"collapse":"visible",width:ka}},o.createElement(aa,{floatFeatures:n,rootTenscript:O,setRootTenscript:j,fabric:d,setFabric:p,selectedIntervals:v,shapeSelection:I,setShapeSelection:z,selectedFaces:w,clearSelectedFaces:function(){return S([])},runTenscript:Q,toFullScreen:function(){return q(!0)},visibleRoles:C,setVisibleRoles:M,storedState$:r})),o.createElement("div",{style:{position:"absolute",left:_?0:Oa,right:0,height:"100%"}},d?o.createElement("div",{className:"h-100"},o.createElement(Na,{fabric:d}),o.createElement("div",{id:"top-right"},o.createElement(ae.a,{color:"info",onClick:function(){return l(!0)}},o.createElement(Zn.E,null)," About")),o.createElement("div",{id:"bottom-middle"},o.createElement(Wn.a,null,o.createElement(ae.a,{color:X?"warning":"secondary",onClick:function(){return r.next(kn(r.getValue(),{ellipsoids:!X}))}},o.createElement(Zn.j,null)),o.createElement(ae.a,{color:I===vr.Faces?"warning":"secondary",disabled:X&&I===vr.None,onClick:function(){return z(I!==vr.Faces?vr.Faces:vr.None)}},o.createElement("span",null,o.createElement(Zn.z,null))),o.createElement(ae.a,{color:T?"warning":"secondary",onClick:function(){return r.next(kn(r.getValue(),{rotating:!T}))}},o.createElement(Zn.P,null)))),o.createElement("div",{id:"view-container",className:"h-100"},o.createElement(kt.a,{style:{backgroundColor:"black",borderStyle:"solid",borderColor:I===vr.Faces||X?"#f0ad4e":"black",cursor:I===vr.Faces?"pointer":"all-scroll",borderWidth:"2px"}},o.createElement(ba,{fabric:d,fabricError:function(e){console.error(e);var t=d.tenscript;p(void 0),setTimeout((function(){return Q(t)}),1e3)},selectedIntervals:v,selectedFaces:w,setSelectedFaces:S,shapeSelection:I,ellipsoids:X,visibleRoles:C,storedState$:r})))):o.createElement("div",{id:"tensegrity-view",className:"h-100"},o.createElement("div",{style:{position:"relative",top:"50%",left:"50%"}},o.createElement(ae.a,{onClick:function(){return Q(O)}},o.createElement("h6",null,O.name),o.createElement("h1",null,o.createElement(Zn.J,null)))))))}function Na(e){var t=e.fabric,n=Object(o.useState)(t.life),r=Object(Un.a)(n,2),a=r[0],i=r[1];return Object(o.useEffect)((function(){var e=t.life$.subscribe(i);return function(){return e.unsubscribe()}}),[t]),o.createElement("div",{id:"top-middle"},o.createElement("span",null,T[a.stage])," ",o.createElement("i",null,'"',t.tenscript.name,'"'))}n(634),n(635);var Ca=!0;function Ma(){return(Ma=Object(i.a)(a.a.mark((function e(){var t,n,r,i,u,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,getFabricEngine();case 2:if(t=e.sent,n=new re(t),r=document.getElementById("root"),(i=new s.BehaviorSubject(jn(An))).subscribe((function(e){return t=e,void localStorage.setItem(On,JSON.stringify(t));var t})),!Ca){e.next=12;break}console.log("Starting Pretenst.."),c.render(o.createElement(Pa,{fabricKernel:n,floatFeatures:Hn(i),storedState$:i}),r),e.next=19;break;case 12:return console.log("Starting Galapagotchi.."),console.log("Using API at ".concat(b)),u=new Jn(b),e.next=17,u.getUser();case 17:l=e.sent,c.render(o.createElement(Wt,{engine:t,floatFeatures:[],storage:u,user:l}),r);case 19:zn();case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){Ma.apply(this,arguments)}()}},[[264,1,2]]]);
//# sourceMappingURL=main.23042bba.chunk.js.map