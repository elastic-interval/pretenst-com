(window.webpackJsonppretenst=window.webpackJsonppretenst||[]).push([[4],{567:function(e,t){},569:function(e,t){},8:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(1),c=n(10),o=n(80),s=n(81),l=n(74),u=n(32),f=n(33),d=n(7);var h=Object.keys(d.FabricFeature).filter((function(e){return isNaN(parseInt(e,10))})).map((function(e){return d.FabricFeature[e]}));function m(e){switch(e){case d.IntervalRole.NexusPush:return"NP";case d.IntervalRole.ColumnPush:return"CP";case d.IntervalRole.Triangle:return"TR";case d.IntervalRole.Ring:return"RI";case d.IntervalRole.NexusCross:return"NC";case d.IntervalRole.ColumnCross:return"CC";case d.IntervalRole.BowMid:return"BM";case d.IntervalRole.BowEnd:return"BE";case d.IntervalRole.FaceConnector:return"FC";case d.IntervalRole.FaceDistancer:return"FD";default:return"?"}}var p=Object.keys(d.IntervalRole).filter((function(e){return d.IntervalRole[e]!==d.IntervalRole.FaceConnector&&d.IntervalRole[e]!==d.IntervalRole.FaceDistancer})).map((function(e){return d.IntervalRole[e]}));function v(e){return e===d.IntervalRole.ColumnPush||e===d.IntervalRole.NexusPush}function g(e){switch(e){case d.FabricFeature.NexusPushLength:return d.IntervalRole.NexusPush;case d.FabricFeature.ColumnPushLength:return d.IntervalRole.ColumnPush;case d.FabricFeature.TriangleLength:return d.IntervalRole.Triangle;case d.FabricFeature.RingLength:return d.IntervalRole.Ring;case d.FabricFeature.NexusCrossLength:return d.IntervalRole.NexusCross;case d.FabricFeature.ColumnCrossLength:return d.IntervalRole.ColumnCross;case d.FabricFeature.BowMidLength:return d.IntervalRole.BowMid;case d.FabricFeature.BowEndLength:return d.IntervalRole.BowEnd;default:return}}var b,E,y,w=n(34),S=n(544),F=n(27),P=1.61803398875,O=Math.sqrt(2);!function(e){e[e.XP=0]="XP",e[e.XN=1]="XN",e[e.YP=2]="YP",e[e.YN=3]="YN",e[e.ZP=4]="ZP",e[e.ZN=5]="ZN"}(b||(b={})),function(e){e[e.XPA=0]="XPA",e[e.XPO=1]="XPO",e[e.XNA=2]="XNA",e[e.XNO=3]="XNO",e[e.YPA=4]="YPA",e[e.YPO=5]="YPO",e[e.YNA=6]="YNA",e[e.YNO=7]="YNO",e[e.ZPA=8]="ZPA",e[e.ZPO=9]="ZPO",e[e.ZNA=10]="ZNA",e[e.ZNO=11]="ZNO"}(E||(E={})),function(e){e[e.NNN=0]="NNN",e[e.PNN=1]="PNN",e[e.NPN=2]="NPN",e[e.NNP=3]="NNP",e[e.NPP=4]="NPP",e[e.PNP=5]="PNP",e[e.PPN=6]="PPN",e[e.PPP=7]="PPP"}(y||(y={}));var k,N=[y.NNN,y.PNN,y.NPN,y.NNP,y.NPP,y.PNP,y.PPN,y.PPP],j="aBCDbcdA";function x(e,t){if(e.alpha.index===t.index)return e.omega;if(e.omega.index===t.index)return e.alpha;throw new Error("Other of what?")}function C(e,t){var n=t.filter((function(t){return t.alpha.index===e.index||t.omega.index===e.index})),r=n.find((function(e){return e.isPush}));if(!r)throw new Error("No push on joint");var a=function(t){return(new F.Vector3).subVectors(x(t,e).location(),e.location()).normalize()},i=a(r);n.sort((function(e,t){var n=a(e).dot(i),r=a(t).dot(i);return n<r?1:n>r?-1:0})),n.shift();var c=a(n[0]),o=(new F.Vector3).addScaledVector(i,c.dot(i)),s=(new F.Vector3).subVectors(c,o).normalize(),l=(new F.Quaternion).setFromUnitVectors(i,s),u=(new F.Vector3).crossVectors(i,s);return n.map((function(t){var n=a(t),r=(new F.Vector3).addScaledVector(i,n.dot(i)),c=(new F.Vector3).subVectors(n,r).normalize(),o=(new F.Vector3).crossVectors(i,n),s=(new F.Quaternion).setFromUnitVectors(i,c),f=180*Math.acos(i.dot(n))/Math.PI,d=l.angleTo(s)*(u.dot(o)>0?180:-180)/Math.PI;return{interval:t.index,role:m(t.intervalRole),joint:x(t,e).index,separation:f,rotation:d}}))}function V(e){var t=new F.Vector3;switch(e){case b.XP:return t.setX(1);case b.XN:return t.setX(-1);case b.YP:return t.setY(1);case b.YN:return t.setY(-1);case b.ZP:return t.setZ(1);case b.ZN:return t.setZ(-1);default:return t}}function R(e,t){return V(e).multiplyScalar(O/2).addScaledVector(V(t),O/2/P)}!function(e){e[e.NN=0]="NN",e[e.PN=1]="PN",e[e.NP=2]="NP",e[e.PP=3]="PP"}(k||(k={}));var I=[{alpha:R(b.ZN,b.XP),omega:R(b.ZP,b.XP)},{alpha:R(b.ZN,b.XN),omega:R(b.ZP,b.XN)},{alpha:R(b.XN,b.YP),omega:R(b.XP,b.YP)},{alpha:R(b.XN,b.YN),omega:R(b.XP,b.YN)},{alpha:R(b.YN,b.ZP),omega:R(b.YP,b.ZP)},{alpha:R(b.YN,b.ZN),omega:R(b.YP,b.ZN)}],M=[{name:y.NNN,opposite:y.PPP,negative:!0,ring:k.NN,pushEnds:[E.YNA,E.XNA,E.ZNA],ringMember:[k.NP,k.PN,k.PP]},{name:y.PNN,opposite:y.NPP,negative:!1,ring:k.PP,pushEnds:[E.XNA,E.YPA,E.ZNO],ringMember:[k.PN,k.NN,k.NP]},{name:y.NPN,opposite:y.PNP,negative:!1,ring:k.PN,pushEnds:[E.XNO,E.YNA,E.ZPA],ringMember:[k.PP,k.NP,k.NN]},{name:y.NNP,opposite:y.PPN,negative:!1,ring:k.NP,pushEnds:[E.XPA,E.YNO,E.ZNA],ringMember:[k.NN,k.PN,k.PP]},{name:y.NPP,opposite:y.PNN,negative:!0,ring:k.PP,pushEnds:[E.YNO,E.XPO,E.ZPA],ringMember:[k.PN,k.NP,k.NN]},{name:y.PNP,opposite:y.NPN,negative:!0,ring:k.PN,pushEnds:[E.YPO,E.XPA,E.ZNO],ringMember:[k.PP,k.NN,k.NP]},{name:y.PPN,opposite:y.NNP,negative:!0,ring:k.NP,pushEnds:[E.YPA,E.XNO,E.ZPO],ringMember:[k.NN,k.PP,k.PN]},{name:y.PPP,opposite:y.NNN,negative:!1,ring:k.NN,pushEnds:[E.XPO,E.YPO,E.ZPO],ringMember:[k.NP,k.PP,k.PN]}];function T(e){return M[e].opposite}function A(e){return e||{_:100}}function _(e){return e._/100}function D(e){return{_:100*e}}function L(e,t,n){var r=!!t.joints.find((function(t){return t.index===e.index})),a=!!n.joints.find((function(t){return t.index===e.index}));if(r&&!a)return t;if(a&&!r)return n;throw new Error("Neither contained joint")}function z(e,t,n){var r=I.reduce((function(e,t){return e.push((new F.Vector3).add(t.alpha)),e.push((new F.Vector3).add(t.omega)),e}),[]),a=T(e),i=M[a].pushEnds.map((function(e){return r[e]})).reverse(),c=i.reduce((function(e,t){return e.add(t)}),new F.Vector3).multiplyScalar(1/3),o=(new F.Vector3).subVectors(i[0],c).normalize(),s=(new F.Vector3).sub(c).normalize(),l=(new F.Vector3).crossVectors(s,o).normalize(),u=(new F.Matrix4).makeBasis(o,s,l),f=_(t),d=(new F.Matrix4).getInverse(u).setPosition(n).scale(new F.Vector3(f,f,f));return r.map((function(e){return e.applyMatrix4(d)}))}function B(e){return.6*e}var Z=function(){function e(t){Object(u.a)(this,e),this.tensegrity=t}return Object(f.a)(e,[{key:"createBrickAt",value:function(e,t){var n=z(y.PPP,t,e);return this.createBrick(n,y.NNN,t)}},{key:"createConnectedBrick",value:function(e,t,n){var r=function(){return e.negativeAdjacent>1&&e.postiveAdjacent>1},a=r(),i=e.faces[t],c=_(e.scale),o=c*_(n),s=this.createBrickOnFace(i,D(o)),l=s.faces[s.base],u=this.tensegrity.numericFeature(d.FabricFeature.IntervalCountdown);return this.connectFaces(i,l,D((c+o)/2),u),a!==r()&&this.brickToOrigin(e),s}},{key:"checkFaceIntervals",value:function(e,t){var n=this;if(0===e.length)return e;return e.filter((function(e){if(e.connector){var r=e.alpha,a=e.omega,i=e.scaleFactor;if(r.location().distanceTo(a.location())<=10*B(i))return function(e){var t=e.alpha,r=e.omega,a=e.scaleFactor,i=n.tensegrity.numericFeature(d.FabricFeature.IntervalCountdown);n.connectFaces(t,r,D(a),i)}(e),t(e),!1}return!0}))}},{key:"faceToOrigin",value:function(e){var t=this.tensegrity.instance;t.apply(function(e){var t=e.joints.map((function(e){return e.location()})),n=t.reduce((function(e,t){return e.add(t)}),new F.Vector3).multiplyScalar(1/3),r=(new F.Vector3).subVectors(t[1],n).normalize(),a=(new F.Vector3).subVectors(t[0],n).normalize(),i=(new F.Vector3).crossVectors(a,r).normalize();a.crossVectors(r,i).normalize();var c=(new F.Matrix4).makeBasis(r,i,a).setPosition(n);return(new F.Matrix4).getInverse(c)}(e)),t.refreshFloatView()}},{key:"brickToOrigin",value:function(e){var t=this.tensegrity.instance;t.apply(function(e,t){var n=t(e.pushes[2].index),r=t(e.pushes[0].index),a=t(e.pushes[4].index),i=e.joints.reduce((function(e,t){return e.add(t.location())}),new F.Vector3(0,10,0)).multiplyScalar(1/12),c=(new F.Matrix4).makeBasis(n,r,a).setPosition(i),o=(new F.Matrix4).makeRotationZ(Math.PI/4);return(new F.Matrix4).getInverse(c.multiply(o))}(e,(function(e){return t.unitVector(e)}))),t.refreshFloatView()}},{key:"createFaceIntervals",value:function(e,t){var n=this,r=function(){var t,r=n.createBrickAt((t=e.map((function(e){return e.location()}))).reduce((function(e,t){return e.add(t)}),new F.Vector3).multiplyScalar(1/t.length),D(function(e){return e.reduce((function(e,t){return e+_(t.brick.scale)}),0)/e.length}(e)));return e.map((function(e){var t=r.faces.filter((function(t){var n=t.negative;return!t.removed&&n!==e.negative})).reduce((function(t,n){return t.location().distanceTo(e.location())<n.location().distanceTo(e.location())?t:n}));return t.removed=!0,n.tensegrity.createFaceConnector(t,e)}))};switch(t.action){case U.JoinFaces:switch(e.length){case 2:return e[0].negative===e[1].negative?r():[this.tensegrity.createFaceConnector(e[0],e[1])];case 3:return r();default:return[]}case U.FaceDistance:var a=t.scale;if(!a)throw new Error("Missing pull scale");var i=[];return e.forEach((function(t,r){e.forEach((function(e,c){r<=c||i.push(n.tensegrity.createFaceDistancer(t,e,a))}))})),i;default:return[]}}},{key:"createBrickOnFace",value:function(e,t){var n=M[e.triangle].negative,r=e.brick,a=e.triangle,i=r.faces[a].joints.map((function(e){return e.location()})),c=i.reduce((function(e,t){return e.add(t)}),new F.Vector3).multiplyScalar(1/3),o=(new F.Vector3).addVectors(i[0],i[1]).multiplyScalar(.5),s=(new F.Vector3).subVectors(o,c).normalize(),l=(new F.Vector3).subVectors(i[1],c).normalize(),u=(new F.Vector3).add(s).multiplyScalar(s.dot(l)),f=l.sub(u).normalize(),d=(new F.Vector3).crossVectors(f,s).normalize().multiplyScalar(.2),h=(new F.Matrix4).makeBasis(s,d,f).setPosition(c),m=z(n?y.NNN:y.PPP,t,new F.Vector3(0,0,0)).map((function(e){return e.applyMatrix4(h)})),p=n?y.PPP:y.NNN;return this.createBrick(m,p,t)}},{key:"createBrick",value:function(e,t,n){var r,a=this,i=this.tensegrity.numericFeature(d.FabricFeature.IntervalCountdown),c=function(e,t,n){return{index:e,base:t,scale:n,joints:[],pushes:[],pulls:[],crosses:[],rings:[[],[],[],[]],faces:[],negativeAdjacent:0,postiveAdjacent:0}}(this.tensegrity.bricks.length,t,n);this.tensegrity.bricks.push(c);var o=e.map((function(e,t){return a.tensegrity.createLeftJoint(e)}));this.tensegrity.instance.refreshFloatView(),I.forEach((function(e,t){Object(S.a)(e);var r=o[2*t],s=o[2*t+1],l={index:r,oppositeIndex:s,location:function(){return a.tensegrity.instance.jointLocation(r)}},u={index:s,oppositeIndex:r,location:function(){return a.tensegrity.instance.jointLocation(s)}};c.pushes.push(a.tensegrity.createInterval(l,u,d.IntervalRole.NexusPush,n,i))})),c.pushes.forEach((function(e){return c.joints.push(e.alpha,e.omega)}));var s=c.pushes.reduce((function(e,t){return e.push(t.alpha,t.omega),e}),[]);return(r=this.tensegrity.joints).push.apply(r,Object(w.a)(s)),M.forEach((function(e){for(var t=e.pushEnds.map((function(e){return s[e]})),r=0;r<3;r++){var o=t[r],l=t[(r+1)%3],u=a.tensegrity.createInterval(o,l,d.IntervalRole.Triangle,n,i);c.pulls.push(u),c.rings[e.ringMember[r]].push(u)}})),M.forEach((function(e){var t=a.tensegrity.createFace(c,e.name);c.faces.push(t)})),this.tensegrity.instance.refreshFloatView(),c}},{key:"facesToRing",value:function(e,t){if(e.negative===t.negative)throw new Error("Polarity not opposite");var n=(new F.Vector3).subVectors(e.joints[0].location(),e.location()).normalize(),r=t.joints.map((function(e,r){return[(new F.Vector3).subVectors(e.location(),t.location()).normalize().dot(n),r]})).sort((function(e,t){return t[0]-e[0]})).pop();if(!r)throw new Error("No opposite joint");var a=[[1,0,2],[2,1,0],[0,2,1]][r[1]];return[e.joints[0],t.joints[a[0]],e.joints[1],t.joints[a[1]],e.joints[2],t.joints[a[2]]]}},{key:"connectFaces",value:function(e,t,n,r){var a=this;if(e.negative===t.negative)throw new Error("Same polarity!");[e,t].forEach((function(e){a.tensegrity.removeFace(e,!0),e.negative?e.brick.postiveAdjacent++:e.brick.negativeAdjacent++}));for(var i=this.facesToRing(e,t),c=function(e,t,i){return a.tensegrity.createInterval(e,t,i,n,r)},o=0;o<i.length;o++){var s=i[(o+5)%6],l=i[o],u=i[(o+1)%6];c(l,u,d.IntervalRole.Ring);var f=function(n,r){var i=a.tensegrity.joints[r.oppositeIndex];L(i,e.brick,t.brick).crosses.push(c(n,i,d.IntervalRole.ColumnCross))};e.negative?f(s,l):f(u,l)}[e,t].forEach((function(e){var t=e.triangle,n=e.brick,i=function(e,t){return e.filter((function(e){return!e.removed&&e.intervalRole!==t})).forEach((function(e){return a.tensegrity.changeIntervalRole(e,t,n.scale,r)}))};!function(e){return e.negativeAdjacent>1||e.postiveAdjacent>1}(n)?(i(n.rings[M[t].ring],d.IntervalRole.Ring),i(n.crosses,d.IntervalRole.ColumnCross),i(n.pushes,d.IntervalRole.ColumnPush)):(i(n.pulls,d.IntervalRole.Triangle),i(n.crosses,d.IntervalRole.NexusCross),i(n.pushes,d.IntervalRole.NexusPush))})),this.tensegrity.instance.refreshFloatView()}}]),e}();function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var U;function $(e){return JSON.stringify(e).replace(/[_.:"]/g,"").replace(/[{]/g,"(").replace(/[}]/g,")").replace(/([ABCDabcdSM])\((\d*)\)/g,(function(e){return"".concat(arguments.length<=1?void 0:arguments[1]).concat(arguments.length<=2?void 0:arguments[2])}))}function G(e){return j.indexOf(e)>=0}function W(e,t){return t["M".concat(j[e])]}function J(e){return"0123456789".indexOf(e)>=0}function Q(e){if(!e.match(/^\d+$/))throw new Error("Not a number: ".concat(e));return parseInt(e,10)}function H(e,t){var n=e.indexOf(","),r=n>=0;if("("!==e.charAt(0))return r?{content:e.substring(0,n),skip:n}:{content:e,skip:e.length};var a=function(e){if("("!==e.charAt(0))throw new Error('Code must start with "(": '.concat(e," ").concat(e.charAt(0)));for(var t=0,n=0;n<e.length;n++){var r=e.charAt(n);if("("===r)t++;else if(")"===r&&0===--t)return n}throw new Error("No matching end bracket: |".concat(e,"|"))}(e);return{content:t?e.substring(1,a):e.substring(0,a+1),skip:a+1}}function q(e,t,n){function r(e){var t=H(e,!0).content,n={};function a(e){var n=H(t.substring(e),!1),a=n.content,i=n.skip;return{codeTree:r(a),skip:i}}for(var i=0;i<t.length;i++){var c=t.charAt(i);if(G(c)){var o=a(i+1);if(!o.codeTree)throw new Error("No subtree: ".concat(t.substring(i)));n[c]=o.codeTree,i+=o.skip}else if(J(c)){var s=H(t,!1);n._=Q(s.content),i+=s.skip}else switch(c){case"S":var l=H(t.substring(i+1),!0);n.S={_:Q(l.content)},i+=l.skip;break;case"M":var u=t.charAt(i+1),f=H(t.substring(i+2),!0);n["M".concat(u)]={_:Q(f.content)},i+=f.skip+1;break;case",":case" ":break;default:throw new Error("Unexpected character: ".concat(c))}}return 0===Object.keys(n).length?void 0:n}try{if(!n||0===n.length)return void e("No code to parse");var a=function(e){var t=e.replace(/[\n\r\t]/g,"").split(":"),n=t.find((function(e){return e.startsWith("'")&&e.endsWith("'")})),r=t.find((function(e){return e.startsWith("(")&&e.endsWith(")")})),a={};return t.filter((function(e){return e.match(/^\d+=.*$/)})).forEach((function(e){var t=e.indexOf("="),n=Number(e.substring(0,t));a[n]=e.substring(t+1)})),{name:n?n.replace(/'/g,""):(new Date).toDateString(),mainCode:r||"(0)",markCode:a}}(n),i=a.name,c=a.mainCode,o=a.markCode,s=r(c);if(!s)return;var l={};return Object.keys(o).forEach((function(e){var t=o[e];if(t.startsWith("subtree")){var n=r(t.substring("subtree".length));l[e]={action:U.Subtree,tree:n}}else if(t.startsWith("base-face"))l[e]={action:U.BaseFace};else if(t.startsWith("join-faces"))l[e]={action:U.JoinFaces};else{if(!t.startsWith("face-distance-"))throw new Error("Unrecognized mark code: [".concat(t,"]"));var a={_:parseInt(t.split("-")[2],10)};l[e]={action:U.FaceDistance,scale:a}}})),function(e,t,n,r){var a=$(t),i=[];Object.keys(n).forEach((function(e){var t=n[e];switch(t.action){case U.Subtree:var r=t.tree;if(!r)throw new Error("Missing tree");i.push("".concat(e,"=").concat($(r)));break;case U.BaseFace:case U.JoinFaces:break;case U.FaceDistance:var a=t.scale;if(!a)throw new Error("Missing scale");i.push("".concat(e,"=face-distance-").concat(a._))}}));var c=i.length>0?":".concat(i.join(":")):"";return{name:e,tree:t,marks:n,code:"'".concat(e,"':").concat(a).concat(c),fromUrl:r}}(i,s,l,t)}catch(u){return void e(u.message)}}function K(e){throw new Error("Unable to parse: ".concat(e))}!function(e){e[e.Subtree=0]="Subtree",e[e.BaseFace=1]="BaseFace",e[e.JoinFaces=2]="JoinFaces",e[e.FaceDistance=3]="FaceDistance"}(U||(U={}));var ee,te=["'Zen':(0)","'One':(1)","'Six':(6)","'Axoneme':(16,S90)","'Knee':(b1,a1)","'Leg':(b3,a3)","'Nexus':(a1,b1,c1,d1)","'Tripod with Knees':(A2,B(3,b(2,S90),S80),C(3,c(2,S90),S80),D(3,d(2,S90),S80))","'Bulge Ring':(A(8, S85, MA1), a(8, S85, MA1))","'Convergence Three':(a1,b(3,S85,MA1),c(3,S85,MA1),d(3,S85,MA1))","'Convergence Ten':(a1,b(10,S85,MA1),c(10,S85,MA1),d(10,S85,MA1))","'Halo by Crane':(B(7,S80,MA1),C(2,S120,MA0),D(7,S80,MA1))","'Pretenst Lander':(B(5,S75),C(5,S75),D(5,S75))","'Zig Zag Loop':(a(1,MA0),c(3,b(3,d(3,c(3,b(3,d(1,MA0)))))))","'Crystal Interstitial':(B2, C2, D2, A(2, b2, c2, d2))","'Diamond':(a(2,b(2,c(2,d(1,MA1)),d(2,c(1,MA0))),c(2,d(2,b(1,MA3)),b(2,d(1,MA2))),d(2,b(2,c(1,MA5)),c(2,b(1,MA4)))),b(2,d(2,Mc3),c(2,Md4)),c(2,b(2,Md5),d(2,Mb0)),d(2,c(2,Mb1),b(2,Mc2)))","'Composed':(3,b(2,MA0),c(2,MA0),d(2,MA0)):0=subtree(b2,c2,d2)","'Galapagotchi1':(A(3,S90,Mb0),b(3,S90,Mb0),a(2,S90,Md0),B(2,Md0,S90)):0=face-distance-60","'Galapagotchi2':(A(2,c(2,MA0)),b(2,c(2,MA0)),a(2,d(2,MA0)),B(2,d(2,MA0))):0=face-distance-115","'Thick Tripod':(A1,B(3,MA1),C(3,MA1),D(3,MA1)):1=face-distance-35"].map((function(e){return q(K,!1,e)}));function ne(e,t){var n=[];return e.forEach((function(e){var r=e.brick,a=e.tree,i=e.tensegrity;function c(e,t,n,r){var a,c,o=e.base===y.PPP?T(n):n,s=new Z(i).createConnectedBrick(e,o,r);return 0===t._&&(a=s,c=t,N.forEach((function(e){var t=W(e,c);if(t){var n=a.base===y.NNN?a.faces[e]:a.faces[T(e)];if(n.removed)throw new Error("!! trying to use a face that was removed");n.mark=t}}))),{tree:t,brick:s,tensegrity:i}}var o=a._;if(o){var s=o-1;n.push(c(r,X({},a,{_:s}),y.PPP,A(a.S)))}else N.forEach((function(e){var i=function(e,t){return t[j[e]]}(e,a),o=W(e,a);if(i){var s=X({},i,{_:i._?i._-1:void 0});n.push(c(r,s,e,A(i.S)))}else if(o){var l=t[o._];if(l&&l.action===U.Subtree){var u=l.tree;if(!u)throw new Error("Missing subtree");!function(e,t){t["M".concat(j[e])]=void 0}(e,a),n.push(c(r,u,e,A(u.S)))}}}))})),n}function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ae(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.Grow="Grow",e.Shape="Shape",e.Realize="Realize",e.View="View",e.Strain="Strain"}(ee||(ee={}));var ie="2020-03-11a";function ce(e){return Object.keys(e.recentCode).map((function(t){var n=e.recentCode[t],r=q((function(e){return console.error(e)}),!1,n);if(!r)throw new Error("Unable to read recent tenscript code: ".concat(n));return r}))}function oe(e){switch(e){case d.IntervalRole.NexusPush:return d.FabricFeature.NexusPushLength;case d.IntervalRole.ColumnPush:return d.FabricFeature.ColumnPushLength;case d.IntervalRole.Triangle:return d.FabricFeature.TriangleLength;case d.IntervalRole.Ring:return d.FabricFeature.RingLength;case d.IntervalRole.NexusCross:return d.FabricFeature.NexusCrossLength;case d.IntervalRole.ColumnCross:return d.FabricFeature.ColumnCrossLength;case d.IntervalRole.BowMid:return d.FabricFeature.BowMidLength;case d.IntervalRole.BowEnd:return d.FabricFeature.BowEndLength;default:throw new Error("role?")}}function se(e,t){return ae({},e,{nonce:e.nonce+1},t)}var le="State";function ue(e,t){var n=localStorage.getItem(le);if(n){var r=JSON.parse(n);if(r.version===ie)return r}return function(e,t){var n=h.map(e).reduce((function(e,n){return e[n.feature]={percent:100,numeric:t(n.feature)},e}),{});return{version:ie,nonce:0,surfaceCharacter:d.SurfaceCharacter.Frozen,featureValues:n,recentCode:{},controlTab:ee.Grow,fullScreen:!0,ellipsoids:!1,rotating:!1,showPushes:!0,showPulls:!0}}(e,t)}function fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function de(e){switch(e){case d.FabricFeature.Gravity:return{feature:e,name:"Gravity",percents:[0,10,50,100,200,500]};case d.FabricFeature.Drag:return{feature:e,name:"Drag",percents:[0,10,50,100,150,200]};case d.FabricFeature.PretenstFactor:return{feature:e,name:"Pretenst factor",percents:[0,50,90,100,125,150,200]};case d.FabricFeature.IterationsPerFrame:return{feature:e,name:"Iterations per frame",percents:[10,25,50,100,200,300,500]};case d.FabricFeature.IntervalCountdown:return{feature:e,name:"Interval Countdown",percents:[10,20,30,100,150,400,1e3]};case d.FabricFeature.RealizingCountdown:return{feature:e,name:"Slack to Pretenst countdown",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.SlackThreshold:return{feature:e,name:"Slack threshold",percents:[.01,.1,1,10,100,1e3]};case d.FabricFeature.ShapingPretenstFactor:return{feature:e,name:"Pretenst factor",percents:[0,1,2,3,5,10,20,50,100]};case d.FabricFeature.ShapingStiffnessFactor:return{feature:e,name:"Stiffness factor",percents:[100,150,200,250,300,400,500]};case d.FabricFeature.ShapingDrag:return{feature:e,name:"Drag",percents:[0,10,50,100,200,500]};case d.FabricFeature.MaxStrain:return{feature:e,name:"Maximum Strain",percents:[1,2,3,5,8,13,21,34,55,100]};case d.FabricFeature.VisualStrain:return{feature:e,name:"Visual Strain",percents:[0,10,50,100,200,300,500,1e3,2e3,3e3]};case d.FabricFeature.PushOverPull:return{feature:e,name:"Compression/Tension",percents:[10,20,30,50,100,200,300,500,1e3]};case d.FabricFeature.NexusPushLength:return{feature:e,name:"Nexus Push",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.ColumnPushLength:return{feature:e,name:"Column Push",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.TriangleLength:return{feature:e,name:"Triangle",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.RingLength:return{feature:e,name:"Ring",percents:[10,80,90,100,110,120,130]};case d.FabricFeature.NexusCrossLength:return{feature:e,name:"Nexus Cross",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.ColumnCrossLength:return{feature:e,name:"Column Cross",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.BowMidLength:return{feature:e,name:"Bow Mid",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.BowEndLength:return{feature:e,name:"Bow End",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.PushRadius:return{feature:e,name:"Push Radius",percents:[5,25,50,100,150,200,300]};case d.FabricFeature.PullRadius:return{feature:e,name:"Pull Radius",percents:[5,25,50,100,150,200,300]};case d.FabricFeature.JointRadius:return{feature:e,name:"Joint Radius",percents:[5,25,50,100,150,200,300]};case d.FabricFeature.MaxStiffness:return{feature:e,name:"Maximum Stiffness",percents:[5,25,50,100,150,200,500]};default:throw new Error("Feature?")}}var he=function(){function e(t,n,r){Object(u.a)(this,e),this.config=t,this.defaultValue=n,this.value$=void 0;var a=r.getValue().featureValues[t.feature],i=void 0!==a?a:{numeric:this.defaultValue,percent:100};this.value$=new s.BehaviorSubject(i),this.value$.subscribe((function(e){var n=r.getValue(),a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fe(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n.featureValues);a[t.feature]=e,r.next(se(n,{featureValues:a}))}))}return Object(f.a)(e,[{key:"value",get:function(){return this.value$.getValue()}},{key:"title",get:function(){return this.config.name}},{key:"percentChoices",get:function(){return this.config.percents}},{key:"numeric",get:function(){return this.value$.getValue().numeric}},{key:"formatted",get:function(){var e=this.numeric,t=e.toExponential(5),n=t.indexOf("e+0");return n>0?t.substring(0,n):Math.max(t.indexOf("e-1"),t.indexOf("e-2"))>0?e.toFixed(5):Math.max(t.indexOf("e+1"),t.indexOf("e+2"))>0?e.toFixed(1):t}},{key:"percent",get:function(){return this.value$.getValue().percent},set:function(e){this.value$.next({numeric:this.defaultValue*e/100,percent:e})}},{key:"observable",get:function(){return this.value$}},{key:"fabricFeature",get:function(){return this.config.feature}}]),e}();function me(e,t){var n={};return h.map(de).forEach((function(r){n[r.feature]=new he(r,t(r.feature),e)})),n}var pe=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function ve(){if("serviceWorker"in navigator){if(new URL("/app",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/app","/service-worker.js");pe?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):ge(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):ge(e)}))}}function ge(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var be=n(30),Ee=n(623),ye=n(112),we=n(548),Se=n(613),Fe=function(e,t,n){var r=3*t;return n?(n.set(e[r],e[r+1],e[r+2]),n):new F.Vector3(e[r],e[r+1],e[r+2])};function Pe(e,t){return{lineColors:Oe((function(e){return t.copy_line_colors_to(e)}),(function(){return 3*e.get_interval_count()*2})),lineLocations:Oe((function(e){return t.copy_line_locations_to(e)}),(function(){return 3*e.get_interval_count()*2})),faceNormals:Oe((function(e){return t.copy_face_normals_to(e)}),(function(){return 3*e.get_face_count()*3})),faceLocations:Oe((function(e){return t.copy_face_vertex_locations_to(e)}),(function(){return 3*e.get_face_count()*3})),jointLocations:Oe((function(e){return t.copy_joint_locations_to(e)}),(function(){return 3*e.get_joint_count()})),jointVelocities:Oe((function(e){return t.copy_joint_velocities_to(e)}),(function(){return 3*e.get_joint_count()})),unitVectors:Oe((function(e){return t.copy_unit_vectors_to(e)}),(function(){return 3*e.get_interval_count()})),idealLengths:Oe((function(e){return t.copy_ideal_lengths_to(e)}),(function(){return e.get_interval_count()})),strains:Oe((function(e){return t.copy_strains_to(e)}),(function(){return e.get_interval_count()})),strainNuances:Oe((function(e){return t.copy_strain_nuances_to(e)}),(function(){return e.get_interval_count()})),stiffnesses:Oe((function(e){return t.copy_stiffnesses_to(e)}),(function(){return e.get_interval_count()})),linearDensities:Oe((function(e){return t.copy_linear_densities_to(e)}),(function(){return e.get_interval_count()}))}}function Oe(e,t){var n=new Float32Array(t());return e(n),n}var ke=function(){function e(t,n){Object(u.a)(this,e),this.fabric=void 0,this.world=void 0,this.view=void 0,this.floatView=void 0,this.featuresToApply=[],this.world=t.World.new(),this.fabric=t.Fabric.new(n),this.view=t.View.on_fabric(this.fabric),this.floatView=Pe(this.fabric,this.view)}return Object(f.a)(e,[{key:"iterate",value:function(e){var t=this,n=this.fabric.iterate(e,this.world);return this.view.render(this.fabric,this.world),this.featuresToApply.length>0&&(this.featuresToApply.forEach((function(e){return t.world.set_float_value(e.fabricFeature,e.numeric)})),this.featuresToApply=[]),this.floatView=Pe(this.fabric,this.view),n}},{key:"refreshFloatView",value:function(){this.view.render(this.fabric,this.world),this.floatView=Pe(this.fabric,this.view)}},{key:"clear",value:function(){this.fabric.clear(),this.refreshFloatView()}},{key:"applyFeature",value:function(e){this.featuresToApply.push(e)}},{key:"jointLocation",value:function(e){return Fe(this.floatView.jointLocations,e)}},{key:"apply",value:function(e){this.fabric.apply_matrix4(new Float32Array(e.toArray()))}},{key:"unitVector",value:function(e){return Fe(this.floatView.unitVectors,e)}}]),e}(),Ne=function(){function e(t){Object(u.a)(this,e),this.tensegrity=t}return Object(f.a)(e,[{key:"replaceCrossedNexusCrosses",value:function(e){var t=this,n=this.tensegrity,r=[],a=function(e){var t=n.intervals.filter((function(e){return e.isPush})).find((function(t){return t.alpha.index===e||t.omega.index===e}));if(!t)throw new Error("Cannot find ".concat(e));return{interval:t,joint:t.alpha.index===e?t.alpha:t.omega}},i=n.intervals.filter((function(e){return e.intervalRole===d.IntervalRole.NexusCross}));i.forEach((function(e,t){var n=e.alpha.index,c=e.omega.index,o=a(n),s=a(c),l=e.alpha.location(),u=e.omega.location(),f=l.distanceTo(u),d=(new F.Vector3).addVectors(l,u).multiplyScalar(.5);i.forEach((function(i,h){var m=i.alpha.index,p=i.omega.index;if(!(t>=h||n===m||n===p||c===m||c===p)){var v,g,b,E,y,w=a(m),S=a(p),P=function(e,t){return e.interval.index===t.interval.index};if(P(o,w))v=o.interval,g=e.alpha,b=e.omega,E=i.alpha,y=i.omega;else if(P(o,S))v=o.interval,g=e.alpha,b=e.omega,E=i.omega,y=i.alpha;else if(P(s,w))v=s.interval,g=e.omega,b=e.alpha,E=i.alpha,y=i.omega;else{if(!P(s,S))return;v=s.interval,g=e.omega,b=e.alpha,E=i.omega,y=i.alpha}var O=i.alpha.location(),k=i.omega.location(),N=O.distanceTo(k),j=(new F.Vector3).addVectors(O,k).multiplyScalar(.5),x=l.distanceTo(j)/N,C=u.distanceTo(j)/N,V=O.distanceTo(d)/f,R=k.distanceTo(d)/f,I=0,M=function(e){e<.5&&I++};if(M(x),M(C),M(V),M(R),!(I<2)){var T=v.scale;r.push({scale:T,a:g,x:b,b:E,y:y})}}}))})),r.forEach((function(r){var a=r.scale,i=r.a,c=r.x,o=r.b,s=r.y;n.createInterval(c,s,d.IntervalRole.BowMid,a,e);var l=n.findInterval(i,c),u=n.findInterval(i,s),f=n.findInterval(o,c),h=n.findInterval(o,s);l&&f&&u&&h?(n.removeInterval(l),n.removeInterval(h),t.tensegrity.changeIntervalRole(u,d.IntervalRole.BowEnd,a,e),t.tensegrity.changeIntervalRole(f,d.IntervalRole.BowEnd,a,e)):console.log("Cannot find intervals during optimize")}))}},{key:"stiffnessesFromStrains",value:function(){var e=this.tensegrity.numericFeature(d.FabricFeature.PushOverPull),t=function(e,t){var n=e.instance.floatView.strains,r=function(e){return e.reduce((function(e,t){return e+n[t.index]}),0)/e.length},a=e.intervals,i=a.filter((function(e){return e.isPush})),c=r(i),o=a.filter((function(e){return!e.isPush})),s=r(o),l=(-t*c+s)/2,u=a.map((function(e){return 1+(n[e.index]*(e.isPush?-t:1)-l)/l}));return e.instance.floatView.stiffnesses.map((function(e,t){return e*u[t]}))}(this.tensegrity,e);this.tensegrity.restore(),this.tensegrity.instance.fabric.copy_stiffnesses(t)}}]),e}();var je=function(){function e(t,n,r){Object(u.a)(this,e),this.numericFeature=t,this.tensegrity=n,this._stage=void 0,this._stage=r}return Object(f.a)(e,[{key:"withStage",value:function(t,n){return this.transition(t,n),this._stage=t,new e(this.numericFeature,this.tensegrity,t)}},{key:"transition",value:function(e,t){var n=this;switch(this._stage){case d.Stage.Growing:switch(e){case d.Stage.Shaping:return void this.tensegrity.save()}break;case d.Stage.Shaping:switch(e){case d.Stage.Slack:if(t&&t.adoptLengths)this.tensegrity.instance.fabric.adopt_lengths(),Object(w.a)(this.tensegrity.faceIntervals).forEach((function(e){return n.tensegrity.removeFaceInterval(e)})),this.tensegrity.save();return;case d.Stage.Realizing:return}break;case d.Stage.Slack:switch(e){case d.Stage.Shaping:case d.Stage.Realizing:return}break;case d.Stage.Realizing:switch(e){case d.Stage.Realized:return}break;case d.Stage.Realized:switch(e){case d.Stage.Slack:if(t){if(t.strainToStiffness)return void new Ne(this.tensegrity).stiffnessesFromStrains();if(t.adoptLengths)return this.tensegrity.instance.fabric.adopt_lengths(),void this.tensegrity.save()}}}throw new Error("No transition ".concat(d.Stage[this._stage]," to ").concat(d.Stage[e]))}},{key:"stage",get:function(){return this._stage}}]),e}(),xe=65535;function Ce(e){return _(e)/1e4}var Ve=function(){function e(t,n,r,a){Object(u.a)(this,e),this.roleDefaultLength=t,this.numericFeature=n,this.instance=r,this.tenscript=a,this.life$=void 0,this.joints=[],this.intervals=[],this.faceIntervals=[],this.faces=[],this.bricks=[],this.activeTenscript=void 0,this.backup=void 0,this.instance.clear(),this.life$=new s.BehaviorSubject(new je(n,this,d.Stage.Growing));var i=new Z(this).createBrickAt(new F.Vector3,A());this.bricks=[i],this.activeTenscript=[{tree:this.tenscript.tree,brick:i,tensegrity:this}]}return Object(f.a)(e,[{key:"save",value:function(){this.backup=this.instance.fabric.copy()}},{key:"restore",value:function(){if(!this.backup)throw new Error("No backup");this.instance.fabric.restore(this.backup)}},{key:"toStage",value:function(e,t){e!==this.life.stage&&this.life$.next(this.life.withStage(e,t))}},{key:"createLeftJoint",value:function(e){return this.instance.fabric.create_joint(e.x,e.y,e.z)}},{key:"createFaceConnector",value:function(e,t){return this.createFaceInterval(e,t)}},{key:"createFaceDistancer",value:function(e,t,n){return this.createFaceInterval(e,t,n)}},{key:"removeFaceInterval",value:function(e){this.faceIntervals=this.faceIntervals.filter((function(t){return t.index!==e.index})),this.instance.fabric.remove_interval(e.index),this.faceIntervals.forEach((function(t){t.index>e.index&&t.index--})),this.intervals.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0}},{key:"createInterval",value:function(e,t,n,r,a){var i=e.location().distanceTo(t.location()),c=_(r)*this.roleDefaultLength(n),o=Ce(r),s={index:this.instance.fabric.create_interval(e.index,t.index,n,i,c,o,a),intervalRole:n,scale:r,alpha:e,omega:t,removed:!1,isPush:v(n),location:function(){return(new F.Vector3).addVectors(e.location(),t.location()).multiplyScalar(.5)}};return this.intervals.push(s),s}},{key:"changeIntervalScale",value:function(e,t){e.scale=D(_(e.scale)*t),this.instance.fabric.multiply_rest_length(e.index,t,100)}},{key:"changeIntervalRole",value:function(e,t,n,r){e.intervalRole=t,this.instance.fabric.set_interval_role(e.index,t),this.instance.fabric.change_rest_length(e.index,_(n)*this.roleDefaultLength(t),r)}},{key:"removeInterval",value:function(e){this.intervals=this.intervals.filter((function(t){return t.index!==e.index})),this.instance.fabric.remove_interval(e.index),this.intervals.forEach((function(t){t.index>e.index&&t.index--})),this.faceIntervals.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0}},{key:"createFace",value:function(e,t){var n=M[t],r=n.negative,a=n.pushEnds,i=a.map((function(t){var n=e.pushes.find((function(n){var r=e.joints[t];return r.index===n.alpha.index||r.index===n.omega.index}));if(void 0===n)throw new Error;return n})),c=[0,1,2].map((function(n){return e.pulls[3*t+n]})),o=a.map((function(t){return e.joints[t]})),s={index:this.instance.fabric.create_face(o[0].index,o[1].index,o[2].index),negative:r,removed:!1,brick:e,triangle:t,joints:o,pushes:i,pulls:c,location:function(){return o.reduce((function(e,t){return e.add(t.location())}),new F.Vector3).multiplyScalar(1/3)}};return this.faces.push(s),s}},{key:"removeFace",value:function(e,t){var n=this;this.instance.fabric.remove_face(e.index),this.faces=this.faces.filter((function(t){return t.index!==e.index})),this.faces.forEach((function(t){t.index>e.index&&t.index--})),this.faceIntervals.forEach((function(t){t.alpha.index>e.index&&t.alpha.index--,t.omega.index>e.index&&t.omega.index--})),e.removed=!0,t&&e.pulls.forEach((function(e){return n.removeInterval(e)}))}},{key:"startTightening",value:function(e){this.faceIntervals=e}},{key:"iterate",value:function(){var e=this,t=this.instance.iterate(this.life$.getValue().stage);if(t===d.Stage.Busy)return t;var n=this.activeTenscript,r=function(){return new Z(e)};return n?(n.length>0&&(this.activeTenscript=ne(n,this.tenscript.marks),this.instance.fabric.centralize()),0===n.length&&(this.activeTenscript=void 0,function(e,t,n){var r={};return e.forEach((function(e){if(void 0!==e.mark){var t=r[e.mark._];t?t.push(e):r[e.mark._]=[e]}})),Object.entries(r).map((function(e){var a=Object(be.a)(e,2),i=a[0],c=a[1],o=t[i],s=o||(1===c.length?{action:U.BaseFace}:{action:U.JoinFaces});return new Me(r[i],s,n)}))}(this.faces,this.tenscript.marks,r()).forEach((function(e){return e.execute()})),t===d.Stage.Growing)?(new Ne(this).replaceCrossedNexusCrosses(1e3),this.instance.fabric.finish_growing()):d.Stage.Growing):(this.faceIntervals.length>0&&(this.faceIntervals=r().checkFaceIntervals(this.faceIntervals,(function(t){return e.removeFaceInterval(t)}))),t)}},{key:"findInterval",value:function(e,t){return this.intervals.find((function(n){return n.alpha.index===e.index&&n.omega.index===t.index||n.alpha.index===t.index&&n.omega.index===e.index}))}},{key:"getFabricOutput",value:function(e){var t=this,n=this.instance.floatView.idealLengths,r=this.instance.floatView.strains,a=this.instance.floatView.stiffnesses,i=this.instance.floatView.linearDensities;return{name:this.tenscript.name,joints:this.joints.map((function(e){var n=e.location();return{index:e.index,x:n.x,y:n.z,z:n.y,jointCables:C(e,t.intervals)}})),intervals:this.intervals.map((function(t){var c=e.featureValues[t.isPush?d.FabricFeature.PushRadius:d.FabricFeature.PullRadius].numeric*i[t.index],o=c*e.featureValues[d.FabricFeature.JointRadius].numeric,s=t.alpha.location().distanceTo(t.omega.location())+(t.isPush?2*-o:2*o);return{index:t.index,joints:[t.alpha.index,t.omega.index],type:t.isPush?"Push":"Pull",strain:r[t.index],stiffness:a[t.index],linearDensity:i[t.index],role:m(t.intervalRole),idealLength:n[t.index],isPush:t.isPush,length:s,radius:c,jointRadius:o}}))}}},{key:"createFaceInterval",value:function(e,t,n){var r=!n,a=r?d.IntervalRole.FaceConnector:d.IntervalRole.FaceDistancer,i=e.location().distanceTo(t.location()),c=Ce(A()),o=(_(e.brick.scale)+_(t.brick.scale))/2,s=n?_(n)*i:B(o),l={index:this.instance.fabric.create_interval(e.index,t.index,a,i,s,c,function(e){var t=6e3*e;return t>xe?xe:t}(i)),alpha:e,omega:t,connector:r,scaleFactor:o,removed:!1};return this.faceIntervals.push(l),l}},{key:"life",get:function(){return this.life$.getValue()}},{key:"submergedJoints",get:function(){return this.joints.filter((function(e){return e.location().y<0}))}},{key:"facesGeometry",get:function(){var e=new F.Float32BufferAttribute(this.instance.floatView.faceLocations,3),t=new F.Float32BufferAttribute(this.instance.floatView.faceNormals,3),n=new F.BufferGeometry;return n.addAttribute("position",e),n.addAttribute("normal",t),n.computeBoundingSphere(),n}},{key:"linesGeometry",get:function(){var e=new F.Float32BufferAttribute(this.instance.floatView.lineLocations,3),t=new F.Float32BufferAttribute(this.instance.floatView.lineColors,3),n=new F.BufferGeometry;return n.addAttribute("position",e),n.addAttribute("color",t),n.computeBoundingSphere(),n}}]),e}();var Re,Ie,Me=function(){function e(t,n,r){Object(u.a)(this,e),this.faces=t,this.mark=n,this.builder=r}return Object(f.a)(e,[{key:"execute",value:function(){switch(this.mark.action){case U.Subtree:break;case U.BaseFace:this.builder.faceToOrigin(this.faces[0]);break;case U.JoinFaces:case U.FaceDistance:this.builder.createFaceIntervals(this.faces,this.mark)}}}]),e}(),Te=n(618),Ae=n(619),_e=n(624),De=n(620),Le=n(621),ze=n(622),Be=["#ff0012","#fb5c06","#e28a00","#d4b500","#afd200","#80da52","#4edd83","#00ddad","#00c4d7","#00a5ff","#007bff","#2329f7"].reverse().map((function(e){return new F.Color(e)})),Ze=!0,Ye=new F.MeshPhongMaterial({color:new F.Color("#1c1608"),side:F.DoubleSide}),Xe=new F.LineBasicMaterial({vertexColors:F.VertexColors}),Ue=new F.LineBasicMaterial({color:new F.Color("#cace02")}),$e=new F.MeshPhongMaterial({lights:Ze,color:new F.Color("white"),side:F.DoubleSide,transparent:!0,opacity:.2}),Ge=new F.MeshPhongMaterial({color:new F.Color("#91934f"),lights:!0}),We=new F.MeshPhongMaterial({color:new F.Color("#e83ada"),lights:!0}),Je=Be.map((function(e){return new F.MeshLambertMaterial({color:e,lights:Ze})}));function Qe(e){switch(e){case d.IntervalRole.NexusPush:return"#6541b4";case d.IntervalRole.ColumnPush:return"#2f3aca";case d.IntervalRole.Triangle:return"#c9c445";case d.IntervalRole.Ring:return"#e83ada";case d.IntervalRole.NexusCross:return"#59ebcb";case d.IntervalRole.ColumnCross:return"#299995";case d.IntervalRole.BowMid:return"#f14302";case d.IntervalRole.BowEnd:return"#c03b02";case d.IntervalRole.FaceConnector:return"#fe0105";case d.IntervalRole.FaceDistancer:return"#fefb07";default:return}}function He(e){var t=function(e){return new F.Color(Qe(e))}(e);return new F.MeshLambertMaterial({color:t,lights:Ze})}function qe(e){var t=e.feature,n=e.disabled,r=Object(c.useState)((function(){return t.percent})),a=Object(be.a)(r,2),i=a[0],o=a[1];Object(c.useEffect)((function(){var e=t.observable.subscribe((function(e){var t=e.percent;return o(t)}));return function(){return e.unsubscribe()}}),[]);var s=Qe(g(t.fabricFeature)),l=s||"#919191";return c.createElement("div",{className:"my-2"},c.createElement("div",{className:"float-right",style:{color:n?"gray":"white"}},t.formatted),c.createElement("div",null,t.config.name),c.createElement(Se.a,{className:"w-100"},t.percentChoices.map((function(e){var r=i===e?"#000000":l;return c.createElement(we.a,{disabled:n,size:"sm",style:{color:"white",backgroundColor:r},key:"".concat(t.config.name,":").concat(e),onClick:function(){return t.percent=e}},function(e){return e<=100?"".concat(e,"%"):"".concat(e/100,"x")}(e))}))))}function Ke(e){var t=e.tensegrity,n=e.stageTransition,r=e.disabled,a=Object(c.useState)(t.life),i=Object(be.a)(a,2),o=i[0],s=i[1];function l(e){return!(!r&&o.stage!==d.Stage.Busy&&o.stage!==d.Stage.Realizing)||o.stage!==e}switch(Object(c.useEffect)((function(){var e=t.life$.subscribe(s);return function(){return e.unsubscribe()}}),[t]),n){case Re.CaptureLengthsToSlack:return c.createElement(we.a,{className:"my-1 w-100",disabled:l(d.Stage.Shaping),onClick:function(){return t.toStage(d.Stage.Slack,{adoptLengths:!0})}},"Capture Lengths ",c.createElement(Ee.j,null)," (",c.createElement(et,{stage:d.Stage.Shaping})," ) ",c.createElement(Ee.d,null)," ( ",c.createElement(Ee.f,null),c.createElement(et,{stage:d.Stage.Slack})," ) New Slack");case Re.CurrentLengthsToSlack:return c.createElement(we.a,{className:"my-1 w-100",disabled:l(d.Stage.Shaping),onClick:function(){return t.toStage(d.Stage.Slack)}},"Current Lengths ",c.createElement(et,{stage:d.Stage.Shaping})," ",c.createElement(Ee.d,null),c.createElement(et,{stage:d.Stage.Slack})," Slack");case Re.SlackToRealizing:return c.createElement(we.a,{className:"my-1 w-100",disabled:l(d.Stage.Slack),onClick:function(){return t.toStage(d.Stage.Realizing)}},"Slack ",c.createElement(et,{stage:d.Stage.Slack})," ",c.createElement(Ee.d,null)," ",c.createElement(et,{stage:d.Stage.Realized})," Realized");case Re.SlackToShaping:return c.createElement(Se.a,{vertical:!0,className:"w-100 my-1"},c.createElement(we.a,{className:"my-1 w-100",disabled:l(d.Stage.Slack),onClick:function(){return t.toStage(d.Stage.Shaping)}},"Slack ",c.createElement(et,{stage:d.Stage.Slack})," ",c.createElement(Ee.d,null)," ",c.createElement(et,{stage:d.Stage.Shaping})," Shaping"));case Re.CaptureRealizedToSlack:return c.createElement(we.a,{className:"my-1 w-100",disabled:l(d.Stage.Realized),onClick:function(){return t.toStage(d.Stage.Slack,{adoptLengths:!0})}},"Capture realized ",c.createElement(Ee.j,null)," ( ",c.createElement(et,{stage:d.Stage.Realized})," ) ",c.createElement(Ee.d,null)," ( ",c.createElement(Ee.f,null),c.createElement(et,{stage:d.Stage.Slack})," ) New Slack");case Re.CaptureStrainForStiffness:return c.createElement(we.a,{className:"my-1 w-100",disabled:l(d.Stage.Realized),onClick:function(){return t.toStage(d.Stage.Slack,{strainToStiffness:!0})}},"Capture Strain ",c.createElement(Ee.j,null)," ( ",c.createElement(et,{stage:d.Stage.Realized})," ",c.createElement(Ee.F,null)," ) ",c.createElement(Ee.d,null),"( ",c.createElement(et,{stage:d.Stage.Slack})," ",c.createElement(Ee.k,null)," ) Slack Stiffness")}}function et(e){switch(e.stage){case d.Stage.Busy:return c.createElement(Ee.n,null);case d.Stage.Growing:return c.createElement(Ee.L,null);case d.Stage.Shaping:return c.createElement(Ee.Q,null);case d.Stage.Slack:return c.createElement(Ee.S,null);case d.Stage.Realizing:return c.createElement(Ee.n,null);case d.Stage.Realized:return c.createElement(Ee.B,null);default:throw new Error("Stage?")}}function tt(e){var t=e.floatFeatures,n=e.tensegrity,r=e.selectedIntervals,a=e.setFabric,i=e.shapeSelection,o=e.setShapeSelection,s=e.selectedFaces,l=e.clearSelectedFaces,u=e.storedState$,f=Object(c.useState)(!1),h=Object(be.a)(f,2),v=h[0],g=h[1];Object(c.useEffect)((function(){n.instance.world.set_push_and_pull(v)}),[v]);var b=Object(c.useState)(u.getValue().ellipsoids),E=Object(be.a)(b,2),y=E[0],S=E[1];Object(c.useEffect)((function(){var e=[u.subscribe((function(e){return S(e.ellipsoids)}))];return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[]);var F=Object(c.useState)(n.life),P=Object(be.a)(F,2),O=P[0],k=P[1];Object(c.useEffect)((function(){var e=n.life$.subscribe(k);return function(){return e.unsubscribe()}}),[n]);var N=Object(c.useState)(t[d.FabricFeature.NexusPushLength]),j=Object(be.a)(N,2),x=j[0],C=j[1],V=function(e,t,a){return function(){r&&r.forEach((function(r){r.isPush&&!t||!r.isPush&&!a||n.changeIntervalScale(r,e?1.03:1/1.03)}))}};function R(){return y||O.stage!==d.Stage.Shaping}function I(e,t){return!(!R()&&i===t)||(s.length<e||y)}function M(){return y||i!==Ie.None}return c.createElement("div",null,c.createElement(kt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.a,null)," Phase"),c.createElement(Ke,{tensegrity:n,stageTransition:Re.CaptureLengthsToSlack,disabled:M()}),c.createElement(Ke,{tensegrity:n,stageTransition:Re.CurrentLengthsToSlack,disabled:M()}),c.createElement(Ke,{tensegrity:n,stageTransition:Re.SlackToShaping,disabled:M()})),c.createElement(kt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.z,null)," Manual"),c.createElement(Se.a,{size:"sm",className:"w-100 my-2"},c.createElement(we.a,{color:i===Ie.Intervals?"warning":"secondary",disabled:y&&i===Ie.None||0===s.length,onClick:function(){var e=i===Ie.Intervals?Ie.None:Ie.Intervals;o(e)}},c.createElement("span",null,c.createElement(Ee.b,null)," Adjust ",c.createElement(Ee.e,null))),c.createElement(we.a,{disabled:I(1,Ie.Intervals),onClick:V(!0,!0,!0)},"TC ",c.createElement(Ee.e,null)),c.createElement(we.a,{disabled:I(1,Ie.Intervals),onClick:V(!1,!0,!0)},"TC ",c.createElement(Ee.b,null)),c.createElement(we.a,{disabled:I(1,Ie.Intervals),onClick:V(!0,!1,!0)},"T",c.createElement(Ee.e,null)),c.createElement(we.a,{disabled:I(1,Ie.Intervals),onClick:V(!1,!1,!0)},"T ",c.createElement(Ee.b,null)),c.createElement(we.a,{disabled:I(1,Ie.Intervals),onClick:V(!0,!0,!1)},"C ",c.createElement(Ee.e,null)),c.createElement(we.a,{disabled:I(1,Ie.Intervals),onClick:V(!1,!0,!1)},"C ",c.createElement(Ee.b,null))),c.createElement(Se.a,{size:"sm",className:"w-100 my-2"},c.createElement(we.a,{disabled:0===s.length||R()&&i!==Ie.None,onClick:function(){return l()}},c.createElement(Ee.O,null)," Clear selection"),c.createElement(we.a,{disabled:I(1,Ie.Faces),onClick:function(){new Z(n).faceToOrigin(s[0]),n.instance.refreshFloatView(),l()}},c.createElement(Ee.o,null),c.createElement("span",null," Upright")),c.createElement(we.a,{disabled:I(2,Ie.Faces),onClick:function(){var e,t=new Z(n).createFaceIntervals(s,{action:U.JoinFaces});(e=n.faceIntervals).push.apply(e,Object(w.a)(t)),l(),o(Ie.None),a(n)}},c.createElement(Ee.E,null),c.createElement("span",null," Connect")))),c.createElement(kt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.Q,null)," Adjustments"),c.createElement(qe,{feature:t[d.FabricFeature.ShapingPretenstFactor],disabled:R()}),c.createElement(qe,{feature:t[d.FabricFeature.ShapingDrag],disabled:R()}),c.createElement(qe,{feature:t[d.FabricFeature.ShapingStiffnessFactor],disabled:R()}),c.createElement(Se.a,{size:"sm",className:"w-100 my-2"},c.createElement(we.a,{disabled:R(),color:v?"secondary":"success",onClick:function(){return g(!1)}},c.createElement(Ee.l,null),": T or C"),c.createElement(we.a,{disabled:R(),color:v?"success":"secondary",onClick:function(){return g(!0)}},c.createElement(Ee.r,null),": T=C"))),c.createElement(kt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.F,null)," Default Lengths"),c.createElement(qe,{key:x.title,feature:x,disabled:R()}),c.createElement(Se.a,{className:"my-2 w-100"},p.map((function(e){return{intervalRole:e,feature:t[oe(e)]}})).map((function(e){var t=e.intervalRole,n=e.feature;return c.createElement(we.a,{size:"sm",key:"IntervalRole[".concat(t,"]"),onClick:function(){return C(n)},color:x.fabricFeature===n.fabricFeature?"success":"secondary"},m(t))})))))}function nt(e){var t=e.floatFeatures,n=e.tensegrity,r=e.shapeSelection,a=e.storedState$,i=Object(c.useState)(a.getValue()),o=Object(be.a)(i,2),s=o[0],l=o[1],u=Object(c.useState)(a.getValue().ellipsoids),f=Object(be.a)(u,2),h=f[0],m=f[1];Object(c.useEffect)((function(){var e=[a.subscribe((function(e){m(s.ellipsoids),l(e)}))];return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[]);var p=Object(c.useState)(n.life),v=Object(be.a)(p,2),g=v[0],b=v[1];function E(){return h||r!==Ie.None||g.stage<d.Stage.Slack}function y(){return h||r!==Ie.None}return Object(c.useEffect)((function(){var e=n.life$.subscribe(b);return function(){return e.unsubscribe()}}),[n]),c.createElement("div",null,c.createElement(kt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.a,null)," Phase"),c.createElement(Ke,{tensegrity:n,stageTransition:Re.SlackToRealizing,disabled:y()}),c.createElement(Ke,{tensegrity:n,stageTransition:Re.CaptureRealizedToSlack,disabled:y()})),c.createElement(kt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.y,null)," Environment"),c.createElement(qe,{feature:t[d.FabricFeature.PretenstFactor],disabled:E()}),c.createElement("div",{className:"float-right",style:{color:E()?"gray":"white"}},d.SurfaceCharacter[s.surfaceCharacter]),c.createElement("div",null,"Surface"),c.createElement(Se.a,{size:"sm",className:"w-100"},Object.keys(d.SurfaceCharacter).map((function(e){return c.createElement(we.a,{key:"SurfaceCharacter[".concat(e,"]"),disabled:E(),active:s.surfaceCharacter===d.SurfaceCharacter[e],onClick:function(){return t={surfaceCharacter:d.SurfaceCharacter[e]},void a.next(se(a.getValue(),t));var t}},e)}))),c.createElement(qe,{feature:t[d.FabricFeature.Gravity],disabled:E()}),c.createElement(qe,{feature:t[d.FabricFeature.Drag],disabled:E()})),c.createElement(kt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.g,null)," Compression vs Tension"),c.createElement(Ke,{tensegrity:n,stageTransition:Re.CaptureStrainForStiffness,disabled:y()}),c.createElement(qe,{feature:t[d.FabricFeature.PushOverPull],disabled:E()})))}!function(e){e[e.CaptureLengthsToSlack=0]="CaptureLengthsToSlack",e[e.CurrentLengthsToSlack=1]="CurrentLengthsToSlack",e[e.SlackToRealizing=2]="SlackToRealizing",e[e.SlackToShaping=3]="SlackToShaping",e[e.CaptureRealizedToSlack=4]="CaptureRealizedToSlack",e[e.CaptureStrainForStiffness=5]="CaptureStrainForStiffness"}(Re||(Re={})),function(e){e[e.None=0]="None",e[e.Faces=1]="Faces",e[e.Intervals=2]="Intervals"}(Ie||(Ie={}));var rt=.7,at=1.4,it=3.5,ct=[d.FabricFeature.MaxStrain,d.FabricFeature.MaxStiffness,d.FabricFeature.VisualStrain,d.FabricFeature.SlackThreshold];function ot(e){var t=new F.Geometry,n=function(e,t){return new F.Vector3(e,t,0)};return t.vertices=[n(0,-it),n(0,it),n(-rt,it),n(rt,it),n(-rt,-it),n(rt,-it)],e&&t.vertices.push(n(-rt,0),n(rt,0)),t}function st(e,t,n,r,a){var i=new Float32Array(2*n.length*3),c=0;e.forEach((function(e){var t=(n[e.index]-r)/(a-r),o=t<-1?-1:t>1?1:t;i[c++]=-rt*at,i[c++]=o*it,i[c++]=0,i[c++]=rt*at,i[c++]=o*it,i[c++]=0}));var o=new F.BufferGeometry;return o.addAttribute("position",new F.Float32BufferAttribute(i,3)),o.addAttribute("color",new F.Float32BufferAttribute(t,3)),o}function lt(e){var t=e.floatFeatures,n=e.tensegrity,r=e.storedState$,a=Object(c.useRef)();return c.createElement(c.Fragment,null,c.createElement(kt,{height:"50%"},c.createElement("div",{style:{position:"absolute",left:"6em"}},"Strain"),c.createElement("div",{style:{position:"absolute",right:"5em"}},"Stiffness"),c.createElement((function(){var e=Object(c.useState)(0),t=Object(be.a)(e,2),i=t[0],o=t[1],s=Object(c.useState)(r.getValue().featureValues[d.FabricFeature.MaxStrain].numeric),l=Object(be.a)(s,2),u=l[0],f=l[1],h=Object(c.useState)(r.getValue().featureValues[d.FabricFeature.MaxStiffness].numeric),m=Object(be.a)(h,2),p=m[0],v=m[1];Object(c.useEffect)((function(){var e=r.subscribe((function(e){f(e.featureValues[d.FabricFeature.MaxStrain].numeric),v(e.featureValues[d.FabricFeature.MaxStiffness].numeric)}));return function(){return e.unsubscribe()}}),[n]),Object(c.useEffect)((function(){var e=setInterval((function(){var e=n.instance.fabric.age;i<e&&o(e)}),1e3);return function(){return clearTimeout(e)}}),[]);var g=n.instance;function b(e){var t=e.position,n=e.intervals,r=e.floats,a=e.mid,i=e.max,o=e.middleTick;return c.createElement("group",{position:new F.Vector3(t,-.15,0)},c.createElement("lineSegments",{geometry:st(n,g.floatView.lineColors,r,a,i),material:Xe}),c.createElement("lineSegments",{geometry:ot(o),material:Ue}))}return c.createElement(ye.a,null,c.createElement("orthographicCamera",{position:new F.Vector3(0,0,-1),ref:a}),c.createElement("scene",null,c.createElement(b,{position:-1.5,intervals:n.intervals,floats:g.floatView.strains,mid:0,max:u,middleTick:!0}),c.createElement(b,{position:1.5,intervals:n.intervals,floats:g.floatView.stiffnesses,mid:0,max:p,middleTick:!1})))}),null)),c.createElement(kt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.M,null)," Adjustments"),ct.map((function(e){return c.createElement(qe,{key:"FabricFeature[".concat(e,"]"),feature:t[e],disabled:!1})}))))}var ut=n(625),ft=n(614),dt=n(615),ht=n(616),mt=n(617);function pt(e){var t=e.rootTenscript,n=e.setRootTenscript,r=e.tensegrity,a=e.runTenscript,i=e.storedState$,o=Object(c.useState)(r&&!r.tenscript.fromUrl?r.tenscript:t),s=Object(be.a)(o,2),l=s[0],u=s[1],f=Object(c.useState)(""),d=Object(be.a)(f,2),h=d[0],m=d[1],p=Object(c.useState)(!1),v=Object(be.a)(p,2),g=v[0],b=v[1],E=Object(c.useState)(ce(i.getValue())),y=Object(be.a)(E,2),w=y[0],S=y[1],F=Object(c.useState)(!1),P=Object(be.a)(F,2),O=P[0],k=P[1];function N(e){var t=function(e,t){var n=t.code,r=t.name,a=ae({},e.recentCode);return a[r]=n,se(e,{recentCode:a})}(i.getValue(),e);S(ce(t)),i.next(t)}return c.createElement("div",{id:"tenscript-panel",style:{flexDirection:"column",position:"relative",backgroundColor:"rgba(0,0,0,1)",height:"100%"}},c.createElement(kt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.L,null)," Tenscript"),c.createElement("div",{id:"code-and-run",style:{flexDirection:"column",height:"available"}},c.createElement(vt,{tenscript:l,setTenscript:u,error:h,setError:m}),c.createElement(Se.a,{className:"w-100 my-2"},c.createElement(we.a,{color:h.length>0?"warning":"success",disabled:h.length>0,onClick:function(){return a(l)}},0===h.length?c.createElement("span",null,"Execute ",c.createElement(Ee.H,null)," tenscript"):c.createElement("span",null,c.createElement(Ee.i,null)," ",h))))),c.createElement(kt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.h,null)," Storage"),0===w.length?void 0:c.createElement(ut.a,{className:"w-100 my-2",isOpen:g,toggle:function(){return b(!g)}},c.createElement(ft.a,{style:{borderRadius:"1.078em"}},g?c.createElement(Ee.J,null):c.createElement(Ee.I,null)," Recent"),c.createElement(dt.a,null,w.map((function(e,t){return c.createElement(ht.a,{key:"Recent".concat(t),onClick:function(){return a(e)}},e.name)})))),c.createElement(Se.a,{className:"w-100 my-2"},c.createElement(we.a,{disabled:l.code===t.code,onClick:function(){n(l),N(l)}},"Save ",c.createElement(Ee.C,null)," for later")),c.createElement(ut.a,{className:"w-100 my-2",isOpen:O,toggle:function(){return k(!O)}},c.createElement(ft.a,{color:"info",style:{borderRadius:"1.078em"}},"Explore ",c.createElement(Ee.D,null)," existing designs"),c.createElement(dt.a,null,te.map((function(e,t){return c.createElement(ht.a,{key:"Boot".concat(t),onClick:function(){return a(e)}},e.name)}))))))}function vt(e){var t=e.tenscript,n=e.setTenscript,r=e.error,a=e.setError,i=Object(c.useState)(""),o=Object(be.a)(i,2),s=o[0],l=o[1];function u(e){l(e),function(e){var t=q(a,!1,e);t&&(a(""),n(t))}(e)}return Object(c.useEffect)((function(){return l(t.code)}),[]),c.createElement("div",{className:"my-2 p-2 w-100",style:{backgroundColor:"#757575",color:"#ffffff",borderStyle:"solid",borderRadius:"1em",borderColor:0===r.length?"black":"#f0ad4e",borderWidth:"2px"}},c.createElement("h6",{className:"w-100 text-center"},c.createElement("i",null,'"',t.name,'"')),c.createElement(mt.a,{style:{borderRadius:"1em",height:"20em"},type:"textarea",id:"tenscript",value:s,onChange:function(e){return u(e.target.value)}}))}var gt=n(561),bt=n(562),Et=n.n(bt);function yt(e){return e.toFixed(5).replace(/[.]/,",")}function wt(){return(new Date).toISOString().replace(/[.].*/,"").replace(/[:T_]/g,"-")}function St(e,t){var n=e.getFabricOutput(t),r=new Et.a;r.file("joints.csv",function(e){var t=[];return t.push(["index","x","y","z"]),e.joints.forEach((function(e){return t.push([(e.index+1).toFixed(0),yt(e.x),yt(e.y),yt(e.z)])})),t.map((function(e){return e.join(";")})).join("\n")}(n)),r.file("intervals.csv",function(e){var t=[];return t.push(["joints","type","strain","stiffness","linear density","role","length"]),e.intervals.forEach((function(e){t.push(['"=""'.concat(e.joints.map((function(e){return(e+1).toFixed(0)})),'"""'),e.type,yt(e.strain),yt(e.stiffness),yt(e.linearDensity),e.role,e.length.toFixed(8)])})),t.map((function(e){return e.join(";")})).join("\n")}(n)),r.file("submerged.csv",function(e){var t=[];return t.push(["joints"]),t.push(['"=""'.concat(e.submergedJoints.map((function(e){return e.index+1})),'"""')]),t.map((function(e){return e.join(";")})).join("\n")}(e)),r.generateAsync({type:"blob",mimeType:"application/zip"}).then((function(e){gt.saveAs(e,"pretenst-".concat(wt(),".zip"))}))}function Ft(e){var t=e.floatFeatures,n=e.tensegrity,r=e.visibleRoles,a=e.setVisibleRoles,i=e.storedState$,o=Object(c.useState)(i.getValue().ellipsoids),s=Object(be.a)(o,2),l=s[0],u=s[1],f=Object(c.useState)(i.getValue().showPushes),h=Object(be.a)(f,2),v=h[0],g=h[1],b=Object(c.useState)(i.getValue().showPulls),E=Object(be.a)(b,2),y=E[0],S=E[1];Object(c.useEffect)((function(){var e=i.subscribe((function(e){u(e.ellipsoids),g(e.showPushes),S(e.showPulls)}));return function(){return e.unsubscribe()}}),[]);var F=Object(c.useState)(n.life),P=Object(be.a)(F,2),O=P[0],k=P[1];function N(e){var t=e.pushes,n=e.pulls,r=e.children;return c.createElement(we.a,{style:{color:"white"},color:t===v&&n===y?"success":"secondary",onClick:function(){i.next(se(i.getValue(),{showPulls:n,showPushes:t}))}},r)}return Object(c.useEffect)((function(){var e=n.life$.subscribe(k);return function(){return e.unsubscribe()}}),[n]),c.createElement("div",null,c.createElement(kt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.t,null)," Coloring"),c.createElement(Se.a,{className:"w-100 my-2"},c.createElement(N,{pushes:!0,pulls:!0},c.createElement("span",null,c.createElement(Ee.x,null)," All")),c.createElement(N,{pushes:!1,pulls:!0},c.createElement("span",null,c.createElement(Ee.R,null)," Pulls")),c.createElement(N,{pushes:!0,pulls:!1},c.createElement("span",null,c.createElement(Ee.s,null)," Pushes")),c.createElement(N,{pushes:!1,pulls:!1},c.createElement("span",null,c.createElement(Ee.m,null)," Roles")))),c.createElement(kt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.j,null)," Snapshot"),c.createElement(Se.a,{size:"sm",className:"w-100"},p.map((function(e){return c.createElement(we.a,{color:r.indexOf(e)<0?"secondary":"success",key:"viz".concat(e),onClick:function(){r.indexOf(e)<0?a([].concat(Object(w.a)(r),[e])):a(r.filter((function(t){return t!==e})))},disabled:!l},m(e))}))),c.createElement(qe,{key:"pushrad",feature:t[d.FabricFeature.PushRadius],disabled:!l}),c.createElement(qe,{key:"pullrad",feature:t[d.FabricFeature.PullRadius],disabled:!l}),c.createElement(qe,{key:"jointrad",feature:t[d.FabricFeature.JointRadius],disabled:!l})),c.createElement(kt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.n,null)," Time"),c.createElement(qe,{key:"it",feature:t[d.FabricFeature.IterationsPerFrame],disabled:l}),c.createElement(qe,{key:"ic",feature:t[d.FabricFeature.IntervalCountdown],disabled:l}),c.createElement(qe,{key:"pc",feature:t[d.FabricFeature.RealizingCountdown],disabled:l})),c.createElement(kt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.w,null)," Perturb"),c.createElement(Se.a,{className:"w-100"},c.createElement(we.a,{disabled:O.stage!==d.Stage.Realized,onClick:function(){return n.instance.fabric.set_altitude(1)}},c.createElement(Ee.A,null)," Nudge"),c.createElement(we.a,{disabled:O.stage!==d.Stage.Realized,onClick:function(){return n.instance.fabric.set_altitude(10)}},c.createElement(Ee.G,null)," Drop"),c.createElement(we.a,{disabled:l,onClick:function(){return n.instance.fabric.centralize()}},c.createElement(Ee.p,null)," Centralize"))),c.createElement(kt,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(Ee.K,null)," Take"),c.createElement(Se.a,{vertical:!1,className:"w-100"},c.createElement(we.a,{onClick:function(){return St(n,i.getValue())}},c.createElement(Ee.q,null)," Download CSV ",c.createElement(Ee.v,null)),c.createElement(we.a,{onClick:function(){return function(e,t){var n=e.getFabricOutput(t),r=new Et.a;r.file("pretenst-".concat(wt(),".json"),JSON.stringify(n,void 0,2)),r.generateAsync({type:"blob",mimeType:"application/zip"}).then((function(e){gt.saveAs(e,"pretenst-".concat(wt(),".zip"))}))}(n,i.getValue())}},c.createElement(Ee.q,null)," Download JSON ",c.createElement(Ee.u,null)))))}var Pt="25em";function Ot(e){var t=e.floatFeatures,n=e.rootTenscript,r=e.setRootTenscript,a=e.shapeSelection,i=e.setShapeSelection,o=e.selectedFaces,s=e.clearSelectedFaces,l=e.selectedIntervals,u=e.tensegrity,f=e.setFabric,d=e.runTenscript,h=e.visibleRoles,m=e.setVisibleRoles,p=e.toFullScreen,v=e.storedState$,g=Object(c.useState)(u?u.life:void 0),b=Object(be.a)(g,2),E=b[0],y=b[1];Object(c.useEffect)((function(){var e=u?u.life$.subscribe(y):void 0;return function(){e&&e.unsubscribe()}}),[u]);var w=Object(c.useState)(v.getValue().controlTab),S=Object(be.a)(w,2),F=S[0],P=S[1];function O(e){var t=e.tab;return c.createElement(Te.a,null,c.createElement(Ae.a,{active:F===t,onClick:function(){return v.next(se(v.getValue(),{controlTab:t}))}},t))}function k(e){var p=e.tab,g=c.createElement(_e.a,{color:"warning"},"No fabric");return c.createElement(De.a,{id:"tab-pane",style:{height:"100%"},tabId:p},c.createElement((function(){switch(p){case ee.Grow:return c.createElement(pt,{rootTenscript:n,setRootTenscript:r,tensegrity:u,runTenscript:d,storedState$:v});case ee.Shape:return u?c.createElement(tt,{floatFeatures:t,tensegrity:u,setFabric:f,selectedIntervals:l,shapeSelection:a,setShapeSelection:i,selectedFaces:o,clearSelectedFaces:s,storedState$:v}):g;case ee.Realize:return u?c.createElement(nt,{floatFeatures:t,tensegrity:u,shapeSelection:a,storedState$:v}):g;case ee.View:return u?c.createElement(Ft,{floatFeatures:t,tensegrity:u,visibleRoles:h,setVisibleRoles:m,storedState$:v}):g;case ee.Strain:return u?c.createElement(lt,{floatFeatures:t,tensegrity:u,storedState$:v}):g}}),null))}return Object(c.useEffect)((function(){F!==ee.Shape&&s()}),[F,E]),Object(c.useEffect)((function(){var e=v.subscribe((function(e){return P(e.controlTab)}));return function(){return e.unsubscribe()}}),[]),c.createElement("div",{className:"h-100"},c.createElement(Le.a,{tabs:!0,style:{backgroundColor:"#b2b2b2"}},Object.keys(ee).map((function(e){return c.createElement(O,{key:"T".concat(e),tab:ee[e]})}))),c.createElement(ze.a,{style:{flex:1,flexFlow:"auto",height:"100%"},id:"tab-content",activeTab:F},Object.keys(ee).map((function(e){return c.createElement(k,{key:e,tab:ee[e]})}))),c.createElement("div",{style:{position:"absolute",top:0,height:"100%",left:Pt,zIndex:10,width:"1em"}},c.createElement((function(){return c.createElement(we.a,{style:{padding:0,margin:0,borderRadius:0,width:"1em"},className:"w-100 h-100",color:"dark",onClick:p},c.createElement(Ee.c,null))}),null)))}function kt(e){var t=e.children,n=e.height;return c.createElement("div",{className:"m-3 p-2",style:{height:n,borderRadius:"1em",borderStyle:"solid",borderWidth:"0.1em",borderColor:"#45782e"}},t)}var Nt=n(612),jt=n(610),xt=n(611),Ct={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},Vt={type:"change"},Rt={type:"start"},It={type:"end"},Mt=function(e){function t(e,n){var r;return Object(u.a)(this,t),(r=Object(Nt.a)(this,Object(jt.a)(t).call(this))).object=void 0,r.element=void 0,r.window=void 0,r.enabled=void 0,r.target=void 0,r.enableZoom=void 0,r.zoomSpeed=void 0,r.minDistance=void 0,r.maxDistance=void 0,r.enableRotate=void 0,r.rotateSpeed=void 0,r.enablePan=void 0,r.keyPanSpeed=void 0,r.autoRotate=void 0,r.autoRotateSpeed=void 0,r.minZoom=void 0,r.maxZoom=void 0,r.minPolarAngle=void 0,r.maxPolarAngle=void 0,r.minAzimuthAngle=void 0,r.maxAzimuthAngle=void 0,r.keys=void 0,r.mouseButtons=void 0,r.enableDamping=void 0,r.dampingFactor=void 0,r.spherical=void 0,r.sphericalDelta=void 0,r.scale=void 0,r.target0=void 0,r.position0=void 0,r.zoom0=void 0,r.state=void 0,r.panOffset=void 0,r.zoomChanged=void 0,r.rotateStart=void 0,r.rotateEnd=void 0,r.rotateDelta=void 0,r.panStart=void 0,r.panEnd=void 0,r.panDelta=void 0,r.dollyStart=void 0,r.dollyEnd=void 0,r.dollyDelta=void 0,r.updateLastPosition=void 0,r.updateOffset=void 0,r.updateQuat=void 0,r.updateLastQuaternion=void 0,r.updateQuatInverse=void 0,r.panLeftV=void 0,r.panUpV=void 0,r.panInternalOffset=void 0,r.onMouseUp=void 0,r.onMouseDown=void 0,r.onMouseMove=void 0,r.onMouseWheel=void 0,r.onTouchStart=void 0,r.onTouchEnd=void 0,r.onTouchMove=void 0,r.object=e,r.element=n,r.window=window,r.enabled=!0,r.target=new F.Vector3,r.minDistance=0,r.maxDistance=1/0,r.minZoom=0,r.maxZoom=1/0,r.minPolarAngle=0,r.maxPolarAngle=Math.PI,r.minAzimuthAngle=-1/0,r.maxAzimuthAngle=1/0,r.enableDamping=!1,r.dampingFactor=.25,r.enableZoom=!0,r.zoomSpeed=1,r.enableRotate=!0,r.rotateSpeed=1,r.enablePan=!0,r.keyPanSpeed=7,r.autoRotate=!1,r.autoRotateSpeed=2,r.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},r.mouseButtons={ORBIT:F.MOUSE.LEFT,ZOOM:F.MOUSE.MIDDLE,PAN:F.MOUSE.RIGHT},r.target0=r.target.clone(),r.position0=r.object.position.clone(),r.zoom0=r.object.zoom,r.updateOffset=new F.Vector3,r.updateQuat=(new F.Quaternion).setFromUnitVectors(r.object.up,new F.Vector3(0,1,0)),r.updateQuatInverse=r.updateQuat.clone().inverse(),r.updateLastPosition=new F.Vector3,r.updateLastQuaternion=new F.Quaternion,r.state=Ct.NONE,r.scale=1,r.spherical=new F.Spherical,r.sphericalDelta=new F.Spherical,r.panOffset=new F.Vector3,r.zoomChanged=!1,r.rotateStart=new F.Vector2,r.rotateEnd=new F.Vector2,r.rotateDelta=new F.Vector2,r.panStart=new F.Vector2,r.panEnd=new F.Vector2,r.panDelta=new F.Vector2,r.dollyStart=new F.Vector2,r.dollyEnd=new F.Vector2,r.dollyDelta=new F.Vector2,r.panLeftV=new F.Vector3,r.panUpV=new F.Vector3,r.panInternalOffset=new F.Vector3,r.onMouseDown=function(e){if(e.preventDefault(),r.enabled){if(e.button===r.mouseButtons.ORBIT){if(!r.enableRotate)return;r.rotateStart.set(e.clientX,e.clientY),r.state=Ct.ROTATE}else if(e.button===r.mouseButtons.ZOOM){if(!r.enableZoom)return;r.dollyStart.set(e.clientX,e.clientY),r.state=Ct.DOLLY}else if(e.button===r.mouseButtons.PAN){if(!r.enablePan)return;r.panStart.set(e.clientX,e.clientY),r.state=Ct.PAN}r.state!==Ct.NONE&&(document.addEventListener("mousemove",r.onMouseMove,!1),document.addEventListener("mouseup",r.onMouseUp,!1),r.dispatchEvent(Rt))}},r.onMouseMove=function(e){if(e.preventDefault(),r.enabled)if(r.state===Ct.ROTATE){if(!r.enableRotate)return;r.rotateEnd.set(e.clientX,e.clientY),r.rotateDelta.subVectors(r.rotateEnd,r.rotateStart),r.rotateLeft(2*Math.PI*r.rotateDelta.x/r.element.clientWidth*r.rotateSpeed),r.rotateUp(2*Math.PI*r.rotateDelta.y/r.element.clientHeight*r.rotateSpeed),r.rotateStart.copy(r.rotateEnd),r.update()}else if(r.state===Ct.DOLLY){if(!r.enableZoom)return;r.dollyEnd.set(e.clientX,e.clientY),r.dollyDelta.subVectors(r.dollyEnd,r.dollyStart),r.dollyDelta.y>0?r.dollyIn(r.getZoomScale()):r.dollyDelta.y<0&&r.dollyOut(r.getZoomScale()),r.dollyStart.copy(r.dollyEnd),r.update()}else if(r.state===Ct.PAN){if(!r.enablePan)return;r.panEnd.set(e.clientX,e.clientY),r.panDelta.subVectors(r.panEnd,r.panStart),r.pan(r.panDelta.x,r.panDelta.y),r.panStart.copy(r.panEnd),r.update()}},r.onMouseUp=function(e){e.preventDefault(),r.enabled&&(document.removeEventListener("mousemove",r.onMouseMove,!1),document.removeEventListener("mouseup",r.onMouseUp,!1),r.dispatchEvent(It),r.state=Ct.NONE)},r.onMouseWheel=function(e){e.preventDefault(),r.enabled&&r.enableZoom&&(r.state===Ct.NONE||r.state===Ct.ROTATE)&&(e.stopPropagation(),e.deltaY<0?r.dollyOut(r.getZoomScale()):e.deltaY>0&&r.dollyIn(r.getZoomScale()),r.update(),r.dispatchEvent(Rt),r.dispatchEvent(It))},r.onTouchStart=function(e){if(e.preventDefault(),r.enabled){switch(e.touches.length){case 1:if(!r.enableRotate)return;r.rotateStart.set(e.touches[0].pageX,e.touches[0].pageY),r.state=Ct.TOUCH_ROTATE;break;case 2:if(!r.enableZoom)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);r.dollyStart.set(0,a),r.state=Ct.TOUCH_DOLLY;break;case 3:if(!r.enablePan)return;r.panStart.set(e.touches[0].pageX,e.touches[0].pageY),r.state=Ct.TOUCH_PAN;break;default:r.state=Ct.NONE}r.state!==Ct.NONE&&r.dispatchEvent(Rt)}},r.onTouchMove=function(e){if(e.preventDefault(),r.enabled)switch(e.touches.length){case 1:if(!r.enableRotate)return;if(r.state!==Ct.TOUCH_ROTATE)return;r.rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY),r.rotateDelta.subVectors(r.rotateEnd,r.rotateStart),r.rotateLeft(2*Math.PI*r.rotateDelta.x/r.element.clientWidth*r.rotateSpeed),r.rotateUp(2*Math.PI*r.rotateDelta.y/r.element.clientHeight*r.rotateSpeed),r.rotateStart.copy(r.rotateEnd),r.update();break;case 2:if(!r.enableZoom)return;if(r.state!==Ct.TOUCH_DOLLY)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);r.dollyEnd.set(0,a),r.dollyDelta.subVectors(r.dollyEnd,r.dollyStart),r.dollyDelta.y>0?r.dollyOut(r.getZoomScale()):r.dollyDelta.y<0&&r.dollyIn(r.getZoomScale()),r.dollyStart.copy(r.dollyEnd),r.update();break;case 3:if(!r.enablePan)return;if(r.state!==Ct.TOUCH_PAN)return;r.panEnd.set(e.touches[0].pageX,e.touches[0].pageY),r.panDelta.subVectors(r.panEnd,r.panStart),r.pan(r.panDelta.x,r.panDelta.y),r.panStart.copy(r.panEnd),r.update();break;default:r.state=Ct.NONE}},r.onTouchEnd=function(e){e.preventDefault(),r.enabled&&(r.dispatchEvent(It),r.state=Ct.NONE)},r.element.addEventListener("mousedown",r.onMouseDown,{capture:!0}),r.element.addEventListener("wheel",r.onMouseWheel,{capture:!0}),r.element.addEventListener("touchstart",r.onTouchStart,{capture:!0}),r.element.addEventListener("touchend",r.onTouchEnd,{capture:!0}),r.element.addEventListener("touchmove",r.onTouchMove,{capture:!0}),r.update(),r}return Object(xt.a)(t,e),Object(f.a)(t,[{key:"update",value:function(){var e=this.object.position;return this.updateOffset.copy(e).sub(this.target),this.updateOffset.applyQuaternion(this.updateQuat),this.spherical.setFromVector3(this.updateOffset),this.autoRotate&&this.state===Ct.NONE&&this.rotateLeft(this.getAutoRotationAngle()),this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi,this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),this.target.add(this.panOffset),this.updateOffset.setFromSpherical(this.spherical),this.updateOffset.applyQuaternion(this.updateQuatInverse),e.copy(this.target).add(this.updateOffset),this.object.lookAt(this.target),this.enableDamping?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor):this.sphericalDelta.set(0,0,0),this.scale=1,this.panOffset.set(0,0,0),!!(this.zoomChanged||this.updateLastPosition.distanceToSquared(this.object.position)>1e-6||8*(1-this.updateLastQuaternion.dot(this.object.quaternion))>1e-6)&&(this.dispatchEvent(Vt),this.updateLastPosition.copy(this.object.position),this.updateLastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0)}},{key:"panLeft",value:function(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}},{key:"panUp",value:function(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}},{key:"pan",value:function(e,t){var n=this.element,r=this.object.position;this.panInternalOffset.copy(r).sub(this.target);var a=this.panInternalOffset.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*a/n.clientHeight,this.object.matrix),this.panUp(2*t*a/n.clientHeight,this.object.matrix)}},{key:"dollyIn",value:function(e){this.scale/=e}},{key:"dollyOut",value:function(e){this.scale*=e}},{key:"getAutoRotationAngle",value:function(){return 2*Math.PI/60/60*this.autoRotateSpeed}},{key:"getZoomScale",value:function(){return Math.pow(.95,this.zoomSpeed)}},{key:"rotateLeft",value:function(e){this.sphericalDelta.theta-=e}},{key:"rotateUp",value:function(e){this.sphericalDelta.phi-=e}},{key:"getPolarAngle",value:function(){return this.spherical.phi}},{key:"getAzimuthalAngle",value:function(){return this.spherical.theta}},{key:"dispose",value:function(){this.element.removeEventListener("mousedown",this.onMouseDown,!1),this.element.removeEventListener("wheel",this.onMouseWheel,!1),this.element.removeEventListener("touchstart",this.onTouchStart,!1),this.element.removeEventListener("touchend",this.onTouchEnd,!1),this.element.removeEventListener("touchmove",this.onTouchMove,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1)}},{key:"reset",value:function(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Vt),this.update(),this.state=Ct.NONE}}]),t}(F.EventDispatcher),Tt=[new F.Vector3(0,0,-20),new F.Vector3(-17.32,0,-10),new F.Vector3(-17.32,0,10),new F.Vector3(0,0,20),new F.Vector3(17.32,0,10),new F.Vector3(17.32,0,-10)],At=new F.Color("tan"),_t=6,Dt=new F.Vector3(0,1,0),Lt=.03;function zt(){var e=Object(c.useMemo)((function(){return function(){var e=new F.Geometry;return function(e,t){e.push.apply(e,Object(w.a)(Tt.map((function(e){return new F.Vector3(e.x,e.y,e.z)})))),e.push(new F.Vector3);for(var n=0;n<_t;n++){var r=(n+1)%_t,a=[Dt,(new F.Vector3).add(Dt).addScaledVector(Tt[n],Lt).normalize(),(new F.Vector3).add(Dt).addScaledVector(Tt[r],Lt).normalize()];t.push(new F.Face3(_t,n,r,a,At))}}(e.vertices,e.faces),e.vertices.forEach((function(e){return e.sub(new F.Vector3(0,.01,0))})),e.computeBoundingSphere(),e}()}),[]);return c.createElement("mesh",{name:"Spots",geometry:e,material:Ye})}Object(ye.b)({Orbit:Mt});var Bt=new F.SphereGeometry(1,32,8),Zt=new F.CylinderGeometry(1,1,1,12,1,!1),Yt=new F.CylinderGeometry(.5,.5,1,6,1,!1),Xt=new F.CylinderGeometry(1,1,.85,12,1,!1),Ut=new F.Color("#ffffff"),$t=100,Gt=1,Wt=new F.SphereGeometry($t,25,25).scale(Gt,Gt,Gt),Jt=.01,Qt=4,Ht=new F.Vector3(0,1,0);function qt(e){var t=e.tensegrity,n=e.fabricError,r=e.selectedIntervals,a=e.selectedFaces,i=e.setSelectedFaces,o=e.storedState$,s=e.shapeSelection,l=e.ellipsoids,u=e.visibleRoles,f=document.getElementById("view-container"),h=Object(c.useState)(0),m=Object(be.a)(h,2),p=m[0],v=m[1],g=Object(ye.d)().camera,b=Object(c.useMemo)((function(){var e=(new F.TextureLoader).load("space.jpg");return new F.MeshPhongMaterial({map:e,side:F.BackSide})}),[]),E=Object(c.useState)(t.life),y=Object(be.a)(E,2),S=y[0],P=y[1];Object(c.useEffect)((function(){var e=t.life$.subscribe(P);return function(){return e.unsubscribe()}}),[t]);var O=Object(c.useState)(o.getValue()),k=Object(be.a)(O,2),N=k[0],j=k[1];Object(c.useEffect)((function(){var e=o.subscribe((function(e){return j(e)}));return function(){return e.unsubscribe()}}),[]),Object(c.useEffect)((function(){x.current.autoRotate=N.rotating}),[N]);var x=Object(ye.e)((function(e){var t=new F.Vector3(0,Qt,0);g.position.set(t.x,Qt,t.z+4*Qt),g.lookAt(x.current.target),g.fov=60,g.far=2*$t,g.near=.001,e.object=g,e.minPolarAngle=-.98*Math.PI/2,e.maxPolarAngle=.8*Math.PI,e.maxDistance=$t*Gt*.9,e.zoomSpeed=.5,e.enableZoom=!0,e.target.set(t.x,t.y,t.z),e.update()}),[]);return Object(ye.c)((function(){try{var e=t.instance,r=e.view,a=new F.Vector3(r.midpoint_x(),r.midpoint_y(),r.midpoint_z()),i=(new F.Vector3).subVectors(a,x.current.target).multiplyScalar(Jt);if(x.current.target.add(i),x.current.update(),!l&&s!==Ie.Faces){var c=t.iterate();S.stage===d.Stage.Realizing&&c===d.Stage.Realized?setTimeout((function(){return t.toStage(d.Stage.Realized,{})})):c!==S.stage&&S.stage!==d.Stage.Realizing&&c!==d.Stage.Busy&&setTimeout((function(){return t.toStage(c,{})}))}v(e.fabric.age)}catch(o){n(o)}}),!0,[t,p,S,s,l]),c.createElement("group",null,c.createElement("orbit",{ref:x,args:[g,f]}),c.createElement("scene",null,l?c.createElement(tn,{key:"ellipsoid",tensegrity:t,selectedIntervals:r,storedState:N,visibleRoles:u}):c.createElement(nn,{key:"lines",tensegrity:t,selectedIntervals:r,storedState:N}),s!==Ie.Faces?void 0:c.createElement(rn,{key:"faces",tensegrity:t,stage:S.stage,selectFace:function(e){a.some((function(t){return t.index===e.index}))?i(a.filter((function(t){return t.index!==e.index}))):i([].concat(Object(w.a)(a),[e]))}}),a.map((function(e){return c.createElement(Kt,{key:"Face".concat(e.index),tensegrity:t,face:e})})),c.createElement(zt,null),c.createElement("mesh",{key:"space",geometry:Wt,material:b}),c.createElement("ambientLight",{color:Ut,intensity:.8}),c.createElement("directionalLight",{color:new F.Color("#FFFFFF"),intensity:2})))}function Kt(e){e.tensegrity;var t=e.face,n=_(t.brick.scale)/8;return c.createElement("mesh",{geometry:Bt,position:t.location(),material:Ge,scale:new F.Vector3(n,n,n)})}function en(e){var t=e.tensegrity,n=e.interval,r=e.storedState,a=He(n.intervalRole);if((r.showPushes||r.showPulls)&&(a=function(e){var t=Math.floor(e*Je.length);return Je[t>=Je.length?Je.length-1:t]}(t.instance.floatView.strainNuances[n.index]),(!r.showPushes||!r.showPulls)&&(r.showPushes&&!n.isPush||r.showPulls&&n.isPush)))return c.createElement("group",null);var i=t.instance.floatView.linearDensities[n.index],o=r.featureValues[n.isPush?d.FabricFeature.PushRadius:d.FabricFeature.PullRadius].numeric*i,s=t.instance.unitVector(n.index),l=(new F.Quaternion).setFromUnitVectors(Ht,s),u=n.alpha.location().distanceTo(n.omega.location()),f=o*r.featureValues[d.FabricFeature.JointRadius].numeric,h=new F.Vector3(o,u+(n.isPush?2*-f:0),o),m=new F.Vector3(f,f,f);return c.createElement(c.Fragment,null,n.isPush?c.createElement(c.Fragment,null,c.createElement("mesh",{geometry:Yt,position:n.location(),rotation:(new F.Euler).setFromQuaternion(l),scale:h,material:a,matrixWorldNeedsUpdate:!0}),c.createElement("mesh",{geometry:Xt,position:n.location(),rotation:(new F.Euler).setFromQuaternion(l),scale:h,material:a,matrixWorldNeedsUpdate:!0}),c.createElement("mesh",{geometry:Bt,position:n.alpha.location(),material:We,scale:m,matrixWorldNeedsUpdate:!0}),c.createElement("mesh",{geometry:Bt,position:n.omega.location(),material:We,scale:m,matrixWorldNeedsUpdate:!0})):c.createElement("mesh",{geometry:Zt,position:n.location(),rotation:(new F.Euler).setFromQuaternion(l),scale:h,material:a,matrixWorldNeedsUpdate:!0}))}function tn(e){var t=e.tensegrity,n=e.visibleRoles,r=e.selectedIntervals,a=e.storedState;return c.createElement("group",null,r.length>0?r.map((function(e){return c.createElement(en,{key:"SI".concat(e.index),tensegrity:t,interval:e,storedState:a})})):t.intervals.map((function(e){return n.indexOf(e.intervalRole)<0?void 0:c.createElement(en,{key:"I".concat(e.index),tensegrity:t,interval:e,storedState:a})})),"}")}function nn(e){var t=e.tensegrity,n=e.selectedIntervals,r=e.storedState;return c.createElement("group",null,c.createElement("lineSegments",{key:"lines",geometry:t.linesGeometry,material:Xe}),n.map((function(e){return c.createElement(en,{key:"SI".concat(e.index),tensegrity:t,interval:e,storedState:r})})))}function rn(e){var t=e.tensegrity,n=e.stage,r=e.selectFace,a=Object(ye.d)().raycaster,i=Object(c.useRef)(),o=Object(c.useState)(),s=Object(be.a)(o,2),l=s[0],u=s[1];return c.createElement("mesh",{key:"faces",ref:i,onPointerDown:function(e){return u(e)},onPointerUp:function(e){var c=i.current;if(!function(e){return e===d.Stage.Growing||e===d.Stage.Slack}(n)&&l&&c){var o=l.clientX-e.clientX,s=l.clientY-e.clientY;if(!(o*o+s*s>100)){var f=a.intersectObjects([c],!0).map((function(e){return e.faceIndex})).map((function(e){if(void 0!==e)return t.faces[e]})).reverse().pop();u(void 0),f&&r(f)}}},geometry:t.facesGeometry,material:$e})}var an="25em",cn="26em";function on(e){var t=function(){var e=location.hash.substring(1);try{return q((function(e){return console.error(e)}),!0,decodeURIComponent(e))}catch(t){console.error("Code error",t)}}();if(t)return t;var n=ce(e);return n.length>0?n[0]:te[0]}function sn(e){var t=e.eig,n=e.floatFeatures,r=e.storedState$,a=Object(c.useMemo)((function(){return new ke(t,100)}),[]),i=Object(c.useState)(),o=Object(be.a)(i,2),s=o[0],l=o[1],u=Object(c.useState)([]),f=Object(be.a)(u,2),h=f[0],m=f[1],v=Object(c.useState)([]),b=Object(be.a)(v,2),E=b[0],y=b[1];Object(c.useEffect)((function(){return m(E.reduce((function(e,t){var n=function(t){return!e.some((function(e){return t.index===e.index}))},r=t.pulls.filter(n),a=t.pushes.filter(n);return[].concat(Object(w.a)(e),Object(w.a)(a),Object(w.a)(r))}),[]))}),[E]);var S=Object(c.useState)((function(){return on(r.getValue())})),F=Object(be.a)(S,2),P=F[0],O=F[1];Object(c.useEffect)((function(){0===location.hash.length&&(location.hash=P.code)}),[P]);var k=Object(c.useState)(p),N=Object(be.a)(k,2),j=N[0],x=N[1],C=Object(c.useState)(r.getValue().rotating),V=Object(be.a)(C,2),R=V[0],I=V[1],M=Object(c.useState)(Ie.None),T=Object(be.a)(M,2),A=T[0],D=T[1],L=Object(c.useState)(r.getValue().fullScreen),z=Object(be.a)(L,2),B=z[0],Z=z[1],Y=Object(c.useState)(r.getValue().ellipsoids),X=Object(be.a)(Y,2),U=X[0],$=X[1];function G(e){if(a){location.hash=e.code,n[d.FabricFeature.ShapingPretenstFactor].percent=100,n[d.FabricFeature.ShapingDrag].percent=100,n[d.FabricFeature.ShapingStiffnessFactor].percent=100,r.next(se(r.getValue(),{ellipsoids:!1}));l(new Ve((function(e){return function(e,t){if(t===d.IntervalRole.FaceConnector||t===d.IntervalRole.FaceDistancer)throw new Error;return e[oe(t)].numeric}(n,e)}),(function(e){return r.getValue().featureValues[e].numeric}),a,e))}}function W(e){r.next(se(r.getValue(),{fullScreen:e}))}return Object(c.useEffect)((function(){return x(p)}),[U]),Object(c.useEffect)((function(){var e=r.subscribe((function(e){Z(e.fullScreen),$(e.ellipsoids),I(e.rotating),s&&(a.world.set_coloring(e.showPushes,e.showPulls),a.world.set_surface_character(e.surfaceCharacter))}));return function(){return e.unsubscribe()}}),[s]),Object(c.useEffect)((function(){var e=Object.keys(n).map((function(e){return n[e]})).map((function(e){return e.observable.subscribe((function(t){if(s){s.instance.applyFeature(e);var n=g(e.config.feature);void 0!==n&&s.intervals.filter((function(e){return e.intervalRole===n})).forEach((function(t){var n=e.numeric*_(t.scale);s.instance.fabric.change_rest_length(t.index,n,500)}))}}))}));return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[s]),Object(c.useEffect)((function(){var e=setTimeout((function(){s||G(P)}),200);return function(){return clearTimeout(e)}}),[P]),c.createElement(c.Fragment,null,B?c.createElement(we.a,{id:"to-full-screen",color:"dark",onClick:function(){return W(!1)}},c.createElement(Ee.d,null),c.createElement("br",null),c.createElement(Ee.P,null),c.createElement("br",null),c.createElement(Ee.d,null)):c.createElement("div",{id:"left-side",style:{visibility:B?"collapse":"visible",width:an}},c.createElement(Ot,{floatFeatures:n,rootTenscript:P,setRootTenscript:O,tensegrity:s,setFabric:l,selectedIntervals:h,shapeSelection:A,setShapeSelection:D,selectedFaces:E,clearSelectedFaces:function(){return y([])},runTenscript:G,toFullScreen:function(){return W(!0)},visibleRoles:j,setVisibleRoles:x,storedState$:r})),c.createElement("div",{style:{position:"absolute",left:B?0:cn,right:0,height:"100%"}},s?c.createElement("div",{className:"h-100"},c.createElement(ln,{tensegrity:s}),c.createElement("div",{id:"bottom-middle"},c.createElement(Se.a,null,c.createElement(we.a,{color:U?"warning":"secondary",onClick:function(){return r.next(se(r.getValue(),{ellipsoids:!U}))}},c.createElement(Ee.j,null)),c.createElement(we.a,{color:A===Ie.Faces?"warning":"secondary",disabled:U&&A===Ie.None,onClick:function(){return D(A!==Ie.Faces?Ie.Faces:Ie.None)}},c.createElement("span",null,c.createElement(Ee.z,null))),c.createElement(we.a,{color:R?"warning":"secondary",onClick:function(){return r.next(se(r.getValue(),{rotating:!R}))}},c.createElement(Ee.N,null)))),c.createElement("div",{id:"view-container",className:"h-100"},c.createElement(ye.a,{style:{backgroundColor:"black",borderStyle:"solid",borderColor:A===Ie.Faces||U?"#f0ad4e":"black",cursor:A===Ie.Faces?"pointer":"all-scroll",borderWidth:"2px"}},c.createElement(qt,{tensegrity:s,fabricError:function(e){console.error(e);var t=s.tenscript;l(void 0),setTimeout((function(){return G(t)}),1e3)},selectedIntervals:h,selectedFaces:E,setSelectedFaces:y,shapeSelection:A,ellipsoids:U,visibleRoles:j,storedState$:r})))):c.createElement("div",{id:"tensegrity-view",className:"h-100"},c.createElement("div",{style:{position:"relative",top:"50%",left:"50%"}},c.createElement(we.a,{onClick:function(){return G(P)}},c.createElement("h6",null,P.name),c.createElement("h1",null,c.createElement(Ee.H,null)))))))}function ln(e){var t=e.tensegrity,n=Object(c.useState)(t.life),r=Object(be.a)(n,2),a=r[0],i=r[1];return Object(c.useEffect)((function(){var e=t.life$.subscribe(i);return function(){return e.unsubscribe()}}),[t]),c.createElement("div",{id:"top-middle"},c.createElement("span",null,d.Stage[a.stage])," ",c.createElement("i",null,'"',t.tenscript.name,'"'))}function un(e){return fn.apply(this,arguments)}function fn(){return(fn=Object(i.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=document.getElementById("root"),(r=new s.BehaviorSubject(ue(de,t.default_fabric_feature))).subscribe((function(e){return t=e,void localStorage.setItem(le,JSON.stringify(t));var t})),o.render(c.createElement(sn,{eig:t,floatFeatures:me(r,t.default_fabric_feature),storedState$:r}),n),ve();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n.d(t,"startReact",(function(){return un}))}}]);
//# sourceMappingURL=4.d389a029.chunk.js.map