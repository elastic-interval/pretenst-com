(window.webpackJsonppretenst=window.webpackJsonppretenst||[]).push([[4],{567:function(e,t){},569:function(e,t){},8:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(1),c=n(10),o=n(80),s=n(81),l=n(74),u=n(34),f=n(35),d=n(7);var h=Object.keys(d.FabricFeature).filter((function(e){return isNaN(parseInt(e,10))})).map((function(e){return d.FabricFeature[e]}));function m(e){switch(e){case d.IntervalRole.NexusPush:return"Nex Push";case d.IntervalRole.ColumnPush:return"Col Push";case d.IntervalRole.Triangle:return"Tri";case d.IntervalRole.Ring:return"Ring";case d.IntervalRole.NexusCross:return"Nex Cross";case d.IntervalRole.ColumnCross:return"Col Cross";case d.IntervalRole.BowMid:return"Bow Mid";case d.IntervalRole.BowEnd:return"Bow End";case d.IntervalRole.FacePull:return"Face Pull";default:return"?"}}var p=Object.keys(d.IntervalRole).filter((function(e){return d.IntervalRole[e]!==d.IntervalRole.FacePull})).map((function(e){return d.IntervalRole[e]}));function b(e){return e===d.IntervalRole.ColumnPush||e===d.IntervalRole.NexusPush}function v(e){switch(e){case d.FabricFeature.NexusPushLength:return d.IntervalRole.NexusPush;case d.FabricFeature.ColumnPushLength:return d.IntervalRole.ColumnPush;case d.FabricFeature.TriangleLength:return d.IntervalRole.Triangle;case d.FabricFeature.RingLength:return d.IntervalRole.Ring;case d.FabricFeature.NexusCrossLength:return d.IntervalRole.NexusCross;case d.FabricFeature.ColumnCrossLength:return d.IntervalRole.ColumnCross;case d.FabricFeature.BowMidLength:return d.IntervalRole.BowMid;case d.FabricFeature.BowEndLength:return d.IntervalRole.BowEnd;default:return}}var g,E,w,S=n(43),y=n(29),P=1.61803398875,O=Math.sqrt(2);!function(e){e[e.XP=0]="XP",e[e.XN=1]="XN",e[e.YP=2]="YP",e[e.YN=3]="YN",e[e.ZP=4]="ZP",e[e.ZN=5]="ZN"}(g||(g={})),function(e){e[e.XPA=0]="XPA",e[e.XPO=1]="XPO",e[e.XNA=2]="XNA",e[e.XNO=3]="XNO",e[e.YPA=4]="YPA",e[e.YPO=5]="YPO",e[e.YNA=6]="YNA",e[e.YNO=7]="YNO",e[e.ZPA=8]="ZPA",e[e.ZPO=9]="ZPO",e[e.ZNA=10]="ZNA",e[e.ZNO=11]="ZNO"}(E||(E={})),function(e){e[e.NNN=0]="NNN",e[e.PNN=1]="PNN",e[e.NPN=2]="NPN",e[e.NNP=3]="NNP",e[e.NPP=4]="NPP",e[e.PNP=5]="PNP",e[e.PPN=6]="PPN",e[e.PPP=7]="PPP"}(w||(w={}));var F,k=[w.NNN,w.PNN,w.NPN,w.NNP,w.NPP,w.PNP,w.PPN,w.PPP],N="aBCDbcdA";function x(e,t){if(e.alpha.index===t.index)return e.omega;if(e.omega.index===t.index)return e.alpha;throw new Error("Other of what?")}function j(e,t){var n=t.filter((function(t){return t.alpha.index===e.index||t.omega.index===e.index})),r=n.find((function(e){return e.isPush}));if(!r)throw new Error("No push on joint");var a=function(t){return(new y.Vector3).subVectors(x(t,e).location(),e.location()).normalize()},i=a(r);n.sort((function(e,t){var n=a(e).dot(i),r=a(t).dot(i);return n<r?1:n>r?-1:0})),n.shift();var c=a(n[0]),o=(new y.Vector3).addScaledVector(i,c.dot(i)),s=(new y.Vector3).subVectors(c,o).normalize(),l=(new y.Quaternion).setFromUnitVectors(i,s),u=(new y.Vector3).crossVectors(i,s);return n.map((function(t){var n=a(t),r=(new y.Vector3).addScaledVector(i,n.dot(i)),c=(new y.Vector3).subVectors(n,r).normalize(),o=(new y.Vector3).crossVectors(i,n),s=(new y.Quaternion).setFromUnitVectors(i,c),f=180*Math.acos(i.dot(n))/Math.PI,d=l.angleTo(s)*(u.dot(o)>0?180:-180)/Math.PI;return{interval:t.index,joint:x(t,e).index,separation:f,rotation:d}}))}function C(e){var t=new y.Vector3;switch(e){case g.XP:return t.setX(1);case g.XN:return t.setX(-1);case g.YP:return t.setY(1);case g.YN:return t.setY(-1);case g.ZP:return t.setZ(1);case g.ZN:return t.setZ(-1);default:return t}}function V(e,t){return C(e).multiplyScalar(O/2).addScaledVector(C(t),O/2/P)}!function(e){e[e.NN=0]="NN",e[e.PN=1]="PN",e[e.NP=2]="NP",e[e.PP=3]="PP"}(F||(F={}));var R=[{alpha:V(g.ZN,g.XP),omega:V(g.ZP,g.XP)},{alpha:V(g.ZN,g.XN),omega:V(g.ZP,g.XN)},{alpha:V(g.XN,g.YP),omega:V(g.XP,g.YP)},{alpha:V(g.XN,g.YN),omega:V(g.XP,g.YN)},{alpha:V(g.YN,g.ZP),omega:V(g.YP,g.ZP)},{alpha:V(g.YN,g.ZN),omega:V(g.YP,g.ZN)}],M=[{name:w.NNN,opposite:w.PPP,negative:!0,ring:F.NN,pushEnds:[E.YNA,E.XNA,E.ZNA],ringMember:[F.NP,F.PN,F.PP]},{name:w.PNN,opposite:w.NPP,negative:!1,ring:F.PP,pushEnds:[E.XNA,E.YPA,E.ZNO],ringMember:[F.PN,F.NN,F.NP]},{name:w.NPN,opposite:w.PNP,negative:!1,ring:F.PN,pushEnds:[E.XNO,E.YNA,E.ZPA],ringMember:[F.PP,F.NP,F.NN]},{name:w.NNP,opposite:w.PPN,negative:!1,ring:F.NP,pushEnds:[E.XPA,E.YNO,E.ZNA],ringMember:[F.NN,F.PN,F.PP]},{name:w.NPP,opposite:w.PNN,negative:!0,ring:F.PP,pushEnds:[E.YNO,E.XPO,E.ZPA],ringMember:[F.PN,F.NP,F.NN]},{name:w.PNP,opposite:w.NPN,negative:!0,ring:F.PN,pushEnds:[E.YPO,E.XPA,E.ZNO],ringMember:[F.PP,F.NN,F.NP]},{name:w.PPN,opposite:w.NNP,negative:!0,ring:F.NP,pushEnds:[E.YPA,E.XNO,E.ZPO],ringMember:[F.NN,F.PP,F.PN]},{name:w.PPP,opposite:w.NNN,negative:!1,ring:F.NN,pushEnds:[E.XPO,E.YPO,E.ZPO],ringMember:[F.NP,F.PP,F.PN]}];function T(e){return M[e].opposite}function I(e){return e||{_:100}}function A(e){return e._/100}function _(e){return{_:100*e}}function L(e,t,n){var r=!!t.joints.find((function(t){return t.index===e.index})),a=!!n.joints.find((function(t){return t.index===e.index}));if(r&&!a)return t;if(a&&!r)return n;throw new Error("Neither contained joint")}function D(e,t,n){var r=R.reduce((function(e,t){return e.push((new y.Vector3).add(t.alpha)),e.push((new y.Vector3).add(t.omega)),e}),[]),a=T(e),i=M[a].pushEnds.map((function(e){return r[e]})).reverse(),c=i.reduce((function(e,t){return e.add(t)}),new y.Vector3).multiplyScalar(1/3),o=(new y.Vector3).subVectors(i[0],c).normalize(),s=(new y.Vector3).sub(c).normalize(),l=(new y.Vector3).crossVectors(s,o).normalize(),u=(new y.Matrix4).makeBasis(o,s,l),f=A(t),d=(new y.Matrix4).getInverse(u).setPosition(n).scale(new y.Vector3(f,f,f));return r.map((function(e){return e.applyMatrix4(d)}))}function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Y(e){return JSON.stringify(e).replace(/[_.:"]/g,"").replace(/[{]/g,"(").replace(/[}]/g,")").replace(/([ABCDabcdSM])\((\d*)\)/g,(function(e){return"".concat(arguments.length<=1?void 0:arguments[1]).concat(arguments.length<=2?void 0:arguments[2])}))}function Z(e){return N.indexOf(e)>=0}function X(e,t){return t["M".concat(N[e])]}function U(e){return"0123456789".indexOf(e)>=0}function $(e){if(!e.match(/^\d+$/))throw new Error("Not a number: ".concat(e));return parseInt(e,10)}function G(e,t){var n=e.indexOf(","),r=n>=0;if("("!==e.charAt(0))return r?{content:e.substring(0,n),skip:n}:{content:e,skip:e.length};var a=function(e){if("("!==e.charAt(0))throw new Error('Code must start with "(": '.concat(e," ").concat(e.charAt(0)));for(var t=0,n=0;n<e.length;n++){var r=e.charAt(n);if("("===r)t++;else if(")"===r&&0===--t)return n}throw new Error("No matching end bracket: |".concat(e,"|"))}(e);return{content:t?e.substring(1,a):e.substring(0,a+1),skip:a+1}}function W(e,t,n){function r(e){var t=G(e,!0).content,n={};function a(e){var n=G(t.substring(e),!1),a=n.content,i=n.skip;return{codeTree:r(a),skip:i}}for(var i=0;i<t.length;i++){var c=t.charAt(i);if(Z(c)){var o=a(i+1);if(!o.codeTree)throw new Error("No subtree: ".concat(t.substring(i)));n[c]=o.codeTree,i+=o.skip}else if(U(c)){var s=G(t,!1);n._=$(s.content),i+=s.skip}else switch(c){case"S":var l=G(t.substring(i+1),!0);n.S={_:$(l.content)},i+=l.skip;break;case"M":var u=t.charAt(i+1),f=G(t.substring(i+2),!0);n["M".concat(u)]={_:$(f.content)},i+=f.skip+1;break;case",":case" ":break;default:throw new Error("Unexpected character: ".concat(c))}}return 0===Object.keys(n).length?void 0:n}try{if(!n||0===n.length)return void e("No code to parse");var a=function(e){var t=e.replace(/[\n\r\t]/g,"").split(":"),n=t.find((function(e){return e.startsWith("'")&&e.endsWith("'")})),r=t.find((function(e){return e.startsWith("(")&&e.endsWith(")")})),a={};return t.filter((function(e){return e.match(/^\d+=.*$/)})).forEach((function(e){var t=e.indexOf("="),n=Number(e.substring(0,t));a[n]=e.substring(t+1)})),{name:n?n.replace(/'/g,""):(new Date).toDateString(),mainCode:r||"(0)",markCode:a}}(n),i=a.name,c=a.mainCode,o=a.markCode,s=r(c);if(!s)return;var l={};return Object.keys(o).forEach((function(e){return l[e]=r(o[e])})),function(e,t,n,r){var a=Y(t),i=Object.keys(n).map((function(e){return"".concat(e,"=").concat(Y(n[e]))})).join(":"),c=i.length>0?":".concat(i):"";return{name:e,tree:t,markTrees:n,code:"'".concat(e,"':").concat(a).concat(c),fromUrl:r}}(i,s,l,t)}catch(u){return void e(u.message)}}function Q(e){throw new Error("Unable to parse: ".concat(e))}var H,J=["(0):'Zen'","(1):'One'","(6):'Six'","(16,S90):'Axoneme'","(b1,a1):'Knee'","(b3,a3):'Leg'","(a1,b1,c1,d1):'Nexus'","(A2,B(3,b(2,S90),S80),C(3,c(2,S90),S80),D(3,d(2,S90),S80)):'Tripod with Knees'","(A(8, S85, MA1), a(8, S85, MA1)):'Bulge Ring'","(a1,b(3,S85,MA1),c(3,S85,MA1),d(3,S85,MA1)):'Convergence Three'","(a1,b(10,S85,MA1),c(10,S85,MA1),d(10,S85,MA1)):'Convergence Ten'","(B(7,S80,MA1),C(2,S120,MA0),D(7,S80,MA1)):'Halo by Crane'","(B(5,S75),C(5,S75),D(5,S75)):'Pretenst Lander'","(a(1,MA0),c(3,b(3,d(3,c(3,b(3,d(1,MA0))))))):'Zig Zag Loop'","(B2, C2, D2, A(2, b2, c2, d2)):'Crystal Interstitial'","(a(2,b(2,c(2,d(1,MA11)),d(2,c(1,MA10))),c(2,d(2,b(1,MA13)),b(2,d(1,MA12))),d(2,b(2,c(1,MA15)),c(2,b(1,MA14)))),b(2,d(2,Mc13),c(2,Md14)),c(2,b(2,Md15),d(2,Mb10)),d(2,c(2,Mb11),b(2,Mc12))):' Diamond'","(a(3,b(3,c(3,d(2,MA11)),d(3,c(2,MA10))),c(3,d(3,b(2,MA13)),b(3,d(2,MA12))),d(3,b(3,c(2,MA15)),c(3,b(2,MA14)))),b(3,d(3,Mc13),c(3,Md14)),c(3,b(3,Md15),d(3,Mb10)),d(3,c(3,Mb11),b(3,Mc12))):'Diamond2'"].map((function(e){return W(Q,!1,e)}));function q(e,t,n){var r=[];return e.forEach((function(e){var a=e.brick,i=e.tree,c=e.fabric;function o(e,t,r,a){var i,o,s=e.base===w.PPP?T(r):r,l=c.builder.createConnectedBrick(e,s,a);return 0===t._&&(i=l,o=t,k.forEach((function(e){var t=X(e,o);if(t){var r=i.base===w.NNN?i.faces[e]:i.faces[T(e)];if(r.removed)throw new Error("!! trying to use a face that was removed");n.markFace(t._,r)}}))),{tree:t,brick:l,fabric:c}}var s=i._;if(s){var l=s-1;r.push(o(a,B({},i,{_:l}),w.PPP,I(i.S)))}else k.forEach((function(e){var n=function(e,t){return t[N[e]]}(e,i),c=X(e,i);if(n){var s=I(n.S),l=B({},n,{_:n._?n._-1:void 0});r.push(o(a,l,e,s))}else if(c){var u=t[c._];if(!u)throw new Error("!! no mark tree for ".concat(c._));var f=I(u.S);r.push(o(a,u,e,f))}}))})),r}function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.Grow="Grow",e.Shape="Shape",e.Realize="Realize",e.View="View",e.Strain="Strain"}(H||(H={}));var te="2020-02-25x";function ne(e){return Object.keys(e.recentCode).map((function(t){var n=e.recentCode[t],r=W((function(e){return console.error(e)}),!1,n);if(!r)throw new Error("Unable to read recent tenscript code: ".concat(n));return r}))}function re(e){switch(e){case d.IntervalRole.NexusPush:return d.FabricFeature.NexusPushLength;case d.IntervalRole.ColumnPush:return d.FabricFeature.ColumnPushLength;case d.IntervalRole.Triangle:return d.FabricFeature.TriangleLength;case d.IntervalRole.Ring:return d.FabricFeature.RingLength;case d.IntervalRole.NexusCross:return d.FabricFeature.NexusCrossLength;case d.IntervalRole.ColumnCross:return d.FabricFeature.ColumnCrossLength;case d.IntervalRole.BowMid:return d.FabricFeature.BowMidLength;case d.IntervalRole.BowEnd:return d.FabricFeature.BowEndLength;default:throw new Error("role?")}}function ae(e,t){return ee({},e,{nonce:e.nonce+1},t)}var ie="State";function ce(e,t){var n=localStorage.getItem(ie);if(n){var r=JSON.parse(n);if(r.version===te)return r}return function(e,t){var n=h.map(e).reduce((function(e,n){return e[n.feature]={percent:100,numeric:t(n.feature)},e}),{});return{version:te,nonce:0,surfaceCharacter:d.SurfaceCharacter.Frozen,featureValues:n,recentCode:{},controlTab:H.Grow,fullScreen:!0,ellipsoids:!1,rotating:!1,showPushes:!0,showPulls:!0}}(e,t)}function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function se(e){switch(e){case d.FabricFeature.Gravity:return{feature:e,name:"Gravity",percents:[0,10,50,100,200,500]};case d.FabricFeature.Drag:return{feature:e,name:"Drag",percents:[0,10,50,100,150,200]};case d.FabricFeature.PretenstFactor:return{feature:e,name:"Pretenst factor",percents:[0,50,90,100,125,150,200]};case d.FabricFeature.IterationsPerFrame:return{feature:e,name:"Iterations per frame",percents:[10,25,50,100,200,300,500]};case d.FabricFeature.IntervalCountdown:return{feature:e,name:"Interval Countdown",percents:[10,20,30,100,150,400,1e3]};case d.FabricFeature.RealizingCountdown:return{feature:e,name:"Slack to Pretenst countdown",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.SlackThreshold:return{feature:e,name:"Slack threshold",percents:[.01,.1,1,10,100,1e3]};case d.FabricFeature.ShapingPretenstFactor:return{feature:e,name:"Pretenst factor",percents:[0,1,2,3,5,10,20,50,100]};case d.FabricFeature.ShapingStiffnessFactor:return{feature:e,name:"Stiffness factor",percents:[100,150,200,250,300,400,500]};case d.FabricFeature.ShapingDrag:return{feature:e,name:"Drag",percents:[0,10,50,100,200,500]};case d.FabricFeature.MaxStrain:return{feature:e,name:"Maximum Strain",percents:[1,2,3,5,8,13,21,34,55,100]};case d.FabricFeature.VisualStrain:return{feature:e,name:"Visual Strain",percents:[0,10,50,100,200,300,500,1e3,1e4,1e5]};case d.FabricFeature.PushOverPull:return{feature:e,name:"Compression/Tension",percents:[10,20,30,50,100,200,300,500,1e3]};case d.FabricFeature.NexusPushLength:return{feature:e,name:"Nexus Push",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.ColumnPushLength:return{feature:e,name:"Column Push",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.TriangleLength:return{feature:e,name:"Triangle",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.RingLength:return{feature:e,name:"Ring",percents:[10,80,90,100,110,120,130]};case d.FabricFeature.NexusCrossLength:return{feature:e,name:"Nexus Cross",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.ColumnCrossLength:return{feature:e,name:"Column Cross",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.BowMidLength:return{feature:e,name:"Bow Mid",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.BowEndLength:return{feature:e,name:"Bow End",percents:[50,75,90,100,125,150,200]};case d.FabricFeature.PushRadius:return{feature:e,name:"Push Radius",percents:[5,25,50,100,150,200,300]};case d.FabricFeature.PullRadius:return{feature:e,name:"Pull Radius",percents:[5,25,50,100,150,200,300]};case d.FabricFeature.JointRadius:return{feature:e,name:"Joint Radius",percents:[5,25,50,100,150,200,300]};case d.FabricFeature.MaxStiffness:return{feature:e,name:"Maximum Stiffness",percents:[5,25,50,100,150,200,500]};default:throw new Error("Feature?")}}var le=function(){function e(t,n,r){Object(u.a)(this,e),this.config=t,this.defaultValue=n,this.value$=void 0;var a=r.getValue().featureValues[t.feature],i=void 0!==a?a:{numeric:this.defaultValue,percent:100};this.value$=new s.BehaviorSubject(i),this.value$.subscribe((function(e){var n=r.getValue(),a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n.featureValues);a[t.feature]=e,r.next(ae(n,{featureValues:a}))}))}return Object(f.a)(e,[{key:"value",get:function(){return this.value$.getValue()}},{key:"title",get:function(){return this.config.name}},{key:"percentChoices",get:function(){return this.config.percents}},{key:"numeric",get:function(){return this.value$.getValue().numeric}},{key:"formatted",get:function(){var e=this.numeric,t=e.toExponential(5),n=t.indexOf("e+0");return n>0?t.substring(0,n):Math.max(t.indexOf("e-1"),t.indexOf("e-2"))>0?e.toFixed(5):Math.max(t.indexOf("e+1"),t.indexOf("e+2"))>0?e.toFixed(1):t}},{key:"percent",get:function(){return this.value$.getValue().percent},set:function(e){this.value$.next({numeric:this.defaultValue*e/100,percent:e})}},{key:"observable",get:function(){return this.value$}},{key:"fabricFeature",get:function(){return this.config.feature}}]),e}();function ue(e,t){var n={};return h.map(se).forEach((function(r){n[r.feature]=new le(r,t(r.feature),e)})),n}var fe=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function de(){if("serviceWorker"in navigator){if(new URL("/app",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/app","/service-worker.js");fe?(!function(e){fetch(e).then((function(t){404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):he(e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")}))):he(e)}))}}function he(e){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var t=e.installing;t&&(t.onstatechange=function(){"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var me=n(31),pe=n(623),be=n(112),ve=n(548),ge=n(613),Ee=function(e,t,n){var r=3*t;return n?(n.set(e[r],e[r+1],e[r+2]),n):new y.Vector3(e[r],e[r+1],e[r+2])};function we(e,t){return{lineColors:Se((function(e){return t.copy_line_colors_to(e)}),(function(){return 3*e.get_interval_count()*2})),lineLocations:Se((function(e){return t.copy_line_locations_to(e)}),(function(){return 3*e.get_interval_count()*2})),faceNormals:Se((function(e){return t.copy_face_normals_to(e)}),(function(){return 3*e.get_face_count()*3})),faceLocations:Se((function(e){return t.copy_face_vertex_locations_to(e)}),(function(){return 3*e.get_face_count()*3})),jointLocations:Se((function(e){return t.copy_joint_locations_to(e)}),(function(){return 3*e.get_joint_count()})),jointVelocities:Se((function(e){return t.copy_joint_velocities_to(e)}),(function(){return 3*e.get_joint_count()})),unitVectors:Se((function(e){return t.copy_unit_vectors_to(e)}),(function(){return 3*e.get_interval_count()})),idealLengths:Se((function(e){return t.copy_ideal_lengths_to(e)}),(function(){return e.get_interval_count()})),strains:Se((function(e){return t.copy_strains_to(e)}),(function(){return e.get_interval_count()})),strainNuances:Se((function(e){return t.copy_strain_nuances_to(e)}),(function(){return e.get_interval_count()})),stiffnesses:Se((function(e){return t.copy_stiffnesses_to(e)}),(function(){return e.get_interval_count()})),linearDensities:Se((function(e){return t.copy_linear_densities_to(e)}),(function(){return e.get_interval_count()}))}}function Se(e,t){var n=new Float32Array(t());return e(n),n}var ye=function(){function e(t,n){Object(u.a)(this,e),this.fabric=void 0,this.world=void 0,this.view=void 0,this.floatView=void 0,this.featuresToApply=[],this.world=t.World.new(),this.fabric=t.Fabric.new(n),this.view=t.View.on_fabric(this.fabric),this.floatView=we(this.fabric,this.view)}return Object(f.a)(e,[{key:"iterate",value:function(e){var t=this,n=this.fabric.iterate(e,this.world);return this.view.render(this.fabric,this.world),this.featuresToApply.length>0&&(this.featuresToApply.forEach((function(e){return t.world.set_float_value(e.fabricFeature,e.numeric)})),this.featuresToApply=[]),this.floatView=we(this.fabric,this.view),n}},{key:"refreshFloatView",value:function(){this.view.render(this.fabric,this.world),this.floatView=we(this.fabric,this.view)}},{key:"clear",value:function(){this.fabric.clear(),this.refreshFloatView()}},{key:"applyFeature",value:function(e){this.featuresToApply.push(e)}},{key:"jointLocation",value:function(e){return Ee(this.floatView.jointLocations,e)}},{key:"apply",value:function(e){this.fabric.apply_matrix4(new Float32Array(e.toArray()))}},{key:"unitVector",value:function(e){return Ee(this.floatView.unitVectors,e)}}]),e}(),Pe=function(){function e(t,n,r){Object(u.a)(this,e),this.numericFeature=t,this.fabric=n,this._stage=void 0,this._stage=r}return Object(f.a)(e,[{key:"withStage",value:function(t,n){return this.transition(t,n),this._stage=t,new e(this.numericFeature,this.fabric,t)}},{key:"transition",value:function(e,t){switch(this._stage){case d.Stage.Growing:switch(e){case d.Stage.Shaping:return void this.fabric.save()}break;case d.Stage.Shaping:switch(e){case d.Stage.Slack:return void(t&&t.adoptLengths&&(this.fabric.instance.fabric.adopt_lengths(),this.fabric.save()));case d.Stage.Realizing:return}break;case d.Stage.Slack:switch(e){case d.Stage.Shaping:case d.Stage.Realizing:return}break;case d.Stage.Realizing:switch(e){case d.Stage.Realized:return}break;case d.Stage.Realized:switch(e){case d.Stage.Slack:if(t&&t.strainToStiffness){var n=this.numericFeature(d.FabricFeature.PushOverPull),r=function(e,t){var n=e.instance.floatView.strains,r=e.instance.floatView.stiffnesses,a=function(e){return e.reduce((function(e,t){return e+n[t.index]}),0)/e.length},i=e.intervals,c=i.filter((function(e){return e.isPush})),o=a(c),s=i.filter((function(e){return!e.isPush})),l=a(s),u=(-t*o+l)/2,f=i.map((function(e){return 1+(n[e.index]*(e.isPush?-t:1)-u)/u})),d=r.map((function(e,t){return e*f[t]})),h=d.map(Oe);return{newStiffnesses:d,newLinearDensities:h}}(this.fabric,n),a=r.newStiffnesses,i=r.newLinearDensities;this.fabric.restore();var c=this.fabric.instance;throw a.forEach((function(e,t){return c.floatView.stiffnesses[t]=e})),i.forEach((function(e,t){return c.floatView.linearDensities[t]=e})),new Error("setting these values isn't going to work!")}return t&&t.adoptLengths?(this.fabric.instance.fabric.adopt_lengths(),void this.fabric.save()):void this.fabric.restore()}}throw new Error("No transition ".concat(d.Stage[this._stage]," to ").concat(d.Stage[e]))}},{key:"stage",get:function(){return this._stage}}]),e}();function Oe(e){return Math.sqrt(e)}var Fe=n(544);function ke(e){return.6*e}var Ne=function(){function e(t,n){Object(u.a)(this,e),this.fabric=t,this.numericFeature=n,this.faceMarks={}}return Object(f.a)(e,[{key:"markFace",value:function(e,t){var n=this.faceMarks[e];n?n.push(t):this.faceMarks[e]=[t]}},{key:"createBrickAt",value:function(e,t){var n=D(w.PPP,t,e);return this.createBrick(n,w.NNN,t)}},{key:"createConnectedBrick",value:function(e,t,n){var r=e.faces[t],a=A(e.scale),i=a*A(n),c=this.createBrickOnFace(r,_(i)),o=c.faces[c.base],s=this.numericFeature(d.FabricFeature.IntervalCountdown);return this.connectFaces(r,o,_((a+i)/2),s),c}},{key:"uprightOnSingleMarkedFace",value:function(){var e=this.faceMarkLists.find((function(e){return 1===e.length}));e&&this.uprightAtOrigin(e[0])}},{key:"checkFacePulls",value:function(e,t){var n=this;if(0===e.length)return e;return e.filter((function(e){var r=e.alpha,a=e.omega,i=e.scaleFactor;return!(r.location().distanceTo(a.location())<=10*ke(i))||(function(e){var t=e.alpha,r=e.omega,a=e.scaleFactor,i=n.numericFeature(d.FabricFeature.IntervalCountdown);n.connectFaces(t,r,_(a),i)}(e),t(e),!1)}))}},{key:"replaceCrossedNexusCrosses",value:function(){var e=this,t=this.fabric,n=[],r=function(e){var n=t.intervals.filter((function(e){return e.isPush})).find((function(t){return t.alpha.index===e||t.omega.index===e}));if(!n)throw new Error("Cannot find ".concat(e));return{interval:n,joint:n.alpha.index===e?n.alpha:n.omega}},a=t.intervals.filter((function(e){return e.intervalRole===d.IntervalRole.NexusCross}));a.forEach((function(e,t){var i=e.alpha.index,c=e.omega.index,o=r(i),s=r(c),l=e.alpha.location(),u=e.omega.location(),f=l.distanceTo(u),d=(new y.Vector3).addVectors(l,u).multiplyScalar(.5);a.forEach((function(a,h){var m=a.alpha.index,p=a.omega.index;if(!(t>=h||i===m||i===p||c===m||c===p)){var b,v,g,E,w,S=r(m),P=r(p),O=function(e,t){return e.interval.index===t.interval.index};if(O(o,S))b=o.interval,v=e.alpha,g=e.omega,E=a.alpha,w=a.omega;else if(O(o,P))b=o.interval,v=e.alpha,g=e.omega,E=a.omega,w=a.alpha;else if(O(s,S))b=s.interval,v=e.omega,g=e.alpha,E=a.alpha,w=a.omega;else{if(!O(s,P))return;b=s.interval,v=e.omega,g=e.alpha,E=a.omega,w=a.alpha}var F=a.alpha.location(),k=a.omega.location(),N=F.distanceTo(k),x=(new y.Vector3).addVectors(F,k).multiplyScalar(.5),j=l.distanceTo(x)/N,C=u.distanceTo(x)/N,V=F.distanceTo(d)/f,R=k.distanceTo(d)/f,M=0,T=function(e){e<.5&&M++};if(T(j),T(C),T(V),T(R),!(M<2)){var I=b.scale;n.push({scale:I,a:v,x:g,b:E,y:w})}}}))}));var i=this.numericFeature(d.FabricFeature.IntervalCountdown);n.forEach((function(n){var r=n.scale,a=n.a,c=n.x,o=n.b,s=n.y;t.createInterval(c,s,d.IntervalRole.BowMid,r,i);var l=t.findInterval(a,c),u=t.findInterval(a,s),f=t.findInterval(o,c),h=t.findInterval(o,s);if(!(l&&f&&u&&h))throw new Error("Cannot find intervals during optimize");t.removeInterval(l),t.removeInterval(h),e.fabric.changeIntervalRole(u,d.IntervalRole.BowEnd,r,i),e.fabric.changeIntervalRole(f,d.IntervalRole.BowEnd,r,i)}))}},{key:"uprightAtOrigin",value:function(e){this.fabric.instance.apply(function(e){var t=e.joints.map((function(e){return e.location()})),n=t.reduce((function(e,t){return e.add(t)}),new y.Vector3).multiplyScalar(1/3),r=(new y.Vector3).subVectors(t[1],n).normalize(),a=(new y.Vector3).subVectors(t[0],n).normalize(),i=(new y.Vector3).crossVectors(a,r).normalize();a.crossVectors(r,i).normalize();var c=(new y.Matrix4).makeBasis(r,i,a).setPosition(n);return(new y.Matrix4).getInverse(c)}(e))}},{key:"createFacePulls",value:function(e){var t=this,n=function(){var n,r=t.createBrickAt((n=e.map((function(e){return e.location()}))).reduce((function(e,t){return e.add(t)}),new y.Vector3).multiplyScalar(1/n.length),_(function(e){return e.reduce((function(e,t){return e+A(t.brick.scale)}),0)/e.length}(e)));return e.map((function(e){var n=r.faces.filter((function(t){var n=t.negative;return!t.removed&&n!==e.negative})).reduce((function(t,n){return t.location().distanceTo(e.location())<n.location().distanceTo(e.location())?t:n}));return n.removed=!0,t.fabric.createFacePull(n,e)}))};switch(e.length){case 2:return e[0].negative===e[1].negative?n():[this.fabric.createFacePull(e[0],e[1])];case 3:return n();default:return[]}}},{key:"createBrickOnFace",value:function(e,t){var n=M[e.triangle].negative,r=e.brick,a=e.triangle;this.fabric.instance.refreshFloatView();var i=r.faces[a].joints.map((function(e){return e.location()})),c=i.reduce((function(e,t){return e.add(t)}),new y.Vector3).multiplyScalar(1/3),o=(new y.Vector3).addVectors(i[0],i[1]).multiplyScalar(.5),s=(new y.Vector3).subVectors(o,c).normalize(),l=(new y.Vector3).subVectors(i[1],c).normalize(),u=(new y.Vector3).add(s).multiplyScalar(s.dot(l)),f=l.sub(u).normalize(),d=(new y.Vector3).crossVectors(f,s).normalize(),h=(new y.Matrix4).makeBasis(s,d,f).setPosition(c),m=D(n?w.NNN:w.PPP,t,new y.Vector3(0,0,0)).map((function(e){return e.applyMatrix4(h)})),p=n?w.PPP:w.NNN;return this.createBrick(m,p,t)}},{key:"createBrick",value:function(e,t,n){var r,a=this,i=this.numericFeature(d.FabricFeature.IntervalCountdown),c=function(e,t,n){return{index:e,base:t,scale:n,joints:[],pushes:[],pulls:[],crosses:[],rings:[[],[],[],[]],faces:[],negativeAdjacent:0,postiveeAdjacent:0}}(this.fabric.bricks.length,t,n);this.fabric.bricks.push(c);var o=e.map((function(e,t){return a.fabric.createJointIndex(e)}));this.fabric.instance.refreshFloatView(),R.forEach((function(e,t){Object(Fe.a)(e);var r=o[2*t],s=o[2*t+1],l={index:r,oppositeIndex:s,location:function(){return a.fabric.instance.jointLocation(r)}},u={index:s,oppositeIndex:r,location:function(){return a.fabric.instance.jointLocation(s)}};c.pushes.push(a.fabric.createInterval(l,u,d.IntervalRole.NexusPush,n,i))})),c.pushes.forEach((function(e){return c.joints.push(e.alpha,e.omega)}));var s=c.pushes.reduce((function(e,t){return e.push(t.alpha,t.omega),e}),[]);return(r=this.fabric.joints).push.apply(r,Object(S.a)(s)),M.forEach((function(e){for(var t=e.pushEnds.map((function(e){return s[e]})),r=0;r<3;r++){var o=t[r],l=t[(r+1)%3],u=a.fabric.createInterval(o,l,d.IntervalRole.Triangle,n,i);c.pulls.push(u),c.rings[e.ringMember[r]].push(u)}})),M.forEach((function(e){var t=a.fabric.createFace(c,e.name);c.faces.push(t)})),this.fabric.instance.refreshFloatView(),c}},{key:"facesToRing",value:function(e,t){if(e.negative===t.negative)throw new Error("Polarity not opposite");var n=(new y.Vector3).subVectors(e.joints[0].location(),e.location()).normalize(),r=t.joints.map((function(e,r){return[(new y.Vector3).subVectors(e.location(),t.location()).normalize().dot(n),r]})).sort((function(e,t){return t[0]-e[0]})).pop();if(!r)throw new Error("No opposite joint");var a=[[1,0,2],[2,1,0],[0,2,1]][r[1]];return[e.joints[0],t.joints[a[0]],e.joints[1],t.joints[a[1]],e.joints[2],t.joints[a[2]]]}},{key:"connectFaces",value:function(e,t,n,r){var a=this;if(e.negative===t.negative)throw new Error("Same polarity!");[e,t].forEach((function(e){a.fabric.removeFace(e,!0),e.negative?e.brick.postiveeAdjacent++:e.brick.negativeAdjacent++}));for(var i=this.facesToRing(e,t),c=function(e,t,i){return a.fabric.createInterval(e,t,i,n,r)},o=0;o<i.length;o++){var s=i[(o+5)%6],l=i[o],u=i[(o+1)%6];c(l,u,d.IntervalRole.Ring);var f=function(n,r){var i=a.fabric.joints[r.oppositeIndex];L(i,e.brick,t.brick).crosses.push(c(n,i,d.IntervalRole.ColumnCross))};e.negative?f(s,l):f(u,l)}[e,t].forEach((function(e){var t=e.triangle,n=e.brick,i=function(e,t){return e.filter((function(e){return!e.removed&&e.intervalRole!==t})).forEach((function(e){return a.fabric.changeIntervalRole(e,t,n.scale,r)}))};!function(e){return e.negativeAdjacent>1||e.postiveeAdjacent>1}(n)?(i(n.rings[M[t].ring],d.IntervalRole.Ring),i(n.crosses,d.IntervalRole.ColumnCross),i(n.pushes,d.IntervalRole.ColumnPush)):(i(n.pulls,d.IntervalRole.Triangle),i(n.crosses,d.IntervalRole.NexusCross),i(n.pushes,d.IntervalRole.NexusPush))}))}},{key:"initialFacePulls",get:function(){var e=this;return this.faceMarkLists.filter((function(e){return 2===e.length||3===e.length})).reduce((function(t,n){return[].concat(Object(S.a)(t),Object(S.a)(e.createFacePulls(n)))}),[])}},{key:"faceMarkLists",get:function(){var e=this;return Object.keys(this.faceMarks).map((function(t){return e.faceMarks[t]}))}}]),e}(),xe=65535;function je(e){return A(e)/1e4}var Ce,Ve,Re=function(){function e(t,n,r,a){Object(u.a)(this,e),this.roleDefaultLength=t,this.numericFeature=n,this.instance=r,this.tenscript=a,this.life$=void 0,this.joints=[],this.intervals=[],this.facePulls=[],this.faces=[],this.bricks=[],this.activeTenscript=void 0,this.facesToConnect=void 0,this.builder=void 0,this.backup=void 0,this.instance.clear(),this.life$=new s.BehaviorSubject(new Pe(n,this,d.Stage.Growing)),this.builder=new Ne(this,n);var i=this.builder.createBrickAt(new y.Vector3,I());this.bricks=[i],this.activeTenscript=[{tree:this.tenscript.tree,brick:i,fabric:this}]}return Object(f.a)(e,[{key:"save",value:function(){console.log("Saving backup"),this.backup=this.instance.fabric.copy()}},{key:"restore",value:function(){if(!this.backup)throw new Error("No backup");console.log("Restoring from backup"),this.instance.fabric.restore(this.backup)}},{key:"toStage",value:function(e,t){e!==this.life.stage&&this.life$.next(this.life.withStage(e,t))}},{key:"connectFaces",value:function(e){this.facesToConnect=e}},{key:"createJointIndex",value:function(e){return this.instance.fabric.create_joint(e.x,e.y,e.z)}},{key:"createFacePull",value:function(e,t){var n=e.location().distanceTo(t.location()),r=je(I()),a=Oe(r),i=(A(e.brick.scale)+A(t.brick.scale))/2,c=ke(i),o={index:this.instance.fabric.create_interval(e.index,t.index,d.IntervalRole.FacePull,n,c,r,a,function(e){var t=6e3*e;return t>xe?xe:t}(n)),alpha:e,omega:t,distance:n,scaleFactor:i,removed:!1};return this.facePulls.push(o),o}},{key:"removeFacePull",value:function(e){this.facePulls=this.facePulls.filter((function(t){return t.index!==e.index})),this.instance.fabric.remove_interval(e.index),this.facePulls.forEach((function(t){t.index>e.index&&t.index--})),this.intervals.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0}},{key:"createInterval",value:function(e,t,n,r,a){var i=e.location().distanceTo(t.location()),c=A(r)*this.roleDefaultLength(n),o=je(r),s=Oe(o),l={index:this.instance.fabric.create_interval(e.index,t.index,n,i,c,o,s,a),intervalRole:n,scale:r,alpha:e,omega:t,removed:!1,isPush:b(n),location:function(){return(new y.Vector3).addVectors(e.location(),t.location()).multiplyScalar(.5)}};return this.intervals.push(l),l}},{key:"changeIntervalScale",value:function(e,t){e.scale=_(A(e.scale)*t),this.instance.fabric.multiply_rest_length(e.index,t,100)}},{key:"changeIntervalRole",value:function(e,t,n,r){e.intervalRole=t,this.instance.fabric.set_interval_role(e.index,t),this.instance.fabric.change_rest_length(e.index,A(n)*this.roleDefaultLength(t),r)}},{key:"removeInterval",value:function(e){this.intervals=this.intervals.filter((function(t){return t.index!==e.index})),this.instance.fabric.remove_interval(e.index),this.intervals.forEach((function(t){t.index>e.index&&t.index--})),this.facePulls.forEach((function(t){t.index>e.index&&t.index--})),e.removed=!0}},{key:"createFace",value:function(e,t){var n=M[t],r=n.negative,a=n.pushEnds,i=a.map((function(t){var n=e.pushes.find((function(n){var r=e.joints[t];return r.index===n.alpha.index||r.index===n.omega.index}));if(void 0===n)throw new Error;return n})),c=[0,1,2].map((function(n){return e.pulls[3*t+n]})),o=a.map((function(t){return e.joints[t]})),s={index:this.instance.fabric.create_face(o[0].index,o[1].index,o[2].index),negative:r,removed:!1,brick:e,triangle:t,joints:o,pushes:i,pulls:c,location:function(){return o.reduce((function(e,t){return e.add(t.location())}),new y.Vector3).multiplyScalar(1/3)}};return this.faces.push(s),s}},{key:"removeFace",value:function(e,t){var n=this;this.instance.fabric.remove_face(e.index),this.faces=this.faces.filter((function(t){return t.index!==e.index})),this.faces.forEach((function(t){t.index>e.index&&t.index--})),this.facePulls.forEach((function(t){t.alpha.index>e.index&&t.alpha.index--,t.omega.index>e.index&&t.omega.index--})),e.removed=!0,t&&e.pulls.forEach((function(e){return n.removeInterval(e)}))}},{key:"startTightening",value:function(e){this.facePulls=e}},{key:"iterate",value:function(){var e=this,t=this.instance.iterate(this.life$.getValue().stage);if(t===d.Stage.Busy)return t;var n=this.activeTenscript;if(n){if(n.length>0&&(this.activeTenscript=q(n,this.tenscript.markTrees,this.builder),this.instance.fabric.centralize()),0===n.length&&(this.activeTenscript=void 0,this.builder.uprightOnSingleMarkedFace(),this.instance.refreshFloatView(),t===d.Stage.Growing)){var r=this.instance.fabric.finish_growing();return this.facePulls=this.builder.initialFacePulls,r}return d.Stage.Growing}var a=this.facesToConnect;return a&&(this.facesToConnect=void 0,this.builder.createFacePulls(a)),this.facePulls=this.builder.checkFacePulls(this.facePulls,(function(t){return e.removeFacePull(t)})),t}},{key:"findInterval",value:function(e,t){return this.intervals.find((function(n){return n.alpha.index===e.index&&n.omega.index===t.index||n.alpha.index===t.index&&n.omega.index===e.index}))}},{key:"life",get:function(){return this.life$.getValue()}},{key:"submergedJoints",get:function(){return this.joints.filter((function(e){return e.location().y<0}))}},{key:"facesGeometry",get:function(){var e=new y.Float32BufferAttribute(this.instance.floatView.faceLocations,3),t=new y.Float32BufferAttribute(this.instance.floatView.faceNormals,3),n=new y.BufferGeometry;return n.addAttribute("position",e),n.addAttribute("normal",t),n.computeBoundingSphere(),n}},{key:"linesGeometry",get:function(){var e=new y.Float32BufferAttribute(this.instance.floatView.lineLocations,3),t=new y.Float32BufferAttribute(this.instance.floatView.lineColors,3),n=new y.BufferGeometry;return n.addAttribute("position",e),n.addAttribute("color",t),n.computeBoundingSphere(),n}},{key:"output",get:function(){var e=this,t=this.instance.floatView.idealLengths,n=this.instance.floatView.strains,r=this.instance.floatView.stiffnesses,a=this.instance.floatView.linearDensities;return{name:this.tenscript.name,joints:this.joints.map((function(t){var n=t.location();return{index:t.index,x:n.x,y:n.z,z:n.y,jointCables:j(t,e.intervals)}})),intervals:this.intervals.map((function(e){return{index:e.index,joints:[e.alpha.index,e.omega.index],type:e.isPush?"Push":"Pull",strain:n[e.index],stiffness:r[e.index],linearDensity:a[e.index],isPush:b(e.intervalRole),role:e.intervalRole.toFixed(0),length:t[e.index]}}))}}}]),e}(),Me=n(618),Te=n(619),Ie=n(624),Ae=n(620),_e=n(621),Le=n(622),De=["#ff0012","#fb5c06","#e28a00","#d4b500","#afd200","#80da52","#4edd83","#00ddad","#00c4d7","#00a5ff","#007bff","#2329f7"].reverse().map((function(e){return new y.Color(e)})),ze=!0,Be=new y.MeshPhongMaterial({color:new y.Color("#1c1608"),side:y.DoubleSide}),Ye=new y.LineBasicMaterial({vertexColors:y.VertexColors}),Ze=new y.LineBasicMaterial({color:new y.Color("#cace02")}),Xe=new y.MeshPhongMaterial({lights:ze,color:new y.Color("white"),side:y.DoubleSide,transparent:!0,opacity:.2}),Ue=new y.MeshPhongMaterial({color:new y.Color("#91934f"),lights:!0}),$e=new y.MeshPhongMaterial({color:new y.Color("#e83ada"),lights:!0}),Ge=De.map((function(e){return new y.MeshLambertMaterial({color:e,lights:ze})}));function We(e){switch(e){case d.IntervalRole.NexusPush:return"#6541b4";case d.IntervalRole.ColumnPush:return"#2f3aca";case d.IntervalRole.Triangle:return"#c9c445";case d.IntervalRole.Ring:return"#e83ada";case d.IntervalRole.NexusCross:return"#59ebcb";case d.IntervalRole.ColumnCross:return"#299995";case d.IntervalRole.BowMid:return"#f14302";case d.IntervalRole.BowEnd:return"#c03b02";case d.IntervalRole.FacePull:return"#fe0105";default:return}}function Qe(e){var t=function(e){return new y.Color(We(e))}(e);return new y.MeshLambertMaterial({color:t,lights:ze})}function He(e){var t=e.feature,n=e.disabled,r=Object(c.useState)((function(){return t.percent})),a=Object(me.a)(r,2),i=a[0],o=a[1];Object(c.useEffect)((function(){var e=t.observable.subscribe((function(e){var t=e.percent;return o(t)}));return function(){return e.unsubscribe()}}),[]);var s=We(v(t.fabricFeature)),l=s||"#919191";return c.createElement("div",{className:"my-2"},c.createElement("div",{className:"float-right",style:{color:n?"gray":"white"}},t.formatted),c.createElement("div",null,t.config.name),c.createElement(ge.a,{className:"w-100"},t.percentChoices.map((function(e){var r=i===e?"#000000":l;return c.createElement(ve.a,{disabled:n,size:"sm",style:{color:"white",backgroundColor:r},key:"".concat(t.config.name,":").concat(e),onClick:function(){return t.percent=e}},function(e){return e<=100?"".concat(e,"%"):"".concat(e/100,"x")}(e))}))))}function Je(e){var t=e.fabric,n=e.stageTransition,r=e.disabled,a=Object(c.useState)(t.life),i=Object(me.a)(a,2),o=i[0],s=i[1];function l(e){return!(!r&&o.stage!==d.Stage.Busy&&o.stage!==d.Stage.Realizing)||o.stage!==e}switch(Object(c.useEffect)((function(){var e=t.life$.subscribe(s);return function(){return e.unsubscribe()}}),[t]),n){case Ce.CaptureLengthsToSlack:return c.createElement(ve.a,{className:"my-1 w-100",disabled:l(d.Stage.Shaping),onClick:function(){return t.toStage(d.Stage.Slack,{adoptLengths:!0})}},"Capture Lengths ",c.createElement(pe.j,null)," (",c.createElement(qe,{stage:d.Stage.Shaping})," ) ",c.createElement(pe.d,null)," ( ",c.createElement(pe.f,null),c.createElement(qe,{stage:d.Stage.Slack})," ) New Slack");case Ce.CurrentLengthsToSlack:return c.createElement(ve.a,{className:"my-1 w-100",disabled:l(d.Stage.Shaping),onClick:function(){return t.toStage(d.Stage.Slack)}},"Current Lengths ",c.createElement(qe,{stage:d.Stage.Shaping})," ",c.createElement(pe.d,null),c.createElement(qe,{stage:d.Stage.Slack})," Slack");case Ce.SlackToRealizing:return c.createElement(ve.a,{className:"my-1 w-100",disabled:l(d.Stage.Slack),onClick:function(){return t.toStage(d.Stage.Realizing)}},"Slack ",c.createElement(qe,{stage:d.Stage.Slack})," ",c.createElement(pe.d,null)," ",c.createElement(qe,{stage:d.Stage.Realized})," Realized");case Ce.SlackToShaping:return c.createElement(ge.a,{vertical:!0,className:"w-100 my-1"},c.createElement(ve.a,{className:"my-1 w-100",disabled:l(d.Stage.Slack),onClick:function(){return t.toStage(d.Stage.Shaping)}},"Slack ",c.createElement(qe,{stage:d.Stage.Slack})," ",c.createElement(pe.d,null)," ",c.createElement(qe,{stage:d.Stage.Shaping})," Shaping"));case Ce.CaptureRealizedToSlack:return c.createElement(ve.a,{className:"my-1 w-100",disabled:l(d.Stage.Realized),onClick:function(){return t.toStage(d.Stage.Slack,{adoptLengths:!0})}},"Capture realized ",c.createElement(pe.j,null)," ( ",c.createElement(qe,{stage:d.Stage.Realized})," ) ",c.createElement(pe.d,null)," ( ",c.createElement(pe.f,null),c.createElement(qe,{stage:d.Stage.Slack})," ) New Slack");case Ce.CaptureStrainForStiffness:return c.createElement(ve.a,{className:"my-1 w-100",disabled:l(d.Stage.Realized),onClick:function(){return t.toStage(d.Stage.Slack,{strainToStiffness:!0})}},"Capture Strain ",c.createElement(pe.j,null)," ( ",c.createElement(qe,{stage:d.Stage.Realized})," ",c.createElement(pe.F,null)," ) ",c.createElement(pe.d,null),"( ",c.createElement(qe,{stage:d.Stage.Slack})," ",c.createElement(pe.k,null)," ) Slack Stiffness")}}function qe(e){switch(e.stage){case d.Stage.Busy:return c.createElement(pe.n,null);case d.Stage.Growing:return c.createElement(pe.M,null);case d.Stage.Shaping:return c.createElement(pe.R,null);case d.Stage.Slack:return c.createElement(pe.T,null);case d.Stage.Realizing:return c.createElement(pe.n,null);case d.Stage.Realized:return c.createElement(pe.B,null);default:throw new Error("Stage?")}}function Ke(e){var t=e.floatFeatures,n=e.fabric,r=e.selectedIntervals,a=e.setFabric,i=e.shapeSelection,o=e.setShapeSelection,s=e.selectedFaces,l=e.clearSelectedFaces,u=e.storedState$,f=Object(c.useState)(!1),h=Object(me.a)(f,2),b=h[0],v=h[1];Object(c.useEffect)((function(){n.instance.world.set_push_and_pull(b)}),[b]);var g=Object(c.useState)(u.getValue().ellipsoids),E=Object(me.a)(g,2),w=E[0],S=E[1];Object(c.useEffect)((function(){var e=[u.subscribe((function(e){return S(e.ellipsoids)}))];return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[]);var y=Object(c.useState)(n.life),P=Object(me.a)(y,2),O=P[0],F=P[1];Object(c.useEffect)((function(){var e=n.life$.subscribe(F);return function(){return e.unsubscribe()}}),[n]);var k=Object(c.useState)(t[d.FabricFeature.NexusPushLength]),N=Object(me.a)(k,2),x=N[0],j=N[1],C=function(e,t,a){return function(){r&&r.forEach((function(r){r.isPush&&!t||!r.isPush&&!a||n.changeIntervalScale(r,e?1.03:1/1.03)}))}};function V(){return w||O.stage!==d.Stage.Shaping}function R(e,t){return!(!V()&&i===t)||(s.length<e||w)}function M(){return w||i!==Ve.None}return c.createElement("div",null,c.createElement(Ot,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(pe.a,null)," Phase"),c.createElement(Je,{fabric:n,stageTransition:Ce.CaptureLengthsToSlack,disabled:M()}),c.createElement(Je,{fabric:n,stageTransition:Ce.CurrentLengthsToSlack,disabled:M()}),c.createElement(Je,{fabric:n,stageTransition:Ce.SlackToShaping,disabled:M()})),c.createElement(Ot,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(pe.z,null)," Manual"),c.createElement(ge.a,{size:"sm",className:"w-100 my-2"},c.createElement(ve.a,{color:i===Ve.Intervals?"warning":"secondary",disabled:w&&i===Ve.None||0===s.length,onClick:function(){var e=i===Ve.Intervals?Ve.None:Ve.Intervals;o(e)}},c.createElement("span",null,c.createElement(pe.b,null)," Adjust ",c.createElement(pe.e,null))),c.createElement(ve.a,{disabled:R(1,Ve.Intervals),onClick:C(!0,!0,!0)},"TC ",c.createElement(pe.e,null)),c.createElement(ve.a,{disabled:R(1,Ve.Intervals),onClick:C(!1,!0,!0)},"TC ",c.createElement(pe.b,null)),c.createElement(ve.a,{disabled:R(1,Ve.Intervals),onClick:C(!0,!1,!0)},"T",c.createElement(pe.e,null)),c.createElement(ve.a,{disabled:R(1,Ve.Intervals),onClick:C(!1,!1,!0)},"T ",c.createElement(pe.b,null)),c.createElement(ve.a,{disabled:R(1,Ve.Intervals),onClick:C(!0,!0,!1)},"C ",c.createElement(pe.e,null)),c.createElement(ve.a,{disabled:R(1,Ve.Intervals),onClick:C(!1,!0,!1)},"C ",c.createElement(pe.b,null))),c.createElement(ge.a,{size:"sm",className:"w-100 my-2"},c.createElement(ve.a,{disabled:0===s.length||V()&&i!==Ve.None,onClick:function(){return l()}},c.createElement(pe.P,null)," Clear selection"),c.createElement(ve.a,{disabled:R(1,Ve.Faces),onClick:function(){n.builder.uprightAtOrigin(s[0]),n.instance.refreshFloatView(),l()}},c.createElement(pe.o,null),c.createElement("span",null," Upright")),c.createElement(ve.a,{disabled:R(2,Ve.Faces),onClick:function(){n.connectFaces(s),l(),o(Ve.None),a(n)}},c.createElement(pe.E,null),c.createElement("span",null," Connect")),c.createElement(ve.a,{disabled:V(),onClick:function(){return n.builder.replaceCrossedNexusCrosses()}},c.createElement(pe.G,null),c.createElement("span",null," Bows")))),c.createElement(Ot,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(pe.R,null)," Adjustments"),c.createElement(He,{feature:t[d.FabricFeature.ShapingPretenstFactor],disabled:V()}),c.createElement(He,{feature:t[d.FabricFeature.ShapingDrag],disabled:V()}),c.createElement(He,{feature:t[d.FabricFeature.ShapingStiffnessFactor],disabled:V()}),c.createElement(ge.a,{size:"sm",className:"w-100 my-2"},c.createElement(ve.a,{disabled:V(),color:b?"secondary":"success",onClick:function(){return v(!1)}},c.createElement(pe.l,null),": T or C"),c.createElement(ve.a,{disabled:V(),color:b?"success":"secondary",onClick:function(){return v(!0)}},c.createElement(pe.r,null),": T=C"))),c.createElement(Ot,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(pe.F,null)," Default Lengths"),c.createElement(He,{key:x.title,feature:x,disabled:V()}),c.createElement(ge.a,{className:"my-2"},p.map((function(e){return{intervalRole:e,feature:t[re(e)]}})).map((function(e){var t=e.intervalRole,n=e.feature;return c.createElement(ve.a,{size:"sm",key:"IntervalRole[".concat(t,"]"),onClick:function(){return j(n)},color:x.fabricFeature===n.fabricFeature?"success":"secondary"},m(t))})))))}function et(e){var t=e.floatFeatures,n=e.fabric,r=e.shapeSelection,a=e.storedState$,i=Object(c.useState)(a.getValue()),o=Object(me.a)(i,2),s=o[0],l=o[1],u=Object(c.useState)(a.getValue().ellipsoids),f=Object(me.a)(u,2),h=f[0],m=f[1];Object(c.useEffect)((function(){var e=[a.subscribe((function(e){m(s.ellipsoids),l(e)}))];return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[]);var p=Object(c.useState)(n.life),b=Object(me.a)(p,2),v=b[0],g=b[1];function E(){return h||r!==Ve.None||v.stage<d.Stage.Slack}function w(){return h||r!==Ve.None}return Object(c.useEffect)((function(){var e=n.life$.subscribe(g);return function(){return e.unsubscribe()}}),[n]),c.createElement("div",null,c.createElement(Ot,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(pe.a,null)," Phase"),c.createElement(Je,{fabric:n,stageTransition:Ce.SlackToRealizing,disabled:w()}),c.createElement(Je,{fabric:n,stageTransition:Ce.CaptureRealizedToSlack,disabled:w()})),c.createElement(Ot,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(pe.y,null)," Environment"),c.createElement(He,{feature:t[d.FabricFeature.PretenstFactor],disabled:E()}),c.createElement("div",{className:"float-right",style:{color:E()?"gray":"white"}},d.SurfaceCharacter[s.surfaceCharacter]),c.createElement("div",null,"Surface"),c.createElement(ge.a,{size:"sm",className:"w-100"},Object.keys(d.SurfaceCharacter).map((function(e){return c.createElement(ve.a,{key:"SurfaceCharacter[".concat(e,"]"),disabled:E(),active:s.surfaceCharacter===d.SurfaceCharacter[e],onClick:function(){return t={surfaceCharacter:d.SurfaceCharacter[e]},void a.next(ae(a.getValue(),t));var t}},e)}))),c.createElement(He,{feature:t[d.FabricFeature.Gravity],disabled:E()}),c.createElement(He,{feature:t[d.FabricFeature.Drag],disabled:E()})),c.createElement(Ot,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(pe.g,null)," Compression vs Tension"),c.createElement(Je,{fabric:n,stageTransition:Ce.CaptureStrainForStiffness,disabled:w()}),c.createElement(He,{feature:t[d.FabricFeature.PushOverPull],disabled:E()})))}!function(e){e[e.CaptureLengthsToSlack=0]="CaptureLengthsToSlack",e[e.CurrentLengthsToSlack=1]="CurrentLengthsToSlack",e[e.SlackToRealizing=2]="SlackToRealizing",e[e.SlackToShaping=3]="SlackToShaping",e[e.CaptureRealizedToSlack=4]="CaptureRealizedToSlack",e[e.CaptureStrainForStiffness=5]="CaptureStrainForStiffness"}(Ce||(Ce={})),function(e){e[e.None=0]="None",e[e.Faces=1]="Faces",e[e.Intervals=2]="Intervals"}(Ve||(Ve={}));var tt=.7,nt=1.4,rt=3.5,at=[d.FabricFeature.MaxStrain,d.FabricFeature.MaxStiffness,d.FabricFeature.VisualStrain,d.FabricFeature.SlackThreshold];function it(e){var t=new y.Geometry,n=function(e,t){return new y.Vector3(e,t,0)};return t.vertices=[n(0,-rt),n(0,rt),n(-tt,rt),n(tt,rt),n(-tt,-rt),n(tt,-rt)],e&&t.vertices.push(n(-tt,0),n(tt,0)),t}function ct(e,t,n,r,a){var i=new Float32Array(2*n.length*3),c=0;e.forEach((function(e){var t=(n[e.index]-r)/(a-r),o=t<-1?-1:t>1?1:t;i[c++]=-tt*nt,i[c++]=o*rt,i[c++]=0,i[c++]=tt*nt,i[c++]=o*rt,i[c++]=0}));var o=new y.BufferGeometry;return o.addAttribute("position",new y.Float32BufferAttribute(i,3)),o.addAttribute("color",new y.Float32BufferAttribute(t,3)),o}function ot(e){var t=e.floatFeatures,n=e.fabric,r=e.storedState$,a=Object(c.useRef)();return c.createElement(c.Fragment,null,c.createElement(Ot,{height:"50%"},c.createElement("div",{style:{position:"absolute",left:"6em"}},"Strain"),c.createElement("div",{style:{position:"absolute",right:"5em"}},"Stiffness"),c.createElement((function(){var e=Object(c.useState)(0),t=Object(me.a)(e,2),i=t[0],o=t[1],s=Object(c.useState)(r.getValue().featureValues[d.FabricFeature.MaxStrain].numeric),l=Object(me.a)(s,2),u=l[0],f=l[1],h=Object(c.useState)(r.getValue().featureValues[d.FabricFeature.MaxStiffness].numeric),m=Object(me.a)(h,2),p=m[0],b=m[1];Object(c.useEffect)((function(){var e=r.subscribe((function(e){f(e.featureValues[d.FabricFeature.MaxStrain].numeric),b(e.featureValues[d.FabricFeature.MaxStiffness].numeric)}));return function(){return e.unsubscribe()}}),[n]),Object(c.useEffect)((function(){var e=setInterval((function(){var e=n.instance.fabric.age;i<e&&o(e)}),1e3);return function(){return clearTimeout(e)}}),[]);var v=n.instance;function g(e){var t=e.position,n=e.intervals,r=e.floats,a=e.mid,i=e.max,o=e.middleTick;return c.createElement("group",{position:new y.Vector3(t,-.15,0)},c.createElement("lineSegments",{geometry:ct(n,v.floatView.lineColors,r,a,i),material:Ye}),c.createElement("lineSegments",{geometry:it(o),material:Ze}))}return c.createElement(be.a,null,c.createElement("orthographicCamera",{position:new y.Vector3(0,0,-1),ref:a}),c.createElement("scene",null,c.createElement(g,{position:-1.5,intervals:n.intervals,floats:v.floatView.strains,mid:0,max:u,middleTick:!0}),c.createElement(g,{position:1.5,intervals:n.intervals,floats:v.floatView.stiffnesses,mid:0,max:p,middleTick:!1})))}),null)),c.createElement(Ot,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(pe.N,null)," Adjustments"),at.map((function(e){return c.createElement(He,{key:"FabricFeature[".concat(e,"]"),feature:t[e],disabled:!1})}))))}var st=n(625),lt=n(614),ut=n(615),ft=n(616),dt=n(617);function ht(e){var t=e.rootTenscript,n=e.setRootTenscript,r=e.fabric,a=e.runTenscript,i=e.storedState$,o=Object(c.useState)(r&&!r.tenscript.fromUrl?r.tenscript:t),s=Object(me.a)(o,2),l=s[0],u=s[1],f=Object(c.useState)(""),d=Object(me.a)(f,2),h=d[0],m=d[1],p=Object(c.useState)(!1),b=Object(me.a)(p,2),v=b[0],g=b[1],E=Object(c.useState)(ne(i.getValue())),w=Object(me.a)(E,2),S=w[0],y=w[1],P=Object(c.useState)(!1),O=Object(me.a)(P,2),F=O[0],k=O[1];function N(e){var t=function(e,t){var n=t.code,r=t.name,a=ee({},e.recentCode);return a[r]=n,ae(e,{recentCode:a})}(i.getValue(),e);y(ne(t)),i.next(t)}return c.createElement("div",{id:"tenscript-panel",style:{flexDirection:"column",position:"relative",backgroundColor:"rgba(0,0,0,1)",height:"100%"}},c.createElement(Ot,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(pe.M,null)," Tenscript"),c.createElement("div",{id:"code-and-run",style:{flexDirection:"column",height:"available"}},c.createElement(mt,{tenscript:l,setTenscript:u,error:h,setError:m}),c.createElement(ge.a,{className:"w-100 my-2"},c.createElement(ve.a,{color:h.length>0?"warning":"success",disabled:h.length>0,onClick:function(){return a(l)}},0===h.length?c.createElement("span",null,"Execute ",c.createElement(pe.I,null)," tenscript"):c.createElement("span",null,c.createElement(pe.i,null)," ",h))))),c.createElement(Ot,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(pe.h,null)," Storage"),0===S.length?void 0:c.createElement(st.a,{className:"w-100 my-2",isOpen:v,toggle:function(){return g(!v)}},c.createElement(lt.a,{style:{borderRadius:"1.078em"}},v?c.createElement(pe.K,null):c.createElement(pe.J,null)," Recent"),c.createElement(ut.a,null,S.map((function(e,t){return c.createElement(ft.a,{key:"Recent".concat(t),onClick:function(){return a(e)}},e.name)})))),c.createElement(ge.a,{className:"w-100 my-2"},c.createElement(ve.a,{disabled:l.code===t.code,onClick:function(){n(l),N(l)}},"Save ",c.createElement(pe.C,null)," for later")),c.createElement(st.a,{className:"w-100 my-2",isOpen:F,toggle:function(){return k(!F)}},c.createElement(lt.a,{color:"info",style:{borderRadius:"1.078em"}},"Explore ",c.createElement(pe.D,null)," existing designs"),c.createElement(ut.a,null,J.map((function(e,t){return c.createElement(ft.a,{key:"Boot".concat(t),onClick:function(){return a(e)}},e.name)}))))))}function mt(e){var t=e.tenscript,n=e.setTenscript,r=e.error,a=e.setError,i=Object(c.useState)(""),o=Object(me.a)(i,2),s=o[0],l=o[1];function u(e){l(e),function(e){var t=W(a,!1,e);t&&(a(""),n(t))}(e)}return Object(c.useEffect)((function(){return l(t.code)}),[]),c.createElement("div",{className:"my-2 p-2 w-100",style:{backgroundColor:"#757575",color:"#ffffff",borderStyle:"solid",borderRadius:"1em",borderColor:0===r.length?"black":"#f0ad4e",borderWidth:"2px"}},c.createElement("h6",{className:"w-100 text-center"},c.createElement("i",null,'"',t.name,'"')),c.createElement(dt.a,{style:{borderRadius:"1em",height:"20em"},type:"textarea",id:"tenscript",value:s,onChange:function(e){return u(e.target.value)}}))}var pt=n(561),bt=n(562),vt=n.n(bt);function gt(e){return e.toFixed(5).replace(/[.]/,",")}function Et(){return(new Date).toISOString().replace(/[.].*/,"").replace(/[:T_]/g,"-")}function wt(e){var t=e.output,n=new vt.a;n.file("joints.csv",function(e){var t=[];return t.push(["index","x","y","z"]),e.joints.forEach((function(e){return t.push([(e.index+1).toFixed(0),gt(e.x),gt(e.y),gt(e.z)])})),t.map((function(e){return e.join(";")})).join("\n")}(t)),n.file("intervals.csv",function(e){var t=[];return t.push(["joints","type","strain","stiffness","linear density","role","length"]),e.intervals.forEach((function(e){t.push(['"=""'.concat(e.joints.map((function(e){return(e+1).toFixed(0)})),'"""'),e.type,gt(e.strain),gt(e.stiffness),gt(e.linearDensity),e.role,e.length.toFixed(8)])})),t.map((function(e){return e.join(";")})).join("\n")}(t)),n.file("submerged.csv",function(e){var t=[];return t.push(["joints"]),t.push(['"=""'.concat(e.submergedJoints.map((function(e){return e.index+1})),'"""')]),t.map((function(e){return e.join(";")})).join("\n")}(e)),n.generateAsync({type:"blob",mimeType:"application/zip"}).then((function(e){pt.saveAs(e,"pretenst-".concat(Et(),".zip"))}))}function St(e){var t=e.floatFeatures,n=e.fabric,r=e.visibleRoles,a=e.setVisibleRoles,i=e.storedState$,o=Object(c.useState)(i.getValue().ellipsoids),s=Object(me.a)(o,2),l=s[0],u=s[1],f=Object(c.useState)(i.getValue().showPushes),h=Object(me.a)(f,2),b=h[0],v=h[1],g=Object(c.useState)(i.getValue().showPulls),E=Object(me.a)(g,2),w=E[0],y=E[1];Object(c.useEffect)((function(){var e=i.subscribe((function(e){u(e.ellipsoids),v(e.showPushes),y(e.showPulls)}));return function(){return e.unsubscribe()}}),[]);var P=Object(c.useState)(n.life),O=Object(me.a)(P,2),F=O[0],k=O[1];function N(e){var t=e.pushes,n=e.pulls,r=e.children;return c.createElement(ve.a,{style:{color:"white"},color:t===b&&n===w?"success":"secondary",onClick:function(){i.next(ae(i.getValue(),{showPulls:n,showPushes:t}))}},r)}return Object(c.useEffect)((function(){var e=n.life$.subscribe(k);return function(){return e.unsubscribe()}}),[n]),c.createElement("div",null,c.createElement(Ot,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(pe.t,null)," Coloring"),c.createElement(ge.a,{className:"w-100 my-2"},c.createElement(N,{pushes:!0,pulls:!0},c.createElement("span",null,c.createElement(pe.x,null)," All")),c.createElement(N,{pushes:!1,pulls:!0},c.createElement("span",null,c.createElement(pe.S,null)," Pulls")),c.createElement(N,{pushes:!0,pulls:!1},c.createElement("span",null,c.createElement(pe.s,null)," Pushes")),c.createElement(N,{pushes:!1,pulls:!1},c.createElement("span",null,c.createElement(pe.m,null)," Roles")))),c.createElement(Ot,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(pe.j,null)," Snapshot"),c.createElement(ge.a,{size:"sm"},p.map((function(e){return c.createElement(ve.a,{color:r.indexOf(e)<0?"secondary":"success",key:"viz".concat(e),onClick:function(){r.indexOf(e)<0?a([].concat(Object(S.a)(r),[e])):a(r.filter((function(t){return t!==e})))},disabled:!l},m(e))}))),c.createElement(He,{key:"pushrad",feature:t[d.FabricFeature.PushRadius],disabled:!l}),c.createElement(He,{key:"pullrad",feature:t[d.FabricFeature.PullRadius],disabled:!l}),c.createElement(He,{key:"jointrad",feature:t[d.FabricFeature.JointRadius],disabled:!l})),c.createElement(Ot,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(pe.n,null)," Time"),c.createElement(He,{key:"it",feature:t[d.FabricFeature.IterationsPerFrame],disabled:l}),c.createElement(He,{key:"ic",feature:t[d.FabricFeature.IntervalCountdown],disabled:l}),c.createElement(He,{key:"pc",feature:t[d.FabricFeature.RealizingCountdown],disabled:l})),c.createElement(Ot,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(pe.w,null)," Perturb"),c.createElement(ge.a,{className:"w-100"},c.createElement(ve.a,{disabled:F.stage!==d.Stage.Realized,onClick:function(){return n.instance.fabric.set_altitude(1)}},c.createElement(pe.A,null)," Nudge"),c.createElement(ve.a,{disabled:F.stage!==d.Stage.Realized,onClick:function(){return n.instance.fabric.set_altitude(10)}},c.createElement(pe.H,null)," Drop"),c.createElement(ve.a,{disabled:l,onClick:function(){return n.instance.fabric.centralize()}},c.createElement(pe.p,null)," Centralize"))),c.createElement(Ot,null,c.createElement("h6",{className:"w-100 text-center"},c.createElement(pe.L,null)," Take"),c.createElement(ge.a,{vertical:!1,className:"w-100"},c.createElement(ve.a,{onClick:function(){return wt(n)}},c.createElement(pe.q,null)," Download CSV ",c.createElement(pe.v,null)),c.createElement(ve.a,{onClick:function(){return function(e){var t=e.output,n=new vt.a;n.file("pretenst-".concat(Et(),".json"),JSON.stringify(t,void 0,2)),n.generateAsync({type:"blob",mimeType:"application/zip"}).then((function(e){pt.saveAs(e,"pretenst-".concat(Et(),".zip"))}))}(n)}},c.createElement(pe.q,null)," Download JSON ",c.createElement(pe.u,null)))))}var yt="25em";function Pt(e){var t=e.floatFeatures,n=e.rootTenscript,r=e.setRootTenscript,a=e.shapeSelection,i=e.setShapeSelection,o=e.selectedFaces,s=e.clearSelectedFaces,l=e.selectedIntervals,u=e.fabric,f=e.setFabric,d=e.runTenscript,h=e.visibleRoles,m=e.setVisibleRoles,p=e.toFullScreen,b=e.storedState$,v=Object(c.useState)(u?u.life:void 0),g=Object(me.a)(v,2),E=g[0],w=g[1];Object(c.useEffect)((function(){var e=u?u.life$.subscribe(w):void 0;return function(){e&&e.unsubscribe()}}),[u]);var S=Object(c.useState)(b.getValue().controlTab),y=Object(me.a)(S,2),P=y[0],O=y[1];function F(e){var t=e.tab;return c.createElement(Me.a,null,c.createElement(Te.a,{active:P===t,onClick:function(){return b.next(ae(b.getValue(),{controlTab:t}))}},t))}function k(e){var p=e.tab,v=c.createElement(Ie.a,{color:"warning"},"No fabric");return c.createElement(Ae.a,{id:"tab-pane",style:{height:"100%"},tabId:p},c.createElement((function(){switch(p){case H.Grow:return c.createElement(ht,{rootTenscript:n,setRootTenscript:r,fabric:u,runTenscript:d,storedState$:b});case H.Shape:return u?c.createElement(Ke,{floatFeatures:t,fabric:u,setFabric:f,selectedIntervals:l,shapeSelection:a,setShapeSelection:i,selectedFaces:o,clearSelectedFaces:s,storedState$:b}):v;case H.Realize:return u?c.createElement(et,{floatFeatures:t,fabric:u,shapeSelection:a,storedState$:b}):v;case H.View:return u?c.createElement(St,{floatFeatures:t,fabric:u,visibleRoles:h,setVisibleRoles:m,storedState$:b}):v;case H.Strain:return u?c.createElement(ot,{floatFeatures:t,fabric:u,storedState$:b}):v}}),null))}return Object(c.useEffect)((function(){P!==H.Shape&&s()}),[P,E]),Object(c.useEffect)((function(){var e=b.subscribe((function(e){return O(e.controlTab)}));return function(){return e.unsubscribe()}}),[]),c.createElement("div",{className:"h-100"},c.createElement(_e.a,{tabs:!0,style:{backgroundColor:"#b2b2b2"}},Object.keys(H).map((function(e){return c.createElement(F,{key:"T".concat(e),tab:H[e]})}))),c.createElement(Le.a,{style:{flex:1,flexFlow:"auto",height:"100%"},id:"tab-content",activeTab:P},Object.keys(H).map((function(e){return c.createElement(k,{key:e,tab:H[e]})}))),c.createElement("div",{style:{position:"absolute",top:0,height:"100%",left:yt,zIndex:10,width:"1em"}},c.createElement((function(){return c.createElement(ve.a,{style:{padding:0,margin:0,borderRadius:0,width:"1em"},className:"w-100 h-100",color:"dark",onClick:p},c.createElement(pe.c,null))}),null)))}function Ot(e){var t=e.children,n=e.height;return c.createElement("div",{className:"m-3 p-2",style:{height:n,borderRadius:"1em",borderStyle:"solid",borderWidth:"0.1em",borderColor:"#45782e"}},t)}var Ft=n(612),kt=n(610),Nt=n(611),xt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},jt={type:"change"},Ct={type:"start"},Vt={type:"end"},Rt=function(e){function t(e,n){var r;return Object(u.a)(this,t),(r=Object(Ft.a)(this,Object(kt.a)(t).call(this))).object=void 0,r.element=void 0,r.window=void 0,r.enabled=void 0,r.target=void 0,r.enableZoom=void 0,r.zoomSpeed=void 0,r.minDistance=void 0,r.maxDistance=void 0,r.enableRotate=void 0,r.rotateSpeed=void 0,r.enablePan=void 0,r.keyPanSpeed=void 0,r.autoRotate=void 0,r.autoRotateSpeed=void 0,r.minZoom=void 0,r.maxZoom=void 0,r.minPolarAngle=void 0,r.maxPolarAngle=void 0,r.minAzimuthAngle=void 0,r.maxAzimuthAngle=void 0,r.keys=void 0,r.mouseButtons=void 0,r.enableDamping=void 0,r.dampingFactor=void 0,r.spherical=void 0,r.sphericalDelta=void 0,r.scale=void 0,r.target0=void 0,r.position0=void 0,r.zoom0=void 0,r.state=void 0,r.panOffset=void 0,r.zoomChanged=void 0,r.rotateStart=void 0,r.rotateEnd=void 0,r.rotateDelta=void 0,r.panStart=void 0,r.panEnd=void 0,r.panDelta=void 0,r.dollyStart=void 0,r.dollyEnd=void 0,r.dollyDelta=void 0,r.updateLastPosition=void 0,r.updateOffset=void 0,r.updateQuat=void 0,r.updateLastQuaternion=void 0,r.updateQuatInverse=void 0,r.panLeftV=void 0,r.panUpV=void 0,r.panInternalOffset=void 0,r.onMouseUp=void 0,r.onMouseDown=void 0,r.onMouseMove=void 0,r.onMouseWheel=void 0,r.onTouchStart=void 0,r.onTouchEnd=void 0,r.onTouchMove=void 0,r.object=e,r.element=n,r.window=window,r.enabled=!0,r.target=new y.Vector3,r.minDistance=0,r.maxDistance=1/0,r.minZoom=0,r.maxZoom=1/0,r.minPolarAngle=0,r.maxPolarAngle=Math.PI,r.minAzimuthAngle=-1/0,r.maxAzimuthAngle=1/0,r.enableDamping=!1,r.dampingFactor=.25,r.enableZoom=!0,r.zoomSpeed=1,r.enableRotate=!0,r.rotateSpeed=1,r.enablePan=!0,r.keyPanSpeed=7,r.autoRotate=!1,r.autoRotateSpeed=2,r.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},r.mouseButtons={ORBIT:y.MOUSE.LEFT,ZOOM:y.MOUSE.MIDDLE,PAN:y.MOUSE.RIGHT},r.target0=r.target.clone(),r.position0=r.object.position.clone(),r.zoom0=r.object.zoom,r.updateOffset=new y.Vector3,r.updateQuat=(new y.Quaternion).setFromUnitVectors(r.object.up,new y.Vector3(0,1,0)),r.updateQuatInverse=r.updateQuat.clone().inverse(),r.updateLastPosition=new y.Vector3,r.updateLastQuaternion=new y.Quaternion,r.state=xt.NONE,r.scale=1,r.spherical=new y.Spherical,r.sphericalDelta=new y.Spherical,r.panOffset=new y.Vector3,r.zoomChanged=!1,r.rotateStart=new y.Vector2,r.rotateEnd=new y.Vector2,r.rotateDelta=new y.Vector2,r.panStart=new y.Vector2,r.panEnd=new y.Vector2,r.panDelta=new y.Vector2,r.dollyStart=new y.Vector2,r.dollyEnd=new y.Vector2,r.dollyDelta=new y.Vector2,r.panLeftV=new y.Vector3,r.panUpV=new y.Vector3,r.panInternalOffset=new y.Vector3,r.onMouseDown=function(e){if(e.preventDefault(),r.enabled){if(e.button===r.mouseButtons.ORBIT){if(!r.enableRotate)return;r.rotateStart.set(e.clientX,e.clientY),r.state=xt.ROTATE}else if(e.button===r.mouseButtons.ZOOM){if(!r.enableZoom)return;r.dollyStart.set(e.clientX,e.clientY),r.state=xt.DOLLY}else if(e.button===r.mouseButtons.PAN){if(!r.enablePan)return;r.panStart.set(e.clientX,e.clientY),r.state=xt.PAN}r.state!==xt.NONE&&(document.addEventListener("mousemove",r.onMouseMove,!1),document.addEventListener("mouseup",r.onMouseUp,!1),r.dispatchEvent(Ct))}},r.onMouseMove=function(e){if(e.preventDefault(),r.enabled)if(r.state===xt.ROTATE){if(!r.enableRotate)return;r.rotateEnd.set(e.clientX,e.clientY),r.rotateDelta.subVectors(r.rotateEnd,r.rotateStart),r.rotateLeft(2*Math.PI*r.rotateDelta.x/r.element.clientWidth*r.rotateSpeed),r.rotateUp(2*Math.PI*r.rotateDelta.y/r.element.clientHeight*r.rotateSpeed),r.rotateStart.copy(r.rotateEnd),r.update()}else if(r.state===xt.DOLLY){if(!r.enableZoom)return;r.dollyEnd.set(e.clientX,e.clientY),r.dollyDelta.subVectors(r.dollyEnd,r.dollyStart),r.dollyDelta.y>0?r.dollyIn(r.getZoomScale()):r.dollyDelta.y<0&&r.dollyOut(r.getZoomScale()),r.dollyStart.copy(r.dollyEnd),r.update()}else if(r.state===xt.PAN){if(!r.enablePan)return;r.panEnd.set(e.clientX,e.clientY),r.panDelta.subVectors(r.panEnd,r.panStart),r.pan(r.panDelta.x,r.panDelta.y),r.panStart.copy(r.panEnd),r.update()}},r.onMouseUp=function(e){e.preventDefault(),r.enabled&&(document.removeEventListener("mousemove",r.onMouseMove,!1),document.removeEventListener("mouseup",r.onMouseUp,!1),r.dispatchEvent(Vt),r.state=xt.NONE)},r.onMouseWheel=function(e){e.preventDefault(),r.enabled&&r.enableZoom&&(r.state===xt.NONE||r.state===xt.ROTATE)&&(e.stopPropagation(),e.deltaY<0?r.dollyOut(r.getZoomScale()):e.deltaY>0&&r.dollyIn(r.getZoomScale()),r.update(),r.dispatchEvent(Ct),r.dispatchEvent(Vt))},r.onTouchStart=function(e){if(e.preventDefault(),r.enabled){switch(e.touches.length){case 1:if(!r.enableRotate)return;r.rotateStart.set(e.touches[0].pageX,e.touches[0].pageY),r.state=xt.TOUCH_ROTATE;break;case 2:if(!r.enableZoom)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);r.dollyStart.set(0,a),r.state=xt.TOUCH_DOLLY;break;case 3:if(!r.enablePan)return;r.panStart.set(e.touches[0].pageX,e.touches[0].pageY),r.state=xt.TOUCH_PAN;break;default:r.state=xt.NONE}r.state!==xt.NONE&&r.dispatchEvent(Ct)}},r.onTouchMove=function(e){if(e.preventDefault(),r.enabled)switch(e.touches.length){case 1:if(!r.enableRotate)return;if(r.state!==xt.TOUCH_ROTATE)return;r.rotateEnd.set(e.touches[0].pageX,e.touches[0].pageY),r.rotateDelta.subVectors(r.rotateEnd,r.rotateStart),r.rotateLeft(2*Math.PI*r.rotateDelta.x/r.element.clientWidth*r.rotateSpeed),r.rotateUp(2*Math.PI*r.rotateDelta.y/r.element.clientHeight*r.rotateSpeed),r.rotateStart.copy(r.rotateEnd),r.update();break;case 2:if(!r.enableZoom)return;if(r.state!==xt.TOUCH_DOLLY)return;var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,a=Math.sqrt(t*t+n*n);r.dollyEnd.set(0,a),r.dollyDelta.subVectors(r.dollyEnd,r.dollyStart),r.dollyDelta.y>0?r.dollyOut(r.getZoomScale()):r.dollyDelta.y<0&&r.dollyIn(r.getZoomScale()),r.dollyStart.copy(r.dollyEnd),r.update();break;case 3:if(!r.enablePan)return;if(r.state!==xt.TOUCH_PAN)return;r.panEnd.set(e.touches[0].pageX,e.touches[0].pageY),r.panDelta.subVectors(r.panEnd,r.panStart),r.pan(r.panDelta.x,r.panDelta.y),r.panStart.copy(r.panEnd),r.update();break;default:r.state=xt.NONE}},r.onTouchEnd=function(e){e.preventDefault(),r.enabled&&(r.dispatchEvent(Vt),r.state=xt.NONE)},r.element.addEventListener("mousedown",r.onMouseDown,{capture:!0}),r.element.addEventListener("wheel",r.onMouseWheel,{capture:!0}),r.element.addEventListener("touchstart",r.onTouchStart,{capture:!0}),r.element.addEventListener("touchend",r.onTouchEnd,{capture:!0}),r.element.addEventListener("touchmove",r.onTouchMove,{capture:!0}),r.update(),r}return Object(Nt.a)(t,e),Object(f.a)(t,[{key:"update",value:function(){var e=this.object.position;return this.updateOffset.copy(e).sub(this.target),this.updateOffset.applyQuaternion(this.updateQuat),this.spherical.setFromVector3(this.updateOffset),this.autoRotate&&this.state===xt.NONE&&this.rotateLeft(this.getAutoRotationAngle()),this.spherical.theta+=this.sphericalDelta.theta,this.spherical.phi+=this.sphericalDelta.phi,this.spherical.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.spherical.theta)),this.spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.spherical.phi)),this.spherical.makeSafe(),this.spherical.radius*=this.scale,this.spherical.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.spherical.radius)),this.target.add(this.panOffset),this.updateOffset.setFromSpherical(this.spherical),this.updateOffset.applyQuaternion(this.updateQuatInverse),e.copy(this.target).add(this.updateOffset),this.object.lookAt(this.target),this.enableDamping?(this.sphericalDelta.theta*=1-this.dampingFactor,this.sphericalDelta.phi*=1-this.dampingFactor):this.sphericalDelta.set(0,0,0),this.scale=1,this.panOffset.set(0,0,0),!!(this.zoomChanged||this.updateLastPosition.distanceToSquared(this.object.position)>1e-6||8*(1-this.updateLastQuaternion.dot(this.object.quaternion))>1e-6)&&(this.dispatchEvent(jt),this.updateLastPosition.copy(this.object.position),this.updateLastQuaternion.copy(this.object.quaternion),this.zoomChanged=!1,!0)}},{key:"panLeft",value:function(e,t){this.panLeftV.setFromMatrixColumn(t,0),this.panLeftV.multiplyScalar(-e),this.panOffset.add(this.panLeftV)}},{key:"panUp",value:function(e,t){this.panUpV.setFromMatrixColumn(t,1),this.panUpV.multiplyScalar(e),this.panOffset.add(this.panUpV)}},{key:"pan",value:function(e,t){var n=this.element,r=this.object.position;this.panInternalOffset.copy(r).sub(this.target);var a=this.panInternalOffset.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this.panLeft(2*e*a/n.clientHeight,this.object.matrix),this.panUp(2*t*a/n.clientHeight,this.object.matrix)}},{key:"dollyIn",value:function(e){this.scale/=e}},{key:"dollyOut",value:function(e){this.scale*=e}},{key:"getAutoRotationAngle",value:function(){return 2*Math.PI/60/60*this.autoRotateSpeed}},{key:"getZoomScale",value:function(){return Math.pow(.95,this.zoomSpeed)}},{key:"rotateLeft",value:function(e){this.sphericalDelta.theta-=e}},{key:"rotateUp",value:function(e){this.sphericalDelta.phi-=e}},{key:"getPolarAngle",value:function(){return this.spherical.phi}},{key:"getAzimuthalAngle",value:function(){return this.spherical.theta}},{key:"dispose",value:function(){this.element.removeEventListener("mousedown",this.onMouseDown,!1),this.element.removeEventListener("wheel",this.onMouseWheel,!1),this.element.removeEventListener("touchstart",this.onTouchStart,!1),this.element.removeEventListener("touchend",this.onTouchEnd,!1),this.element.removeEventListener("touchmove",this.onTouchMove,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1)}},{key:"reset",value:function(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(jt),this.update(),this.state=xt.NONE}}]),t}(y.EventDispatcher),Mt=[new y.Vector3(0,0,-20),new y.Vector3(-17.32,0,-10),new y.Vector3(-17.32,0,10),new y.Vector3(0,0,20),new y.Vector3(17.32,0,10),new y.Vector3(17.32,0,-10)],Tt=new y.Color("tan"),It=6,At=new y.Vector3(0,1,0),_t=.03;function Lt(){var e=Object(c.useMemo)((function(){return function(){var e=new y.Geometry;return function(e,t){e.push.apply(e,Object(S.a)(Mt.map((function(e){return new y.Vector3(e.x,e.y,e.z)})))),e.push(new y.Vector3);for(var n=0;n<It;n++){var r=(n+1)%It,a=[At,(new y.Vector3).add(At).addScaledVector(Mt[n],_t).normalize(),(new y.Vector3).add(At).addScaledVector(Mt[r],_t).normalize()];t.push(new y.Face3(It,n,r,a,Tt))}}(e.vertices,e.faces),e.vertices.forEach((function(e){return e.sub(new y.Vector3(0,.01,0))})),e.computeBoundingSphere(),e}()}),[]);return c.createElement("mesh",{name:"Spots",geometry:e,material:Be})}Object(be.b)({Orbit:Rt});var Dt=new y.SphereGeometry(1,32,8),zt=new y.CylinderGeometry(1,1,1,12,1,!1),Bt=new y.CylinderGeometry(.5,.5,1,6,1,!1),Yt=new y.CylinderGeometry(1,1,.85,12,1,!1),Zt=new y.Color("#ffffff"),Xt=100,Ut=1,$t=new y.SphereGeometry(Xt,25,25).scale(Ut,Ut,Ut),Gt=.01,Wt=4,Qt=new y.Vector3(0,1,0);function Ht(e){var t=e.fabric,n=e.fabricError,r=e.selectedIntervals,a=e.selectedFaces,i=e.setSelectedFaces,o=e.storedState$,s=e.shapeSelection,l=e.ellipsoids,u=e.visibleRoles,f=document.getElementById("view-container"),h=Object(c.useState)(0),m=Object(me.a)(h,2),p=m[0],b=m[1],v=Object(be.d)().camera,g=Object(c.useMemo)((function(){var e=(new y.TextureLoader).load("space.jpg");return new y.MeshPhongMaterial({map:e,side:y.BackSide})}),[]),E=Object(c.useState)(t.life),w=Object(me.a)(E,2),P=w[0],O=w[1];Object(c.useEffect)((function(){var e=t.life$.subscribe(O);return function(){return e.unsubscribe()}}),[t]);var F=Object(c.useState)(o.getValue()),k=Object(me.a)(F,2),N=k[0],x=k[1];Object(c.useEffect)((function(){var e=o.subscribe((function(e){return x(e)}));return function(){return e.unsubscribe()}}),[]),Object(c.useEffect)((function(){j.current.autoRotate=N.rotating}),[N]);var j=Object(be.e)((function(e){var t=new y.Vector3(0,Wt,0);v.position.set(t.x,Wt,t.z+4*Wt),v.lookAt(j.current.target),v.fov=60,v.far=2*Xt,v.near=.001,e.object=v,e.minPolarAngle=-.98*Math.PI/2,e.maxPolarAngle=.8*Math.PI,e.maxDistance=Xt*Ut*.9,e.zoomSpeed=.5,e.enableZoom=!0,e.target.set(t.x,t.y,t.z),e.update()}),[]);return Object(be.c)((function(){try{var e=t.instance,r=e.view,a=new y.Vector3(r.midpoint_x(),r.midpoint_y(),r.midpoint_z()),i=(new y.Vector3).subVectors(a,j.current.target).multiplyScalar(Gt);if(j.current.target.add(i),j.current.update(),!l&&s!==Ve.Faces){var c=t.iterate();P.stage===d.Stage.Realizing&&c===d.Stage.Realized?setTimeout((function(){return t.toStage(d.Stage.Realized,{})})):c!==P.stage&&P.stage!==d.Stage.Realizing&&c!==d.Stage.Busy&&setTimeout((function(){return t.toStage(c,{})}))}b(e.fabric.age)}catch(o){n(o)}}),!0,[t,p,P,s,l]),c.createElement("group",null,c.createElement("orbit",{ref:j,args:[v,f]}),c.createElement("scene",null,l?c.createElement(Kt,{key:"ellipsoid",fabric:t,selectedIntervals:r,storedState:N,visibleRoles:u}):c.createElement(en,{key:"lines",fabric:t,selectedIntervals:r,storedState:N}),s!==Ve.Faces?void 0:c.createElement(tn,{key:"faces",fabric:t,stage:P.stage,selectFace:function(e){a.some((function(t){return t.index===e.index}))?i(a.filter((function(t){return t.index!==e.index}))):i([].concat(Object(S.a)(a),[e]))}}),a.map((function(e){return c.createElement(Jt,{key:"Face".concat(e.index),fabric:t,face:e})})),c.createElement(Lt,null),c.createElement("mesh",{key:"space",geometry:$t,material:g}),c.createElement("ambientLight",{color:Zt,intensity:.8}),c.createElement("directionalLight",{color:new y.Color("#FFFFFF"),intensity:2})))}function Jt(e){e.fabric;var t=e.face,n=A(t.brick.scale)/8;return c.createElement("mesh",{geometry:Dt,position:t.location(),material:Ue,scale:new y.Vector3(n,n,n)})}function qt(e){var t=e.fabric,n=e.interval,r=e.storedState,a=Qe(n.intervalRole);if((r.showPushes||r.showPulls)&&(a=function(e){var t=Math.floor(e*Ge.length);return Ge[t>=Ge.length?Ge.length-1:t]}(t.instance.floatView.strainNuances[n.index]),(!r.showPushes||!r.showPulls)&&(r.showPushes&&!n.isPush||r.showPulls&&n.isPush)))return c.createElement("group",null);var i=t.instance.floatView.linearDensities[n.index],o=r.featureValues[n.isPush?d.FabricFeature.PushRadius:d.FabricFeature.PullRadius].numeric*i,s=t.instance.unitVector(n.index),l=(new y.Quaternion).setFromUnitVectors(Qt,s),u=n.alpha.location().distanceTo(n.omega.location()),f=o*r.featureValues[d.FabricFeature.JointRadius].numeric,h=new y.Vector3(o,u+(n.isPush?2*-f:0),o),m=new y.Vector3(f,f,f);return c.createElement(c.Fragment,null,n.isPush?c.createElement(c.Fragment,null,c.createElement("mesh",{geometry:Bt,position:n.location(),rotation:(new y.Euler).setFromQuaternion(l),scale:h,material:a,matrixWorldNeedsUpdate:!0}),c.createElement("mesh",{geometry:Yt,position:n.location(),rotation:(new y.Euler).setFromQuaternion(l),scale:h,material:a,matrixWorldNeedsUpdate:!0}),c.createElement("mesh",{geometry:Dt,position:n.alpha.location(),material:$e,scale:m,matrixWorldNeedsUpdate:!0}),c.createElement("mesh",{geometry:Dt,position:n.omega.location(),material:$e,scale:m,matrixWorldNeedsUpdate:!0})):c.createElement("mesh",{geometry:zt,position:n.location(),rotation:(new y.Euler).setFromQuaternion(l),scale:h,material:a,matrixWorldNeedsUpdate:!0}))}function Kt(e){var t=e.fabric,n=e.visibleRoles,r=e.selectedIntervals,a=e.storedState;return c.createElement("group",null,r.length>0?r.map((function(e){return c.createElement(qt,{key:"SI".concat(e.index),fabric:t,interval:e,storedState:a})})):t.intervals.map((function(e){return n.indexOf(e.intervalRole)<0?void 0:c.createElement(qt,{key:"I".concat(e.index),fabric:t,interval:e,storedState:a})})),"}")}function en(e){var t=e.fabric,n=e.selectedIntervals,r=e.storedState;return c.createElement("group",null,c.createElement("lineSegments",{key:"lines",geometry:t.linesGeometry,material:Ye}),n.map((function(e){return c.createElement(qt,{key:"SI".concat(e.index),fabric:t,interval:e,storedState:r})})))}function tn(e){var t=e.fabric,n=e.stage,r=e.selectFace,a=Object(be.d)().raycaster,i=Object(c.useRef)(),o=Object(c.useState)(),s=Object(me.a)(o,2),l=s[0],u=s[1];return c.createElement("mesh",{key:"faces",ref:i,onPointerDown:function(e){return u(e)},onPointerUp:function(e){var c=i.current;if(!function(e){return e===d.Stage.Growing||e===d.Stage.Slack}(n)&&l&&c){var o=l.clientX-e.clientX,s=l.clientY-e.clientY;if(!(o*o+s*s>100)){var f=a.intersectObjects([c],!0).map((function(e){return e.faceIndex})).map((function(e){if(void 0!==e)return t.faces[e]})).reverse().pop();u(void 0),f&&r(f)}}},geometry:t.facesGeometry,material:Xe})}var nn="25em",rn="26em";function an(e){var t=function(){var e=location.hash.substring(1);try{return W((function(e){return console.error(e)}),!0,decodeURIComponent(e))}catch(t){console.error("Code error",t)}}();if(t)return t;var n=ne(e);return n.length>0?n[0]:J[0]}function cn(e){var t=e.eig,n=e.floatFeatures,r=e.storedState$,a=Object(c.useMemo)((function(){return new ye(t,100)}),[]),i=Object(c.useState)(),o=Object(me.a)(i,2),s=o[0],l=o[1],u=Object(c.useState)([]),f=Object(me.a)(u,2),h=f[0],m=f[1],b=Object(c.useState)([]),g=Object(me.a)(b,2),E=g[0],w=g[1];Object(c.useEffect)((function(){return m(E.reduce((function(e,t){var n=function(t){return!e.some((function(e){return t.index===e.index}))},r=t.pulls.filter(n),a=t.pushes.filter(n);return[].concat(Object(S.a)(e),Object(S.a)(a),Object(S.a)(r))}),[]))}),[E]);var y=Object(c.useState)((function(){return an(r.getValue())})),P=Object(me.a)(y,2),O=P[0],F=P[1];Object(c.useEffect)((function(){0===location.hash.length&&(location.hash=O.code)}),[O]);var k=Object(c.useState)(p),N=Object(me.a)(k,2),x=N[0],j=N[1],C=Object(c.useState)(r.getValue().rotating),V=Object(me.a)(C,2),R=V[0],M=V[1],T=Object(c.useState)(Ve.None),I=Object(me.a)(T,2),_=I[0],L=I[1],D=Object(c.useState)(r.getValue().fullScreen),z=Object(me.a)(D,2),B=z[0],Y=z[1],Z=Object(c.useState)(r.getValue().ellipsoids),X=Object(me.a)(Z,2),U=X[0],$=X[1];function G(e){if(a){location.hash=e.code,n[d.FabricFeature.ShapingPretenstFactor].percent=100,n[d.FabricFeature.ShapingDrag].percent=100,n[d.FabricFeature.ShapingStiffnessFactor].percent=100,r.next(ae(r.getValue(),{ellipsoids:!1}));l(new Re((function(e){return function(e,t){if(t===d.IntervalRole.FacePull)throw new Error;return e[re(t)].numeric}(n,e)}),(function(e){return r.getValue().featureValues[e].numeric}),a,e))}}function W(e){r.next(ae(r.getValue(),{fullScreen:e}))}return Object(c.useEffect)((function(){return j(p)}),[U]),Object(c.useEffect)((function(){var e=r.subscribe((function(e){Y(e.fullScreen),$(e.ellipsoids),M(e.rotating),s&&(a.world.set_coloring(e.showPushes,e.showPulls),a.world.set_surface_character(e.surfaceCharacter))}));return function(){return e.unsubscribe()}}),[s]),Object(c.useEffect)((function(){var e=Object.keys(n).map((function(e){return n[e]})).map((function(e){return e.observable.subscribe((function(t){if(s){s.instance.applyFeature(e);var n=v(e.config.feature);void 0!==n&&s.intervals.filter((function(e){return e.intervalRole===n})).forEach((function(t){var n=e.numeric*A(t.scale);s.instance.fabric.change_rest_length(t.index,n,500)}))}}))}));return function(){return e.forEach((function(e){return e.unsubscribe()}))}}),[s]),Object(c.useEffect)((function(){var e=setTimeout((function(){s||G(O)}),200);return function(){return clearTimeout(e)}}),[O]),c.createElement(c.Fragment,null,B?c.createElement(ve.a,{id:"to-full-screen",color:"dark",onClick:function(){return W(!1)}},c.createElement(pe.d,null),c.createElement("br",null),c.createElement(pe.Q,null),c.createElement("br",null),c.createElement(pe.d,null)):c.createElement("div",{id:"left-side",style:{visibility:B?"collapse":"visible",width:nn}},c.createElement(Pt,{floatFeatures:n,rootTenscript:O,setRootTenscript:F,fabric:s,setFabric:l,selectedIntervals:h,shapeSelection:_,setShapeSelection:L,selectedFaces:E,clearSelectedFaces:function(){return w([])},runTenscript:G,toFullScreen:function(){return W(!0)},visibleRoles:x,setVisibleRoles:j,storedState$:r})),c.createElement("div",{style:{position:"absolute",left:B?0:rn,right:0,height:"100%"}},s?c.createElement("div",{className:"h-100"},c.createElement(on,{fabric:s}),c.createElement("div",{id:"bottom-middle"},c.createElement(ge.a,null,c.createElement(ve.a,{color:U?"warning":"secondary",onClick:function(){return r.next(ae(r.getValue(),{ellipsoids:!U}))}},c.createElement(pe.j,null)),c.createElement(ve.a,{color:_===Ve.Faces?"warning":"secondary",disabled:U&&_===Ve.None,onClick:function(){return L(_!==Ve.Faces?Ve.Faces:Ve.None)}},c.createElement("span",null,c.createElement(pe.z,null))),c.createElement(ve.a,{color:R?"warning":"secondary",onClick:function(){return r.next(ae(r.getValue(),{rotating:!R}))}},c.createElement(pe.O,null)))),c.createElement("div",{id:"view-container",className:"h-100"},c.createElement(be.a,{style:{backgroundColor:"black",borderStyle:"solid",borderColor:_===Ve.Faces||U?"#f0ad4e":"black",cursor:_===Ve.Faces?"pointer":"all-scroll",borderWidth:"2px"}},c.createElement(Ht,{fabric:s,fabricError:function(e){console.error(e);var t=s.tenscript;l(void 0),setTimeout((function(){return G(t)}),1e3)},selectedIntervals:h,selectedFaces:E,setSelectedFaces:w,shapeSelection:_,ellipsoids:U,visibleRoles:x,storedState$:r})))):c.createElement("div",{id:"tensegrity-view",className:"h-100"},c.createElement("div",{style:{position:"relative",top:"50%",left:"50%"}},c.createElement(ve.a,{onClick:function(){return G(O)}},c.createElement("h6",null,O.name),c.createElement("h1",null,c.createElement(pe.I,null)))))))}function on(e){var t=e.fabric,n=Object(c.useState)(t.life),r=Object(me.a)(n,2),a=r[0],i=r[1];return Object(c.useEffect)((function(){var e=t.life$.subscribe(i);return function(){return e.unsubscribe()}}),[t]),c.createElement("div",{id:"top-middle"},c.createElement("span",null,d.Stage[a.stage])," ",c.createElement("i",null,'"',t.tenscript.name,'"'))}function sn(e){return ln.apply(this,arguments)}function ln(){return(ln=Object(i.a)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=document.getElementById("root"),(r=new s.BehaviorSubject(ce(se,t.default_fabric_feature))).subscribe((function(e){return t=e,void localStorage.setItem(ie,JSON.stringify(t));var t})),o.render(c.createElement(cn,{eig:t,floatFeatures:ue(r,t.default_fabric_feature),storedState$:r}),n),de();case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n.d(t,"startReact",(function(){return sn}))}}]);
//# sourceMappingURL=4.470ce7c9.chunk.js.map